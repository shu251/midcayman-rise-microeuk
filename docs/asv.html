<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mid-Cayman Rise analysis - 18S survey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Mid-Cayman Rise analysis</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./grazing.html">Grazing analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./asv.html" aria-current="page">Sequence analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sequence-qc.html">Sequence QC &amp; import</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#import-sequence-and-metadata" id="toc-import-sequence-and-metadata" class="nav-link active" data-scroll-target="#import-sequence-and-metadata"><span class="toc-section-number">1</span>  Import sequence and metadata</a>
  <ul class="collapse">
  <li><a href="#import-asv-r-objects" id="toc-import-asv-r-objects" class="nav-link" data-scroll-target="#import-asv-r-objects"><span class="toc-section-number">1.1</span>  Import ASV R objects</a></li>
  <li><a href="#factor---legendcolor-key" id="toc-factor---legendcolor-key" class="nav-link" data-scroll-target="#factor---legendcolor-key"><span class="toc-section-number">1.2</span>  Factor - legend/color key</a></li>
  </ul></li>
  <li><a href="#visualize-metadata" id="toc-visualize-metadata" class="nav-link" data-scroll-target="#visualize-metadata"><span class="toc-section-number">2</span>  Visualize metadata</a></li>
  <li><a href="#community-structure-diversity-at-von-damm-piccard" id="toc-community-structure-diversity-at-von-damm-piccard" class="nav-link" data-scroll-target="#community-structure-diversity-at-von-damm-piccard"><span class="toc-section-number">3</span>  Community structure &amp; diversity at Von Damm &amp; Piccard</a>
  <ul class="collapse">
  <li><a href="#cluster-analysis" id="toc-cluster-analysis" class="nav-link" data-scroll-target="#cluster-analysis"><span class="toc-section-number">3.1</span>  Cluster analysis</a></li>
  <li><a href="#cluster-analysis-with-grazing-assays" id="toc-cluster-analysis-with-grazing-assays" class="nav-link" data-scroll-target="#cluster-analysis-with-grazing-assays"><span class="toc-section-number">3.2</span>  Cluster analysis with grazing assays</a>
  <ul class="collapse">
  <li><a href="#pcoa-with-all-samples" id="toc-pcoa-with-all-samples" class="nav-link" data-scroll-target="#pcoa-with-all-samples">PCoA with all samples</a></li>
  <li><a href="#pcoa-with-in-situ-only" id="toc-pcoa-with-in-situ-only" class="nav-link" data-scroll-target="#pcoa-with-in-situ-only">PCoA with in situ only</a></li>
  </ul></li>
  <li><a href="#taxonomic-breakdown" id="toc-taxonomic-breakdown" class="nav-link" data-scroll-target="#taxonomic-breakdown"><span class="toc-section-number">3.3</span>  Taxonomic breakdown</a>
  <ul class="collapse">
  <li><a href="#dendrogram-with-bubble-plot" id="toc-dendrogram-with-bubble-plot" class="nav-link" data-scroll-target="#dendrogram-with-bubble-plot">Dendrogram with bubble plot</a></li>
  </ul></li>
  <li><a href="#shared-asvs" id="toc-shared-asvs" class="nav-link" data-scroll-target="#shared-asvs"><span class="toc-section-number">3.4</span>  Shared ASVs</a></li>
  <li><a href="#corncob" id="toc-corncob" class="nav-link" data-scroll-target="#corncob"><span class="toc-section-number">3.5</span>  Corncob</a>
  <ul class="collapse">
  <li><a href="#supergroup-corncob" id="toc-supergroup-corncob" class="nav-link" data-scroll-target="#supergroup-corncob">Supergroup corncob</a></li>
  <li><a href="#phylum-corncob-analysis" id="toc-phylum-corncob-analysis" class="nav-link" data-scroll-target="#phylum-corncob-analysis">Phylum corncob analysis</a></li>
  <li><a href="#class-corncob-analysis" id="toc-class-corncob-analysis" class="nav-link" data-scroll-target="#class-corncob-analysis">Class corncob analysis</a></li>
  <li><a href="#order-corncob" id="toc-order-corncob" class="nav-link" data-scroll-target="#order-corncob">Order corncob</a></li>
  <li><a href="#family-corncob" id="toc-family-corncob" class="nav-link" data-scroll-target="#family-corncob">Family corncob</a></li>
  <li><a href="#genus-corncob" id="toc-genus-corncob" class="nav-link" data-scroll-target="#genus-corncob">Genus corncob</a></li>
  <li><a href="#species-corncob" id="toc-species-corncob" class="nav-link" data-scroll-target="#species-corncob">Species corncob</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#compare-in-situ-and-tf-samples" id="toc-compare-in-situ-and-tf-samples" class="nav-link" data-scroll-target="#compare-in-situ-and-tf-samples"><span class="toc-section-number">4</span>  Compare in situ and Tf samples</a>
  <ul class="collapse">
  <li><a href="#clr-change" id="toc-clr-change" class="nav-link" data-scroll-target="#clr-change"><span class="toc-section-number">4.1</span>  CLR change</a></li>
  </ul></li>
  <li><a href="#tree" id="toc-tree" class="nav-link" data-scroll-target="#tree"><span class="toc-section-number">5</span>  Tree</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information"><span class="toc-section-number">6</span>  Session information</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">18S survey</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="import-sequence-and-metadata" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Import sequence and metadata</h1>
<p>Set up R environment</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(ape)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggupset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import previously sequenced and analyzed tag-sequence data. See https://shu251.github.io/microeuk-amplicon-survey/ for additional information.</p>
<section id="import-asv-r-objects" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="import-asv-r-objects"><span class="header-section-number">1.1</span> Import ASV R objects</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="factor---legendcolor-key" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="factor---legendcolor-key"><span class="header-section-number">1.2</span> Factor - legend/color key</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>, <span class="st">"Plume"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"LotsOShrimp"</span>, <span class="st">"X18"</span>, <span class="st">"OMT"</span>, <span class="st">"OldManTree"</span>, <span class="st">"Rav2"</span>, <span class="st">"MustardStand"</span>, <span class="st">"ShrimpHole"</span>, <span class="st">"WhiteCastle"</span>, <span class="st">"ArrowLoop"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>vent_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"Lots 'O Shrimp"</span>, <span class="st">"X-18"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Ravelin #2"</span>, <span class="st">"Mustard Stand"</span>, <span class="st">"Shrimp Hole"</span>, <span class="st">"White Castle"</span>, <span class="st">"Arrow Loop"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>site_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VD"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for VD and Piccard</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>site_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#418b84"</span>, <span class="st">"#943b36"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># site_colors</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent colors</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>vent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#c2bfc2"</span>,<span class="st">"#ebdac9"</span>, <span class="st">"#c02c5b"</span>, <span class="st">"#cfae20"</span>, <span class="st">"#86952c"</span>, <span class="st">"#a88fab"</span>, <span class="st">"#a88fab"</span>, <span class="st">"#70b2aa"</span>, <span class="st">"#8c906d"</span>, <span class="st">"#806fa2"</span>, <span class="st">"#8cabcf"</span>, <span class="st">"#609482"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vent_colors) <span class="ot">&lt;-</span> vent_fullname</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_colors) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Cooler colors for VD</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># c("#4e7d4b") green</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">#569c91 blue</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#ae8fbb purple</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#ce86ba a lighter purple</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">#31464a dark dark green</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">#8c906d grey green</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#bab446 yellow green</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#ebdac9 white - cream</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">#c2bfc2 grey</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Piccard</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">#c02c5b pink - red</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#d65a9e pink</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="do">##cfae20 yellow</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="visualize-metadata" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Visualize metadata</h1>
<p>Import environmental parameters and look at Mid-Cayman Rise sites.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>env_params <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="at">file =</span> <span class="st">"input-data/table_wenv.txt"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># env_params</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>subset_metadata <span class="ot">&lt;-</span> env_params <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VENT <span class="sc">!=</span> <span class="st">"Quakeplume"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SITE, VENT, SAMPLETYPE, RATE_min, EUK_ml, GRAZING_EFFECT_hr) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">RATE_min_avg =</span> <span class="fu">mean</span>(RATE_min),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">EUK_ml_avg =</span> <span class="fu">mean</span>(EUK_ml),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">GRAZING_EFFECT_hr_avg =</span> <span class="fu">mean</span>(GRAZING_EFFECT_hr)) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"_avg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>metadata_numeric <span class="ot">&lt;-</span> metadata_mcr <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VENT, SITE, SAMPLETYPE, DEPTH, TEMP, pH, PercSeawater, Mg, H2, H2S, CH4, ProkConc) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> DEPTH<span class="sc">:</span>ProkConc, <span class="at">values_to =</span> <span class="st">"VALUE_TMP"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(VALUE_TMP)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>VALUE_TMP) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(subset_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Code to make tile plot for environmental parameters, but may skip this.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tileplot_env &lt;- function(x){</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   metadata_numeric %&gt;% </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(name == x) %&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = name, y = VENT, fill = value)) +</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(color = "black") +</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(SITE + SAMPLETYPE ~ ., switch = "both", space = "free", scale = "free") + theme_linedraw() +</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme(axis.text.y = element_blank(),</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.text = element_blank(),</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.background = element_blank(),</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#           axis.ticks = element_blank(),</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.placement = "outside",</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.title = element_blank(),</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.position = "top",</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.text = element_text(size = 5),</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.background = element_blank(),</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.border = element_blank(),</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.grid = element_blank()) +</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     labs(x = "", y = "") +</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_fill_distiller(palette = "Reds", direction=2, na.value = "grey50")</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Optional plot, likely will not use.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_grid(</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("TEMP") + </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "YlOrRd", direction=2, na.value = "grey50") +</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(axis.text.y = element_text(color = "black", hjust = 1, vjust = 0), </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.text.y = element_text(color = "black", hjust = 0, vjust = 0), </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.placement = "outside"),</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("PercSeawater") + </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Blues", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("pH") + </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "YlGnBu", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("Mg") + </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  # endemic_env("NO3"),</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("H2") + </span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("CH4") + </span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("H2S") + </span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("ProkConc") + </span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("EUK_ml_avg") + </span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(axis.text.y = element_text(color = "black", hjust = 1, vjust = 0), </span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.text.y = element_text(color = "black", hjust = 0, vjust = 0), </span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.placement = "outside") +</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("GRAZING_EFFECT_hr_avg") + </span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#  nrow = 1,</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">#  rel_widths = c(4,1,1,1,1,1,1,1, 4, 1)</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="community-structure-diversity-at-von-damm-piccard" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Community structure &amp; diversity at Von Damm &amp; Piccard</h1>
<section id="cluster-analysis" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="cluster-analysis"><span class="header-section-number">3.1</span> Cluster analysis</h2>
<p>Ordination analysis and methods to look at whole protistan communities at MCR.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan); <span class="fu">library</span>(ggdendro); <span class="fu">library</span>(compositions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: permute</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is vegan 2.6-2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to compositions, a package for compositional data analysis.
Find an intro with "? compositions"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'compositions'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ape':

    balance</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    anova, cor, cov, dist, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    %*%, norm, scale, scale.default</code></pre>
</div>
</div>
</section>
<section id="cluster-analysis-with-grazing-assays" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="cluster-analysis-with-grazing-assays"><span class="header-section-number">3.2</span> Cluster analysis with grazing assays</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<p>Transform compositional data, center log ratio.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric)))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(logratio_mcr)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ?alr()</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ?ilr()</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(logratio_mcr)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>variance_logratio <span class="ot">&lt;-</span> (pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 21 rows [1, 2, 3, 4,
5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
</div>
<section id="pcoa-with-all-samples" class="level3">
<h3 class="anchored" data-anchor-id="pcoa-with-all-samples">PCoA with all samples</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(mcr_pca_pts$VENT)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># vent_ids</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># site_fullname</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE_ORDER, <span class="at">fill =</span> VENT_ORDER, <span class="at">alpha =</span> TYPE)) <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Dendrogram analysis</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?decostand()</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative abundance</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>rel_abun <span class="ot">&lt;-</span> <span class="fu">decostand</span>(asv_mcr_numeric, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"total"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster dendrogram (average hierarchical clustering)</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>cluster_mcr <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(rel_abun)), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>dendro <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(cluster_mcr)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>mcr_dendro <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(dendro, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">segment</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend)) <span class="sc">+</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">data =</span> <span class="fu">label</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dendro</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Dissimilarity"</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">14</span>), <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#252525"</span>), </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># svg('figs/SUPPLEMENTARY-dendrogram-wreps.svg', w = 10, h = 8)</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="pcoa-with-in-situ-only" class="level3">
<h3 class="anchored" data-anchor-id="pcoa-with-in-situ-only">PCoA with in situ only</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric_insitu <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>insitu_logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric_insitu)))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>insitu_pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(insitu_logratio_mcr)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>insitu_variance_logratio <span class="ot">&lt;-</span> (insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(insitu_variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points for only insitu samples</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(insitu_pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(insitu_pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 13 rows [1, 2, 3, 4,
5, 6, 7, 8, 9, 10, 11, 12, 13].</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE, <span class="at">fill =</span> VENT, <span class="at">alpha =</span> TYPE)) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="768"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep same sample colors to compare to cluster analysis with in situ and Tf samples.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="taxonomic-breakdown" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="taxonomic-breakdown"><span class="header-section-number">3.3</span> Taxonomic breakdown</h2>
<p>Try to pair with dendrogram</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>out_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcr_dendro<span class="sc">$</span>labels)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>mcr_sample_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(out_labels<span class="sc">$</span>label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span> </span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TOTAL_SEQ =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq),</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">REL_ABUN =</span> SUM<span class="sc">/</span>TOTAL_SEQ) <span class="sc">%&gt;%</span> </span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUPERGROUP, <span class="at">size =</span> REL_ABUN)) <span class="sc">+</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="fu">aes</span>(<span class="at">size =</span> REL_ABUN, <span class="at">fill =</span> SUPERGROUP, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(. ~ SITE, scales = "free", space = "free") +</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'Taxon'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 10924 rows [3, 10,
11, 12, 13, 14, 18, 19, 20, 21, 23, 27, 28, 30, 31, 32, 33, 34, 35, 38, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 6487 rows [1, 2,
4, 5, 6, 7, 8, 9, 15, 16, 17, 22, 24, 25, 26, 29, 36, 37, 48, 49, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'SUPERGROUP'. You can override using the `.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>bubble</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="1056"></p>
</div>
</div>
<section id="dendrogram-with-bubble-plot" class="level3">
<h3 class="anchored" data-anchor-id="dendrogram-with-bubble-plot">Dendrogram with bubble plot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_dendro_plot + bubble + patchwork::plot_layout(ncol = 2) + patchwork::plot_annotation(tag_levels = "a")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="shared-asvs" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="shared-asvs"><span class="header-section-number">3.4</span> Shared ASVs</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(asv_wtax_qc$SITE)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
  FeatureID SAMPLE value Taxon Conse…¹ SAMPL…² VENT  SITE  SAMPL…³ DEPTH SAMPL…⁴
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
1 00056209… 52_MC…     0 Euka…     0.8 "Picca… Lots… Picc… ""      ""    Incuba…
2 00056209… 53_MC…     0 Euka…     0.8 "Picca… Lots… Picc… ""      ""    Incuba…
3 00056209… 54_MC…     0 Euka…     0.8 "VonDa… Must… VonD… ""      ""    Incuba…
4 00056209… 55_MC…     0 Euka…     0.8 "VonDa… Shri… VonD… ""      ""    Incuba…
5 00056209… 57_MC…     0 Euka…     0.8 "Picca… Shri… Picc… ""      ""    Incuba…
6 00056209… 58_MC…     0 Euka…     0.8 "VonDa… Plume VonD… ""      ""    Incuba…
# … with 11 more variables: SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;,
#   pH &lt;chr&gt;, PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, and abbreviated variable names
#   ¹​Consensus, ²​SAMPLENAME, ³​SAMPLEID, ⁴​SAMPLETYPE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(TAX)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to generate upsetR plot with varied taxonomic levels.</p>
<p>Questions:</p>
<ul>
<li><p>How many ASVs are shared among vent sites within Von Damm and Piccard?</p></li>
<li><p>What about shared ASVs across each vent field?</p></li>
<li><p>Is there a taxonomic level that drives site-to-site or field-to-field community dissimilarity?</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># options for taxa: SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 5926 rows [5, 6, 7,
8, 9, 10, 11, 14, 15, 16, 17, 20, 21, 22, 24, 25, 26, 28, 29, 30, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 3451 rows [1, 2,
3, 4, 12, 13, 18, 19, 23, 27, 35, 44, 45, 46, 48, 49, 53, 54, 55, 56, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME', 'VENT'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 7678 rows [1, 2, 3,
4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SupergroupPhylum'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="1056"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to reduce noise and show sample type to vent ecosystem variability.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Taxon, SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 5926 rows [5, 6, 7,
8, 9, 10, 11, 14, 15, 16, 17, 20, 21, 22, 24, 25, 26, 28, 29, 30, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 3451 rows [1, 2,
3, 4, 12, 13, 18, 19, 23, 27, 35, 44, 45, 46, 48, 49, 53, 54, 55, 56, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME', 'VENT',
'SupergroupPhylum'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 7678 rows [1, 2, 3,
4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SupergroupPhylum', 'Taxon'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'SupergroupPhylum'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 300 rows containing non-finite values (stat_count).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<p>Example comparisons of shared taxonomic levels. <em>Explanation</em>: At ASV level, most ASVs are not shared across samples. So at other taxonomic categories, are these taxa also present or are there whole classes not present?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 10</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 15</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, SupergroupPhylum)</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(plotly)</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplotly(tmp)</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, Class) + theme(legend.position = "none")</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, Supergroup) + theme(legend.position = "none")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A better visualization may be a presence/absence across samples with a tile plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>make_tile_plot_pa <span class="ot">&lt;-</span> <span class="cf">function</span>(df, taxa_level, level0){ </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  taxa_select <span class="ot">&lt;-</span> <span class="fu">enquo</span>(taxa_level)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  taxa_select_higher <span class="ot">&lt;-</span> <span class="fu">enquo</span>(level0)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, <span class="sc">!!</span>taxa_select_higher, <span class="sc">!!</span>taxa_select) <span class="sc">%&gt;%</span> </span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, <span class="sc">!!</span>taxa_select_higher, <span class="sc">!!</span>taxa_select, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">PRESENT =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># remove NAs in taxa categories</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE, <span class="at">y =</span> <span class="sc">!!</span>taxa_select)) <span class="sc">+</span></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> PRESENT)) <span class="sc">+</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(SupergroupPhylum <span class="sc">~</span> SITE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>))</span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 10</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 20</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make_tile_plot_pa(asv_wtax_qc, "Class", "SupergroupPhylum")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Above plot addresses presence/absence of the families within major protistan supergroups across the Von Damm and Piccard vent, plume, and background samples.</p>
</blockquote>
</section>
<section id="corncob" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="corncob"><span class="header-section-number">3.5</span> Corncob</h2>
<p>Corncob analysis can be used to identify specific ASVs that may be enriched when we compare non-vent to vent samples.</p>
<p>Questions:</p>
<ul>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at Piccard?</p></li>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at Von Damm?</p></li>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at both sites?</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("bryandmartin/corncob")</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corncob); <span class="fu">library</span>(phyloseq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
</div>
<p>Explore data input for corncob</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># otu_table(physeq_mcr)[1:10, 1:3]</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(physeq_mcr)</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(physeq_mcr)[1:3, ]</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Designated vent vs. non-vent</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SAMPLETYPE_BIN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "non-vent" "vent"    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Designats Piccard vs. vondamm.</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SITE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Piccard" "VonDamm"</code></pre>
</div>
</div>
<p>Start by removing incubation samples for now. Subset to eukaryotes only and use phyloseq’s tax glom to summarize to Supergroup, Phylum, Class, Order, Genus, &amp; species.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tax_table</span>(physeq_mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Taxonomy Table:     [6 taxa by 8 taxonomic ranks]:
                                 Domain      Supergroup     Phylum            
0c7bdd7d35a3559db857584cecc4f5c9 "Eukaryota" "Opisthokonta" "Choanoflagellida"
7b0dd4c34fe16642ff23b7effa1bf1bd "Eukaryota" "Alveolata"    "Ciliophora"      
dc268dc3fdd431dc0de1fcc60de681f0 "Eukaryota" "Rhizaria"     "Cercozoa"        
08586d1dca4dda0f128d142b85379e0b "Eukaryota" "Apusozoa"     "Apusomonadidae"  
e3bed7480f3f3c95f0f4db2e03cee011 "Eukaryota" "Rhizaria"     "Radiolaria"      
44dcf603d76f712038c8b797beb1282f "Eukaryota" "Alveolata"    "Dinoflagellata"  
                                 Class                   
0c7bdd7d35a3559db857584cecc4f5c9 "Choanoflagellatea"     
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP"             
dc268dc3fdd431dc0de1fcc60de681f0 "Filosa-Thecofilosea"   
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1"
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea"            
44dcf603d76f712038c8b797beb1282f "Syndiniales"           
                                 Order                     
0c7bdd7d35a3559db857584cecc4f5c9 "Acanthoecida"            
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP_X"             
dc268dc3fdd431dc0de1fcc60de681f0 "Ventricleftida"          
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1_X"
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1"            
44dcf603d76f712038c8b797beb1282f "Dino-Group-IV"           
                                 Family                            
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D"          
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP_XX"                    
dc268dc3fdd431dc0de1fcc60de681f0 NA                                
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1_XX"       
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_X"                  
44dcf603d76f712038c8b797beb1282f "Dino-Group-IV-Hematodinium-Group"
                                 Genus                     
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D_X"
7b0dd4c34fe16642ff23b7effa1bf1bd NA                        
dc268dc3fdd431dc0de1fcc60de681f0 NA                        
08586d1dca4dda0f128d142b85379e0b NA                        
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_XX"         
44dcf603d76f712038c8b797beb1282f "Hematodinium"            
                                 Species                       
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D_X_sp."
7b0dd4c34fe16642ff23b7effa1bf1bd NA                            
dc268dc3fdd431dc0de1fcc60de681f0 NA                            
08586d1dca4dda0f128d142b85379e0b NA                            
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_XX_sp."         
44dcf603d76f712038c8b797beb1282f "Hematodinium_sp."            </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>mcr_super <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Supergroup"</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>mcr_phy <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Phylum"</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>mcr_class <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Class"</span>)</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>mcr_order <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Order"</span>)</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>mcr_fam <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Family"</span>)</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>mcr_genera <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Genus"</span>)</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>mcr_spp <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Species"</span>)</span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(mcr_order)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Differential tests in corncob</p>
<p>These tests work to see if taxa are differentially-abundant or variable across a given variable. In this study we have different taxonomic levels, are there more general or species-specific trends? We also have across sample types and site Below set up differential tests across sample types and site (and either or) at different taxonomic levels.</p>
<p>Function to perform specific differential tests across vent fields. Below use <strong>SITE_PICK</strong> parameter to choose between vent fields. Then use the df, to specify the taxonomic level.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>corncob_mcr <span class="ot">&lt;-</span> <span class="cf">function</span>(df_in){</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SAMPLETYPE+ SITE,</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SAMPLETYPE_BIN specifically compares vent to non-vent.</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  da_analysis_output <span class="ot">&lt;-</span> <span class="fu">differentialTest</span>(<span class="at">formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula_null =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula_null =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">test =</span> <span class="st">"Wald"</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> df_in,</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fdr_cutoff =</span> <span class="fl">0.05</span>)</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SITE,</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SITE,</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SITE,</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>  list_ofsig <span class="ot">&lt;-</span> <span class="fu">as.character</span>(da_analysis_output<span class="sc">$</span>significant_taxa)</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>  total_number <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ofsig)[<span class="dv">1</span>]</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>  sig_taxa_names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(df_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FEATURE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(FEATURE <span class="sc">%in%</span> list_ofsig) <span class="sc">%&gt;%</span> </span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"NUMBER"</span>)</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_number){</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>    out_0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(da_analysis_output<span class="sc">$</span>significant_models[[var]]<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">NUMBER =</span> <span class="fu">as.character</span>(var))</span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"extracted # "</span>,var, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"extracted_coef"</span>)){</span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> out_0 <span class="co"># create the final count table</span></span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extracted_coef, out_0)</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(out_0) <span class="co"># remove excess df</span></span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>  output_full <span class="ot">&lt;-</span> extracted_coef <span class="sc">%&gt;%</span> </span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"mu."</span>, variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sig_taxa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUMBER"</span> <span class="ot">=</span> <span class="st">"NUMBER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">VARIABLE =</span> <span class="fu">str_remove</span>(variable, <span class="st">"[:digit:]+"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variable) <span class="co">#%&gt;% </span></span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pivot_wider(names_from = VARIABLE, names_glue = "{VARIABLE}_{.value}", values_from = c(Estimate, Std..Error, t.value, Pr...t..))</span></span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(extracted_coef)</span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_full)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Define SITE_PICK</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>, <span class="st">"VonDamm"</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>picc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to visualize output from corncob</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>plot_corn <span class="ot">&lt;-</span> <span class="cf">function</span>(cob_out, LEVEL, TITLE){</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">enquo</span>(LEVEL)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  cob_out <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> level, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> TITLE)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="supergroup-corncob" class="level3">
<h3 class="anchored" data-anchor-id="supergroup-corncob">Supergroup corncob</h3>
<p>What main supergroups are enriched at MCR?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # vd</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% vd))</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% picc))</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_super <span class="sc">%&gt;%</span> </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd %&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "VD supergroup")</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc %&gt;%</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "piccard supergroup")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot supergroup enrichment</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Supergroup, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR supergroup"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="phylum-corncob-analysis" class="level3">
<h3 class="anchored" data-anchor-id="phylum-corncob-analysis">Phylum corncob analysis</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_phy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Phylum, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Phylum), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR Phylum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="class-corncob-analysis" class="level3">
<h3 class="anchored" data-anchor-id="class-corncob-analysis">Class corncob analysis</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_class <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="sc">%&gt;%</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Class, <span class="fu">c</span>(Phylum, Class), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Class, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Class level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<blockquote class="blockquote">
<p>Class level looks pretty good. Keep this one. Looks at major taxonomic groups that were more enriched at vents? Work on the language here. Repeat vent vs.&nbsp;plume at ASV level. ID some of the core ASVs that can help elaborate on what we see above (table in supplementary)</p>
</blockquote>
<blockquote class="blockquote">
<p><em>Interpretation</em> :</p>
</blockquote>
</section>
<section id="order-corncob" class="level3">
<h3 class="anchored" data-anchor-id="order-corncob">Order corncob</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_order)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 
extracted #  17 
extracted #  18 
extracted #  19 
extracted #  20 
extracted #  21 
extracted #  22 
extracted #  23 
extracted #  24 
extracted #  25 
extracted #  26 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Order, <span class="fu">c</span>(Phylum, Class, Order), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Order, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Order level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="960"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?geom_errorbar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="family-corncob" class="level3">
<h3 class="anchored" data-anchor-id="family-corncob">Family corncob</h3>
<p>Plan to pairing with tree below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_fam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 
extracted #  17 
extracted #  18 
extracted #  19 
extracted #  20 
extracted #  21 
extracted #  22 
extracted #  23 
extracted #  24 
extracted #  25 
extracted #  26 
extracted #  27 
extracted #  28 
extracted #  29 
extracted #  30 
extracted #  31 
extracted #  32 
extracted #  33 
extracted #  34 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Family, <span class="fu">c</span>(Class, Order, Family), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Family, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Phylum <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Family level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="genus-corncob" class="level3">
<h3 class="anchored" data-anchor-id="genus-corncob">Genus corncob</h3>
<p>Plan to pairing with tree below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_genera)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Genus, <span class="fu">c</span>(Phylum, Genus), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Genus, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Genus level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="species-corncob" class="level3">
<h3 class="anchored" data-anchor-id="species-corncob">Species corncob</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_spp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="sc">%&gt;%</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Species, <span class="fu">c</span>(Genus, Species), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Species, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Order <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Species level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
</section>
<section id="compare-in-situ-and-tf-samples" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Compare in situ and Tf samples</h1>
<p>Examine in situ to T final samples for presence/absence.</p>
<blockquote class="blockquote">
<p>Repeat corncob analysis. Add in situ vs.&nbsp;incubation and run corncob on incubation coefficient. Do this at class and ASV level to ID those ASVs that are specifically positively differentially variable in the incubation samples compared to the in situ.</p>
</blockquote>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
  FeatureID SAMPLE value Taxon Conse…¹ SAMPL…² VENT  SITE  SAMPL…³ DEPTH SAMPL…⁴
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
1 00056209… 52_MC…     0 Euka…     0.8 "Picca… Lots… Picc… ""      ""    Incuba…
2 00056209… 53_MC…     0 Euka…     0.8 "Picca… Lots… Picc… ""      ""    Incuba…
3 00056209… 54_MC…     0 Euka…     0.8 "VonDa… Must… VonD… ""      ""    Incuba…
4 00056209… 55_MC…     0 Euka…     0.8 "VonDa… Shri… VonD… ""      ""    Incuba…
5 00056209… 57_MC…     0 Euka…     0.8 "Picca… Shri… Picc… ""      ""    Incuba…
6 00056209… 58_MC…     0 Euka…     0.8 "VonDa… Plume VonD… ""      ""    Incuba…
# … with 11 more variables: SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;,
#   pH &lt;chr&gt;, PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, and abbreviated variable names
#   ¹​Consensus, ²​SAMPLENAME, ³​SAMPLEID, ⁴​SAMPLETYPE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View(asv_wtax_qc)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Calculate percent change from in situ to Tf for all grazing experiments</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract taxa information</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>taxa_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(TAX)) <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>perc_change <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SAMPLETYPE, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ASSAY =</span> <span class="fu">case_when</span>(</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Tf"</span>,</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"insitu"</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SAMPLETYPE) <span class="sc">%&gt;%</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> ASSAY, <span class="at">values_from =</span> avg_seq, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only ASVs present in both in situ and incubation experiments.</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># remove NAs</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(insitu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> Tf <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove if 1 or the other are zero</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(insitu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Tf <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">seq_change =</span> Tf <span class="sc">-</span> insitu) <span class="sc">%&gt;%</span> </span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">category_change =</span> <span class="fu">case_when</span>(</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Decrease"</span>,</span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Increase"</span>,</span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No Change"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add in supergroup information</span></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(taxa_table, FeatureID, Domain<span class="sc">:</span>Species) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT', 'SAMPLETYPE'. You can
override using the `.groups` argument.
Joining, by = "FeatureID"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(perc_change<span class="sc">$</span>category_change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Decrease  Increase No Change 
     1073      1291        28 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(perc_change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 16
  SITE    VENT  Featu…¹ insitu    Tf seq_c…² categ…³ Domain Super…⁴ Phylum Class
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
1 Piccard Lots… 006f56…     52  10.5   -41.5 Decrea… Eukar… Strame… Ochro… Chry…
2 Piccard Lots… 0197a4…     52  11     -41   Decrea… Eukar… Strame… Sagen… MAST…
3 Piccard Lots… 01a71e…    211 135     -76   Decrea… Eukar… Strame… Pseud… MAST…
4 Piccard Lots… 01d1a4…    838 374.   -464.  Decrea… Eukar… Rhizar… Radio… RAD-B
5 Piccard Lots… 020295…    189 129     -60   Decrea… Eukar… Rhizar… Radio… RAD-B
6 Piccard Lots… 021b3d…      4  16      12   Increa… Eukar… Alveol… Cilio… Phyl…
# … with 5 more variables: Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;,
#   Species &lt;chr&gt;, SUPERGROUP &lt;chr&gt;, and abbreviated variable names ¹​FeatureID,
#   ²​seq_change, ³​category_change, ⁴​Supergroup</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(perc_change[1:2])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Of the ASVs that appeared in both in situ and Tf for each grazing experiment, 1073 decreased in sequence relative abundance, and over 1200 increased. Only 28 showed no change in sequence relative abundance.</p>
<p>Formatted table to show sequence increase vs.&nbsp;decrease PER ASV from insitu to experiment Tf.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>all_taxa_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ciliophora"</span>, <span class="st">"Alveolata-Dinoflagellata"</span>, <span class="st">"Protalveolata"</span>, <span class="st">"Other Alveolata"</span>, <span class="st">"Amoebozoa"</span>, <span class="st">"Apusozoa"</span>, <span class="st">"Excavata"</span>, <span class="st">"Hacrobia"</span>, <span class="st">"Archaeplastida"</span>, <span class="st">"Rhizaria"</span>, <span class="st">"Rhizaria-Radiolaria"</span>, <span class="st">"Rhizaria-Cercozoa"</span>, <span class="st">"Stramenopiles"</span>, <span class="st">"Stramenopiles-Opalozoa"</span>, <span class="st">"Stramenopiles-Sagenista"</span>, <span class="st">"Stramenopiles-Ochrophyta"</span>, <span class="st">"Opisthokonta"</span>, <span class="st">"Unknown Eukaryota"</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co"># length(all_taxa_order)</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>,<span class="st">"#cc4c02"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#238b45"</span>, <span class="st">"#c6dbef"</span>, <span class="st">"#99d8c9"</span>,<span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#f0f0f0"</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co"># length(all_taxa_color)</span></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, category_change, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_change =</span> <span class="fu">sum</span>(seq_change),</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">asv_total =</span> <span class="fu">n_distinct</span>(FeatureID)) <span class="sc">%&gt;%</span> </span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP_ORDER =</span> <span class="fu">factor</span>(SUPERGROUP, <span class="at">levels =</span> all_taxa_order),</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(SUPERGROUP_ORDER = factor(SUPERGROUP, levels = all_taxa_order)) %&gt;% </span></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sum_change, <span class="at">y =</span> VENT_ORDER, <span class="at">fill =</span> SUPERGROUP_ORDER)) <span class="sc">+</span></span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(limits = c(-15000, 150000)) +</span></span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color) <span class="sc">+</span></span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(SITE_ORER ~ ., space = "free", scales = "free") +</span></span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb111-22"><a href="#cb111-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb111-23"><a href="#cb111-23" aria-hidden="true" tabindex="-1"></a>          <span class="co"># strip.text = element_blank(),</span></span>
<span id="cb111-24"><a href="#cb111-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-25"><a href="#cb111-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-26"><a href="#cb111-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb111-27"><a href="#cb111-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-28"><a href="#cb111-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb111-29"><a href="#cb111-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb111-30"><a href="#cb111-30" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.background = element_blank(),</span></span>
<span id="cb111-31"><a href="#cb111-31" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb111-32"><a href="#cb111-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb111-33"><a href="#cb111-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sequence Decrease           Sequence Increase"</span>, <span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT', 'category_change'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="864"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_bar(filter(category_change == "Increase"), stat = "identity") </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># str(perc_change)</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, category_change, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_change =</span> <span class="fu">sum</span>(seq_change),</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">asv_total =</span> <span class="fu">n_distinct</span>(FeatureID)) <span class="sc">%&gt;%</span> </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">asv_int =</span> <span class="fu">as.numeric</span>(asv_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">asv_change =</span> <span class="fu">case_when</span>(</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>           category_change <span class="sc">==</span> <span class="st">"Decrease"</span> <span class="sc">~</span> (<span class="dv">0</span> <span class="sc">-</span> asv_int),</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> asv_int</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span> </span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP_ORDER =</span> <span class="fu">factor</span>(SUPERGROUP, <span class="at">levels =</span> all_taxa_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> asv_change, <span class="at">y =</span> VENT, <span class="at">fill =</span> SUPERGROUP_ORDER)) <span class="sc">+</span></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">350</span>, <span class="dv">350</span>)) <span class="sc">+</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color) <span class="sc">+</span></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(SITE <span class="sc">~</span> ., <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true" tabindex="-1"></a>          <span class="co"># strip.text = element_blank(),</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.background = element_blank(),</span></span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"ASV change"</span>, <span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT', 'category_change'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SITE, VENT, SUPERGROUP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,392 × 3
   SITE    VENT        SUPERGROUP              
   &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;                   
 1 Piccard LotsOShrimp Stramenopiles-Ochrophyta
 2 Piccard LotsOShrimp Stramenopiles-Sagenista 
 3 Piccard LotsOShrimp Stramenopiles           
 4 Piccard LotsOShrimp Rhizaria-Radiolaria     
 5 Piccard LotsOShrimp Rhizaria-Radiolaria     
 6 Piccard LotsOShrimp Alveolata-Ciliophora    
 7 Piccard LotsOShrimp Stramenopiles-Ochrophyta
 8 Piccard LotsOShrimp Stramenopiles-Ochrophyta
 9 Piccard LotsOShrimp Alveolata-Ciliophora    
10 Piccard LotsOShrimp Alveolata-Ciliophora    
# … with 2,382 more rows</code></pre>
</div>
</div>
<section id="clr-change" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="clr-change"><span class="header-section-number">4.1</span> CLR change</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>numeric_tmp <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unite(TAX, Taxon, FeatureID, sep = "__") %&gt;% </span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME'. You can override
using the `.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(numeric_tmp))))</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="do">## From above </span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(logratio_mcr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                 VonDamm.Vent.2020.Rav2.
0016c92095329cf769d2fc9f5a0b826c               0.4824678
0024760a130d14a29d63bb07f082733e               0.0000000
00508684a4c673b882a5d186733b3271              -1.7147568
0052bc3663c02b5375d7472fdcb21cd0               0.0000000
006c58bbe54f99c39fe7f3920319e5a8               0.0000000
006df5d12667ab19d5ebbf6f0a786297               0.0000000
                                 VonDamm.Incubation.2020.X18.
0016c92095329cf769d2fc9f5a0b826c                    0.0000000
0024760a130d14a29d63bb07f082733e                   -0.8797993
00508684a4c673b882a5d186733b3271                    0.0000000
0052bc3663c02b5375d7472fdcb21cd0                    0.0000000
006c58bbe54f99c39fe7f3920319e5a8                    0.0000000
006df5d12667ab19d5ebbf6f0a786297                    0.0000000
                                 VonDamm.Plume.2020.Plume.
0016c92095329cf769d2fc9f5a0b826c                  0.000000
0024760a130d14a29d63bb07f082733e                  0.000000
00508684a4c673b882a5d186733b3271                  0.000000
0052bc3663c02b5375d7472fdcb21cd0                 -1.998135
006c58bbe54f99c39fe7f3920319e5a8                 -1.528132
006df5d12667ab19d5ebbf6f0a786297                  0.000000
                                 VonDamm.Vent.2020.OldManTree.
0016c92095329cf769d2fc9f5a0b826c                     0.0000000
0024760a130d14a29d63bb07f082733e                     0.0000000
00508684a4c673b882a5d186733b3271                     0.0000000
0052bc3663c02b5375d7472fdcb21cd0                     0.0000000
006c58bbe54f99c39fe7f3920319e5a8                     0.0000000
006df5d12667ab19d5ebbf6f0a786297                    -0.8247801
                                 Piccard.Incubation.2020.LotsOShrimp.
0016c92095329cf769d2fc9f5a0b826c                                    0
0024760a130d14a29d63bb07f082733e                                    0
00508684a4c673b882a5d186733b3271                                    0
0052bc3663c02b5375d7472fdcb21cd0                                    0
006c58bbe54f99c39fe7f3920319e5a8                                    0
006df5d12667ab19d5ebbf6f0a786297                                    0
                                 Piccard.Vent.2020.LotsOShrimp.
0016c92095329cf769d2fc9f5a0b826c                              0
0024760a130d14a29d63bb07f082733e                              0
00508684a4c673b882a5d186733b3271                              0
0052bc3663c02b5375d7472fdcb21cd0                              0
006c58bbe54f99c39fe7f3920319e5a8                              0
006df5d12667ab19d5ebbf6f0a786297                              0
                                 Piccard.Vent.2020.Shrimpocalypse.
0016c92095329cf769d2fc9f5a0b826c                                 0
0024760a130d14a29d63bb07f082733e                                 0
00508684a4c673b882a5d186733b3271                                 0
0052bc3663c02b5375d7472fdcb21cd0                                 0
006c58bbe54f99c39fe7f3920319e5a8                                 0
006df5d12667ab19d5ebbf6f0a786297                                 0
                                 VonDamm.Incubation.2020.MustardStand.
0016c92095329cf769d2fc9f5a0b826c                                     0
0024760a130d14a29d63bb07f082733e                                     0
00508684a4c673b882a5d186733b3271                                     0
0052bc3663c02b5375d7472fdcb21cd0                                     0
006c58bbe54f99c39fe7f3920319e5a8                                     0
006df5d12667ab19d5ebbf6f0a786297                                     0
                                 VonDamm.Incubation.2020.Rav2.
0016c92095329cf769d2fc9f5a0b826c                             0
0024760a130d14a29d63bb07f082733e                             0
00508684a4c673b882a5d186733b3271                             0
0052bc3663c02b5375d7472fdcb21cd0                             0
006c58bbe54f99c39fe7f3920319e5a8                             0
006df5d12667ab19d5ebbf6f0a786297                             0
                                 VonDamm.Vent.2020.ArrowLoop.
0016c92095329cf769d2fc9f5a0b826c                            0
0024760a130d14a29d63bb07f082733e                            0
00508684a4c673b882a5d186733b3271                            0
0052bc3663c02b5375d7472fdcb21cd0                            0
006c58bbe54f99c39fe7f3920319e5a8                            0
006df5d12667ab19d5ebbf6f0a786297                            0
                                 Piccard.Incubation.2020.Shrimpocalypse.
0016c92095329cf769d2fc9f5a0b826c                                       0
0024760a130d14a29d63bb07f082733e                                       0
00508684a4c673b882a5d186733b3271                                       0
0052bc3663c02b5375d7472fdcb21cd0                                       0
006c58bbe54f99c39fe7f3920319e5a8                                       0
006df5d12667ab19d5ebbf6f0a786297                                       0
                                 VonDamm.Vent.2020.ShrimpHole.
0016c92095329cf769d2fc9f5a0b826c                             0
0024760a130d14a29d63bb07f082733e                             0
00508684a4c673b882a5d186733b3271                             0
0052bc3663c02b5375d7472fdcb21cd0                             0
006c58bbe54f99c39fe7f3920319e5a8                             0
006df5d12667ab19d5ebbf6f0a786297                             0
                                 VonDamm.Vent.2020.X18.
0016c92095329cf769d2fc9f5a0b826c                      0
0024760a130d14a29d63bb07f082733e                      0
00508684a4c673b882a5d186733b3271                      0
0052bc3663c02b5375d7472fdcb21cd0                      0
006c58bbe54f99c39fe7f3920319e5a8                      0
006df5d12667ab19d5ebbf6f0a786297                      0
                                 Piccard.Background.2020.BSW.
0016c92095329cf769d2fc9f5a0b826c                            0
0024760a130d14a29d63bb07f082733e                            0
00508684a4c673b882a5d186733b3271                            0
0052bc3663c02b5375d7472fdcb21cd0                            0
006c58bbe54f99c39fe7f3920319e5a8                            0
006df5d12667ab19d5ebbf6f0a786297                            0
                                 VonDamm.Incubation.2020.Plume.
0016c92095329cf769d2fc9f5a0b826c                              0
0024760a130d14a29d63bb07f082733e                              0
00508684a4c673b882a5d186733b3271                              0
0052bc3663c02b5375d7472fdcb21cd0                              0
006c58bbe54f99c39fe7f3920319e5a8                              0
006df5d12667ab19d5ebbf6f0a786297                              0
                                 VonDamm.Incubation.2020.ShrimpHole.
0016c92095329cf769d2fc9f5a0b826c                                   0
0024760a130d14a29d63bb07f082733e                                   0
00508684a4c673b882a5d186733b3271                                   0
0052bc3663c02b5375d7472fdcb21cd0                                   0
006c58bbe54f99c39fe7f3920319e5a8                                   0
006df5d12667ab19d5ebbf6f0a786297                                   0
                                 VonDamm.Background.2020.BSW.
0016c92095329cf769d2fc9f5a0b826c                            0
0024760a130d14a29d63bb07f082733e                            0
00508684a4c673b882a5d186733b3271                            0
0052bc3663c02b5375d7472fdcb21cd0                            0
006c58bbe54f99c39fe7f3920319e5a8                            0
006df5d12667ab19d5ebbf6f0a786297                            0
                                 VonDamm.Incubation.2020.BSW.
0016c92095329cf769d2fc9f5a0b826c                            0
0024760a130d14a29d63bb07f082733e                            0
00508684a4c673b882a5d186733b3271                            0
0052bc3663c02b5375d7472fdcb21cd0                            0
006c58bbe54f99c39fe7f3920319e5a8                            0
006df5d12667ab19d5ebbf6f0a786297                            0
                                 Piccard.Plume.2020.Plume.
0016c92095329cf769d2fc9f5a0b826c                         0
0024760a130d14a29d63bb07f082733e                         0
00508684a4c673b882a5d186733b3271                         0
0052bc3663c02b5375d7472fdcb21cd0                         0
006c58bbe54f99c39fe7f3920319e5a8                         0
006df5d12667ab19d5ebbf6f0a786297                         0
                                 VonDamm.Vent.2020.WhiteCastle.
0016c92095329cf769d2fc9f5a0b826c                              0
0024760a130d14a29d63bb07f082733e                              0
00508684a4c673b882a5d186733b3271                              0
0052bc3663c02b5375d7472fdcb21cd0                              0
006c58bbe54f99c39fe7f3920319e5a8                              0
006df5d12667ab19d5ebbf6f0a786297                              0
                                 VonDamm.Vent.2020.MustardStand.
0016c92095329cf769d2fc9f5a0b826c                               0
0024760a130d14a29d63bb07f082733e                               0
00508684a4c673b882a5d186733b3271                               0
0052bc3663c02b5375d7472fdcb21cd0                               0
006c58bbe54f99c39fe7f3920319e5a8                               0
006df5d12667ab19d5ebbf6f0a786297                               0</code></pre>
</div>
</div>
<p>Reformat to generate dot plot</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> logratio_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>((<span class="fu">starts_with</span>(<span class="st">"VonDamm.Incubation"</span>) <span class="sc">|</span> <span class="fu">starts_with</span>(<span class="st">"Piccard.Incubation"</span>)), <span class="at">names_to =</span> <span class="st">"TF"</span>, <span class="at">values_to =</span> <span class="st">"tf_clr"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>((<span class="fu">starts_with</span>(<span class="st">"VonDamm."</span>) <span class="sc">|</span> <span class="fu">starts_with</span>(<span class="st">"Piccard."</span>)), <span class="at">names_to =</span> <span class="st">"IN SITU"</span>, <span class="at">values_to =</span> <span class="st">"insitu_clr"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(taxa_table, FeatureID, Domain<span class="sc">:</span>Species) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(TF, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"TYPE_TF"</span>, <span class="st">"VENT_TF"</span>), <span class="at">sep =</span> <span class="st">".2020."</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="st">`</span><span class="at">IN SITU</span><span class="st">`</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"TYPE_insitu"</span>, <span class="st">"VENT_insitu"</span>), <span class="at">sep =</span> <span class="st">".2020."</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VENT_insitu <span class="sc">==</span> VENT_TF) <span class="sc">%&gt;%</span> </span>
<span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(TYPE_TF, <span class="at">into=</span><span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"TF"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>) <span class="sc">%&gt;%</span> <span class="fu">separate</span>(TYPE_insitu, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "FeatureID"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?pivot_longer</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tmp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 18
  FeatureID    VENT_TF TF    tf_clr IN SI…¹ VENT_…² SITE  SAMPL…³ insit…⁴ Domain
  &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; 
1 0016c920953… X18.    Incu…      0 VonDam… X18.    VonD… Vent      0     Eukar…
2 0016c920953… Mustar… Incu…      0 VonDam… Mustar… VonD… Vent      0     Eukar…
3 0016c920953… Rav2.   Incu…      0 VonDam… Rav2.   VonD… Vent      0.482 Eukar…
4 0016c920953… Plume.  Incu…      0 VonDam… Plume.  VonD… Plume     0     Eukar…
5 0016c920953… Plume.  Incu…      0 Piccar… Plume.  Picc… Plume     0     Eukar…
6 0016c920953… Shrimp… Incu…      0 VonDam… Shrimp… VonD… Vent      0     Eukar…
# … with 8 more variables: Supergroup &lt;chr&gt;, Phylum &lt;chr&gt;, Class &lt;chr&gt;,
#   Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;, Species &lt;chr&gt;, SUPERGROUP &lt;chr&gt;,
#   and abbreviated variable names ¹​`IN SITU`, ²​VENT_insitu, ³​SAMPLETYPE,
#   ⁴​insitu_clr</code></pre>
</div>
</div>
<p>Try x by y comparison.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="sc">%&gt;%</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tf_clr <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(insitu_clr <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> insitu_clr, <span class="at">y =</span> tf_clr, <span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(VENT_insitu <span class="sc">~</span> SUPERGROUP) <span class="sc">+</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">8</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>TO DO: Make table with total starting ASVs, number that were shared, and final in the Tf. Alluvial plots? from T0 to Tf by supergroup? Then more detailed plots like the above can be in supplemental?</p>
</section>
</section>
<section id="tree" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Tree</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>What is relatedness between piccard and von damm ciliate communities? First try at</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(tax_table(physeq_mcr))</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_ciliate &lt;- subset_taxa(physeq_mcr, Phylum == "Ciliophora") %&gt;% </span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   subset_samples(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   tax_glom(taxrank="Species")</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_ciliate</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # head(tax_table(mcr_ciliate))</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # subset_ciliate &lt;- prune_samples(sample_sums(mcr_ciliate) &gt; 100)</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co"># phy_tree(mcr_ciliate)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bug in phyloseq requires update with dev version on github:</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library("devtools")</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install_github("joey711/phyloseq")</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(phyloseq)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_tree(clean, </span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co">#           color = "SITE",</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">#           label.tips = "Species", </span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">#           shape = "SAMPLETYPE", size = "abundance", base.spacing = 0.06)</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ?plot_tree</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="session-information" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Session information</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.1 (2022-06-23)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur ... 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] corncob_0.3.0      compositions_2.0-4 ggdendro_0.1.23    vegan_2.6-2       
 [5] lattice_0.20-45    permute_0.9-7      ggupset_0.3.0      ape_5.6-2         
 [9] phyloseq_1.41.1    forcats_0.5.2      stringr_1.4.1      dplyr_1.0.10      
[13] purrr_0.3.5        readr_2.1.2        tidyr_1.2.1        tibble_3.1.8      
[17] ggplot2_3.3.6      tidyverse_1.3.2   

loaded via a namespace (and not attached):
  [1] VGAM_1.1-7               googledrive_2.0.0        colorspace_2.0-3        
  [4] ellipsis_0.3.2           XVector_0.36.0           fs_1.5.2                
  [7] rstudioapi_0.14          farver_2.1.1             fansi_1.0.3             
 [10] lubridate_1.8.0          xml2_1.3.3               codetools_0.2-18        
 [13] splines_4.2.1            robustbase_0.95-0        knitr_1.40              
 [16] ade4_1.7-19              jsonlite_1.8.0           broom_1.0.1             
 [19] cluster_2.1.4            dbplyr_2.2.1             compiler_4.2.1          
 [22] httr_1.4.4               backports_1.4.1          assertthat_0.2.1        
 [25] Matrix_1.5-1             fastmap_1.1.0            gargle_1.2.1            
 [28] cli_3.4.1                htmltools_0.5.3          tools_4.2.1             
 [31] igraph_1.3.5             ROI.plugin.lpsolve_1.0-1 gtable_0.3.1            
 [34] glue_1.6.2               GenomeInfoDbData_1.2.8   reshape2_1.4.4          
 [37] Rcpp_1.0.9               slam_0.1-50              Biobase_2.56.0          
 [40] cellranger_1.1.0         vctrs_0.5.0              Biostrings_2.64.1       
 [43] rhdf5filters_1.8.0       multtest_2.52.0          nlme_3.1-159            
 [46] iterators_1.0.14         tensorA_0.36.2           xfun_0.33               
 [49] trust_0.1-8              rvest_1.0.3              lifecycle_1.0.3         
 [52] googlesheets4_1.0.1      ROI_1.0-0                DEoptimR_1.0-11         
 [55] zlibbioc_1.42.0          MASS_7.3-58.1            scales_1.2.1            
 [58] hms_1.1.2                parallel_4.2.1           biomformat_1.24.0       
 [61] rhdf5_2.40.0             yaml_2.3.5               stringi_1.7.8           
 [64] S4Vectors_0.34.0         foreach_1.5.2            BiocGenerics_0.42.0     
 [67] detectseparation_0.3     GenomeInfoDb_1.32.4      rlang_1.0.6             
 [70] pkgconfig_2.0.3          bitops_1.0-7             lpSolveAPI_5.5.2.0-17.9 
 [73] evaluate_0.16            Rhdf5lib_1.18.2          htmlwidgets_1.5.4       
 [76] labeling_0.4.2           tidyselect_1.2.0         plyr_1.8.7              
 [79] magrittr_2.0.3           R6_2.5.1                 IRanges_2.30.1          
 [82] generics_0.1.3           DBI_1.1.3                pillar_1.8.1            
 [85] haven_2.5.1              withr_2.5.0              mgcv_1.8-40             
 [88] survival_3.4-0           RCurl_1.98-1.8           bayesm_3.1-4            
 [91] modelr_0.1.9             crayon_1.5.2             utf8_1.2.2              
 [94] tzdb_0.3.0               rmarkdown_2.16           grid_4.2.1              
 [97] readxl_1.4.1             data.table_1.14.2        reprex_2.0.2            
[100] digest_0.6.30            numDeriv_2016.8-1.1      stats4_4.2.1            
[103] munsell_0.5.0            registry_0.5-1          </code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb134" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "18S survey"</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 2</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Import sequence and metadata</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>Set up R environment</span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(ape)</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggupset)</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>Import previously sequenced and analyzed tag-sequence data. See https://shu251.github.io/microeuk-amplicon-survey/ for additional information.</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import ASV R objects</span></span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> T)</span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Factor - legend/color key</span></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>, <span class="st">"Plume"</span>)</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"LotsOShrimp"</span>, <span class="st">"X18"</span>, <span class="st">"OMT"</span>, <span class="st">"OldManTree"</span>, <span class="st">"Rav2"</span>, <span class="st">"MustardStand"</span>, <span class="st">"ShrimpHole"</span>, <span class="st">"WhiteCastle"</span>, <span class="st">"ArrowLoop"</span>)</span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>vent_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"Lots 'O Shrimp"</span>, <span class="st">"X-18"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Ravelin #2"</span>, <span class="st">"Mustard Stand"</span>, <span class="st">"Shrimp Hole"</span>, <span class="st">"White Castle"</span>, <span class="st">"Arrow Loop"</span>)</span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>site_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VD"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for VD and Piccard</span></span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>site_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#418b84"</span>, <span class="st">"#943b36"</span>)</span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a><span class="co"># site_colors</span></span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent colors</span></span>
<span id="cb134-56"><a href="#cb134-56" aria-hidden="true" tabindex="-1"></a>vent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#c2bfc2"</span>,<span class="st">"#ebdac9"</span>, <span class="st">"#c02c5b"</span>, <span class="st">"#cfae20"</span>, <span class="st">"#86952c"</span>, <span class="st">"#a88fab"</span>, <span class="st">"#a88fab"</span>, <span class="st">"#70b2aa"</span>, <span class="st">"#8c906d"</span>, <span class="st">"#806fa2"</span>, <span class="st">"#8cabcf"</span>, <span class="st">"#609482"</span>)</span>
<span id="cb134-57"><a href="#cb134-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-58"><a href="#cb134-58" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vent_colors) <span class="ot">&lt;-</span> vent_fullname</span>
<span id="cb134-59"><a href="#cb134-59" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_colors) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb134-60"><a href="#cb134-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Cooler colors for VD</span></span>
<span id="cb134-61"><a href="#cb134-61" aria-hidden="true" tabindex="-1"></a><span class="co"># c("#4e7d4b") green</span></span>
<span id="cb134-62"><a href="#cb134-62" aria-hidden="true" tabindex="-1"></a><span class="co">#569c91 blue</span></span>
<span id="cb134-63"><a href="#cb134-63" aria-hidden="true" tabindex="-1"></a><span class="co">#ae8fbb purple</span></span>
<span id="cb134-64"><a href="#cb134-64" aria-hidden="true" tabindex="-1"></a><span class="co">#ce86ba a lighter purple</span></span>
<span id="cb134-65"><a href="#cb134-65" aria-hidden="true" tabindex="-1"></a><span class="co">#31464a dark dark green</span></span>
<span id="cb134-66"><a href="#cb134-66" aria-hidden="true" tabindex="-1"></a><span class="co">#8c906d grey green</span></span>
<span id="cb134-67"><a href="#cb134-67" aria-hidden="true" tabindex="-1"></a><span class="co">#bab446 yellow green</span></span>
<span id="cb134-68"><a href="#cb134-68" aria-hidden="true" tabindex="-1"></a><span class="co">#ebdac9 white - cream</span></span>
<span id="cb134-69"><a href="#cb134-69" aria-hidden="true" tabindex="-1"></a><span class="co">#c2bfc2 grey</span></span>
<span id="cb134-70"><a href="#cb134-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Piccard</span></span>
<span id="cb134-71"><a href="#cb134-71" aria-hidden="true" tabindex="-1"></a><span class="co">#c02c5b pink - red</span></span>
<span id="cb134-72"><a href="#cb134-72" aria-hidden="true" tabindex="-1"></a><span class="co">#d65a9e pink</span></span>
<span id="cb134-73"><a href="#cb134-73" aria-hidden="true" tabindex="-1"></a><span class="do">##cfae20 yellow</span></span>
<span id="cb134-74"><a href="#cb134-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-75"><a href="#cb134-75" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb134-76"><a href="#cb134-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-77"><a href="#cb134-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-78"><a href="#cb134-78" aria-hidden="true" tabindex="-1"></a><span class="fu"># Visualize metadata</span></span>
<span id="cb134-79"><a href="#cb134-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-80"><a href="#cb134-80" aria-hidden="true" tabindex="-1"></a>Import environmental parameters and look at Mid-Cayman Rise sites.</span>
<span id="cb134-81"><a href="#cb134-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-84"><a href="#cb134-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-85"><a href="#cb134-85" aria-hidden="true" tabindex="-1"></a>env_params <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="at">file =</span> <span class="st">"input-data/table_wenv.txt"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb134-86"><a href="#cb134-86" aria-hidden="true" tabindex="-1"></a><span class="co"># env_params</span></span>
<span id="cb134-87"><a href="#cb134-87" aria-hidden="true" tabindex="-1"></a>subset_metadata <span class="ot">&lt;-</span> env_params <span class="sc">%&gt;%</span></span>
<span id="cb134-88"><a href="#cb134-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-89"><a href="#cb134-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VENT <span class="sc">!=</span> <span class="st">"Quakeplume"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-90"><a href="#cb134-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SITE, VENT, SAMPLETYPE, RATE_min, EUK_ml, GRAZING_EFFECT_hr) <span class="sc">%&gt;%</span></span>
<span id="cb134-91"><a href="#cb134-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-92"><a href="#cb134-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span></span>
<span id="cb134-93"><a href="#cb134-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">RATE_min_avg =</span> <span class="fu">mean</span>(RATE_min),</span>
<span id="cb134-94"><a href="#cb134-94" aria-hidden="true" tabindex="-1"></a>              <span class="at">EUK_ml_avg =</span> <span class="fu">mean</span>(EUK_ml),</span>
<span id="cb134-95"><a href="#cb134-95" aria-hidden="true" tabindex="-1"></a>              <span class="at">GRAZING_EFFECT_hr_avg =</span> <span class="fu">mean</span>(GRAZING_EFFECT_hr)) <span class="sc">%&gt;%</span></span>
<span id="cb134-96"><a href="#cb134-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-97"><a href="#cb134-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"_avg"</span>))</span>
<span id="cb134-98"><a href="#cb134-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-99"><a href="#cb134-99" aria-hidden="true" tabindex="-1"></a>metadata_numeric <span class="ot">&lt;-</span> metadata_mcr <span class="sc">%&gt;%</span></span>
<span id="cb134-100"><a href="#cb134-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-101"><a href="#cb134-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VENT, SITE, SAMPLETYPE, DEPTH, TEMP, pH, PercSeawater, Mg, H2, H2S, CH4, ProkConc) <span class="sc">%&gt;%</span></span>
<span id="cb134-102"><a href="#cb134-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-103"><a href="#cb134-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> DEPTH<span class="sc">:</span>ProkConc, <span class="at">values_to =</span> <span class="st">"VALUE_TMP"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-104"><a href="#cb134-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(VALUE_TMP)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>VALUE_TMP) <span class="sc">%&gt;%</span></span>
<span id="cb134-105"><a href="#cb134-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(subset_metadata)</span>
<span id="cb134-106"><a href="#cb134-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-107"><a href="#cb134-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-108"><a href="#cb134-108" aria-hidden="true" tabindex="-1"></a>Code to make tile plot for environmental parameters, but may skip this.</span>
<span id="cb134-109"><a href="#cb134-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-112"><a href="#cb134-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-113"><a href="#cb134-113" aria-hidden="true" tabindex="-1"></a><span class="co"># tileplot_env &lt;- function(x){</span></span>
<span id="cb134-114"><a href="#cb134-114" aria-hidden="true" tabindex="-1"></a><span class="co">#   metadata_numeric %&gt;% </span></span>
<span id="cb134-115"><a href="#cb134-115" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(name == x) %&gt;%</span></span>
<span id="cb134-116"><a href="#cb134-116" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = name, y = VENT, fill = value)) +</span></span>
<span id="cb134-117"><a href="#cb134-117" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(color = "black") +</span></span>
<span id="cb134-118"><a href="#cb134-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(SITE + SAMPLETYPE ~ ., switch = "both", space = "free", scale = "free") + theme_linedraw() +</span></span>
<span id="cb134-119"><a href="#cb134-119" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme(axis.text.y = element_blank(),</span></span>
<span id="cb134-120"><a href="#cb134-120" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.text = element_blank(),</span></span>
<span id="cb134-121"><a href="#cb134-121" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.background = element_blank(),</span></span>
<span id="cb134-122"><a href="#cb134-122" aria-hidden="true" tabindex="-1"></a><span class="co">#           axis.ticks = element_blank(),</span></span>
<span id="cb134-123"><a href="#cb134-123" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.placement = "outside",</span></span>
<span id="cb134-124"><a href="#cb134-124" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.title = element_blank(),</span></span>
<span id="cb134-125"><a href="#cb134-125" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.position = "top",</span></span>
<span id="cb134-126"><a href="#cb134-126" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.text = element_text(size = 5),</span></span>
<span id="cb134-127"><a href="#cb134-127" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.background = element_blank(),</span></span>
<span id="cb134-128"><a href="#cb134-128" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.border = element_blank(),</span></span>
<span id="cb134-129"><a href="#cb134-129" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.grid = element_blank()) +</span></span>
<span id="cb134-130"><a href="#cb134-130" aria-hidden="true" tabindex="-1"></a><span class="co">#     labs(x = "", y = "") +</span></span>
<span id="cb134-131"><a href="#cb134-131" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_fill_distiller(palette = "Reds", direction=2, na.value = "grey50")</span></span>
<span id="cb134-132"><a href="#cb134-132" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb134-133"><a href="#cb134-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-134"><a href="#cb134-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-135"><a href="#cb134-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-136"><a href="#cb134-136" aria-hidden="true" tabindex="-1"></a>Optional plot, likely will not use.</span>
<span id="cb134-137"><a href="#cb134-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-140"><a href="#cb134-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-141"><a href="#cb134-141" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_grid(</span></span>
<span id="cb134-142"><a href="#cb134-142" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("TEMP") + </span></span>
<span id="cb134-143"><a href="#cb134-143" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "YlOrRd", direction=2, na.value = "grey50") +</span></span>
<span id="cb134-144"><a href="#cb134-144" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(axis.text.y = element_text(color = "black", hjust = 1, vjust = 0), </span></span>
<span id="cb134-145"><a href="#cb134-145" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.text.y = element_text(color = "black", hjust = 0, vjust = 0), </span></span>
<span id="cb134-146"><a href="#cb134-146" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.placement = "outside"),</span></span>
<span id="cb134-147"><a href="#cb134-147" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("PercSeawater") + </span></span>
<span id="cb134-148"><a href="#cb134-148" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Blues", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-149"><a href="#cb134-149" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("pH") + </span></span>
<span id="cb134-150"><a href="#cb134-150" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "YlGnBu", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-151"><a href="#cb134-151" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("Mg") + </span></span>
<span id="cb134-152"><a href="#cb134-152" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-153"><a href="#cb134-153" aria-hidden="true" tabindex="-1"></a><span class="co">#  # endemic_env("NO3"),</span></span>
<span id="cb134-154"><a href="#cb134-154" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("H2") + </span></span>
<span id="cb134-155"><a href="#cb134-155" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-156"><a href="#cb134-156" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("CH4") + </span></span>
<span id="cb134-157"><a href="#cb134-157" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-158"><a href="#cb134-158" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("H2S") + </span></span>
<span id="cb134-159"><a href="#cb134-159" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-160"><a href="#cb134-160" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("ProkConc") + </span></span>
<span id="cb134-161"><a href="#cb134-161" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-162"><a href="#cb134-162" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("EUK_ml_avg") + </span></span>
<span id="cb134-163"><a href="#cb134-163" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(axis.text.y = element_text(color = "black", hjust = 1, vjust = 0), </span></span>
<span id="cb134-164"><a href="#cb134-164" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.text.y = element_text(color = "black", hjust = 0, vjust = 0), </span></span>
<span id="cb134-165"><a href="#cb134-165" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.placement = "outside") +</span></span>
<span id="cb134-166"><a href="#cb134-166" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-167"><a href="#cb134-167" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("GRAZING_EFFECT_hr_avg") + </span></span>
<span id="cb134-168"><a href="#cb134-168" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb134-169"><a href="#cb134-169" aria-hidden="true" tabindex="-1"></a><span class="co">#  nrow = 1,</span></span>
<span id="cb134-170"><a href="#cb134-170" aria-hidden="true" tabindex="-1"></a><span class="co">#  rel_widths = c(4,1,1,1,1,1,1,1, 4, 1)</span></span>
<span id="cb134-171"><a href="#cb134-171" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb134-172"><a href="#cb134-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-173"><a href="#cb134-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-174"><a href="#cb134-174" aria-hidden="true" tabindex="-1"></a><span class="fu"># Community structure &amp; diversity at Von Damm &amp; Piccard</span></span>
<span id="cb134-175"><a href="#cb134-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-176"><a href="#cb134-176" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cluster analysis</span></span>
<span id="cb134-177"><a href="#cb134-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-178"><a href="#cb134-178" aria-hidden="true" tabindex="-1"></a>Ordination analysis and methods to look at whole protistan communities at MCR.</span>
<span id="cb134-179"><a href="#cb134-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-182"><a href="#cb134-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-183"><a href="#cb134-183" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb134-184"><a href="#cb134-184" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan); <span class="fu">library</span>(ggdendro); <span class="fu">library</span>(compositions)</span>
<span id="cb134-185"><a href="#cb134-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-186"><a href="#cb134-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-187"><a href="#cb134-187" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cluster analysis with grazing assays</span></span>
<span id="cb134-188"><a href="#cb134-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-191"><a href="#cb134-191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-192"><a href="#cb134-192" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb134-193"><a href="#cb134-193" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb134-194"><a href="#cb134-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-195"><a href="#cb134-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb134-196"><a href="#cb134-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-197"><a href="#cb134-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb134-198"><a href="#cb134-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-199"><a href="#cb134-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb134-200"><a href="#cb134-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-201"><a href="#cb134-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-202"><a href="#cb134-202" aria-hidden="true" tabindex="-1"></a>Transform compositional data, center log ratio.</span>
<span id="cb134-203"><a href="#cb134-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-206"><a href="#cb134-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-207"><a href="#cb134-207" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric)))</span>
<span id="cb134-208"><a href="#cb134-208" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(logratio_mcr)</span></span>
<span id="cb134-209"><a href="#cb134-209" aria-hidden="true" tabindex="-1"></a><span class="co"># ?alr()</span></span>
<span id="cb134-210"><a href="#cb134-210" aria-hidden="true" tabindex="-1"></a><span class="co"># ?ilr()</span></span>
<span id="cb134-211"><a href="#cb134-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-212"><a href="#cb134-212" aria-hidden="true" tabindex="-1"></a>pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(logratio_mcr)</span>
<span id="cb134-213"><a href="#cb134-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-214"><a href="#cb134-214" aria-hidden="true" tabindex="-1"></a>variance_logratio <span class="ot">&lt;-</span> (pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb134-215"><a href="#cb134-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-216"><a href="#cb134-216" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb134-217"><a href="#cb134-217" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span>
<span id="cb134-218"><a href="#cb134-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-219"><a href="#cb134-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-220"><a href="#cb134-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-223"><a href="#cb134-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-224"><a href="#cb134-224" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points</span></span>
<span id="cb134-225"><a href="#cb134-225" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-226"><a href="#cb134-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-227"><a href="#cb134-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb134-228"><a href="#cb134-228" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb134-229"><a href="#cb134-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-230"><a href="#cb134-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-231"><a href="#cb134-231" aria-hidden="true" tabindex="-1"></a><span class="fu">### PCoA with all samples</span></span>
<span id="cb134-232"><a href="#cb134-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-233"><a href="#cb134-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=6, fig.width=8}</span></span>
<span id="cb134-234"><a href="#cb134-234" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(mcr_pca_pts$VENT)</span></span>
<span id="cb134-235"><a href="#cb134-235" aria-hidden="true" tabindex="-1"></a><span class="co"># vent_ids</span></span>
<span id="cb134-236"><a href="#cb134-236" aria-hidden="true" tabindex="-1"></a><span class="co"># site_fullname</span></span>
<span id="cb134-237"><a href="#cb134-237" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb134-238"><a href="#cb134-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb134-239"><a href="#cb134-239" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-240"><a href="#cb134-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-241"><a href="#cb134-241" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb134-242"><a href="#cb134-242" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb134-243"><a href="#cb134-243" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb134-244"><a href="#cb134-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb134-245"><a href="#cb134-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE_ORDER, <span class="at">fill =</span> VENT_ORDER, <span class="at">alpha =</span> TYPE)) <span class="sc">+</span></span>
<span id="cb134-246"><a href="#cb134-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb134-247"><a href="#cb134-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb134-248"><a href="#cb134-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb134-249"><a href="#cb134-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb134-250"><a href="#cb134-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb134-251"><a href="#cb134-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span>
<span id="cb134-252"><a href="#cb134-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-253"><a href="#cb134-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-254"><a href="#cb134-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-255"><a href="#cb134-255" aria-hidden="true" tabindex="-1"></a>Dendrogram analysis</span>
<span id="cb134-256"><a href="#cb134-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-259"><a href="#cb134-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-260"><a href="#cb134-260" aria-hidden="true" tabindex="-1"></a><span class="co"># ?decostand()</span></span>
<span id="cb134-261"><a href="#cb134-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative abundance</span></span>
<span id="cb134-262"><a href="#cb134-262" aria-hidden="true" tabindex="-1"></a>rel_abun <span class="ot">&lt;-</span> <span class="fu">decostand</span>(asv_mcr_numeric, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"total"</span>)</span>
<span id="cb134-263"><a href="#cb134-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster dendrogram (average hierarchical clustering)</span></span>
<span id="cb134-264"><a href="#cb134-264" aria-hidden="true" tabindex="-1"></a>cluster_mcr <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(rel_abun)), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb134-265"><a href="#cb134-265" aria-hidden="true" tabindex="-1"></a>dendro <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(cluster_mcr)</span>
<span id="cb134-266"><a href="#cb134-266" aria-hidden="true" tabindex="-1"></a>mcr_dendro <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(dendro, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span>
<span id="cb134-267"><a href="#cb134-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-268"><a href="#cb134-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-269"><a href="#cb134-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-270"><a href="#cb134-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=4}</span></span>
<span id="cb134-271"><a href="#cb134-271" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">segment</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb134-272"><a href="#cb134-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, </span>
<span id="cb134-273"><a href="#cb134-273" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend)) <span class="sc">+</span> </span>
<span id="cb134-274"><a href="#cb134-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb134-275"><a href="#cb134-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb134-276"><a href="#cb134-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">data =</span> <span class="fu">label</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb134-277"><a href="#cb134-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dendro</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Dissimilarity"</span>) <span class="sc">+</span></span>
<span id="cb134-278"><a href="#cb134-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">14</span>), <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#252525"</span>), </span>
<span id="cb134-279"><a href="#cb134-279" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb134-280"><a href="#cb134-280" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb134-281"><a href="#cb134-281" aria-hidden="true" tabindex="-1"></a><span class="co"># svg('figs/SUPPLEMENTARY-dendrogram-wreps.svg', w = 10, h = 8)</span></span>
<span id="cb134-282"><a href="#cb134-282" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot</span>
<span id="cb134-283"><a href="#cb134-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-284"><a href="#cb134-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-285"><a href="#cb134-285" aria-hidden="true" tabindex="-1"></a><span class="fu">### PCoA with in situ only</span></span>
<span id="cb134-286"><a href="#cb134-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-289"><a href="#cb134-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-290"><a href="#cb134-290" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric_insitu <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb134-291"><a href="#cb134-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-292"><a href="#cb134-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-293"><a href="#cb134-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb134-294"><a href="#cb134-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-295"><a href="#cb134-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb134-296"><a href="#cb134-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-297"><a href="#cb134-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb134-298"><a href="#cb134-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-299"><a href="#cb134-299" aria-hidden="true" tabindex="-1"></a>insitu_logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric_insitu)))</span>
<span id="cb134-300"><a href="#cb134-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-301"><a href="#cb134-301" aria-hidden="true" tabindex="-1"></a>insitu_pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(insitu_logratio_mcr)</span>
<span id="cb134-302"><a href="#cb134-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-303"><a href="#cb134-303" aria-hidden="true" tabindex="-1"></a>insitu_variance_logratio <span class="ot">&lt;-</span> (insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb134-304"><a href="#cb134-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-305"><a href="#cb134-305" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(insitu_variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb134-306"><a href="#cb134-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span>
<span id="cb134-307"><a href="#cb134-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-308"><a href="#cb134-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-311"><a href="#cb134-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-312"><a href="#cb134-312" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points for only insitu samples</span></span>
<span id="cb134-313"><a href="#cb134-313" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(insitu_pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(insitu_pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-314"><a href="#cb134-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-315"><a href="#cb134-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb134-316"><a href="#cb134-316" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb134-317"><a href="#cb134-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-318"><a href="#cb134-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-319"><a href="#cb134-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=6, fig.width=8}</span></span>
<span id="cb134-320"><a href="#cb134-320" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb134-321"><a href="#cb134-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-322"><a href="#cb134-322" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb134-323"><a href="#cb134-323" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb134-324"><a href="#cb134-324" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb134-325"><a href="#cb134-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb134-326"><a href="#cb134-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE, <span class="at">fill =</span> VENT, <span class="at">alpha =</span> TYPE)) <span class="sc">+</span></span>
<span id="cb134-327"><a href="#cb134-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb134-328"><a href="#cb134-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb134-329"><a href="#cb134-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb134-330"><a href="#cb134-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb134-331"><a href="#cb134-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span>
<span id="cb134-332"><a href="#cb134-332" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep same sample colors to compare to cluster analysis with in situ and Tf samples.</span></span>
<span id="cb134-333"><a href="#cb134-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-334"><a href="#cb134-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-335"><a href="#cb134-335" aria-hidden="true" tabindex="-1"></a><span class="fu">## Taxonomic breakdown</span></span>
<span id="cb134-336"><a href="#cb134-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-337"><a href="#cb134-337" aria-hidden="true" tabindex="-1"></a>Try to pair with dendrogram</span>
<span id="cb134-338"><a href="#cb134-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-341"><a href="#cb134-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-342"><a href="#cb134-342" aria-hidden="true" tabindex="-1"></a>out_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcr_dendro<span class="sc">$</span>labels)</span>
<span id="cb134-343"><a href="#cb134-343" aria-hidden="true" tabindex="-1"></a>mcr_sample_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(out_labels<span class="sc">$</span>label)</span>
<span id="cb134-344"><a href="#cb134-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-345"><a href="#cb134-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-346"><a href="#cb134-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=11}</span></span>
<span id="cb134-347"><a href="#cb134-347" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb134-348"><a href="#cb134-348" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb134-349"><a href="#cb134-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-350"><a href="#cb134-350" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb134-351"><a href="#cb134-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-352"><a href="#cb134-352" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb134-353"><a href="#cb134-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb134-354"><a href="#cb134-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-355"><a href="#cb134-355" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb134-356"><a href="#cb134-356" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb134-357"><a href="#cb134-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb134-358"><a href="#cb134-358" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb134-359"><a href="#cb134-359" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-360"><a href="#cb134-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb134-361"><a href="#cb134-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb134-362"><a href="#cb134-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb134-363"><a href="#cb134-363" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb134-364"><a href="#cb134-364" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb134-365"><a href="#cb134-365" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-366"><a href="#cb134-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-367"><a href="#cb134-367" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb134-368"><a href="#cb134-368" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb134-369"><a href="#cb134-369" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb134-370"><a href="#cb134-370" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb134-371"><a href="#cb134-371" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb134-372"><a href="#cb134-372" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb134-373"><a href="#cb134-373" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb134-374"><a href="#cb134-374" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb134-375"><a href="#cb134-375" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb134-376"><a href="#cb134-376" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb134-377"><a href="#cb134-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb134-378"><a href="#cb134-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span> </span>
<span id="cb134-379"><a href="#cb134-379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TOTAL_SEQ =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-380"><a href="#cb134-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb134-381"><a href="#cb134-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb134-382"><a href="#cb134-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq),</span>
<span id="cb134-383"><a href="#cb134-383" aria-hidden="true" tabindex="-1"></a>            <span class="at">REL_ABUN =</span> SUM<span class="sc">/</span>TOTAL_SEQ) <span class="sc">%&gt;%</span> </span>
<span id="cb134-384"><a href="#cb134-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-385"><a href="#cb134-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUPERGROUP, <span class="at">size =</span> REL_ABUN)) <span class="sc">+</span></span>
<span id="cb134-386"><a href="#cb134-386" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="fu">aes</span>(<span class="at">size =</span> REL_ABUN, <span class="at">fill =</span> SUPERGROUP, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb134-387"><a href="#cb134-387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb134-388"><a href="#cb134-388" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(. ~ SITE, scales = "free", space = "free") +</span></span>
<span id="cb134-389"><a href="#cb134-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb134-390"><a href="#cb134-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb134-391"><a href="#cb134-391" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb134-392"><a href="#cb134-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-393"><a href="#cb134-393" aria-hidden="true" tabindex="-1"></a>bubble</span>
<span id="cb134-394"><a href="#cb134-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-395"><a href="#cb134-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-396"><a href="#cb134-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dendrogram with bubble plot</span></span>
<span id="cb134-397"><a href="#cb134-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-398"><a href="#cb134-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=20, fig.height=11}</span></span>
<span id="cb134-399"><a href="#cb134-399" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_dendro_plot + bubble + patchwork::plot_layout(ncol = 2) + patchwork::plot_annotation(tag_levels = "a")</span></span>
<span id="cb134-400"><a href="#cb134-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-401"><a href="#cb134-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-402"><a href="#cb134-402" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shared ASVs</span></span>
<span id="cb134-403"><a href="#cb134-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-406"><a href="#cb134-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-407"><a href="#cb134-407" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span>
<span id="cb134-408"><a href="#cb134-408" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(asv_wtax_qc$SITE)</span></span>
<span id="cb134-409"><a href="#cb134-409" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span>
<span id="cb134-410"><a href="#cb134-410" aria-hidden="true" tabindex="-1"></a><span class="co"># head(TAX)</span></span>
<span id="cb134-411"><a href="#cb134-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-412"><a href="#cb134-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-413"><a href="#cb134-413" aria-hidden="true" tabindex="-1"></a>Function to generate upsetR plot with varied taxonomic levels.</span>
<span id="cb134-414"><a href="#cb134-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-415"><a href="#cb134-415" aria-hidden="true" tabindex="-1"></a>Questions:</span>
<span id="cb134-416"><a href="#cb134-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-417"><a href="#cb134-417" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How many ASVs are shared among vent sites within Von Damm and Piccard?</span>
<span id="cb134-418"><a href="#cb134-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-419"><a href="#cb134-419" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What about shared ASVs across each vent field?</span>
<span id="cb134-420"><a href="#cb134-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-421"><a href="#cb134-421" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is there a taxonomic level that drives site-to-site or field-to-field community dissimilarity?</span>
<span id="cb134-422"><a href="#cb134-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-423"><a href="#cb134-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=11}</span></span>
<span id="cb134-424"><a href="#cb134-424" aria-hidden="true" tabindex="-1"></a><span class="co"># options for taxa: SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb134-425"><a href="#cb134-425" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb134-426"><a href="#cb134-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-427"><a href="#cb134-427" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb134-428"><a href="#cb134-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-429"><a href="#cb134-429" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb134-430"><a href="#cb134-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-431"><a href="#cb134-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-432"><a href="#cb134-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb134-433"><a href="#cb134-433" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb134-434"><a href="#cb134-434" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-435"><a href="#cb134-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb134-436"><a href="#cb134-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb134-437"><a href="#cb134-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb134-438"><a href="#cb134-438" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb134-439"><a href="#cb134-439" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb134-440"><a href="#cb134-440" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-441"><a href="#cb134-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-442"><a href="#cb134-442" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb134-443"><a href="#cb134-443" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb134-444"><a href="#cb134-444" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb134-445"><a href="#cb134-445" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb134-446"><a href="#cb134-446" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb134-447"><a href="#cb134-447" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb134-448"><a href="#cb134-448" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb134-449"><a href="#cb134-449" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb134-450"><a href="#cb134-450" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb134-451"><a href="#cb134-451" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb134-452"><a href="#cb134-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb134-453"><a href="#cb134-453" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb134-454"><a href="#cb134-454" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb134-455"><a href="#cb134-455" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-456"><a href="#cb134-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb134-457"><a href="#cb134-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-458"><a href="#cb134-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb134-459"><a href="#cb134-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-460"><a href="#cb134-460" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb134-461"><a href="#cb134-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-462"><a href="#cb134-462" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb134-463"><a href="#cb134-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb134-464"><a href="#cb134-464" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb134-465"><a href="#cb134-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-466"><a href="#cb134-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-467"><a href="#cb134-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb134-468"><a href="#cb134-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-469"><a href="#cb134-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb134-470"><a href="#cb134-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb134-471"><a href="#cb134-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb134-472"><a href="#cb134-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb134-473"><a href="#cb134-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb134-474"><a href="#cb134-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb134-475"><a href="#cb134-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-476"><a href="#cb134-476" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-477"><a href="#cb134-477" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-478"><a href="#cb134-478" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-479"><a href="#cb134-479" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-480"><a href="#cb134-480" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-481"><a href="#cb134-481" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb134-482"><a href="#cb134-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span>
<span id="cb134-483"><a href="#cb134-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-484"><a href="#cb134-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to reduce noise and show sample type to vent ecosystem variability.</span></span>
<span id="cb134-485"><a href="#cb134-485" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb134-486"><a href="#cb134-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-487"><a href="#cb134-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-488"><a href="#cb134-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=15, fig.height=12}</span></span>
<span id="cb134-489"><a href="#cb134-489" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb134-490"><a href="#cb134-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-491"><a href="#cb134-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-492"><a href="#cb134-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb134-493"><a href="#cb134-493" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb134-494"><a href="#cb134-494" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-495"><a href="#cb134-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb134-496"><a href="#cb134-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb134-497"><a href="#cb134-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb134-498"><a href="#cb134-498" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb134-499"><a href="#cb134-499" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb134-500"><a href="#cb134-500" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-501"><a href="#cb134-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-502"><a href="#cb134-502" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb134-503"><a href="#cb134-503" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb134-504"><a href="#cb134-504" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb134-505"><a href="#cb134-505" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb134-506"><a href="#cb134-506" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb134-507"><a href="#cb134-507" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb134-508"><a href="#cb134-508" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb134-509"><a href="#cb134-509" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb134-510"><a href="#cb134-510" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb134-511"><a href="#cb134-511" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb134-512"><a href="#cb134-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb134-513"><a href="#cb134-513" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb134-514"><a href="#cb134-514" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb134-515"><a href="#cb134-515" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-516"><a href="#cb134-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb134-517"><a href="#cb134-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-518"><a href="#cb134-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb134-519"><a href="#cb134-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-520"><a href="#cb134-520" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb134-521"><a href="#cb134-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-522"><a href="#cb134-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb134-523"><a href="#cb134-523" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb134-524"><a href="#cb134-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-525"><a href="#cb134-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Taxon, SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-526"><a href="#cb134-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb134-527"><a href="#cb134-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-528"><a href="#cb134-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb134-529"><a href="#cb134-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb134-530"><a href="#cb134-530" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb134-531"><a href="#cb134-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb134-532"><a href="#cb134-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb134-533"><a href="#cb134-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb134-534"><a href="#cb134-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-535"><a href="#cb134-535" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-536"><a href="#cb134-536" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-537"><a href="#cb134-537" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb134-538"><a href="#cb134-538" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-539"><a href="#cb134-539" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-540"><a href="#cb134-540" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb134-541"><a href="#cb134-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span>
<span id="cb134-542"><a href="#cb134-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-543"><a href="#cb134-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-544"><a href="#cb134-544" aria-hidden="true" tabindex="-1"></a>Example comparisons of shared taxonomic levels. *Explanation*: At ASV level, most ASVs are not shared across samples. So at other taxonomic categories, are these taxa also present or are there whole classes not present?</span>
<span id="cb134-545"><a href="#cb134-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-546"><a href="#cb134-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=15, fig.height=8}</span></span>
<span id="cb134-547"><a href="#cb134-547" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 10</span></span>
<span id="cb134-548"><a href="#cb134-548" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 15</span></span>
<span id="cb134-549"><a href="#cb134-549" aria-hidden="true" tabindex="-1"></a><span class="co"># SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb134-550"><a href="#cb134-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-551"><a href="#cb134-551" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, SupergroupPhylum)</span></span>
<span id="cb134-552"><a href="#cb134-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-553"><a href="#cb134-553" aria-hidden="true" tabindex="-1"></a><span class="co"># library(plotly)</span></span>
<span id="cb134-554"><a href="#cb134-554" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplotly(tmp)</span></span>
<span id="cb134-555"><a href="#cb134-555" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, Class) + theme(legend.position = "none")</span></span>
<span id="cb134-556"><a href="#cb134-556" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, Supergroup) + theme(legend.position = "none")</span></span>
<span id="cb134-557"><a href="#cb134-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-558"><a href="#cb134-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-559"><a href="#cb134-559" aria-hidden="true" tabindex="-1"></a>A better visualization may be a presence/absence across samples with a tile plot.</span>
<span id="cb134-560"><a href="#cb134-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-563"><a href="#cb134-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-564"><a href="#cb134-564" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb134-565"><a href="#cb134-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-566"><a href="#cb134-566" aria-hidden="true" tabindex="-1"></a>make_tile_plot_pa <span class="ot">&lt;-</span> <span class="cf">function</span>(df, taxa_level, level0){ </span>
<span id="cb134-567"><a href="#cb134-567" aria-hidden="true" tabindex="-1"></a>  taxa_select <span class="ot">&lt;-</span> <span class="fu">enquo</span>(taxa_level)</span>
<span id="cb134-568"><a href="#cb134-568" aria-hidden="true" tabindex="-1"></a>  taxa_select_higher <span class="ot">&lt;-</span> <span class="fu">enquo</span>(level0)</span>
<span id="cb134-569"><a href="#cb134-569" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb134-570"><a href="#cb134-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-571"><a href="#cb134-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-572"><a href="#cb134-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb134-573"><a href="#cb134-573" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb134-574"><a href="#cb134-574" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-575"><a href="#cb134-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb134-576"><a href="#cb134-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb134-577"><a href="#cb134-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb134-578"><a href="#cb134-578" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb134-579"><a href="#cb134-579" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb134-580"><a href="#cb134-580" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-581"><a href="#cb134-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-582"><a href="#cb134-582" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb134-583"><a href="#cb134-583" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb134-584"><a href="#cb134-584" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb134-585"><a href="#cb134-585" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb134-586"><a href="#cb134-586" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb134-587"><a href="#cb134-587" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb134-588"><a href="#cb134-588" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb134-589"><a href="#cb134-589" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb134-590"><a href="#cb134-590" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb134-591"><a href="#cb134-591" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb134-592"><a href="#cb134-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb134-593"><a href="#cb134-593" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb134-594"><a href="#cb134-594" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, <span class="sc">!!</span>taxa_select_higher, <span class="sc">!!</span>taxa_select) <span class="sc">%&gt;%</span> </span>
<span id="cb134-595"><a href="#cb134-595" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-596"><a href="#cb134-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb134-597"><a href="#cb134-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-598"><a href="#cb134-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb134-599"><a href="#cb134-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-600"><a href="#cb134-600" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb134-601"><a href="#cb134-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-602"><a href="#cb134-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, <span class="sc">!!</span>taxa_select_higher, <span class="sc">!!</span>taxa_select, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb134-603"><a href="#cb134-603" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb134-604"><a href="#cb134-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb134-605"><a href="#cb134-605" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">PRESENT =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-606"><a href="#cb134-606" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># remove NAs in taxa categories</span></span>
<span id="cb134-607"><a href="#cb134-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE, <span class="at">y =</span> <span class="sc">!!</span>taxa_select)) <span class="sc">+</span></span>
<span id="cb134-608"><a href="#cb134-608" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> PRESENT)) <span class="sc">+</span></span>
<span id="cb134-609"><a href="#cb134-609" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(SupergroupPhylum <span class="sc">~</span> SITE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-610"><a href="#cb134-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb134-611"><a href="#cb134-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb134-612"><a href="#cb134-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb134-613"><a href="#cb134-613" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb134-614"><a href="#cb134-614" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb134-615"><a href="#cb134-615" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb134-616"><a href="#cb134-616" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-617"><a href="#cb134-617" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-618"><a href="#cb134-618" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-619"><a href="#cb134-619" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>))</span>
<span id="cb134-620"><a href="#cb134-620" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-621"><a href="#cb134-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-622"><a href="#cb134-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-623"><a href="#cb134-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=18, fig.width=7}</span></span>
<span id="cb134-624"><a href="#cb134-624" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 10</span></span>
<span id="cb134-625"><a href="#cb134-625" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 20</span></span>
<span id="cb134-626"><a href="#cb134-626" aria-hidden="true" tabindex="-1"></a><span class="co"># make_tile_plot_pa(asv_wtax_qc, "Class", "SupergroupPhylum")</span></span>
<span id="cb134-627"><a href="#cb134-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-628"><a href="#cb134-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-629"><a href="#cb134-629" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Above plot addresses presence/absence of the families within major protistan supergroups across the Von Damm and Piccard vent, plume, and background samples.</span></span>
<span id="cb134-630"><a href="#cb134-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-631"><a href="#cb134-631" aria-hidden="true" tabindex="-1"></a><span class="fu">## Corncob</span></span>
<span id="cb134-632"><a href="#cb134-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-633"><a href="#cb134-633" aria-hidden="true" tabindex="-1"></a>Corncob analysis can be used to identify specific ASVs that may be enriched when we compare non-vent to vent samples.</span>
<span id="cb134-634"><a href="#cb134-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-635"><a href="#cb134-635" aria-hidden="true" tabindex="-1"></a>Questions:</span>
<span id="cb134-636"><a href="#cb134-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-637"><a href="#cb134-637" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at Piccard?</span>
<span id="cb134-638"><a href="#cb134-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-639"><a href="#cb134-639" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at Von Damm?</span>
<span id="cb134-640"><a href="#cb134-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-641"><a href="#cb134-641" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at both sites?</span>
<span id="cb134-642"><a href="#cb134-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-645"><a href="#cb134-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-646"><a href="#cb134-646" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb134-647"><a href="#cb134-647" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("bryandmartin/corncob")</span></span>
<span id="cb134-648"><a href="#cb134-648" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corncob); <span class="fu">library</span>(phyloseq)</span>
<span id="cb134-649"><a href="#cb134-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-650"><a href="#cb134-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-653"><a href="#cb134-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-654"><a href="#cb134-654" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb134-655"><a href="#cb134-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-656"><a href="#cb134-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-657"><a href="#cb134-657" aria-hidden="true" tabindex="-1"></a>Explore data input for corncob</span>
<span id="cb134-658"><a href="#cb134-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-661"><a href="#cb134-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-662"><a href="#cb134-662" aria-hidden="true" tabindex="-1"></a><span class="co"># otu_table(physeq_mcr)[1:10, 1:3]</span></span>
<span id="cb134-663"><a href="#cb134-663" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(physeq_mcr)</span></span>
<span id="cb134-664"><a href="#cb134-664" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(physeq_mcr)[1:3, ]</span></span>
<span id="cb134-665"><a href="#cb134-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-666"><a href="#cb134-666" aria-hidden="true" tabindex="-1"></a><span class="co"># Designated vent vs. non-vent</span></span>
<span id="cb134-667"><a href="#cb134-667" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SAMPLETYPE_BIN)</span>
<span id="cb134-668"><a href="#cb134-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-669"><a href="#cb134-669" aria-hidden="true" tabindex="-1"></a><span class="co">#Designats Piccard vs. vondamm.</span></span>
<span id="cb134-670"><a href="#cb134-670" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SITE)</span>
<span id="cb134-671"><a href="#cb134-671" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-672"><a href="#cb134-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-673"><a href="#cb134-673" aria-hidden="true" tabindex="-1"></a>Start by removing incubation samples for now. Subset to eukaryotes only and use phyloseq's tax glom to summarize to Supergroup, Phylum, Class, Order, Genus, &amp; species.</span>
<span id="cb134-674"><a href="#cb134-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-677"><a href="#cb134-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-678"><a href="#cb134-678" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tax_table</span>(physeq_mcr))</span>
<span id="cb134-679"><a href="#cb134-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-680"><a href="#cb134-680" aria-hidden="true" tabindex="-1"></a>mcr_super <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span></span>
<span id="cb134-681"><a href="#cb134-681" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb134-682"><a href="#cb134-682" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-683"><a href="#cb134-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Supergroup"</span>)</span>
<span id="cb134-684"><a href="#cb134-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-685"><a href="#cb134-685" aria-hidden="true" tabindex="-1"></a>mcr_phy <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb134-686"><a href="#cb134-686" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-687"><a href="#cb134-687" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-688"><a href="#cb134-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Phylum"</span>)</span>
<span id="cb134-689"><a href="#cb134-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-690"><a href="#cb134-690" aria-hidden="true" tabindex="-1"></a>mcr_class <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb134-691"><a href="#cb134-691" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-692"><a href="#cb134-692" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-693"><a href="#cb134-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Class"</span>)</span>
<span id="cb134-694"><a href="#cb134-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-695"><a href="#cb134-695" aria-hidden="true" tabindex="-1"></a>mcr_order <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb134-696"><a href="#cb134-696" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-697"><a href="#cb134-697" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-698"><a href="#cb134-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Order"</span>)</span>
<span id="cb134-699"><a href="#cb134-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-700"><a href="#cb134-700" aria-hidden="true" tabindex="-1"></a>mcr_fam <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb134-701"><a href="#cb134-701" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-702"><a href="#cb134-702" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-703"><a href="#cb134-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Family"</span>)</span>
<span id="cb134-704"><a href="#cb134-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-705"><a href="#cb134-705" aria-hidden="true" tabindex="-1"></a>mcr_genera <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb134-706"><a href="#cb134-706" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-707"><a href="#cb134-707" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-708"><a href="#cb134-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Genus"</span>)</span>
<span id="cb134-709"><a href="#cb134-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-710"><a href="#cb134-710" aria-hidden="true" tabindex="-1"></a>mcr_spp <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb134-711"><a href="#cb134-711" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-712"><a href="#cb134-712" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-713"><a href="#cb134-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Species"</span>)</span>
<span id="cb134-714"><a href="#cb134-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-715"><a href="#cb134-715" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(mcr_order)</span></span>
<span id="cb134-716"><a href="#cb134-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-717"><a href="#cb134-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-718"><a href="#cb134-718" aria-hidden="true" tabindex="-1"></a>Differential tests in corncob</span>
<span id="cb134-719"><a href="#cb134-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-720"><a href="#cb134-720" aria-hidden="true" tabindex="-1"></a>These tests work to see if taxa are differentially-abundant or variable across a given variable. In this study we have different taxonomic levels, are there more general or species-specific trends? We also have across sample types and site Below set up differential tests across sample types and site (and either or) at different taxonomic levels.</span>
<span id="cb134-721"><a href="#cb134-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-722"><a href="#cb134-722" aria-hidden="true" tabindex="-1"></a>Function to perform specific differential tests across vent fields. Below use **SITE_PICK** parameter to choose between vent fields. Then use the df, to specify the taxonomic level.</span>
<span id="cb134-723"><a href="#cb134-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-726"><a href="#cb134-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-727"><a href="#cb134-727" aria-hidden="true" tabindex="-1"></a>corncob_mcr <span class="ot">&lt;-</span> <span class="cf">function</span>(df_in){</span>
<span id="cb134-728"><a href="#cb134-728" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb134-729"><a href="#cb134-729" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SAMPLETYPE+ SITE,</span></span>
<span id="cb134-730"><a href="#cb134-730" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb134-731"><a href="#cb134-731" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb134-732"><a href="#cb134-732" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb134-733"><a href="#cb134-733" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb134-734"><a href="#cb134-734" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb134-735"><a href="#cb134-735" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SAMPLETYPE_BIN specifically compares vent to non-vent.</span></span>
<span id="cb134-736"><a href="#cb134-736" aria-hidden="true" tabindex="-1"></a>  da_analysis_output <span class="ot">&lt;-</span> <span class="fu">differentialTest</span>(<span class="at">formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb134-737"><a href="#cb134-737" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb134-738"><a href="#cb134-738" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula_null =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb134-739"><a href="#cb134-739" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula_null =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb134-740"><a href="#cb134-740" aria-hidden="true" tabindex="-1"></a>                                <span class="at">test =</span> <span class="st">"Wald"</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb134-741"><a href="#cb134-741" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> df_in,</span>
<span id="cb134-742"><a href="#cb134-742" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fdr_cutoff =</span> <span class="fl">0.05</span>)</span>
<span id="cb134-743"><a href="#cb134-743" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SITE,</span></span>
<span id="cb134-744"><a href="#cb134-744" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SITE,</span></span>
<span id="cb134-745"><a href="#cb134-745" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb134-746"><a href="#cb134-746" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SITE,</span></span>
<span id="cb134-747"><a href="#cb134-747" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb134-748"><a href="#cb134-748" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb134-749"><a href="#cb134-749" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb134-750"><a href="#cb134-750" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb134-751"><a href="#cb134-751" aria-hidden="true" tabindex="-1"></a>  list_ofsig <span class="ot">&lt;-</span> <span class="fu">as.character</span>(da_analysis_output<span class="sc">$</span>significant_taxa)</span>
<span id="cb134-752"><a href="#cb134-752" aria-hidden="true" tabindex="-1"></a>  total_number <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ofsig)[<span class="dv">1</span>]</span>
<span id="cb134-753"><a href="#cb134-753" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb134-754"><a href="#cb134-754" aria-hidden="true" tabindex="-1"></a>  sig_taxa_names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(df_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-755"><a href="#cb134-755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FEATURE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-756"><a href="#cb134-756" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(FEATURE <span class="sc">%in%</span> list_ofsig) <span class="sc">%&gt;%</span> </span>
<span id="cb134-757"><a href="#cb134-757" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"NUMBER"</span>)</span>
<span id="cb134-758"><a href="#cb134-758" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb134-759"><a href="#cb134-759" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_number){</span>
<span id="cb134-760"><a href="#cb134-760" aria-hidden="true" tabindex="-1"></a>    out_0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(da_analysis_output<span class="sc">$</span>significant_models[[var]]<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb134-761"><a href="#cb134-761" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">NUMBER =</span> <span class="fu">as.character</span>(var))</span>
<span id="cb134-762"><a href="#cb134-762" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"extracted # "</span>,var, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb134-763"><a href="#cb134-763" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"extracted_coef"</span>)){</span>
<span id="cb134-764"><a href="#cb134-764" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> out_0 <span class="co"># create the final count table</span></span>
<span id="cb134-765"><a href="#cb134-765" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb134-766"><a href="#cb134-766" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extracted_coef, out_0)</span>
<span id="cb134-767"><a href="#cb134-767" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb134-768"><a href="#cb134-768" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(out_0) <span class="co"># remove excess df</span></span>
<span id="cb134-769"><a href="#cb134-769" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb134-770"><a href="#cb134-770" aria-hidden="true" tabindex="-1"></a>  output_full <span class="ot">&lt;-</span> extracted_coef <span class="sc">%&gt;%</span> </span>
<span id="cb134-771"><a href="#cb134-771" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-772"><a href="#cb134-772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"mu."</span>, variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-773"><a href="#cb134-773" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sig_taxa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUMBER"</span> <span class="ot">=</span> <span class="st">"NUMBER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-774"><a href="#cb134-774" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">VARIABLE =</span> <span class="fu">str_remove</span>(variable, <span class="st">"[:digit:]+"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variable) <span class="co">#%&gt;% </span></span>
<span id="cb134-775"><a href="#cb134-775" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pivot_wider(names_from = VARIABLE, names_glue = "{VARIABLE}_{.value}", values_from = c(Estimate, Std..Error, t.value, Pr...t..))</span></span>
<span id="cb134-776"><a href="#cb134-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(extracted_coef)</span>
<span id="cb134-777"><a href="#cb134-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_full)}</span>
<span id="cb134-778"><a href="#cb134-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-779"><a href="#cb134-779" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-780"><a href="#cb134-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-781"><a href="#cb134-781" aria-hidden="true" tabindex="-1"></a>Define SITE_PICK</span>
<span id="cb134-782"><a href="#cb134-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-785"><a href="#cb134-785" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-786"><a href="#cb134-786" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>, <span class="st">"VonDamm"</span>)</span>
<span id="cb134-787"><a href="#cb134-787" aria-hidden="true" tabindex="-1"></a>picc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>)</span>
<span id="cb134-788"><a href="#cb134-788" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>)</span>
<span id="cb134-789"><a href="#cb134-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-790"><a href="#cb134-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-791"><a href="#cb134-791" aria-hidden="true" tabindex="-1"></a>Function to visualize output from corncob</span>
<span id="cb134-792"><a href="#cb134-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-795"><a href="#cb134-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-796"><a href="#cb134-796" aria-hidden="true" tabindex="-1"></a>plot_corn <span class="ot">&lt;-</span> <span class="cf">function</span>(cob_out, LEVEL, TITLE){</span>
<span id="cb134-797"><a href="#cb134-797" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">enquo</span>(LEVEL)</span>
<span id="cb134-798"><a href="#cb134-798" aria-hidden="true" tabindex="-1"></a>  cob_out <span class="sc">%&gt;%</span></span>
<span id="cb134-799"><a href="#cb134-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-800"><a href="#cb134-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> level, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-801"><a href="#cb134-801" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-802"><a href="#cb134-802" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-803"><a href="#cb134-803" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-804"><a href="#cb134-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-805"><a href="#cb134-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-806"><a href="#cb134-806" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb134-807"><a href="#cb134-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-808"><a href="#cb134-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> TITLE)</span>
<span id="cb134-809"><a href="#cb134-809" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-810"><a href="#cb134-810" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-811"><a href="#cb134-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-812"><a href="#cb134-812" aria-hidden="true" tabindex="-1"></a><span class="fu">### Supergroup corncob</span></span>
<span id="cb134-813"><a href="#cb134-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-814"><a href="#cb134-814" aria-hidden="true" tabindex="-1"></a>What main supergroups are enriched at MCR?</span>
<span id="cb134-815"><a href="#cb134-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-818"><a href="#cb134-818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-819"><a href="#cb134-819" aria-hidden="true" tabindex="-1"></a><span class="co"># # vd</span></span>
<span id="cb134-820"><a href="#cb134-820" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb134-821"><a href="#cb134-821" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% vd))</span></span>
<span id="cb134-822"><a href="#cb134-822" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb134-823"><a href="#cb134-823" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb134-824"><a href="#cb134-824" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% picc))</span></span>
<span id="cb134-825"><a href="#cb134-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-826"><a href="#cb134-826" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_super <span class="sc">%&gt;%</span> </span>
<span id="cb134-827"><a href="#cb134-827" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span>
<span id="cb134-828"><a href="#cb134-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-829"><a href="#cb134-829" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd %&gt;%</span></span>
<span id="cb134-830"><a href="#cb134-830" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb134-831"><a href="#cb134-831" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb134-832"><a href="#cb134-832" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb134-833"><a href="#cb134-833" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb134-834"><a href="#cb134-834" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb134-835"><a href="#cb134-835" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb134-836"><a href="#cb134-836" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb134-837"><a href="#cb134-837" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb134-838"><a href="#cb134-838" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb134-839"><a href="#cb134-839" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "VD supergroup")</span></span>
<span id="cb134-840"><a href="#cb134-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-841"><a href="#cb134-841" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc %&gt;%</span></span>
<span id="cb134-842"><a href="#cb134-842" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb134-843"><a href="#cb134-843" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb134-844"><a href="#cb134-844" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb134-845"><a href="#cb134-845" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb134-846"><a href="#cb134-846" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb134-847"><a href="#cb134-847" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb134-848"><a href="#cb134-848" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb134-849"><a href="#cb134-849" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb134-850"><a href="#cb134-850" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb134-851"><a href="#cb134-851" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "piccard supergroup")</span></span>
<span id="cb134-852"><a href="#cb134-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-853"><a href="#cb134-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-854"><a href="#cb134-854" aria-hidden="true" tabindex="-1"></a>Plot supergroup enrichment</span>
<span id="cb134-855"><a href="#cb134-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-858"><a href="#cb134-858" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-859"><a href="#cb134-859" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="sc">%&gt;%</span></span>
<span id="cb134-860"><a href="#cb134-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-861"><a href="#cb134-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Supergroup, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-862"><a href="#cb134-862" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-863"><a href="#cb134-863" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-864"><a href="#cb134-864" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-865"><a href="#cb134-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-866"><a href="#cb134-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-867"><a href="#cb134-867" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb134-868"><a href="#cb134-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-869"><a href="#cb134-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR supergroup"</span>)</span>
<span id="cb134-870"><a href="#cb134-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-871"><a href="#cb134-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-872"><a href="#cb134-872" aria-hidden="true" tabindex="-1"></a><span class="fu">### Phylum corncob analysis</span></span>
<span id="cb134-873"><a href="#cb134-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-876"><a href="#cb134-876" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-877"><a href="#cb134-877" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_phy)</span>
<span id="cb134-878"><a href="#cb134-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-879"><a href="#cb134-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-882"><a href="#cb134-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-883"><a href="#cb134-883" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="sc">%&gt;%</span></span>
<span id="cb134-884"><a href="#cb134-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-885"><a href="#cb134-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Phylum, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-886"><a href="#cb134-886" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-887"><a href="#cb134-887" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-888"><a href="#cb134-888" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Phylum), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-889"><a href="#cb134-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-890"><a href="#cb134-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-891"><a href="#cb134-891" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb134-892"><a href="#cb134-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-893"><a href="#cb134-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR Phylum"</span>)</span>
<span id="cb134-894"><a href="#cb134-894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-895"><a href="#cb134-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-896"><a href="#cb134-896" aria-hidden="true" tabindex="-1"></a><span class="fu">### Class corncob analysis</span></span>
<span id="cb134-897"><a href="#cb134-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-900"><a href="#cb134-900" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-901"><a href="#cb134-901" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_class <span class="sc">%&gt;%</span></span>
<span id="cb134-902"><a href="#cb134-902" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span>
<span id="cb134-903"><a href="#cb134-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-904"><a href="#cb134-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-905"><a href="#cb134-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb134-906"><a href="#cb134-906" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb134-907"><a href="#cb134-907" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb134-908"><a href="#cb134-908" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="sc">%&gt;%</span></span>
<span id="cb134-909"><a href="#cb134-909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Class, <span class="fu">c</span>(Phylum, Class), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-910"><a href="#cb134-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-911"><a href="#cb134-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Class, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-912"><a href="#cb134-912" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-913"><a href="#cb134-913" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-914"><a href="#cb134-914" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-915"><a href="#cb134-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-916"><a href="#cb134-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-917"><a href="#cb134-917" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb134-918"><a href="#cb134-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-919"><a href="#cb134-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Class level test for differential abundance"</span>)</span>
<span id="cb134-920"><a href="#cb134-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-921"><a href="#cb134-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-922"><a href="#cb134-922" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Class level looks pretty good. Keep this one. Looks at major taxonomic groups that were more enriched at vents? Work on the language here. Repeat vent vs. plume at ASV level. ID some of the core ASVs that can help elaborate on what we see above (table in supplementary)</span></span>
<span id="cb134-923"><a href="#cb134-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-924"><a href="#cb134-924" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Interpretation* :</span></span>
<span id="cb134-925"><a href="#cb134-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-926"><a href="#cb134-926" aria-hidden="true" tabindex="-1"></a><span class="fu">### Order corncob</span></span>
<span id="cb134-927"><a href="#cb134-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-930"><a href="#cb134-930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-931"><a href="#cb134-931" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_order)</span>
<span id="cb134-932"><a href="#cb134-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-933"><a href="#cb134-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-934"><a href="#cb134-934" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb134-935"><a href="#cb134-935" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb134-936"><a href="#cb134-936" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb134-937"><a href="#cb134-937" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="sc">%&gt;%</span></span>
<span id="cb134-938"><a href="#cb134-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Order, <span class="fu">c</span>(Phylum, Class, Order), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-939"><a href="#cb134-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-940"><a href="#cb134-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Order, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-941"><a href="#cb134-941" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-942"><a href="#cb134-942" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-943"><a href="#cb134-943" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-944"><a href="#cb134-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-945"><a href="#cb134-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-946"><a href="#cb134-946" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb134-947"><a href="#cb134-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-948"><a href="#cb134-948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Order level test for differential abundance"</span>)</span>
<span id="cb134-949"><a href="#cb134-949" aria-hidden="true" tabindex="-1"></a><span class="co"># ?geom_errorbar</span></span>
<span id="cb134-950"><a href="#cb134-950" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-951"><a href="#cb134-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-952"><a href="#cb134-952" aria-hidden="true" tabindex="-1"></a><span class="fu">### Family corncob</span></span>
<span id="cb134-953"><a href="#cb134-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-954"><a href="#cb134-954" aria-hidden="true" tabindex="-1"></a>Plan to pairing with tree below</span>
<span id="cb134-955"><a href="#cb134-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-958"><a href="#cb134-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-959"><a href="#cb134-959" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_fam)</span>
<span id="cb134-960"><a href="#cb134-960" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-961"><a href="#cb134-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-964"><a href="#cb134-964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-965"><a href="#cb134-965" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="sc">%&gt;%</span></span>
<span id="cb134-966"><a href="#cb134-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Family, <span class="fu">c</span>(Class, Order, Family), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-967"><a href="#cb134-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-968"><a href="#cb134-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Family, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-969"><a href="#cb134-969" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-970"><a href="#cb134-970" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-971"><a href="#cb134-971" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-972"><a href="#cb134-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Phylum <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-973"><a href="#cb134-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-974"><a href="#cb134-974" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb134-975"><a href="#cb134-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-976"><a href="#cb134-976" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Family level test for differential abundance"</span>)</span>
<span id="cb134-977"><a href="#cb134-977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-978"><a href="#cb134-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-979"><a href="#cb134-979" aria-hidden="true" tabindex="-1"></a><span class="fu">### Genus corncob</span></span>
<span id="cb134-980"><a href="#cb134-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-981"><a href="#cb134-981" aria-hidden="true" tabindex="-1"></a>Plan to pairing with tree below</span>
<span id="cb134-982"><a href="#cb134-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-985"><a href="#cb134-985" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-986"><a href="#cb134-986" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_genera)</span>
<span id="cb134-987"><a href="#cb134-987" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-988"><a href="#cb134-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-991"><a href="#cb134-991" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-992"><a href="#cb134-992" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="sc">%&gt;%</span></span>
<span id="cb134-993"><a href="#cb134-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Genus, <span class="fu">c</span>(Phylum, Genus), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-994"><a href="#cb134-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-995"><a href="#cb134-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Genus, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-996"><a href="#cb134-996" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-997"><a href="#cb134-997" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-998"><a href="#cb134-998" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-999"><a href="#cb134-999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-1000"><a href="#cb134-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-1001"><a href="#cb134-1001" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb134-1002"><a href="#cb134-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-1003"><a href="#cb134-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Genus level test for differential abundance"</span>)</span>
<span id="cb134-1004"><a href="#cb134-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1005"><a href="#cb134-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1006"><a href="#cb134-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">### Species corncob</span></span>
<span id="cb134-1007"><a href="#cb134-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1010"><a href="#cb134-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1011"><a href="#cb134-1011" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_spp)</span>
<span id="cb134-1012"><a href="#cb134-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1013"><a href="#cb134-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1014"><a href="#cb134-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb134-1015"><a href="#cb134-1015" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="sc">%&gt;%</span></span>
<span id="cb134-1016"><a href="#cb134-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Species, <span class="fu">c</span>(Genus, Species), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-1017"><a href="#cb134-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-1018"><a href="#cb134-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Species, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb134-1019"><a href="#cb134-1019" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-1020"><a href="#cb134-1020" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb134-1021"><a href="#cb134-1021" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-1022"><a href="#cb134-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Order <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-1023"><a href="#cb134-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-1024"><a href="#cb134-1024" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb134-1025"><a href="#cb134-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-1026"><a href="#cb134-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Species level test for differential abundance"</span>)</span>
<span id="cb134-1027"><a href="#cb134-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1028"><a href="#cb134-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1029"><a href="#cb134-1029" aria-hidden="true" tabindex="-1"></a><span class="fu"># Compare in situ and Tf samples</span></span>
<span id="cb134-1030"><a href="#cb134-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1031"><a href="#cb134-1031" aria-hidden="true" tabindex="-1"></a>Examine in situ to T final samples for presence/absence.</span>
<span id="cb134-1032"><a href="#cb134-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1033"><a href="#cb134-1033" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Repeat corncob analysis. Add in situ vs. incubation and run corncob on incubation coefficient. Do this at class and ASV level to ID those ASVs that are specifically positively differentially variable in the incubation samples compared to the in situ.</span></span>
<span id="cb134-1034"><a href="#cb134-1034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1037"><a href="#cb134-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1038"><a href="#cb134-1038" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span>
<span id="cb134-1039"><a href="#cb134-1039" aria-hidden="true" tabindex="-1"></a><span class="co"># View(asv_wtax_qc)</span></span>
<span id="cb134-1040"><a href="#cb134-1040" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1041"><a href="#cb134-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1042"><a href="#cb134-1042" aria-hidden="true" tabindex="-1"></a>Calculate percent change from in situ to Tf for all grazing experiments</span>
<span id="cb134-1043"><a href="#cb134-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1046"><a href="#cb134-1046" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1047"><a href="#cb134-1047" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb134-1048"><a href="#cb134-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1049"><a href="#cb134-1049" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract taxa information</span></span>
<span id="cb134-1050"><a href="#cb134-1050" aria-hidden="true" tabindex="-1"></a>taxa_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(TAX)) <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb134-1051"><a href="#cb134-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1052"><a href="#cb134-1052" aria-hidden="true" tabindex="-1"></a>perc_change <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb134-1053"><a href="#cb134-1053" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1054"><a href="#cb134-1054" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb134-1055"><a href="#cb134-1055" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SAMPLETYPE, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1056"><a href="#cb134-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1057"><a href="#cb134-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ASSAY =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-1058"><a href="#cb134-1058" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Tf"</span>,</span>
<span id="cb134-1059"><a href="#cb134-1059" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"insitu"</span></span>
<span id="cb134-1060"><a href="#cb134-1060" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb134-1061"><a href="#cb134-1061" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb134-1062"><a href="#cb134-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SAMPLETYPE) <span class="sc">%&gt;%</span></span>
<span id="cb134-1063"><a href="#cb134-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> ASSAY, <span class="at">values_from =</span> avg_seq, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1064"><a href="#cb134-1064" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only ASVs present in both in situ and incubation experiments.</span></span>
<span id="cb134-1065"><a href="#cb134-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># remove NAs</span></span>
<span id="cb134-1066"><a href="#cb134-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(insitu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> Tf <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove if 1 or the other are zero</span></span>
<span id="cb134-1067"><a href="#cb134-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(insitu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Tf <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb134-1068"><a href="#cb134-1068" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">seq_change =</span> Tf <span class="sc">-</span> insitu) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1069"><a href="#cb134-1069" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">category_change =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-1070"><a href="#cb134-1070" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Decrease"</span>,</span>
<span id="cb134-1071"><a href="#cb134-1071" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Increase"</span>,</span>
<span id="cb134-1072"><a href="#cb134-1072" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No Change"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1073"><a href="#cb134-1073" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add in supergroup information</span></span>
<span id="cb134-1074"><a href="#cb134-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(taxa_table, FeatureID, Domain<span class="sc">:</span>Species) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1075"><a href="#cb134-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-1076"><a href="#cb134-1076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1077"><a href="#cb134-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb134-1078"><a href="#cb134-1078" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb134-1079"><a href="#cb134-1079" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb134-1080"><a href="#cb134-1080" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1081"><a href="#cb134-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-1082"><a href="#cb134-1082" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb134-1083"><a href="#cb134-1083" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb134-1084"><a href="#cb134-1084" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb134-1085"><a href="#cb134-1085" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb134-1086"><a href="#cb134-1086" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb134-1087"><a href="#cb134-1087" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb134-1088"><a href="#cb134-1088" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb134-1089"><a href="#cb134-1089" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb134-1090"><a href="#cb134-1090" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb134-1091"><a href="#cb134-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1092"><a href="#cb134-1092" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(perc_change<span class="sc">$</span>category_change)</span>
<span id="cb134-1093"><a href="#cb134-1093" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(perc_change)</span>
<span id="cb134-1094"><a href="#cb134-1094" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(perc_change[1:2])</span></span>
<span id="cb134-1095"><a href="#cb134-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1096"><a href="#cb134-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1097"><a href="#cb134-1097" aria-hidden="true" tabindex="-1"></a>Of the ASVs that appeared in both in situ and Tf for each grazing experiment, 1073 decreased in sequence relative abundance, and over 1200 increased. Only 28 showed no change in sequence relative abundance.</span>
<span id="cb134-1098"><a href="#cb134-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1099"><a href="#cb134-1099" aria-hidden="true" tabindex="-1"></a>Formatted table to show sequence increase vs. decrease PER ASV from insitu to experiment Tf.</span>
<span id="cb134-1100"><a href="#cb134-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1101"><a href="#cb134-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=9}</span></span>
<span id="cb134-1102"><a href="#cb134-1102" aria-hidden="true" tabindex="-1"></a>all_taxa_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ciliophora"</span>, <span class="st">"Alveolata-Dinoflagellata"</span>, <span class="st">"Protalveolata"</span>, <span class="st">"Other Alveolata"</span>, <span class="st">"Amoebozoa"</span>, <span class="st">"Apusozoa"</span>, <span class="st">"Excavata"</span>, <span class="st">"Hacrobia"</span>, <span class="st">"Archaeplastida"</span>, <span class="st">"Rhizaria"</span>, <span class="st">"Rhizaria-Radiolaria"</span>, <span class="st">"Rhizaria-Cercozoa"</span>, <span class="st">"Stramenopiles"</span>, <span class="st">"Stramenopiles-Opalozoa"</span>, <span class="st">"Stramenopiles-Sagenista"</span>, <span class="st">"Stramenopiles-Ochrophyta"</span>, <span class="st">"Opisthokonta"</span>, <span class="st">"Unknown Eukaryota"</span>)</span>
<span id="cb134-1103"><a href="#cb134-1103" aria-hidden="true" tabindex="-1"></a><span class="co"># length(all_taxa_order)</span></span>
<span id="cb134-1104"><a href="#cb134-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1105"><a href="#cb134-1105" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>,<span class="st">"#cc4c02"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#238b45"</span>, <span class="st">"#c6dbef"</span>, <span class="st">"#99d8c9"</span>,<span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#f0f0f0"</span>)</span>
<span id="cb134-1106"><a href="#cb134-1106" aria-hidden="true" tabindex="-1"></a><span class="co"># length(all_taxa_color)</span></span>
<span id="cb134-1107"><a href="#cb134-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1108"><a href="#cb134-1108" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb134-1109"><a href="#cb134-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, category_change, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1110"><a href="#cb134-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_change =</span> <span class="fu">sum</span>(seq_change),</span>
<span id="cb134-1111"><a href="#cb134-1111" aria-hidden="true" tabindex="-1"></a>            <span class="at">asv_total =</span> <span class="fu">n_distinct</span>(FeatureID)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1112"><a href="#cb134-1112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP_ORDER =</span> <span class="fu">factor</span>(SUPERGROUP, <span class="at">levels =</span> all_taxa_order),</span>
<span id="cb134-1113"><a href="#cb134-1113" aria-hidden="true" tabindex="-1"></a>         <span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb134-1114"><a href="#cb134-1114" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1115"><a href="#cb134-1115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(SUPERGROUP_ORDER = factor(SUPERGROUP, levels = all_taxa_order)) %&gt;% </span></span>
<span id="cb134-1116"><a href="#cb134-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sum_change, <span class="at">y =</span> VENT_ORDER, <span class="at">fill =</span> SUPERGROUP_ORDER)) <span class="sc">+</span></span>
<span id="cb134-1117"><a href="#cb134-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-1118"><a href="#cb134-1118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(limits = c(-15000, 150000)) +</span></span>
<span id="cb134-1119"><a href="#cb134-1119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color) <span class="sc">+</span></span>
<span id="cb134-1120"><a href="#cb134-1120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(SITE_ORER ~ ., space = "free", scales = "free") +</span></span>
<span id="cb134-1121"><a href="#cb134-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb134-1122"><a href="#cb134-1122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb134-1123"><a href="#cb134-1123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb134-1124"><a href="#cb134-1124" aria-hidden="true" tabindex="-1"></a>          <span class="co"># strip.text = element_blank(),</span></span>
<span id="cb134-1125"><a href="#cb134-1125" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-1126"><a href="#cb134-1126" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-1127"><a href="#cb134-1127" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb134-1128"><a href="#cb134-1128" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-1129"><a href="#cb134-1129" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb134-1130"><a href="#cb134-1130" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb134-1131"><a href="#cb134-1131" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.background = element_blank(),</span></span>
<span id="cb134-1132"><a href="#cb134-1132" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb134-1133"><a href="#cb134-1133" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb134-1134"><a href="#cb134-1134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sequence Decrease           Sequence Increase"</span>, <span class="at">y =</span> <span class="st">""</span>)</span>
<span id="cb134-1135"><a href="#cb134-1135" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_bar(filter(category_change == "Increase"), stat = "identity") </span></span>
<span id="cb134-1136"><a href="#cb134-1136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1137"><a href="#cb134-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1140"><a href="#cb134-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1141"><a href="#cb134-1141" aria-hidden="true" tabindex="-1"></a><span class="co"># str(perc_change)</span></span>
<span id="cb134-1142"><a href="#cb134-1142" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb134-1143"><a href="#cb134-1143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, category_change, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1144"><a href="#cb134-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_change =</span> <span class="fu">sum</span>(seq_change),</span>
<span id="cb134-1145"><a href="#cb134-1145" aria-hidden="true" tabindex="-1"></a>            <span class="at">asv_total =</span> <span class="fu">n_distinct</span>(FeatureID)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1146"><a href="#cb134-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb134-1147"><a href="#cb134-1147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">asv_int =</span> <span class="fu">as.numeric</span>(asv_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1148"><a href="#cb134-1148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">asv_change =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-1149"><a href="#cb134-1149" aria-hidden="true" tabindex="-1"></a>           category_change <span class="sc">==</span> <span class="st">"Decrease"</span> <span class="sc">~</span> (<span class="dv">0</span> <span class="sc">-</span> asv_int),</span>
<span id="cb134-1150"><a href="#cb134-1150" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> asv_int</span>
<span id="cb134-1151"><a href="#cb134-1151" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1152"><a href="#cb134-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP_ORDER =</span> <span class="fu">factor</span>(SUPERGROUP, <span class="at">levels =</span> all_taxa_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1153"><a href="#cb134-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> asv_change, <span class="at">y =</span> VENT, <span class="at">fill =</span> SUPERGROUP_ORDER)) <span class="sc">+</span></span>
<span id="cb134-1154"><a href="#cb134-1154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb134-1155"><a href="#cb134-1155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">350</span>, <span class="dv">350</span>)) <span class="sc">+</span></span>
<span id="cb134-1156"><a href="#cb134-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color) <span class="sc">+</span></span>
<span id="cb134-1157"><a href="#cb134-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(SITE <span class="sc">~</span> ., <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb134-1158"><a href="#cb134-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb134-1159"><a href="#cb134-1159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb134-1160"><a href="#cb134-1160" aria-hidden="true" tabindex="-1"></a>          <span class="co"># strip.text = element_blank(),</span></span>
<span id="cb134-1161"><a href="#cb134-1161" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-1162"><a href="#cb134-1162" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-1163"><a href="#cb134-1163" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb134-1164"><a href="#cb134-1164" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb134-1165"><a href="#cb134-1165" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb134-1166"><a href="#cb134-1166" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb134-1167"><a href="#cb134-1167" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.background = element_blank(),</span></span>
<span id="cb134-1168"><a href="#cb134-1168" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb134-1169"><a href="#cb134-1169" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb134-1170"><a href="#cb134-1170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"ASV change"</span>, <span class="at">y =</span> <span class="st">""</span>)</span>
<span id="cb134-1171"><a href="#cb134-1171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1172"><a href="#cb134-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1175"><a href="#cb134-1175" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1176"><a href="#cb134-1176" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb134-1177"><a href="#cb134-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SITE, VENT, SUPERGROUP)</span>
<span id="cb134-1178"><a href="#cb134-1178" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1179"><a href="#cb134-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1180"><a href="#cb134-1180" aria-hidden="true" tabindex="-1"></a><span class="fu">## CLR change</span></span>
<span id="cb134-1181"><a href="#cb134-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1184"><a href="#cb134-1184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1185"><a href="#cb134-1185" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb134-1186"><a href="#cb134-1186" aria-hidden="true" tabindex="-1"></a>tmp_tax <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb134-1187"><a href="#cb134-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1188"><a href="#cb134-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1189"><a href="#cb134-1189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb134-1190"><a href="#cb134-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1191"><a href="#cb134-1191" aria-hidden="true" tabindex="-1"></a>numeric_tmp <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb134-1192"><a href="#cb134-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1193"><a href="#cb134-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1194"><a href="#cb134-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1195"><a href="#cb134-1195" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unite(TAX, Taxon, FeatureID, sep = "__") %&gt;% </span></span>
<span id="cb134-1196"><a href="#cb134-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1197"><a href="#cb134-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1198"><a href="#cb134-1198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb134-1199"><a href="#cb134-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1200"><a href="#cb134-1200" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(numeric_tmp))))</span>
<span id="cb134-1201"><a href="#cb134-1201" aria-hidden="true" tabindex="-1"></a><span class="do">## From above </span></span>
<span id="cb134-1202"><a href="#cb134-1202" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(logratio_mcr)</span>
<span id="cb134-1203"><a href="#cb134-1203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1204"><a href="#cb134-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1205"><a href="#cb134-1205" aria-hidden="true" tabindex="-1"></a>Reformat to generate dot plot</span>
<span id="cb134-1206"><a href="#cb134-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1209"><a href="#cb134-1209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1210"><a href="#cb134-1210" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> logratio_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb134-1211"><a href="#cb134-1211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1212"><a href="#cb134-1212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>((<span class="fu">starts_with</span>(<span class="st">"VonDamm.Incubation"</span>) <span class="sc">|</span> <span class="fu">starts_with</span>(<span class="st">"Piccard.Incubation"</span>)), <span class="at">names_to =</span> <span class="st">"TF"</span>, <span class="at">values_to =</span> <span class="st">"tf_clr"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1213"><a href="#cb134-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>((<span class="fu">starts_with</span>(<span class="st">"VonDamm."</span>) <span class="sc">|</span> <span class="fu">starts_with</span>(<span class="st">"Piccard."</span>)), <span class="at">names_to =</span> <span class="st">"IN SITU"</span>, <span class="at">values_to =</span> <span class="st">"insitu_clr"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1214"><a href="#cb134-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(taxa_table, FeatureID, Domain<span class="sc">:</span>Species) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1215"><a href="#cb134-1215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-1216"><a href="#cb134-1216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1217"><a href="#cb134-1217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb134-1218"><a href="#cb134-1218" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb134-1219"><a href="#cb134-1219" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb134-1220"><a href="#cb134-1220" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1221"><a href="#cb134-1221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb134-1222"><a href="#cb134-1222" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb134-1223"><a href="#cb134-1223" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb134-1224"><a href="#cb134-1224" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb134-1225"><a href="#cb134-1225" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb134-1226"><a href="#cb134-1226" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb134-1227"><a href="#cb134-1227" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb134-1228"><a href="#cb134-1228" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb134-1229"><a href="#cb134-1229" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb134-1230"><a href="#cb134-1230" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb134-1231"><a href="#cb134-1231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(TF, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"TYPE_TF"</span>, <span class="st">"VENT_TF"</span>), <span class="at">sep =</span> <span class="st">".2020."</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1232"><a href="#cb134-1232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="st">`</span><span class="at">IN SITU</span><span class="st">`</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"TYPE_insitu"</span>, <span class="st">"VENT_insitu"</span>), <span class="at">sep =</span> <span class="st">".2020."</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1233"><a href="#cb134-1233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VENT_insitu <span class="sc">==</span> VENT_TF) <span class="sc">%&gt;%</span> </span>
<span id="cb134-1234"><a href="#cb134-1234" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(TYPE_TF, <span class="at">into=</span><span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"TF"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>) <span class="sc">%&gt;%</span> <span class="fu">separate</span>(TYPE_insitu, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)</span>
<span id="cb134-1235"><a href="#cb134-1235" aria-hidden="true" tabindex="-1"></a><span class="co"># ?pivot_longer</span></span>
<span id="cb134-1236"><a href="#cb134-1236" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tmp)</span>
<span id="cb134-1237"><a href="#cb134-1237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1238"><a href="#cb134-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1239"><a href="#cb134-1239" aria-hidden="true" tabindex="-1"></a>Try x by y comparison.</span>
<span id="cb134-1240"><a href="#cb134-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1243"><a href="#cb134-1243" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1244"><a href="#cb134-1244" aria-hidden="true" tabindex="-1"></a>tmp <span class="sc">%&gt;%</span> </span>
<span id="cb134-1245"><a href="#cb134-1245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tf_clr <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-1246"><a href="#cb134-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(insitu_clr <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb134-1247"><a href="#cb134-1247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> insitu_clr, <span class="at">y =</span> tf_clr, <span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb134-1248"><a href="#cb134-1248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb134-1249"><a href="#cb134-1249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(VENT_insitu <span class="sc">~</span> SUPERGROUP) <span class="sc">+</span></span>
<span id="cb134-1250"><a href="#cb134-1250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb134-1251"><a href="#cb134-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">8</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb134-1252"><a href="#cb134-1252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb134-1253"><a href="#cb134-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span>
<span id="cb134-1254"><a href="#cb134-1254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1255"><a href="#cb134-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1256"><a href="#cb134-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1257"><a href="#cb134-1257" aria-hidden="true" tabindex="-1"></a>TO DO:</span>
<span id="cb134-1258"><a href="#cb134-1258" aria-hidden="true" tabindex="-1"></a>Make table with total starting ASVs, number that were shared, and final in the Tf.</span>
<span id="cb134-1259"><a href="#cb134-1259" aria-hidden="true" tabindex="-1"></a>Alluvial plots? from T0 to Tf by supergroup? Then more detailed plots like the above can be in supplemental?</span>
<span id="cb134-1260"><a href="#cb134-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1261"><a href="#cb134-1261" aria-hidden="true" tabindex="-1"></a><span class="fu"># Tree</span></span>
<span id="cb134-1262"><a href="#cb134-1262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1265"><a href="#cb134-1265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1266"><a href="#cb134-1266" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span>
<span id="cb134-1267"><a href="#cb134-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1268"><a href="#cb134-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1269"><a href="#cb134-1269" aria-hidden="true" tabindex="-1"></a>What is relatedness between piccard and von damm ciliate communities? First try at</span>
<span id="cb134-1270"><a href="#cb134-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1273"><a href="#cb134-1273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1274"><a href="#cb134-1274" aria-hidden="true" tabindex="-1"></a><span class="co"># head(tax_table(physeq_mcr))</span></span>
<span id="cb134-1275"><a href="#cb134-1275" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_ciliate &lt;- subset_taxa(physeq_mcr, Phylum == "Ciliophora") %&gt;% </span></span>
<span id="cb134-1276"><a href="#cb134-1276" aria-hidden="true" tabindex="-1"></a><span class="co">#   subset_samples(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb134-1277"><a href="#cb134-1277" aria-hidden="true" tabindex="-1"></a><span class="co">#   tax_glom(taxrank="Species")</span></span>
<span id="cb134-1278"><a href="#cb134-1278" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb134-1279"><a href="#cb134-1279" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_ciliate</span></span>
<span id="cb134-1280"><a href="#cb134-1280" aria-hidden="true" tabindex="-1"></a><span class="co"># # head(tax_table(mcr_ciliate))</span></span>
<span id="cb134-1281"><a href="#cb134-1281" aria-hidden="true" tabindex="-1"></a><span class="co"># # subset_ciliate &lt;- prune_samples(sample_sums(mcr_ciliate) &gt; 100)</span></span>
<span id="cb134-1282"><a href="#cb134-1282" aria-hidden="true" tabindex="-1"></a><span class="co"># phy_tree(mcr_ciliate)</span></span>
<span id="cb134-1283"><a href="#cb134-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1284"><a href="#cb134-1284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1287"><a href="#cb134-1287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1288"><a href="#cb134-1288" aria-hidden="true" tabindex="-1"></a><span class="co"># Bug in phyloseq requires update with dev version on github:</span></span>
<span id="cb134-1289"><a href="#cb134-1289" aria-hidden="true" tabindex="-1"></a><span class="co"># library("devtools")</span></span>
<span id="cb134-1290"><a href="#cb134-1290" aria-hidden="true" tabindex="-1"></a><span class="co"># install_github("joey711/phyloseq")</span></span>
<span id="cb134-1291"><a href="#cb134-1291" aria-hidden="true" tabindex="-1"></a><span class="co"># library(phyloseq)</span></span>
<span id="cb134-1292"><a href="#cb134-1292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1293"><a href="#cb134-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1294"><a href="#cb134-1294" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=18, fig.width=9}</span></span>
<span id="cb134-1295"><a href="#cb134-1295" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_tree(clean, </span></span>
<span id="cb134-1296"><a href="#cb134-1296" aria-hidden="true" tabindex="-1"></a><span class="co">#           color = "SITE",</span></span>
<span id="cb134-1297"><a href="#cb134-1297" aria-hidden="true" tabindex="-1"></a><span class="co">#           label.tips = "Species", </span></span>
<span id="cb134-1298"><a href="#cb134-1298" aria-hidden="true" tabindex="-1"></a><span class="co">#           shape = "SAMPLETYPE", size = "abundance", base.spacing = 0.06)</span></span>
<span id="cb134-1299"><a href="#cb134-1299" aria-hidden="true" tabindex="-1"></a><span class="co"># ?plot_tree</span></span>
<span id="cb134-1300"><a href="#cb134-1300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb134-1301"><a href="#cb134-1301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1302"><a href="#cb134-1302" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session information</span></span>
<span id="cb134-1303"><a href="#cb134-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-1306"><a href="#cb134-1306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb134-1307"><a href="#cb134-1307" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb134-1308"><a href="#cb134-1308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>