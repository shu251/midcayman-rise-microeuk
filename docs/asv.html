<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mid-Cayman Rise analysis - 18S survey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Mid-Cayman Rise analysis</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./grazing.html">Grazing analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./asv.html" aria-current="page">Sequence analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sequence-qc.html">Sequence QC &amp; import</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#import-sequence-and-metadata" id="toc-import-sequence-and-metadata" class="nav-link active" data-scroll-target="#import-sequence-and-metadata"><span class="toc-section-number">1</span>  Import sequence and metadata</a>
  <ul class="collapse">
  <li><a href="#import-asv-r-objects" id="toc-import-asv-r-objects" class="nav-link" data-scroll-target="#import-asv-r-objects"><span class="toc-section-number">1.1</span>  Import ASV R objects</a></li>
  <li><a href="#factor---legendcolor-key" id="toc-factor---legendcolor-key" class="nav-link" data-scroll-target="#factor---legendcolor-key"><span class="toc-section-number">1.2</span>  Factor - legend/color key</a></li>
  </ul></li>
  <li><a href="#visualize-metadata" id="toc-visualize-metadata" class="nav-link" data-scroll-target="#visualize-metadata"><span class="toc-section-number">2</span>  Visualize metadata</a></li>
  <li><a href="#community-structure-diversity-at-von-damm-piccard" id="toc-community-structure-diversity-at-von-damm-piccard" class="nav-link" data-scroll-target="#community-structure-diversity-at-von-damm-piccard"><span class="toc-section-number">3</span>  Community structure &amp; diversity at Von Damm &amp; Piccard</a>
  <ul class="collapse">
  <li><a href="#cluster-analysis" id="toc-cluster-analysis" class="nav-link" data-scroll-target="#cluster-analysis"><span class="toc-section-number">3.1</span>  Cluster analysis</a></li>
  <li><a href="#cluster-analysis-with-grazing-assays" id="toc-cluster-analysis-with-grazing-assays" class="nav-link" data-scroll-target="#cluster-analysis-with-grazing-assays"><span class="toc-section-number">3.2</span>  Cluster analysis with grazing assays</a>
  <ul class="collapse">
  <li><a href="#pcoa-with-all-samples" id="toc-pcoa-with-all-samples" class="nav-link" data-scroll-target="#pcoa-with-all-samples">PCoA with all samples</a></li>
  <li><a href="#pcoa-with-in-situ-only" id="toc-pcoa-with-in-situ-only" class="nav-link" data-scroll-target="#pcoa-with-in-situ-only">PCoA with in situ only</a></li>
  </ul></li>
  <li><a href="#taxonomic-breakdown" id="toc-taxonomic-breakdown" class="nav-link" data-scroll-target="#taxonomic-breakdown"><span class="toc-section-number">3.3</span>  Taxonomic breakdown</a>
  <ul class="collapse">
  <li><a href="#dendrogram-with-bubble-plot" id="toc-dendrogram-with-bubble-plot" class="nav-link" data-scroll-target="#dendrogram-with-bubble-plot">Dendrogram with bubble plot</a></li>
  </ul></li>
  <li><a href="#shared-asvs" id="toc-shared-asvs" class="nav-link" data-scroll-target="#shared-asvs"><span class="toc-section-number">3.4</span>  Shared ASVs</a></li>
  <li><a href="#corncob" id="toc-corncob" class="nav-link" data-scroll-target="#corncob"><span class="toc-section-number">3.5</span>  Corncob</a>
  <ul class="collapse">
  <li><a href="#supergroup-corncob" id="toc-supergroup-corncob" class="nav-link" data-scroll-target="#supergroup-corncob">Supergroup corncob</a></li>
  <li><a href="#phylum-corncob-analysis" id="toc-phylum-corncob-analysis" class="nav-link" data-scroll-target="#phylum-corncob-analysis">Phylum corncob analysis</a></li>
  <li><a href="#class-corncob-analysis" id="toc-class-corncob-analysis" class="nav-link" data-scroll-target="#class-corncob-analysis">Class corncob analysis</a></li>
  <li><a href="#order-corncob" id="toc-order-corncob" class="nav-link" data-scroll-target="#order-corncob">Order corncob</a></li>
  <li><a href="#family-corncob" id="toc-family-corncob" class="nav-link" data-scroll-target="#family-corncob">Family corncob</a></li>
  <li><a href="#genus-corncob" id="toc-genus-corncob" class="nav-link" data-scroll-target="#genus-corncob">Genus corncob</a></li>
  <li><a href="#species-corncob" id="toc-species-corncob" class="nav-link" data-scroll-target="#species-corncob">Species corncob</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#compare-in-situ-and-tf-samples" id="toc-compare-in-situ-and-tf-samples" class="nav-link" data-scroll-target="#compare-in-situ-and-tf-samples"><span class="toc-section-number">4</span>  Compare in situ and Tf samples</a>
  <ul class="collapse">
  <li><a href="#clr-change" id="toc-clr-change" class="nav-link" data-scroll-target="#clr-change"><span class="toc-section-number">4.1</span>  CLR change</a></li>
  </ul></li>
  <li><a href="#tree" id="toc-tree" class="nav-link" data-scroll-target="#tree"><span class="toc-section-number">5</span>  Tree</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information"><span class="toc-section-number">6</span>  Session information</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">18S survey</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="import-sequence-and-metadata" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Import sequence and metadata</h1>
<p>Set up R environment</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(ape)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggupset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import previously sequenced and analyzed tag-sequence data. See https://shu251.github.io/microeuk-amplicon-survey/ for additional information.</p>
<section id="import-asv-r-objects" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="import-asv-r-objects"><span class="header-section-number">1.1</span> Import ASV R objects</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="factor---legendcolor-key" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="factor---legendcolor-key"><span class="header-section-number">1.2</span> Factor - legend/color key</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>, <span class="st">"Plume"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"LotsOShrimp"</span>, <span class="st">"X18"</span>, <span class="st">"OMT"</span>, <span class="st">"OldManTree"</span>, <span class="st">"Rav2"</span>, <span class="st">"MustardStand"</span>, <span class="st">"ShrimpHole"</span>, <span class="st">"WhiteCastle"</span>, <span class="st">"ArrowLoop"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>vent_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"Lots 'O Shrimp"</span>, <span class="st">"X-18"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Ravelin #2"</span>, <span class="st">"Mustard Stand"</span>, <span class="st">"Shrimp Hole"</span>, <span class="st">"White Castle"</span>, <span class="st">"Arrow Loop"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>site_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VD"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for VD and Piccard</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>site_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#418b84"</span>, <span class="st">"#943b36"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># site_colors</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent colors</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>vent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#c2bfc2"</span>,<span class="st">"#ebdac9"</span>, <span class="st">"#c02c5b"</span>, <span class="st">"#cfae20"</span>, <span class="st">"#86952c"</span>, <span class="st">"#a88fab"</span>, <span class="st">"#a88fab"</span>, <span class="st">"#70b2aa"</span>, <span class="st">"#8c906d"</span>, <span class="st">"#806fa2"</span>, <span class="st">"#8cabcf"</span>, <span class="st">"#609482"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vent_colors) <span class="ot">&lt;-</span> vent_fullname</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_colors) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Cooler colors for VD</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># c("#4e7d4b") green</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">#569c91 blue</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#ae8fbb purple</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#ce86ba a lighter purple</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">#31464a dark dark green</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">#8c906d grey green</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#bab446 yellow green</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#ebdac9 white - cream</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">#c2bfc2 grey</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Piccard</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">#c02c5b pink - red</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#d65a9e pink</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="do">##cfae20 yellow</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="visualize-metadata" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Visualize metadata</h1>
<p>Import environmental parameters and look at Mid-Cayman Rise sites.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>env_params <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="at">file =</span> <span class="st">"input-data/table_wenv.txt"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># env_params</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>subset_metadata <span class="ot">&lt;-</span> env_params <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VENT <span class="sc">!=</span> <span class="st">"Quakeplume"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SITE, VENT, SAMPLETYPE, RATE_min, EUK_ml, GRAZING_EFFECT_hr) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">RATE_min_avg =</span> <span class="fu">mean</span>(RATE_min),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">EUK_ml_avg =</span> <span class="fu">mean</span>(EUK_ml),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">GRAZING_EFFECT_hr_avg =</span> <span class="fu">mean</span>(GRAZING_EFFECT_hr)) <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"_avg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>metadata_numeric <span class="ot">&lt;-</span> metadata_mcr <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VENT, SITE, SAMPLETYPE, DEPTH, TEMP, pH, PercSeawater, Mg, H2, H2S, CH4, ProkConc) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> DEPTH<span class="sc">:</span>ProkConc, <span class="at">values_to =</span> <span class="st">"VALUE_TMP"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(VALUE_TMP)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>VALUE_TMP) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(subset_metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mask$eval_all_mutate(quo): NAs introduced by coercion</code></pre>
</div>
</div>
<p>Code to make tile plot for environmental parameters, but may skip this.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tileplot_env &lt;- function(x){</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   metadata_numeric %&gt;% </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(name == x) %&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = name, y = VENT, fill = value)) +</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(color = "black") +</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(SITE + SAMPLETYPE ~ ., switch = "both", space = "free", scale = "free") + theme_linedraw() +</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme(axis.text.y = element_blank(),</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.text = element_blank(),</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.background = element_blank(),</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#           axis.ticks = element_blank(),</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.placement = "outside",</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.title = element_blank(),</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.position = "top",</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.text = element_text(size = 5),</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.background = element_blank(),</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.border = element_blank(),</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.grid = element_blank()) +</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     labs(x = "", y = "") +</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_fill_distiller(palette = "Reds", direction=2, na.value = "grey50")</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Optional plot, likely will not use.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_grid(</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("TEMP") + </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "YlOrRd", direction=2, na.value = "grey50") +</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(axis.text.y = element_text(color = "black", hjust = 1, vjust = 0), </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.text.y = element_text(color = "black", hjust = 0, vjust = 0), </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.placement = "outside"),</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("PercSeawater") + </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Blues", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("pH") + </span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "YlGnBu", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("Mg") + </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  # endemic_env("NO3"),</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("H2") + </span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("CH4") + </span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("H2S") + </span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("ProkConc") + </span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("EUK_ml_avg") + </span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(axis.text.y = element_text(color = "black", hjust = 1, vjust = 0), </span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.text.y = element_text(color = "black", hjust = 0, vjust = 0), </span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.placement = "outside") +</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("GRAZING_EFFECT_hr_avg") + </span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#  nrow = 1,</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">#  rel_widths = c(4,1,1,1,1,1,1,1, 4, 1)</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="community-structure-diversity-at-von-damm-piccard" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Community structure &amp; diversity at Von Damm &amp; Piccard</h1>
<section id="cluster-analysis" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="cluster-analysis"><span class="header-section-number">3.1</span> Cluster analysis</h2>
<p>Ordination analysis and methods to look at whole protistan communities at MCR.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan); <span class="fu">library</span>(ggdendro); <span class="fu">library</span>(compositions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: permute</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is vegan 2.6-2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to compositions, a package for compositional data analysis.
Find an intro with "? compositions"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'compositions'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ape':

    balance</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    anova, cor, cov, dist, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    %*%, norm, scale, scale.default</code></pre>
</div>
</div>
</section>
<section id="cluster-analysis-with-grazing-assays" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="cluster-analysis-with-grazing-assays"><span class="header-section-number">3.2</span> Cluster analysis with grazing assays</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<p>Transform compositional data, center log ratio.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric)))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(logratio_mcr)</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ?alr()</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ?ilr()</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(logratio_mcr)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>variance_logratio <span class="ot">&lt;-</span> (pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 21 rows [1, 2, 3, 4,
5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
</div>
<section id="pcoa-with-all-samples" class="level3">
<h3 class="anchored" data-anchor-id="pcoa-with-all-samples">PCoA with all samples</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(mcr_pca_pts$VENT)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># vent_ids</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># site_fullname</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE_ORDER, <span class="at">fill =</span> VENT_ORDER, <span class="at">alpha =</span> TYPE)) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Dendrogram analysis</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?decostand()</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative abundance</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>rel_abun <span class="ot">&lt;-</span> <span class="fu">decostand</span>(asv_mcr_numeric, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"total"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster dendrogram (average hierarchical clustering)</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>cluster_mcr <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(rel_abun)), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>dendro <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(cluster_mcr)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>mcr_dendro <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(dendro, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">segment</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend)) <span class="sc">+</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">data =</span> <span class="fu">label</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dendro</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Dissimilarity"</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">14</span>), <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#252525"</span>), </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># svg('figs/SUPPLEMENTARY-dendrogram-wreps.svg', w = 10, h = 8)</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
<section id="pcoa-with-in-situ-only" class="level3">
<h3 class="anchored" data-anchor-id="pcoa-with-in-situ-only">PCoA with in situ only</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric_insitu <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>insitu_logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric_insitu)))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>insitu_pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(insitu_logratio_mcr)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>insitu_variance_logratio <span class="ot">&lt;-</span> (insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(insitu_variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points for only insitu samples</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(insitu_pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(insitu_pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 13 rows [1, 2, 3, 4,
5, 6, 7, 8, 9, 10, 11, 12, 13].</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE, <span class="at">fill =</span> VENT, <span class="at">alpha =</span> TYPE)) <span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="768"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep same sample colors to compare to cluster analysis with in situ and Tf samples.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="taxonomic-breakdown" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="taxonomic-breakdown"><span class="header-section-number">3.3</span> Taxonomic breakdown</h2>
<p>Try to pair with dendrogram</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>out_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcr_dendro<span class="sc">$</span>labels)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>mcr_sample_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(out_labels<span class="sc">$</span>label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span> </span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TOTAL_SEQ =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq),</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">REL_ABUN =</span> SUM<span class="sc">/</span>TOTAL_SEQ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUPERGROUP, <span class="at">size =</span> REL_ABUN)) <span class="sc">+</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="fu">aes</span>(<span class="at">size =</span> REL_ABUN, <span class="at">fill =</span> SUPERGROUP, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(. ~ SITE, scales = "free", space = "free") +</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'Taxon'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 10924 rows [3, 10,
11, 12, 13, 14, 18, 19, 20, 21, 23, 27, 28, 30, 31, 32, 33, 34, 35, 38, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 6487 rows [1, 2,
4, 5, 6, 7, 8, 9, 15, 16, 17, 22, 24, 25, 26, 29, 36, 37, 48, 49, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'SUPERGROUP'. You can override using the `.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>bubble</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="1056"></p>
</div>
</div>
<section id="dendrogram-with-bubble-plot" class="level3">
<h3 class="anchored" data-anchor-id="dendrogram-with-bubble-plot">Dendrogram with bubble plot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_dendro_plot + bubble + patchwork::plot_layout(ncol = 2) + patchwork::plot_annotation(tag_levels = "a")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="shared-asvs" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="shared-asvs"><span class="header-section-number">3.4</span> Shared ASVs</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(asv_wtax_qc$SITE)</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  22
  FeatureID SAMPLE value Taxon Conse SAMPL VENT  SITE  SAMPL DEPTH SAMPL
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
1 00056209 52_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
2 00056209 53_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
3 00056209 54_MC     0 Euka     0.8 "VonDa Must VonD ""      ""    Incuba
4 00056209 55_MC     0 Euka     0.8 "VonDa Shri VonD ""      ""    Incuba
5 00056209 57_MC     0 Euka     0.8 "Picca Shri Picc ""      ""    Incuba
6 00056209 58_MC     0 Euka     0.8 "VonDa Plume VonD ""      ""    Incuba
#  with 11 more variables: SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;,
#   pH &lt;chr&gt;, PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, and abbreviated variable names
#   Consensus, SAMPLENAME, SAMPLEID, SAMPLETYPE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(TAX)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to generate upsetR plot with varied taxonomic levels.</p>
<p>Questions:</p>
<ul>
<li><p>How many ASVs are shared among vent sites within Von Damm and Piccard?</p></li>
<li><p>What about shared ASVs across each vent field?</p></li>
<li><p>Is there a taxonomic level that drives site-to-site or field-to-field community dissimilarity?</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># options for taxa: SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 5926 rows [5, 6, 7,
8, 9, 10, 11, 14, 15, 16, 17, 20, 21, 22, 24, 25, 26, 28, 29, 30, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 3451 rows [1, 2,
3, 4, 12, 13, 18, 19, 23, 27, 35, 44, 45, 46, 48, 49, 53, 54, 55, 56, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME', 'VENT'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 7678 rows [1, 2, 3,
4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SupergroupPhylum'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="1056"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to reduce noise and show sample type to vent ecosystem variability.</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Taxon, SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 5926 rows [5, 6, 7,
8, 9, 10, 11, 14, 15, 16, 17, 20, 21, 22, 24, 25, 26, 28, 29, 30, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 3451 rows [1, 2,
3, 4, 12, 13, 18, 19, 23, 27, 35, 44, 45, 46, 48, 49, 53, 54, 55, 56, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME', 'VENT',
'SupergroupPhylum'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 7678 rows [1, 2, 3,
4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SupergroupPhylum', 'Taxon'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'SupergroupPhylum'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 300 rows containing non-finite values (stat_count).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
<p>Example comparisons of shared taxonomic levels. <em>Explanation</em>: At ASV level, most ASVs are not shared across samples. So at other taxonomic categories, are these taxa also present or are there whole classes not present?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 10</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 15</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, SupergroupPhylum)</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># library(plotly)</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplotly(tmp)</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, Class) + theme(legend.position = "none")</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, Supergroup) + theme(legend.position = "none")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A better visualization may be a presence/absence across samples with a tile plot.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>make_tile_plot_pa <span class="ot">&lt;-</span> <span class="cf">function</span>(df, taxa_level, level0){ </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  taxa_select <span class="ot">&lt;-</span> <span class="fu">enquo</span>(taxa_level)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  taxa_select_higher <span class="ot">&lt;-</span> <span class="fu">enquo</span>(level0)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, <span class="sc">!!</span>taxa_select_higher, <span class="sc">!!</span>taxa_select) <span class="sc">%&gt;%</span> </span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, <span class="sc">!!</span>taxa_select_higher, <span class="sc">!!</span>taxa_select, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">PRESENT =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># remove NAs in taxa categories</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE, <span class="at">y =</span> <span class="sc">!!</span>taxa_select)) <span class="sc">+</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> PRESENT)) <span class="sc">+</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(SupergroupPhylum <span class="sc">~</span> SITE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>))</span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 10</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 20</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make_tile_plot_pa(asv_wtax_qc, "Class", "SupergroupPhylum")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<blockquote class="blockquote">
<p>Above plot addresses presence/absence of the families within major protistan supergroups across the Von Damm and Piccard vent, plume, and background samples.</p>
</blockquote>
</section>
<section id="corncob" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="corncob"><span class="header-section-number">3.5</span> Corncob</h2>
<p>Corncob analysis can be used to identify specific ASVs that may be enriched when we compare non-vent to vent samples.</p>
<p>Questions:</p>
<ul>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at Piccard?</p></li>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at Von Damm?</p></li>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at both sites?</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("bryandmartin/corncob")</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corncob); <span class="fu">library</span>(phyloseq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
</div>
<p>Explore data input for corncob</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># otu_table(physeq_mcr)[1:10, 1:3]</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(physeq_mcr)</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(physeq_mcr)[1:3, ]</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Designated vent vs. non-vent</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SAMPLETYPE_BIN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "non-vent" "vent"    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Designats Piccard vs. vondamm.</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SITE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Piccard" "VonDamm"</code></pre>
</div>
</div>
<p>Start by removing incubation samples for now. Subset to eukaryotes only and use phyloseqs tax glom to summarize to Supergroup, Phylum, Class, Order, Genus, &amp; species.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tax_table</span>(physeq_mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Taxonomy Table:     [6 taxa by 8 taxonomic ranks]:
                                 Domain       Supergroup  Phylum          
370f6c96664e9b3972ccd76d7c895405 "Eukaryota"  "Hacrobia"  "Haptophyta"    
c6782ea47ec52655fe143d45c7a91fe3 "Eukaryota"  "Rhizaria"  "Cercozoa"      
491247054f0e7def89dd8c691694f372 "Eukaryota"  "Alveolata" "Dinoflagellata"
7e67897312e51beddf2bfb0e5c9fded9 "Eukaryota"  "Alveolata" "Dinoflagellata"
53b15e82f3b4bcbe3a298bb41fc5a0eb "Unassigned" NA          NA              
be997054214c83f8ff09220080148d14 "Eukaryota"  "Alveolata" "Dinoflagellata"
                                 Class              Order          
370f6c96664e9b3972ccd76d7c895405 "Prymnesiophyceae" "Prymnesiales" 
c6782ea47ec52655fe143d45c7a91fe3 NA                 NA             
491247054f0e7def89dd8c691694f372 "Syndiniales"      "Dino-Group-I" 
7e67897312e51beddf2bfb0e5c9fded9 "Dinophyceae"      NA             
53b15e82f3b4bcbe3a298bb41fc5a0eb NA                 NA             
be997054214c83f8ff09220080148d14 "Syndiniales"      "Dino-Group-II"
                                 Family                 
370f6c96664e9b3972ccd76d7c895405 "Chrysochromulinaceae" 
c6782ea47ec52655fe143d45c7a91fe3 NA                     
491247054f0e7def89dd8c691694f372 "Dino-Group-I-Clade-3" 
7e67897312e51beddf2bfb0e5c9fded9 NA                     
53b15e82f3b4bcbe3a298bb41fc5a0eb NA                     
be997054214c83f8ff09220080148d14 "Dino-Group-II-Clade-7"
                                 Genus                    
370f6c96664e9b3972ccd76d7c895405 "Chrysochromulina"       
c6782ea47ec52655fe143d45c7a91fe3 NA                       
491247054f0e7def89dd8c691694f372 "Dino-Group-I-Clade-3_X" 
7e67897312e51beddf2bfb0e5c9fded9 NA                       
53b15e82f3b4bcbe3a298bb41fc5a0eb NA                       
be997054214c83f8ff09220080148d14 "Dino-Group-II-Clade-7_X"
                                 Species                      
370f6c96664e9b3972ccd76d7c895405 "Chrysochromulina_sp."       
c6782ea47ec52655fe143d45c7a91fe3 NA                           
491247054f0e7def89dd8c691694f372 "Dino-Group-I-Clade-3_X_sp." 
7e67897312e51beddf2bfb0e5c9fded9 NA                           
53b15e82f3b4bcbe3a298bb41fc5a0eb NA                           
be997054214c83f8ff09220080148d14 "Dino-Group-II-Clade-7_X_sp."</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mcr_super <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Supergroup"</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>mcr_phy <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Phylum"</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>mcr_class <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Class"</span>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>mcr_order <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Order"</span>)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>mcr_fam <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Family"</span>)</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>mcr_genera <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Genus"</span>)</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>mcr_spp <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Species"</span>)</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(mcr_order)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Differential tests in corncob</p>
<p>These tests work to see if taxa are differentially-abundant or variable across a given variable. In this study we have different taxonomic levels, are there more general or species-specific trends? We also have across sample types and site Below set up differential tests across sample types and site (and either or) at different taxonomic levels.</p>
<p>Function to perform specific differential tests across vent fields. Below use <strong>SITE_PICK</strong> parameter to choose between vent fields. Then use the df, to specify the taxonomic level.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>corncob_mcr <span class="ot">&lt;-</span> <span class="cf">function</span>(df_in){</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SAMPLETYPE+ SITE,</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SAMPLETYPE_BIN specifically compares vent to non-vent.</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  da_analysis_output <span class="ot">&lt;-</span> <span class="fu">differentialTest</span>(<span class="at">formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula_null =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula_null =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">test =</span> <span class="st">"Wald"</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> df_in,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fdr_cutoff =</span> <span class="fl">0.05</span>)</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SITE,</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SITE,</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SITE,</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>  list_ofsig <span class="ot">&lt;-</span> <span class="fu">as.character</span>(da_analysis_output<span class="sc">$</span>significant_taxa)</span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>  total_number <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ofsig)[<span class="dv">1</span>]</span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>  sig_taxa_names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(df_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FEATURE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(FEATURE <span class="sc">%in%</span> list_ofsig) <span class="sc">%&gt;%</span> </span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"NUMBER"</span>)</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_number){</span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>    out_0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(da_analysis_output<span class="sc">$</span>significant_models[[var]]<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">NUMBER =</span> <span class="fu">as.character</span>(var))</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"extracted # "</span>,var, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"extracted_coef"</span>)){</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> out_0 <span class="co"># create the final count table</span></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extracted_coef, out_0)</span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(out_0) <span class="co"># remove excess df</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>  output_full <span class="ot">&lt;-</span> extracted_coef <span class="sc">%&gt;%</span> </span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"mu."</span>, variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sig_taxa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUMBER"</span> <span class="ot">=</span> <span class="st">"NUMBER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">VARIABLE =</span> <span class="fu">str_remove</span>(variable, <span class="st">"[:digit:]+"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variable) <span class="co">#%&gt;% </span></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pivot_wider(names_from = VARIABLE, names_glue = "{VARIABLE}_{.value}", values_from = c(Estimate, Std..Error, t.value, Pr...t..))</span></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(extracted_coef)</span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_full)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Define SITE_PICK</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>, <span class="st">"VonDamm"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>picc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to visualize output from corncob</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>plot_corn <span class="ot">&lt;-</span> <span class="cf">function</span>(cob_out, LEVEL, TITLE){</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">enquo</span>(LEVEL)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  cob_out <span class="sc">%&gt;%</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> level, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> TITLE)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="supergroup-corncob" class="level3">
<h3 class="anchored" data-anchor-id="supergroup-corncob">Supergroup corncob</h3>
<p>What main supergroups are enriched at MCR?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # vd</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% vd))</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% picc))</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_super <span class="sc">%&gt;%</span> </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd %&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "VD supergroup")</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc %&gt;%</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "piccard supergroup")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot supergroup enrichment</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Supergroup, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR supergroup"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="phylum-corncob-analysis" class="level3">
<h3 class="anchored" data-anchor-id="phylum-corncob-analysis">Phylum corncob analysis</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_phy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Phylum, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Phylum), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR Phylum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="class-corncob-analysis" class="level3">
<h3 class="anchored" data-anchor-id="class-corncob-analysis">Class corncob analysis</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_class <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="sc">%&gt;%</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Class, <span class="fu">c</span>(Phylum, Class), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Class, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Class level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<blockquote class="blockquote">
<p>Class level looks pretty good. Keep this one. Looks at major taxonomic groups that were more enriched at vents? Work on the language here. Repeat vent vs.&nbsp;plume at ASV level. ID some of the core ASVs that can help elaborate on what we see above (table in supplementary)</p>
</blockquote>
<blockquote class="blockquote">
<p><em>Interpretation</em> :</p>
</blockquote>
</section>
<section id="order-corncob" class="level3">
<h3 class="anchored" data-anchor-id="order-corncob">Order corncob</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_order)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 
extracted #  17 
extracted #  18 
extracted #  19 
extracted #  20 
extracted #  21 
extracted #  22 
extracted #  23 
extracted #  24 
extracted #  25 
extracted #  26 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Order, <span class="fu">c</span>(Phylum, Class, Order), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Order, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Order level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="960"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?geom_errorbar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="family-corncob" class="level3">
<h3 class="anchored" data-anchor-id="family-corncob">Family corncob</h3>
<p>Plan to pairing with tree below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_fam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 
extracted #  17 
extracted #  18 
extracted #  19 
extracted #  20 
extracted #  21 
extracted #  22 
extracted #  23 
extracted #  24 
extracted #  25 
extracted #  26 
extracted #  27 
extracted #  28 
extracted #  29 
extracted #  30 
extracted #  31 
extracted #  32 
extracted #  33 
extracted #  34 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Family, <span class="fu">c</span>(Class, Order, Family), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Family, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Phylum <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Family level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="genus-corncob" class="level3">
<h3 class="anchored" data-anchor-id="genus-corncob">Genus corncob</h3>
<p>Plan to pairing with tree below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_genera)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Genus, <span class="fu">c</span>(Phylum, Genus), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Genus, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Genus level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="species-corncob" class="level3">
<h3 class="anchored" data-anchor-id="species-corncob">Species corncob</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_spp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Species, <span class="fu">c</span>(Genus, Species), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Species, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Order <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Species level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
</section>
<section id="compare-in-situ-and-tf-samples" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Compare in situ and Tf samples</h1>
<p>Examine in situ to T final samples for presence/absence.</p>
<blockquote class="blockquote">
<p>Repeat corncob analysis. Add in situ vs.&nbsp;incubation and run corncob on incubation coefficient. Do this at class and ASV level to ID those ASVs that are specifically positively differentially variable in the incubation samples compared to the in situ.</p>
</blockquote>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  22
  FeatureID SAMPLE value Taxon Conse SAMPL VENT  SITE  SAMPL DEPTH SAMPL
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
1 00056209 52_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
2 00056209 53_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
3 00056209 54_MC     0 Euka     0.8 "VonDa Must VonD ""      ""    Incuba
4 00056209 55_MC     0 Euka     0.8 "VonDa Shri VonD ""      ""    Incuba
5 00056209 57_MC     0 Euka     0.8 "Picca Shri Picc ""      ""    Incuba
6 00056209 58_MC     0 Euka     0.8 "VonDa Plume VonD ""      ""    Incuba
#  with 11 more variables: SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;,
#   pH &lt;chr&gt;, PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, and abbreviated variable names
#   Consensus, SAMPLENAME, SAMPLEID, SAMPLETYPE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View(asv_wtax_qc)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Calculate percent change from in situ to Tf for all grazing experiments</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract taxa information</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>taxa_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(TAX)) <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>perc_change <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SAMPLETYPE, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ASSAY =</span> <span class="fu">case_when</span>(</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Tf"</span>,</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"insitu"</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SAMPLETYPE) <span class="sc">%&gt;%</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> ASSAY, <span class="at">values_from =</span> avg_seq, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only ASVs present in both in situ and incubation experiments.</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># remove NAs</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(insitu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> Tf <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove if 1 or the other are zero</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(insitu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Tf <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">seq_change =</span> Tf <span class="sc">-</span> insitu) <span class="sc">%&gt;%</span> </span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">category_change =</span> <span class="fu">case_when</span>(</span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Decrease"</span>,</span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Increase"</span>,</span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No Change"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add in supergroup information</span></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(taxa_table, FeatureID, Domain<span class="sc">:</span>Species) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT', 'SAMPLETYPE'. You can
override using the `.groups` argument.
Joining, by = "FeatureID"</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(perc_change<span class="sc">$</span>category_change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Decrease  Increase No Change 
     1073      1291        28 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(perc_change)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  16
  SITE    VENT  Featu insitu    Tf seq_c categ Domain Super Phylum Class
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;
1 Piccard Lots 006f56     52  10.5   -41.5 Decrea Eukar Strame Ochro Chry
2 Piccard Lots 0197a4     52  11     -41   Decrea Eukar Strame Sagen MAST
3 Piccard Lots 01a71e    211 135     -76   Decrea Eukar Strame Pseud MAST
4 Piccard Lots 01d1a4    838 374.   -464.  Decrea Eukar Rhizar Radio RAD-B
5 Piccard Lots 020295    189 129     -60   Decrea Eukar Rhizar Radio RAD-B
6 Piccard Lots 021b3d      4  16      12   Increa Eukar Alveol Cilio Phyl
#  with 5 more variables: Order &lt;chr&gt;, Family &lt;chr&gt;, Genus &lt;chr&gt;,
#   Species &lt;chr&gt;, SUPERGROUP &lt;chr&gt;, and abbreviated variable names FeatureID,
#   seq_change, category_change, Supergroup</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(perc_change[1:2])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Of the ASVs that appeared in both in situ and Tf for each grazing experiment, 1073 decreased in sequence relative abundance, and over 1200 increased. Only 28 showed no change in sequence relative abundance.</p>
<p>Formatted table to show sequence increase vs.&nbsp;decrease PER ASV from insitu to experiment Tf.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>all_taxa_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ciliophora"</span>, <span class="st">"Alveolata-Dinoflagellata"</span>, <span class="st">"Protalveolata"</span>, <span class="st">"Other Alveolata"</span>, <span class="st">"Amoebozoa"</span>, <span class="st">"Apusozoa"</span>, <span class="st">"Excavata"</span>, <span class="st">"Hacrobia"</span>, <span class="st">"Archaeplastida"</span>, <span class="st">"Rhizaria"</span>, <span class="st">"Rhizaria-Radiolaria"</span>, <span class="st">"Rhizaria-Cercozoa"</span>, <span class="st">"Stramenopiles"</span>, <span class="st">"Stramenopiles-Opalozoa"</span>, <span class="st">"Stramenopiles-Sagenista"</span>, <span class="st">"Stramenopiles-Ochrophyta"</span>, <span class="st">"Opisthokonta"</span>, <span class="st">"Unknown Eukaryota"</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># length(all_taxa_order)</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>,<span class="st">"#cc4c02"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#238b45"</span>, <span class="st">"#c6dbef"</span>, <span class="st">"#99d8c9"</span>,<span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#f0f0f0"</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co"># length(all_taxa_color)</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, category_change, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_change =</span> <span class="fu">sum</span>(seq_change),</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">asv_total =</span> <span class="fu">n_distinct</span>(FeatureID)) <span class="sc">%&gt;%</span> </span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP_ORDER =</span> <span class="fu">factor</span>(SUPERGROUP, <span class="at">levels =</span> all_taxa_order),</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(SUPERGROUP_ORDER = factor(SUPERGROUP, levels = all_taxa_order)) %&gt;% </span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sum_change, <span class="at">y =</span> VENT_ORDER, <span class="at">fill =</span> SUPERGROUP_ORDER)) <span class="sc">+</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(limits = c(-15000, 150000)) +</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color) <span class="sc">+</span></span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(SITE_ORER ~ ., space = "free", scales = "free") +</span></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>          <span class="co"># strip.text = element_blank(),</span></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.background = element_blank(),</span></span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sequence Decrease           Sequence Increase"</span>, <span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT', 'category_change'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="864"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_bar(filter(category_change == "Increase"), stat = "identity") </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># str(perc_change)</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, category_change, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_change =</span> <span class="fu">sum</span>(seq_change),</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">asv_total =</span> <span class="fu">n_distinct</span>(FeatureID)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">asv_int =</span> <span class="fu">as.numeric</span>(asv_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">asv_change =</span> <span class="fu">case_when</span>(</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>           category_change <span class="sc">==</span> <span class="st">"Decrease"</span> <span class="sc">~</span> (<span class="dv">0</span> <span class="sc">-</span> asv_int),</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> asv_int</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span> </span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP_ORDER =</span> <span class="fu">factor</span>(SUPERGROUP, <span class="at">levels =</span> all_taxa_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> asv_change, <span class="at">y =</span> VENT, <span class="at">fill =</span> SUPERGROUP_ORDER)) <span class="sc">+</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">350</span>, <span class="dv">350</span>)) <span class="sc">+</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color) <span class="sc">+</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(SITE <span class="sc">~</span> ., <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>          <span class="co"># strip.text = element_blank(),</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.background = element_blank(),</span></span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"ASV change"</span>, <span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT', 'category_change'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SITE, VENT, SUPERGROUP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,392  3
   SITE    VENT        SUPERGROUP              
   &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;                   
 1 Piccard LotsOShrimp Stramenopiles-Ochrophyta
 2 Piccard LotsOShrimp Stramenopiles-Sagenista 
 3 Piccard LotsOShrimp Stramenopiles           
 4 Piccard LotsOShrimp Rhizaria-Radiolaria     
 5 Piccard LotsOShrimp Rhizaria-Radiolaria     
 6 Piccard LotsOShrimp Alveolata-Ciliophora    
 7 Piccard LotsOShrimp Stramenopiles-Ochrophyta
 8 Piccard LotsOShrimp Stramenopiles-Ochrophyta
 9 Piccard LotsOShrimp Alveolata-Ciliophora    
10 Piccard LotsOShrimp Alveolata-Ciliophora    
#  with 2,382 more rows</code></pre>
</div>
</div>
<section id="clr-change" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="clr-change"><span class="header-section-number">4.1</span> CLR change</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>numeric_tmp <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unite(TAX, Taxon, FeatureID, sep = "__") %&gt;% </span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME'. You can override
using the `.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(numeric_tmp))))</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="do">## From above </span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co"># head(logratio_mcr)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="tree" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Tree</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>What is relatedness between piccard and von damm ciliate communities? First try at</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(tax_table(physeq_mcr))</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_ciliate &lt;- subset_taxa(physeq_mcr, Phylum == "Ciliophora") %&gt;% </span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   subset_samples(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   tax_glom(taxrank="Species")</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_ciliate</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # head(tax_table(mcr_ciliate))</span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # subset_ciliate &lt;- prune_samples(sample_sums(mcr_ciliate) &gt; 100)</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="co"># phy_tree(mcr_ciliate)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bug in phyloseq requires update with dev version on github:</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library("devtools")</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install_github("joey711/phyloseq")</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a><span class="co"># library(phyloseq)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_tree(clean, </span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co">#           color = "SITE",</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="co">#           label.tips = "Species", </span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="co">#           shape = "SAMPLETYPE", size = "abundance", base.spacing = 0.06)</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ?plot_tree</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="session-information" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Session information</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.1 (2022-06-23)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur ... 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] corncob_0.3.0      compositions_2.0-4 ggdendro_0.1.23    vegan_2.6-2       
 [5] lattice_0.20-45    permute_0.9-7      ggupset_0.3.0      ape_5.6-2         
 [9] phyloseq_1.41.1    forcats_0.5.2      stringr_1.4.1      dplyr_1.0.10      
[13] purrr_0.3.5        readr_2.1.2        tidyr_1.2.1        tibble_3.1.8      
[17] ggplot2_3.3.6      tidyverse_1.3.2   

loaded via a namespace (and not attached):
  [1] VGAM_1.1-7               googledrive_2.0.0        colorspace_2.0-3        
  [4] ellipsis_0.3.2           XVector_0.36.0           fs_1.5.2                
  [7] rstudioapi_0.14          farver_2.1.1             fansi_1.0.3             
 [10] lubridate_1.8.0          xml2_1.3.3               codetools_0.2-18        
 [13] splines_4.2.1            robustbase_0.95-0        knitr_1.40              
 [16] ade4_1.7-19              jsonlite_1.8.0           broom_1.0.1             
 [19] cluster_2.1.4            dbplyr_2.2.1             compiler_4.2.1          
 [22] httr_1.4.4               backports_1.4.1          assertthat_0.2.1        
 [25] Matrix_1.5-1             fastmap_1.1.0            gargle_1.2.1            
 [28] cli_3.4.1                htmltools_0.5.3          tools_4.2.1             
 [31] igraph_1.3.5             ROI.plugin.lpsolve_1.0-1 gtable_0.3.1            
 [34] glue_1.6.2               GenomeInfoDbData_1.2.8   reshape2_1.4.4          
 [37] Rcpp_1.0.9               slam_0.1-50              Biobase_2.56.0          
 [40] cellranger_1.1.0         vctrs_0.5.0              Biostrings_2.64.1       
 [43] rhdf5filters_1.8.0       multtest_2.52.0          nlme_3.1-159            
 [46] iterators_1.0.14         tensorA_0.36.2           xfun_0.33               
 [49] trust_0.1-8              rvest_1.0.3              lifecycle_1.0.3         
 [52] googlesheets4_1.0.1      ROI_1.0-0                DEoptimR_1.0-11         
 [55] zlibbioc_1.42.0          MASS_7.3-58.1            scales_1.2.1            
 [58] hms_1.1.2                parallel_4.2.1           biomformat_1.24.0       
 [61] rhdf5_2.40.0             yaml_2.3.5               stringi_1.7.8           
 [64] S4Vectors_0.34.0         foreach_1.5.2            BiocGenerics_0.42.0     
 [67] detectseparation_0.3     GenomeInfoDb_1.32.4      rlang_1.0.6             
 [70] pkgconfig_2.0.3          bitops_1.0-7             lpSolveAPI_5.5.2.0-17.9 
 [73] evaluate_0.16            Rhdf5lib_1.18.2          htmlwidgets_1.5.4       
 [76] labeling_0.4.2           tidyselect_1.2.0         plyr_1.8.7              
 [79] magrittr_2.0.3           R6_2.5.1                 IRanges_2.30.1          
 [82] generics_0.1.3           DBI_1.1.3                pillar_1.8.1            
 [85] haven_2.5.1              withr_2.5.0              mgcv_1.8-40             
 [88] survival_3.4-0           RCurl_1.98-1.8           bayesm_3.1-4            
 [91] modelr_0.1.9             crayon_1.5.2             utf8_1.2.2              
 [94] tzdb_0.3.0               rmarkdown_2.16           grid_4.2.1              
 [97] readxl_1.4.1             data.table_1.14.2        reprex_2.0.2            
[100] digest_0.6.30            numDeriv_2016.8-1.1      stats4_4.2.1            
[103] munsell_0.5.0            registry_0.5-1          </code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb128" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "18S survey"</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 2</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># Import sequence and metadata</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>Set up R environment</span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(ape)</span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggupset)</span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>Import previously sequenced and analyzed tag-sequence data. See https://shu251.github.io/microeuk-amplicon-survey/ for additional information.</span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import ASV R objects</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> T)</span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## Factor - legend/color key</span></span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>, <span class="st">"Plume"</span>)</span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"LotsOShrimp"</span>, <span class="st">"X18"</span>, <span class="st">"OMT"</span>, <span class="st">"OldManTree"</span>, <span class="st">"Rav2"</span>, <span class="st">"MustardStand"</span>, <span class="st">"ShrimpHole"</span>, <span class="st">"WhiteCastle"</span>, <span class="st">"ArrowLoop"</span>)</span>
<span id="cb128-47"><a href="#cb128-47" aria-hidden="true" tabindex="-1"></a>vent_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"Lots 'O Shrimp"</span>, <span class="st">"X-18"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Ravelin #2"</span>, <span class="st">"Mustard Stand"</span>, <span class="st">"Shrimp Hole"</span>, <span class="st">"White Castle"</span>, <span class="st">"Arrow Loop"</span>)</span>
<span id="cb128-48"><a href="#cb128-48" aria-hidden="true" tabindex="-1"></a>site_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VD"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb128-49"><a href="#cb128-49" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb128-50"><a href="#cb128-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-51"><a href="#cb128-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for VD and Piccard</span></span>
<span id="cb128-52"><a href="#cb128-52" aria-hidden="true" tabindex="-1"></a>site_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#418b84"</span>, <span class="st">"#943b36"</span>)</span>
<span id="cb128-53"><a href="#cb128-53" aria-hidden="true" tabindex="-1"></a><span class="co"># site_colors</span></span>
<span id="cb128-54"><a href="#cb128-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-55"><a href="#cb128-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent colors</span></span>
<span id="cb128-56"><a href="#cb128-56" aria-hidden="true" tabindex="-1"></a>vent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#c2bfc2"</span>,<span class="st">"#ebdac9"</span>, <span class="st">"#c02c5b"</span>, <span class="st">"#cfae20"</span>, <span class="st">"#86952c"</span>, <span class="st">"#a88fab"</span>, <span class="st">"#a88fab"</span>, <span class="st">"#70b2aa"</span>, <span class="st">"#8c906d"</span>, <span class="st">"#806fa2"</span>, <span class="st">"#8cabcf"</span>, <span class="st">"#609482"</span>)</span>
<span id="cb128-57"><a href="#cb128-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-58"><a href="#cb128-58" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vent_colors) <span class="ot">&lt;-</span> vent_fullname</span>
<span id="cb128-59"><a href="#cb128-59" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_colors) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb128-60"><a href="#cb128-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Cooler colors for VD</span></span>
<span id="cb128-61"><a href="#cb128-61" aria-hidden="true" tabindex="-1"></a><span class="co"># c("#4e7d4b") green</span></span>
<span id="cb128-62"><a href="#cb128-62" aria-hidden="true" tabindex="-1"></a><span class="co">#569c91 blue</span></span>
<span id="cb128-63"><a href="#cb128-63" aria-hidden="true" tabindex="-1"></a><span class="co">#ae8fbb purple</span></span>
<span id="cb128-64"><a href="#cb128-64" aria-hidden="true" tabindex="-1"></a><span class="co">#ce86ba a lighter purple</span></span>
<span id="cb128-65"><a href="#cb128-65" aria-hidden="true" tabindex="-1"></a><span class="co">#31464a dark dark green</span></span>
<span id="cb128-66"><a href="#cb128-66" aria-hidden="true" tabindex="-1"></a><span class="co">#8c906d grey green</span></span>
<span id="cb128-67"><a href="#cb128-67" aria-hidden="true" tabindex="-1"></a><span class="co">#bab446 yellow green</span></span>
<span id="cb128-68"><a href="#cb128-68" aria-hidden="true" tabindex="-1"></a><span class="co">#ebdac9 white - cream</span></span>
<span id="cb128-69"><a href="#cb128-69" aria-hidden="true" tabindex="-1"></a><span class="co">#c2bfc2 grey</span></span>
<span id="cb128-70"><a href="#cb128-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Piccard</span></span>
<span id="cb128-71"><a href="#cb128-71" aria-hidden="true" tabindex="-1"></a><span class="co">#c02c5b pink - red</span></span>
<span id="cb128-72"><a href="#cb128-72" aria-hidden="true" tabindex="-1"></a><span class="co">#d65a9e pink</span></span>
<span id="cb128-73"><a href="#cb128-73" aria-hidden="true" tabindex="-1"></a><span class="do">##cfae20 yellow</span></span>
<span id="cb128-74"><a href="#cb128-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-75"><a href="#cb128-75" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb128-76"><a href="#cb128-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-77"><a href="#cb128-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-78"><a href="#cb128-78" aria-hidden="true" tabindex="-1"></a><span class="fu"># Visualize metadata</span></span>
<span id="cb128-79"><a href="#cb128-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-80"><a href="#cb128-80" aria-hidden="true" tabindex="-1"></a>Import environmental parameters and look at Mid-Cayman Rise sites.</span>
<span id="cb128-81"><a href="#cb128-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-84"><a href="#cb128-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-85"><a href="#cb128-85" aria-hidden="true" tabindex="-1"></a>env_params <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="at">file =</span> <span class="st">"input-data/table_wenv.txt"</span>, <span class="at">sep =</span> <span class="st">" "</span>)</span>
<span id="cb128-86"><a href="#cb128-86" aria-hidden="true" tabindex="-1"></a><span class="co"># env_params</span></span>
<span id="cb128-87"><a href="#cb128-87" aria-hidden="true" tabindex="-1"></a>subset_metadata <span class="ot">&lt;-</span> env_params <span class="sc">%&gt;%</span></span>
<span id="cb128-88"><a href="#cb128-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-89"><a href="#cb128-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VENT <span class="sc">!=</span> <span class="st">"Quakeplume"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-90"><a href="#cb128-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SITE, VENT, SAMPLETYPE, RATE_min, EUK_ml, GRAZING_EFFECT_hr) <span class="sc">%&gt;%</span></span>
<span id="cb128-91"><a href="#cb128-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-92"><a href="#cb128-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span></span>
<span id="cb128-93"><a href="#cb128-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">RATE_min_avg =</span> <span class="fu">mean</span>(RATE_min),</span>
<span id="cb128-94"><a href="#cb128-94" aria-hidden="true" tabindex="-1"></a>              <span class="at">EUK_ml_avg =</span> <span class="fu">mean</span>(EUK_ml),</span>
<span id="cb128-95"><a href="#cb128-95" aria-hidden="true" tabindex="-1"></a>              <span class="at">GRAZING_EFFECT_hr_avg =</span> <span class="fu">mean</span>(GRAZING_EFFECT_hr)) <span class="sc">%&gt;%</span></span>
<span id="cb128-96"><a href="#cb128-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-97"><a href="#cb128-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"_avg"</span>))</span>
<span id="cb128-98"><a href="#cb128-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-99"><a href="#cb128-99" aria-hidden="true" tabindex="-1"></a>metadata_numeric <span class="ot">&lt;-</span> metadata_mcr <span class="sc">%&gt;%</span></span>
<span id="cb128-100"><a href="#cb128-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-101"><a href="#cb128-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(VENT, SITE, SAMPLETYPE, DEPTH, TEMP, pH, PercSeawater, Mg, H2, H2S, CH4, ProkConc) <span class="sc">%&gt;%</span></span>
<span id="cb128-102"><a href="#cb128-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-103"><a href="#cb128-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> DEPTH<span class="sc">:</span>ProkConc, <span class="at">values_to =</span> <span class="st">"VALUE_TMP"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-104"><a href="#cb128-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(VALUE_TMP)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>VALUE_TMP) <span class="sc">%&gt;%</span></span>
<span id="cb128-105"><a href="#cb128-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(subset_metadata)</span>
<span id="cb128-106"><a href="#cb128-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-107"><a href="#cb128-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-108"><a href="#cb128-108" aria-hidden="true" tabindex="-1"></a>Code to make tile plot for environmental parameters, but may skip this.</span>
<span id="cb128-109"><a href="#cb128-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-112"><a href="#cb128-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-113"><a href="#cb128-113" aria-hidden="true" tabindex="-1"></a><span class="co"># tileplot_env &lt;- function(x){</span></span>
<span id="cb128-114"><a href="#cb128-114" aria-hidden="true" tabindex="-1"></a><span class="co">#   metadata_numeric %&gt;% </span></span>
<span id="cb128-115"><a href="#cb128-115" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(name == x) %&gt;%</span></span>
<span id="cb128-116"><a href="#cb128-116" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = name, y = VENT, fill = value)) +</span></span>
<span id="cb128-117"><a href="#cb128-117" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_tile(color = "black") +</span></span>
<span id="cb128-118"><a href="#cb128-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(SITE + SAMPLETYPE ~ ., switch = "both", space = "free", scale = "free") + theme_linedraw() +</span></span>
<span id="cb128-119"><a href="#cb128-119" aria-hidden="true" tabindex="-1"></a><span class="co">#     theme(axis.text.y = element_blank(),</span></span>
<span id="cb128-120"><a href="#cb128-120" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.text = element_blank(),</span></span>
<span id="cb128-121"><a href="#cb128-121" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.background = element_blank(),</span></span>
<span id="cb128-122"><a href="#cb128-122" aria-hidden="true" tabindex="-1"></a><span class="co">#           axis.ticks = element_blank(),</span></span>
<span id="cb128-123"><a href="#cb128-123" aria-hidden="true" tabindex="-1"></a><span class="co">#           strip.placement = "outside",</span></span>
<span id="cb128-124"><a href="#cb128-124" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.title = element_blank(),</span></span>
<span id="cb128-125"><a href="#cb128-125" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.position = "top",</span></span>
<span id="cb128-126"><a href="#cb128-126" aria-hidden="true" tabindex="-1"></a><span class="co">#           legend.text = element_text(size = 5),</span></span>
<span id="cb128-127"><a href="#cb128-127" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.background = element_blank(),</span></span>
<span id="cb128-128"><a href="#cb128-128" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.border = element_blank(),</span></span>
<span id="cb128-129"><a href="#cb128-129" aria-hidden="true" tabindex="-1"></a><span class="co">#           panel.grid = element_blank()) +</span></span>
<span id="cb128-130"><a href="#cb128-130" aria-hidden="true" tabindex="-1"></a><span class="co">#     labs(x = "", y = "") +</span></span>
<span id="cb128-131"><a href="#cb128-131" aria-hidden="true" tabindex="-1"></a><span class="co">#     scale_fill_distiller(palette = "Reds", direction=2, na.value = "grey50")</span></span>
<span id="cb128-132"><a href="#cb128-132" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb128-133"><a href="#cb128-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-134"><a href="#cb128-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-135"><a href="#cb128-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-136"><a href="#cb128-136" aria-hidden="true" tabindex="-1"></a>Optional plot, likely will not use.</span>
<span id="cb128-137"><a href="#cb128-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-140"><a href="#cb128-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-141"><a href="#cb128-141" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_grid(</span></span>
<span id="cb128-142"><a href="#cb128-142" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("TEMP") + </span></span>
<span id="cb128-143"><a href="#cb128-143" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "YlOrRd", direction=2, na.value = "grey50") +</span></span>
<span id="cb128-144"><a href="#cb128-144" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(axis.text.y = element_text(color = "black", hjust = 1, vjust = 0), </span></span>
<span id="cb128-145"><a href="#cb128-145" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.text.y = element_text(color = "black", hjust = 0, vjust = 0), </span></span>
<span id="cb128-146"><a href="#cb128-146" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.placement = "outside"),</span></span>
<span id="cb128-147"><a href="#cb128-147" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("PercSeawater") + </span></span>
<span id="cb128-148"><a href="#cb128-148" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Blues", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-149"><a href="#cb128-149" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("pH") + </span></span>
<span id="cb128-150"><a href="#cb128-150" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "YlGnBu", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-151"><a href="#cb128-151" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("Mg") + </span></span>
<span id="cb128-152"><a href="#cb128-152" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-153"><a href="#cb128-153" aria-hidden="true" tabindex="-1"></a><span class="co">#  # endemic_env("NO3"),</span></span>
<span id="cb128-154"><a href="#cb128-154" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("H2") + </span></span>
<span id="cb128-155"><a href="#cb128-155" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-156"><a href="#cb128-156" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("CH4") + </span></span>
<span id="cb128-157"><a href="#cb128-157" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-158"><a href="#cb128-158" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("H2S") + </span></span>
<span id="cb128-159"><a href="#cb128-159" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Purples", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-160"><a href="#cb128-160" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("ProkConc") + </span></span>
<span id="cb128-161"><a href="#cb128-161" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-162"><a href="#cb128-162" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("EUK_ml_avg") + </span></span>
<span id="cb128-163"><a href="#cb128-163" aria-hidden="true" tabindex="-1"></a><span class="co">#    theme(axis.text.y = element_text(color = "black", hjust = 1, vjust = 0), </span></span>
<span id="cb128-164"><a href="#cb128-164" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.text.y = element_text(color = "black", hjust = 0, vjust = 0), </span></span>
<span id="cb128-165"><a href="#cb128-165" aria-hidden="true" tabindex="-1"></a><span class="co">#          strip.placement = "outside") +</span></span>
<span id="cb128-166"><a href="#cb128-166" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-167"><a href="#cb128-167" aria-hidden="true" tabindex="-1"></a><span class="co">#  tileplot_env("GRAZING_EFFECT_hr_avg") + </span></span>
<span id="cb128-168"><a href="#cb128-168" aria-hidden="true" tabindex="-1"></a><span class="co">#    scale_fill_distiller(palette = "Oranges", direction=2, na.value = "grey50"),</span></span>
<span id="cb128-169"><a href="#cb128-169" aria-hidden="true" tabindex="-1"></a><span class="co">#  nrow = 1,</span></span>
<span id="cb128-170"><a href="#cb128-170" aria-hidden="true" tabindex="-1"></a><span class="co">#  rel_widths = c(4,1,1,1,1,1,1,1, 4, 1)</span></span>
<span id="cb128-171"><a href="#cb128-171" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb128-172"><a href="#cb128-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-173"><a href="#cb128-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-174"><a href="#cb128-174" aria-hidden="true" tabindex="-1"></a><span class="fu"># Community structure &amp; diversity at Von Damm &amp; Piccard</span></span>
<span id="cb128-175"><a href="#cb128-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-176"><a href="#cb128-176" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cluster analysis</span></span>
<span id="cb128-177"><a href="#cb128-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-178"><a href="#cb128-178" aria-hidden="true" tabindex="-1"></a>Ordination analysis and methods to look at whole protistan communities at MCR.</span>
<span id="cb128-179"><a href="#cb128-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-182"><a href="#cb128-182" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-183"><a href="#cb128-183" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb128-184"><a href="#cb128-184" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan); <span class="fu">library</span>(ggdendro); <span class="fu">library</span>(compositions)</span>
<span id="cb128-185"><a href="#cb128-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-186"><a href="#cb128-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-187"><a href="#cb128-187" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cluster analysis with grazing assays</span></span>
<span id="cb128-188"><a href="#cb128-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-191"><a href="#cb128-191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-192"><a href="#cb128-192" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb128-193"><a href="#cb128-193" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb128-194"><a href="#cb128-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-195"><a href="#cb128-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb128-196"><a href="#cb128-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-197"><a href="#cb128-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb128-198"><a href="#cb128-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-199"><a href="#cb128-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb128-200"><a href="#cb128-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-201"><a href="#cb128-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-202"><a href="#cb128-202" aria-hidden="true" tabindex="-1"></a>Transform compositional data, center log ratio.</span>
<span id="cb128-203"><a href="#cb128-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-206"><a href="#cb128-206" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-207"><a href="#cb128-207" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric)))</span>
<span id="cb128-208"><a href="#cb128-208" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(logratio_mcr)</span></span>
<span id="cb128-209"><a href="#cb128-209" aria-hidden="true" tabindex="-1"></a><span class="co"># ?alr()</span></span>
<span id="cb128-210"><a href="#cb128-210" aria-hidden="true" tabindex="-1"></a><span class="co"># ?ilr()</span></span>
<span id="cb128-211"><a href="#cb128-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-212"><a href="#cb128-212" aria-hidden="true" tabindex="-1"></a>pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(logratio_mcr)</span>
<span id="cb128-213"><a href="#cb128-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-214"><a href="#cb128-214" aria-hidden="true" tabindex="-1"></a>variance_logratio <span class="ot">&lt;-</span> (pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb128-215"><a href="#cb128-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-216"><a href="#cb128-216" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb128-217"><a href="#cb128-217" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span>
<span id="cb128-218"><a href="#cb128-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-219"><a href="#cb128-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-220"><a href="#cb128-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-223"><a href="#cb128-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-224"><a href="#cb128-224" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points</span></span>
<span id="cb128-225"><a href="#cb128-225" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-226"><a href="#cb128-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-227"><a href="#cb128-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb128-228"><a href="#cb128-228" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb128-229"><a href="#cb128-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-230"><a href="#cb128-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-231"><a href="#cb128-231" aria-hidden="true" tabindex="-1"></a><span class="fu">### PCoA with all samples</span></span>
<span id="cb128-232"><a href="#cb128-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-233"><a href="#cb128-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=6, fig.width=8}</span></span>
<span id="cb128-234"><a href="#cb128-234" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(mcr_pca_pts$VENT)</span></span>
<span id="cb128-235"><a href="#cb128-235" aria-hidden="true" tabindex="-1"></a><span class="co"># vent_ids</span></span>
<span id="cb128-236"><a href="#cb128-236" aria-hidden="true" tabindex="-1"></a><span class="co"># site_fullname</span></span>
<span id="cb128-237"><a href="#cb128-237" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb128-238"><a href="#cb128-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb128-239"><a href="#cb128-239" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-240"><a href="#cb128-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-241"><a href="#cb128-241" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb128-242"><a href="#cb128-242" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb128-243"><a href="#cb128-243" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb128-244"><a href="#cb128-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb128-245"><a href="#cb128-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE_ORDER, <span class="at">fill =</span> VENT_ORDER, <span class="at">alpha =</span> TYPE)) <span class="sc">+</span></span>
<span id="cb128-246"><a href="#cb128-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb128-247"><a href="#cb128-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb128-248"><a href="#cb128-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb128-249"><a href="#cb128-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb128-250"><a href="#cb128-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb128-251"><a href="#cb128-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span>
<span id="cb128-252"><a href="#cb128-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-253"><a href="#cb128-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-254"><a href="#cb128-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-255"><a href="#cb128-255" aria-hidden="true" tabindex="-1"></a>Dendrogram analysis</span>
<span id="cb128-256"><a href="#cb128-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-259"><a href="#cb128-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-260"><a href="#cb128-260" aria-hidden="true" tabindex="-1"></a><span class="co"># ?decostand()</span></span>
<span id="cb128-261"><a href="#cb128-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative abundance</span></span>
<span id="cb128-262"><a href="#cb128-262" aria-hidden="true" tabindex="-1"></a>rel_abun <span class="ot">&lt;-</span> <span class="fu">decostand</span>(asv_mcr_numeric, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"total"</span>)</span>
<span id="cb128-263"><a href="#cb128-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster dendrogram (average hierarchical clustering)</span></span>
<span id="cb128-264"><a href="#cb128-264" aria-hidden="true" tabindex="-1"></a>cluster_mcr <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(rel_abun)), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb128-265"><a href="#cb128-265" aria-hidden="true" tabindex="-1"></a>dendro <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(cluster_mcr)</span>
<span id="cb128-266"><a href="#cb128-266" aria-hidden="true" tabindex="-1"></a>mcr_dendro <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(dendro, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span>
<span id="cb128-267"><a href="#cb128-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-268"><a href="#cb128-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-269"><a href="#cb128-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-270"><a href="#cb128-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=4}</span></span>
<span id="cb128-271"><a href="#cb128-271" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">segment</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb128-272"><a href="#cb128-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, </span>
<span id="cb128-273"><a href="#cb128-273" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend)) <span class="sc">+</span> </span>
<span id="cb128-274"><a href="#cb128-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb128-275"><a href="#cb128-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb128-276"><a href="#cb128-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">data =</span> <span class="fu">label</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb128-277"><a href="#cb128-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dendro</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Dissimilarity"</span>) <span class="sc">+</span></span>
<span id="cb128-278"><a href="#cb128-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">14</span>), <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#252525"</span>), </span>
<span id="cb128-279"><a href="#cb128-279" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb128-280"><a href="#cb128-280" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb128-281"><a href="#cb128-281" aria-hidden="true" tabindex="-1"></a><span class="co"># svg('figs/SUPPLEMENTARY-dendrogram-wreps.svg', w = 10, h = 8)</span></span>
<span id="cb128-282"><a href="#cb128-282" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot</span>
<span id="cb128-283"><a href="#cb128-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-284"><a href="#cb128-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-285"><a href="#cb128-285" aria-hidden="true" tabindex="-1"></a><span class="fu">### PCoA with in situ only</span></span>
<span id="cb128-286"><a href="#cb128-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-289"><a href="#cb128-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-290"><a href="#cb128-290" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric_insitu <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb128-291"><a href="#cb128-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-292"><a href="#cb128-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-293"><a href="#cb128-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb128-294"><a href="#cb128-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-295"><a href="#cb128-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb128-296"><a href="#cb128-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-297"><a href="#cb128-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb128-298"><a href="#cb128-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-299"><a href="#cb128-299" aria-hidden="true" tabindex="-1"></a>insitu_logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric_insitu)))</span>
<span id="cb128-300"><a href="#cb128-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-301"><a href="#cb128-301" aria-hidden="true" tabindex="-1"></a>insitu_pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(insitu_logratio_mcr)</span>
<span id="cb128-302"><a href="#cb128-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-303"><a href="#cb128-303" aria-hidden="true" tabindex="-1"></a>insitu_variance_logratio <span class="ot">&lt;-</span> (insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb128-304"><a href="#cb128-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-305"><a href="#cb128-305" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(insitu_variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb128-306"><a href="#cb128-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span>
<span id="cb128-307"><a href="#cb128-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-308"><a href="#cb128-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-311"><a href="#cb128-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-312"><a href="#cb128-312" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points for only insitu samples</span></span>
<span id="cb128-313"><a href="#cb128-313" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(insitu_pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(insitu_pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-314"><a href="#cb128-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-315"><a href="#cb128-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb128-316"><a href="#cb128-316" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb128-317"><a href="#cb128-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-318"><a href="#cb128-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-319"><a href="#cb128-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=6, fig.width=8}</span></span>
<span id="cb128-320"><a href="#cb128-320" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb128-321"><a href="#cb128-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-322"><a href="#cb128-322" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb128-323"><a href="#cb128-323" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb128-324"><a href="#cb128-324" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb128-325"><a href="#cb128-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb128-326"><a href="#cb128-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE, <span class="at">fill =</span> VENT, <span class="at">alpha =</span> TYPE)) <span class="sc">+</span></span>
<span id="cb128-327"><a href="#cb128-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb128-328"><a href="#cb128-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb128-329"><a href="#cb128-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb128-330"><a href="#cb128-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb128-331"><a href="#cb128-331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span>
<span id="cb128-332"><a href="#cb128-332" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep same sample colors to compare to cluster analysis with in situ and Tf samples.</span></span>
<span id="cb128-333"><a href="#cb128-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-334"><a href="#cb128-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-335"><a href="#cb128-335" aria-hidden="true" tabindex="-1"></a><span class="fu">## Taxonomic breakdown</span></span>
<span id="cb128-336"><a href="#cb128-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-337"><a href="#cb128-337" aria-hidden="true" tabindex="-1"></a>Try to pair with dendrogram</span>
<span id="cb128-338"><a href="#cb128-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-341"><a href="#cb128-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-342"><a href="#cb128-342" aria-hidden="true" tabindex="-1"></a>out_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcr_dendro<span class="sc">$</span>labels)</span>
<span id="cb128-343"><a href="#cb128-343" aria-hidden="true" tabindex="-1"></a>mcr_sample_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(out_labels<span class="sc">$</span>label)</span>
<span id="cb128-344"><a href="#cb128-344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-345"><a href="#cb128-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-346"><a href="#cb128-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=11}</span></span>
<span id="cb128-347"><a href="#cb128-347" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb128-348"><a href="#cb128-348" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb128-349"><a href="#cb128-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-350"><a href="#cb128-350" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb128-351"><a href="#cb128-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-352"><a href="#cb128-352" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb128-353"><a href="#cb128-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb128-354"><a href="#cb128-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-355"><a href="#cb128-355" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb128-356"><a href="#cb128-356" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb128-357"><a href="#cb128-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb128-358"><a href="#cb128-358" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb128-359"><a href="#cb128-359" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-360"><a href="#cb128-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb128-361"><a href="#cb128-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb128-362"><a href="#cb128-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb128-363"><a href="#cb128-363" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb128-364"><a href="#cb128-364" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb128-365"><a href="#cb128-365" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-366"><a href="#cb128-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-367"><a href="#cb128-367" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb128-368"><a href="#cb128-368" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb128-369"><a href="#cb128-369" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb128-370"><a href="#cb128-370" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb128-371"><a href="#cb128-371" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb128-372"><a href="#cb128-372" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb128-373"><a href="#cb128-373" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb128-374"><a href="#cb128-374" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb128-375"><a href="#cb128-375" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb128-376"><a href="#cb128-376" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb128-377"><a href="#cb128-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb128-378"><a href="#cb128-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span> </span>
<span id="cb128-379"><a href="#cb128-379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TOTAL_SEQ =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-380"><a href="#cb128-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-381"><a href="#cb128-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb128-382"><a href="#cb128-382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq),</span>
<span id="cb128-383"><a href="#cb128-383" aria-hidden="true" tabindex="-1"></a>            <span class="at">REL_ABUN =</span> SUM<span class="sc">/</span>TOTAL_SEQ) <span class="sc">%&gt;%</span> </span>
<span id="cb128-384"><a href="#cb128-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-385"><a href="#cb128-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUPERGROUP, <span class="at">size =</span> REL_ABUN)) <span class="sc">+</span></span>
<span id="cb128-386"><a href="#cb128-386" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="fu">aes</span>(<span class="at">size =</span> REL_ABUN, <span class="at">fill =</span> SUPERGROUP, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb128-387"><a href="#cb128-387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb128-388"><a href="#cb128-388" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(. ~ SITE, scales = "free", space = "free") +</span></span>
<span id="cb128-389"><a href="#cb128-389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb128-390"><a href="#cb128-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb128-391"><a href="#cb128-391" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb128-392"><a href="#cb128-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-393"><a href="#cb128-393" aria-hidden="true" tabindex="-1"></a>bubble</span>
<span id="cb128-394"><a href="#cb128-394" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-395"><a href="#cb128-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-396"><a href="#cb128-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dendrogram with bubble plot</span></span>
<span id="cb128-397"><a href="#cb128-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-398"><a href="#cb128-398" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=20, fig.height=11}</span></span>
<span id="cb128-399"><a href="#cb128-399" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_dendro_plot + bubble + patchwork::plot_layout(ncol = 2) + patchwork::plot_annotation(tag_levels = "a")</span></span>
<span id="cb128-400"><a href="#cb128-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-401"><a href="#cb128-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-402"><a href="#cb128-402" aria-hidden="true" tabindex="-1"></a><span class="fu">## Shared ASVs</span></span>
<span id="cb128-403"><a href="#cb128-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-406"><a href="#cb128-406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-407"><a href="#cb128-407" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span>
<span id="cb128-408"><a href="#cb128-408" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(asv_wtax_qc$SITE)</span></span>
<span id="cb128-409"><a href="#cb128-409" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span>
<span id="cb128-410"><a href="#cb128-410" aria-hidden="true" tabindex="-1"></a><span class="co"># head(TAX)</span></span>
<span id="cb128-411"><a href="#cb128-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-412"><a href="#cb128-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-413"><a href="#cb128-413" aria-hidden="true" tabindex="-1"></a>Function to generate upsetR plot with varied taxonomic levels.</span>
<span id="cb128-414"><a href="#cb128-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-415"><a href="#cb128-415" aria-hidden="true" tabindex="-1"></a>Questions:</span>
<span id="cb128-416"><a href="#cb128-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-417"><a href="#cb128-417" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How many ASVs are shared among vent sites within Von Damm and Piccard?</span>
<span id="cb128-418"><a href="#cb128-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-419"><a href="#cb128-419" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What about shared ASVs across each vent field?</span>
<span id="cb128-420"><a href="#cb128-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-421"><a href="#cb128-421" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is there a taxonomic level that drives site-to-site or field-to-field community dissimilarity?</span>
<span id="cb128-422"><a href="#cb128-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-423"><a href="#cb128-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=11}</span></span>
<span id="cb128-424"><a href="#cb128-424" aria-hidden="true" tabindex="-1"></a><span class="co"># options for taxa: SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb128-425"><a href="#cb128-425" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb128-426"><a href="#cb128-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-427"><a href="#cb128-427" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb128-428"><a href="#cb128-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-429"><a href="#cb128-429" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb128-430"><a href="#cb128-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-431"><a href="#cb128-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-432"><a href="#cb128-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb128-433"><a href="#cb128-433" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb128-434"><a href="#cb128-434" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-435"><a href="#cb128-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb128-436"><a href="#cb128-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb128-437"><a href="#cb128-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb128-438"><a href="#cb128-438" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb128-439"><a href="#cb128-439" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb128-440"><a href="#cb128-440" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-441"><a href="#cb128-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-442"><a href="#cb128-442" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb128-443"><a href="#cb128-443" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb128-444"><a href="#cb128-444" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb128-445"><a href="#cb128-445" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb128-446"><a href="#cb128-446" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb128-447"><a href="#cb128-447" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb128-448"><a href="#cb128-448" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb128-449"><a href="#cb128-449" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb128-450"><a href="#cb128-450" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb128-451"><a href="#cb128-451" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb128-452"><a href="#cb128-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb128-453"><a href="#cb128-453" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb128-454"><a href="#cb128-454" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb128-455"><a href="#cb128-455" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-456"><a href="#cb128-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-457"><a href="#cb128-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-458"><a href="#cb128-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb128-459"><a href="#cb128-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-460"><a href="#cb128-460" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb128-461"><a href="#cb128-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-462"><a href="#cb128-462" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb128-463"><a href="#cb128-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb128-464"><a href="#cb128-464" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb128-465"><a href="#cb128-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-466"><a href="#cb128-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-467"><a href="#cb128-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb128-468"><a href="#cb128-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-469"><a href="#cb128-469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb128-470"><a href="#cb128-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb128-471"><a href="#cb128-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb128-472"><a href="#cb128-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb128-473"><a href="#cb128-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb128-474"><a href="#cb128-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb128-475"><a href="#cb128-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-476"><a href="#cb128-476" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-477"><a href="#cb128-477" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-478"><a href="#cb128-478" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-479"><a href="#cb128-479" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-480"><a href="#cb128-480" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-481"><a href="#cb128-481" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb128-482"><a href="#cb128-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span>
<span id="cb128-483"><a href="#cb128-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-484"><a href="#cb128-484" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to reduce noise and show sample type to vent ecosystem variability.</span></span>
<span id="cb128-485"><a href="#cb128-485" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb128-486"><a href="#cb128-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-487"><a href="#cb128-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-488"><a href="#cb128-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=15, fig.height=12}</span></span>
<span id="cb128-489"><a href="#cb128-489" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb128-490"><a href="#cb128-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-491"><a href="#cb128-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-492"><a href="#cb128-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb128-493"><a href="#cb128-493" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb128-494"><a href="#cb128-494" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-495"><a href="#cb128-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb128-496"><a href="#cb128-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb128-497"><a href="#cb128-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb128-498"><a href="#cb128-498" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb128-499"><a href="#cb128-499" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb128-500"><a href="#cb128-500" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-501"><a href="#cb128-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-502"><a href="#cb128-502" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb128-503"><a href="#cb128-503" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb128-504"><a href="#cb128-504" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb128-505"><a href="#cb128-505" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb128-506"><a href="#cb128-506" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb128-507"><a href="#cb128-507" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb128-508"><a href="#cb128-508" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb128-509"><a href="#cb128-509" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb128-510"><a href="#cb128-510" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb128-511"><a href="#cb128-511" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb128-512"><a href="#cb128-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb128-513"><a href="#cb128-513" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb128-514"><a href="#cb128-514" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb128-515"><a href="#cb128-515" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-516"><a href="#cb128-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-517"><a href="#cb128-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-518"><a href="#cb128-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb128-519"><a href="#cb128-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-520"><a href="#cb128-520" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb128-521"><a href="#cb128-521" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-522"><a href="#cb128-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb128-523"><a href="#cb128-523" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb128-524"><a href="#cb128-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-525"><a href="#cb128-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Taxon, SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-526"><a href="#cb128-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb128-527"><a href="#cb128-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-528"><a href="#cb128-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb128-529"><a href="#cb128-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb128-530"><a href="#cb128-530" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb128-531"><a href="#cb128-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb128-532"><a href="#cb128-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb128-533"><a href="#cb128-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb128-534"><a href="#cb128-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-535"><a href="#cb128-535" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-536"><a href="#cb128-536" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-537"><a href="#cb128-537" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb128-538"><a href="#cb128-538" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-539"><a href="#cb128-539" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-540"><a href="#cb128-540" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb128-541"><a href="#cb128-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span>
<span id="cb128-542"><a href="#cb128-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-543"><a href="#cb128-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-544"><a href="#cb128-544" aria-hidden="true" tabindex="-1"></a>Example comparisons of shared taxonomic levels. *Explanation*: At ASV level, most ASVs are not shared across samples. So at other taxonomic categories, are these taxa also present or are there whole classes not present?</span>
<span id="cb128-545"><a href="#cb128-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-546"><a href="#cb128-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=15, fig.height=8}</span></span>
<span id="cb128-547"><a href="#cb128-547" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 10</span></span>
<span id="cb128-548"><a href="#cb128-548" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 15</span></span>
<span id="cb128-549"><a href="#cb128-549" aria-hidden="true" tabindex="-1"></a><span class="co"># SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb128-550"><a href="#cb128-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-551"><a href="#cb128-551" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, SupergroupPhylum)</span></span>
<span id="cb128-552"><a href="#cb128-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-553"><a href="#cb128-553" aria-hidden="true" tabindex="-1"></a><span class="co"># library(plotly)</span></span>
<span id="cb128-554"><a href="#cb128-554" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplotly(tmp)</span></span>
<span id="cb128-555"><a href="#cb128-555" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, Class) + theme(legend.position = "none")</span></span>
<span id="cb128-556"><a href="#cb128-556" aria-hidden="true" tabindex="-1"></a><span class="co"># make_upset_plot(asv_wtax_qc, Supergroup) + theme(legend.position = "none")</span></span>
<span id="cb128-557"><a href="#cb128-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-558"><a href="#cb128-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-559"><a href="#cb128-559" aria-hidden="true" tabindex="-1"></a>A better visualization may be a presence/absence across samples with a tile plot.</span>
<span id="cb128-560"><a href="#cb128-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-563"><a href="#cb128-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-564"><a href="#cb128-564" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb128-565"><a href="#cb128-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-566"><a href="#cb128-566" aria-hidden="true" tabindex="-1"></a>make_tile_plot_pa <span class="ot">&lt;-</span> <span class="cf">function</span>(df, taxa_level, level0){ </span>
<span id="cb128-567"><a href="#cb128-567" aria-hidden="true" tabindex="-1"></a>  taxa_select <span class="ot">&lt;-</span> <span class="fu">enquo</span>(taxa_level)</span>
<span id="cb128-568"><a href="#cb128-568" aria-hidden="true" tabindex="-1"></a>  taxa_select_higher <span class="ot">&lt;-</span> <span class="fu">enquo</span>(level0)</span>
<span id="cb128-569"><a href="#cb128-569" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb128-570"><a href="#cb128-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-571"><a href="#cb128-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-572"><a href="#cb128-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb128-573"><a href="#cb128-573" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb128-574"><a href="#cb128-574" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-575"><a href="#cb128-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb128-576"><a href="#cb128-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb128-577"><a href="#cb128-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb128-578"><a href="#cb128-578" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb128-579"><a href="#cb128-579" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb128-580"><a href="#cb128-580" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-581"><a href="#cb128-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-582"><a href="#cb128-582" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb128-583"><a href="#cb128-583" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb128-584"><a href="#cb128-584" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb128-585"><a href="#cb128-585" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb128-586"><a href="#cb128-586" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb128-587"><a href="#cb128-587" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb128-588"><a href="#cb128-588" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb128-589"><a href="#cb128-589" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb128-590"><a href="#cb128-590" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb128-591"><a href="#cb128-591" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb128-592"><a href="#cb128-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb128-593"><a href="#cb128-593" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb128-594"><a href="#cb128-594" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, <span class="sc">!!</span>taxa_select_higher, <span class="sc">!!</span>taxa_select) <span class="sc">%&gt;%</span> </span>
<span id="cb128-595"><a href="#cb128-595" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-596"><a href="#cb128-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-597"><a href="#cb128-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-598"><a href="#cb128-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb128-599"><a href="#cb128-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-600"><a href="#cb128-600" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb128-601"><a href="#cb128-601" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-602"><a href="#cb128-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, <span class="sc">!!</span>taxa_select_higher, <span class="sc">!!</span>taxa_select, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb128-603"><a href="#cb128-603" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb128-604"><a href="#cb128-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb128-605"><a href="#cb128-605" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">PRESENT =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-606"><a href="#cb128-606" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># remove NAs in taxa categories</span></span>
<span id="cb128-607"><a href="#cb128-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE, <span class="at">y =</span> <span class="sc">!!</span>taxa_select)) <span class="sc">+</span></span>
<span id="cb128-608"><a href="#cb128-608" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> PRESENT)) <span class="sc">+</span></span>
<span id="cb128-609"><a href="#cb128-609" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(SupergroupPhylum <span class="sc">~</span> SITE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-610"><a href="#cb128-610" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb128-611"><a href="#cb128-611" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb128-612"><a href="#cb128-612" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb128-613"><a href="#cb128-613" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb128-614"><a href="#cb128-614" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">11</span>),</span>
<span id="cb128-615"><a href="#cb128-615" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb128-616"><a href="#cb128-616" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-617"><a href="#cb128-617" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-618"><a href="#cb128-618" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-619"><a href="#cb128-619" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>))</span>
<span id="cb128-620"><a href="#cb128-620" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-621"><a href="#cb128-621" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-622"><a href="#cb128-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-623"><a href="#cb128-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=18, fig.width=7}</span></span>
<span id="cb128-624"><a href="#cb128-624" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-width: 10</span></span>
<span id="cb128-625"><a href="#cb128-625" aria-hidden="true" tabindex="-1"></a><span class="co"># | fig-height: 20</span></span>
<span id="cb128-626"><a href="#cb128-626" aria-hidden="true" tabindex="-1"></a><span class="co"># make_tile_plot_pa(asv_wtax_qc, "Class", "SupergroupPhylum")</span></span>
<span id="cb128-627"><a href="#cb128-627" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-628"><a href="#cb128-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-629"><a href="#cb128-629" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Above plot addresses presence/absence of the families within major protistan supergroups across the Von Damm and Piccard vent, plume, and background samples.</span></span>
<span id="cb128-630"><a href="#cb128-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-631"><a href="#cb128-631" aria-hidden="true" tabindex="-1"></a><span class="fu">## Corncob</span></span>
<span id="cb128-632"><a href="#cb128-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-633"><a href="#cb128-633" aria-hidden="true" tabindex="-1"></a>Corncob analysis can be used to identify specific ASVs that may be enriched when we compare non-vent to vent samples.</span>
<span id="cb128-634"><a href="#cb128-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-635"><a href="#cb128-635" aria-hidden="true" tabindex="-1"></a>Questions:</span>
<span id="cb128-636"><a href="#cb128-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-637"><a href="#cb128-637" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at Piccard?</span>
<span id="cb128-638"><a href="#cb128-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-639"><a href="#cb128-639" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at Von Damm?</span>
<span id="cb128-640"><a href="#cb128-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-641"><a href="#cb128-641" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at both sites?</span>
<span id="cb128-642"><a href="#cb128-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-645"><a href="#cb128-645" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-646"><a href="#cb128-646" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb128-647"><a href="#cb128-647" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("bryandmartin/corncob")</span></span>
<span id="cb128-648"><a href="#cb128-648" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corncob); <span class="fu">library</span>(phyloseq)</span>
<span id="cb128-649"><a href="#cb128-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-650"><a href="#cb128-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-653"><a href="#cb128-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-654"><a href="#cb128-654" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-655"><a href="#cb128-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-656"><a href="#cb128-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-657"><a href="#cb128-657" aria-hidden="true" tabindex="-1"></a>Explore data input for corncob</span>
<span id="cb128-658"><a href="#cb128-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-661"><a href="#cb128-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-662"><a href="#cb128-662" aria-hidden="true" tabindex="-1"></a><span class="co"># otu_table(physeq_mcr)[1:10, 1:3]</span></span>
<span id="cb128-663"><a href="#cb128-663" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(physeq_mcr)</span></span>
<span id="cb128-664"><a href="#cb128-664" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(physeq_mcr)[1:3, ]</span></span>
<span id="cb128-665"><a href="#cb128-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-666"><a href="#cb128-666" aria-hidden="true" tabindex="-1"></a><span class="co"># Designated vent vs. non-vent</span></span>
<span id="cb128-667"><a href="#cb128-667" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SAMPLETYPE_BIN)</span>
<span id="cb128-668"><a href="#cb128-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-669"><a href="#cb128-669" aria-hidden="true" tabindex="-1"></a><span class="co">#Designats Piccard vs. vondamm.</span></span>
<span id="cb128-670"><a href="#cb128-670" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SITE)</span>
<span id="cb128-671"><a href="#cb128-671" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-672"><a href="#cb128-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-673"><a href="#cb128-673" aria-hidden="true" tabindex="-1"></a>Start by removing incubation samples for now. Subset to eukaryotes only and use phyloseq's tax glom to summarize to Supergroup, Phylum, Class, Order, Genus, &amp; species.</span>
<span id="cb128-674"><a href="#cb128-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-677"><a href="#cb128-677" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-678"><a href="#cb128-678" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tax_table</span>(physeq_mcr))</span>
<span id="cb128-679"><a href="#cb128-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-680"><a href="#cb128-680" aria-hidden="true" tabindex="-1"></a>mcr_super <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span></span>
<span id="cb128-681"><a href="#cb128-681" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-682"><a href="#cb128-682" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-683"><a href="#cb128-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Supergroup"</span>)</span>
<span id="cb128-684"><a href="#cb128-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-685"><a href="#cb128-685" aria-hidden="true" tabindex="-1"></a>mcr_phy <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb128-686"><a href="#cb128-686" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-687"><a href="#cb128-687" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-688"><a href="#cb128-688" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Phylum"</span>)</span>
<span id="cb128-689"><a href="#cb128-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-690"><a href="#cb128-690" aria-hidden="true" tabindex="-1"></a>mcr_class <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb128-691"><a href="#cb128-691" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-692"><a href="#cb128-692" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-693"><a href="#cb128-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Class"</span>)</span>
<span id="cb128-694"><a href="#cb128-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-695"><a href="#cb128-695" aria-hidden="true" tabindex="-1"></a>mcr_order <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb128-696"><a href="#cb128-696" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-697"><a href="#cb128-697" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-698"><a href="#cb128-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Order"</span>)</span>
<span id="cb128-699"><a href="#cb128-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-700"><a href="#cb128-700" aria-hidden="true" tabindex="-1"></a>mcr_fam <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb128-701"><a href="#cb128-701" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-702"><a href="#cb128-702" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-703"><a href="#cb128-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Family"</span>)</span>
<span id="cb128-704"><a href="#cb128-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-705"><a href="#cb128-705" aria-hidden="true" tabindex="-1"></a>mcr_genera <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb128-706"><a href="#cb128-706" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-707"><a href="#cb128-707" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-708"><a href="#cb128-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Genus"</span>)</span>
<span id="cb128-709"><a href="#cb128-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-710"><a href="#cb128-710" aria-hidden="true" tabindex="-1"></a>mcr_spp <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb128-711"><a href="#cb128-711" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-712"><a href="#cb128-712" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-713"><a href="#cb128-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Species"</span>)</span>
<span id="cb128-714"><a href="#cb128-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-715"><a href="#cb128-715" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(mcr_order)</span></span>
<span id="cb128-716"><a href="#cb128-716" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-717"><a href="#cb128-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-718"><a href="#cb128-718" aria-hidden="true" tabindex="-1"></a>Differential tests in corncob</span>
<span id="cb128-719"><a href="#cb128-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-720"><a href="#cb128-720" aria-hidden="true" tabindex="-1"></a>These tests work to see if taxa are differentially-abundant or variable across a given variable. In this study we have different taxonomic levels, are there more general or species-specific trends? We also have across sample types and site Below set up differential tests across sample types and site (and either or) at different taxonomic levels.</span>
<span id="cb128-721"><a href="#cb128-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-722"><a href="#cb128-722" aria-hidden="true" tabindex="-1"></a>Function to perform specific differential tests across vent fields. Below use **SITE_PICK** parameter to choose between vent fields. Then use the df, to specify the taxonomic level.</span>
<span id="cb128-723"><a href="#cb128-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-726"><a href="#cb128-726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-727"><a href="#cb128-727" aria-hidden="true" tabindex="-1"></a>corncob_mcr <span class="ot">&lt;-</span> <span class="cf">function</span>(df_in){</span>
<span id="cb128-728"><a href="#cb128-728" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb128-729"><a href="#cb128-729" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SAMPLETYPE+ SITE,</span></span>
<span id="cb128-730"><a href="#cb128-730" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb128-731"><a href="#cb128-731" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb128-732"><a href="#cb128-732" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb128-733"><a href="#cb128-733" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb128-734"><a href="#cb128-734" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb128-735"><a href="#cb128-735" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SAMPLETYPE_BIN specifically compares vent to non-vent.</span></span>
<span id="cb128-736"><a href="#cb128-736" aria-hidden="true" tabindex="-1"></a>  da_analysis_output <span class="ot">&lt;-</span> <span class="fu">differentialTest</span>(<span class="at">formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb128-737"><a href="#cb128-737" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb128-738"><a href="#cb128-738" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula_null =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb128-739"><a href="#cb128-739" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula_null =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb128-740"><a href="#cb128-740" aria-hidden="true" tabindex="-1"></a>                                <span class="at">test =</span> <span class="st">"Wald"</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb128-741"><a href="#cb128-741" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> df_in,</span>
<span id="cb128-742"><a href="#cb128-742" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fdr_cutoff =</span> <span class="fl">0.05</span>)</span>
<span id="cb128-743"><a href="#cb128-743" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SITE,</span></span>
<span id="cb128-744"><a href="#cb128-744" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SITE,</span></span>
<span id="cb128-745"><a href="#cb128-745" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb128-746"><a href="#cb128-746" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SITE,</span></span>
<span id="cb128-747"><a href="#cb128-747" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb128-748"><a href="#cb128-748" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb128-749"><a href="#cb128-749" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb128-750"><a href="#cb128-750" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb128-751"><a href="#cb128-751" aria-hidden="true" tabindex="-1"></a>  list_ofsig <span class="ot">&lt;-</span> <span class="fu">as.character</span>(da_analysis_output<span class="sc">$</span>significant_taxa)</span>
<span id="cb128-752"><a href="#cb128-752" aria-hidden="true" tabindex="-1"></a>  total_number <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ofsig)[<span class="dv">1</span>]</span>
<span id="cb128-753"><a href="#cb128-753" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb128-754"><a href="#cb128-754" aria-hidden="true" tabindex="-1"></a>  sig_taxa_names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(df_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-755"><a href="#cb128-755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FEATURE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-756"><a href="#cb128-756" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(FEATURE <span class="sc">%in%</span> list_ofsig) <span class="sc">%&gt;%</span> </span>
<span id="cb128-757"><a href="#cb128-757" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"NUMBER"</span>)</span>
<span id="cb128-758"><a href="#cb128-758" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb128-759"><a href="#cb128-759" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_number){</span>
<span id="cb128-760"><a href="#cb128-760" aria-hidden="true" tabindex="-1"></a>    out_0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(da_analysis_output<span class="sc">$</span>significant_models[[var]]<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb128-761"><a href="#cb128-761" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">NUMBER =</span> <span class="fu">as.character</span>(var))</span>
<span id="cb128-762"><a href="#cb128-762" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"extracted # "</span>,var, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb128-763"><a href="#cb128-763" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"extracted_coef"</span>)){</span>
<span id="cb128-764"><a href="#cb128-764" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> out_0 <span class="co"># create the final count table</span></span>
<span id="cb128-765"><a href="#cb128-765" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb128-766"><a href="#cb128-766" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extracted_coef, out_0)</span>
<span id="cb128-767"><a href="#cb128-767" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb128-768"><a href="#cb128-768" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(out_0) <span class="co"># remove excess df</span></span>
<span id="cb128-769"><a href="#cb128-769" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb128-770"><a href="#cb128-770" aria-hidden="true" tabindex="-1"></a>  output_full <span class="ot">&lt;-</span> extracted_coef <span class="sc">%&gt;%</span> </span>
<span id="cb128-771"><a href="#cb128-771" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-772"><a href="#cb128-772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"mu."</span>, variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-773"><a href="#cb128-773" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sig_taxa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUMBER"</span> <span class="ot">=</span> <span class="st">"NUMBER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-774"><a href="#cb128-774" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">VARIABLE =</span> <span class="fu">str_remove</span>(variable, <span class="st">"[:digit:]+"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variable) <span class="co">#%&gt;% </span></span>
<span id="cb128-775"><a href="#cb128-775" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pivot_wider(names_from = VARIABLE, names_glue = "{VARIABLE}_{.value}", values_from = c(Estimate, Std..Error, t.value, Pr...t..))</span></span>
<span id="cb128-776"><a href="#cb128-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(extracted_coef)</span>
<span id="cb128-777"><a href="#cb128-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_full)}</span>
<span id="cb128-778"><a href="#cb128-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-779"><a href="#cb128-779" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-780"><a href="#cb128-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-781"><a href="#cb128-781" aria-hidden="true" tabindex="-1"></a>Define SITE_PICK</span>
<span id="cb128-782"><a href="#cb128-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-785"><a href="#cb128-785" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-786"><a href="#cb128-786" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>, <span class="st">"VonDamm"</span>)</span>
<span id="cb128-787"><a href="#cb128-787" aria-hidden="true" tabindex="-1"></a>picc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>)</span>
<span id="cb128-788"><a href="#cb128-788" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>)</span>
<span id="cb128-789"><a href="#cb128-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-790"><a href="#cb128-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-791"><a href="#cb128-791" aria-hidden="true" tabindex="-1"></a>Function to visualize output from corncob</span>
<span id="cb128-792"><a href="#cb128-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-795"><a href="#cb128-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-796"><a href="#cb128-796" aria-hidden="true" tabindex="-1"></a>plot_corn <span class="ot">&lt;-</span> <span class="cf">function</span>(cob_out, LEVEL, TITLE){</span>
<span id="cb128-797"><a href="#cb128-797" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">enquo</span>(LEVEL)</span>
<span id="cb128-798"><a href="#cb128-798" aria-hidden="true" tabindex="-1"></a>  cob_out <span class="sc">%&gt;%</span></span>
<span id="cb128-799"><a href="#cb128-799" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-800"><a href="#cb128-800" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> level, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb128-801"><a href="#cb128-801" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-802"><a href="#cb128-802" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-803"><a href="#cb128-803" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-804"><a href="#cb128-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-805"><a href="#cb128-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-806"><a href="#cb128-806" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb128-807"><a href="#cb128-807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-808"><a href="#cb128-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> TITLE)</span>
<span id="cb128-809"><a href="#cb128-809" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb128-810"><a href="#cb128-810" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-811"><a href="#cb128-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-812"><a href="#cb128-812" aria-hidden="true" tabindex="-1"></a><span class="fu">### Supergroup corncob</span></span>
<span id="cb128-813"><a href="#cb128-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-814"><a href="#cb128-814" aria-hidden="true" tabindex="-1"></a>What main supergroups are enriched at MCR?</span>
<span id="cb128-815"><a href="#cb128-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-818"><a href="#cb128-818" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-819"><a href="#cb128-819" aria-hidden="true" tabindex="-1"></a><span class="co"># # vd</span></span>
<span id="cb128-820"><a href="#cb128-820" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb128-821"><a href="#cb128-821" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% vd))</span></span>
<span id="cb128-822"><a href="#cb128-822" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb128-823"><a href="#cb128-823" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb128-824"><a href="#cb128-824" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% picc))</span></span>
<span id="cb128-825"><a href="#cb128-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-826"><a href="#cb128-826" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_super <span class="sc">%&gt;%</span> </span>
<span id="cb128-827"><a href="#cb128-827" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span>
<span id="cb128-828"><a href="#cb128-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-829"><a href="#cb128-829" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd %&gt;%</span></span>
<span id="cb128-830"><a href="#cb128-830" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb128-831"><a href="#cb128-831" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb128-832"><a href="#cb128-832" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb128-833"><a href="#cb128-833" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb128-834"><a href="#cb128-834" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb128-835"><a href="#cb128-835" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb128-836"><a href="#cb128-836" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb128-837"><a href="#cb128-837" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb128-838"><a href="#cb128-838" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb128-839"><a href="#cb128-839" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "VD supergroup")</span></span>
<span id="cb128-840"><a href="#cb128-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-841"><a href="#cb128-841" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc %&gt;%</span></span>
<span id="cb128-842"><a href="#cb128-842" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb128-843"><a href="#cb128-843" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb128-844"><a href="#cb128-844" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb128-845"><a href="#cb128-845" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb128-846"><a href="#cb128-846" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb128-847"><a href="#cb128-847" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb128-848"><a href="#cb128-848" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb128-849"><a href="#cb128-849" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb128-850"><a href="#cb128-850" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb128-851"><a href="#cb128-851" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "piccard supergroup")</span></span>
<span id="cb128-852"><a href="#cb128-852" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-853"><a href="#cb128-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-854"><a href="#cb128-854" aria-hidden="true" tabindex="-1"></a>Plot supergroup enrichment</span>
<span id="cb128-855"><a href="#cb128-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-858"><a href="#cb128-858" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-859"><a href="#cb128-859" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="sc">%&gt;%</span></span>
<span id="cb128-860"><a href="#cb128-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-861"><a href="#cb128-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Supergroup, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb128-862"><a href="#cb128-862" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-863"><a href="#cb128-863" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-864"><a href="#cb128-864" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-865"><a href="#cb128-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-866"><a href="#cb128-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-867"><a href="#cb128-867" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb128-868"><a href="#cb128-868" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-869"><a href="#cb128-869" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR supergroup"</span>)</span>
<span id="cb128-870"><a href="#cb128-870" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-871"><a href="#cb128-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-872"><a href="#cb128-872" aria-hidden="true" tabindex="-1"></a><span class="fu">### Phylum corncob analysis</span></span>
<span id="cb128-873"><a href="#cb128-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-876"><a href="#cb128-876" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-877"><a href="#cb128-877" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_phy)</span>
<span id="cb128-878"><a href="#cb128-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-879"><a href="#cb128-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-882"><a href="#cb128-882" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-883"><a href="#cb128-883" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="sc">%&gt;%</span></span>
<span id="cb128-884"><a href="#cb128-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-885"><a href="#cb128-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Phylum, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb128-886"><a href="#cb128-886" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-887"><a href="#cb128-887" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-888"><a href="#cb128-888" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Phylum), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-889"><a href="#cb128-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-890"><a href="#cb128-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-891"><a href="#cb128-891" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb128-892"><a href="#cb128-892" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-893"><a href="#cb128-893" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR Phylum"</span>)</span>
<span id="cb128-894"><a href="#cb128-894" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-895"><a href="#cb128-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-896"><a href="#cb128-896" aria-hidden="true" tabindex="-1"></a><span class="fu">### Class corncob analysis</span></span>
<span id="cb128-897"><a href="#cb128-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-900"><a href="#cb128-900" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-901"><a href="#cb128-901" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_class <span class="sc">%&gt;%</span></span>
<span id="cb128-902"><a href="#cb128-902" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span>
<span id="cb128-903"><a href="#cb128-903" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-904"><a href="#cb128-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-905"><a href="#cb128-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb128-906"><a href="#cb128-906" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb128-907"><a href="#cb128-907" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb128-908"><a href="#cb128-908" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="sc">%&gt;%</span></span>
<span id="cb128-909"><a href="#cb128-909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Class, <span class="fu">c</span>(Phylum, Class), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-910"><a href="#cb128-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-911"><a href="#cb128-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Class, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb128-912"><a href="#cb128-912" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-913"><a href="#cb128-913" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-914"><a href="#cb128-914" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-915"><a href="#cb128-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-916"><a href="#cb128-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-917"><a href="#cb128-917" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb128-918"><a href="#cb128-918" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-919"><a href="#cb128-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Class level test for differential abundance"</span>)</span>
<span id="cb128-920"><a href="#cb128-920" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-921"><a href="#cb128-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-922"><a href="#cb128-922" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Class level looks pretty good. Keep this one. Looks at major taxonomic groups that were more enriched at vents? Work on the language here. Repeat vent vs. plume at ASV level. ID some of the core ASVs that can help elaborate on what we see above (table in supplementary)</span></span>
<span id="cb128-923"><a href="#cb128-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-924"><a href="#cb128-924" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Interpretation* :</span></span>
<span id="cb128-925"><a href="#cb128-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-926"><a href="#cb128-926" aria-hidden="true" tabindex="-1"></a><span class="fu">### Order corncob</span></span>
<span id="cb128-927"><a href="#cb128-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-930"><a href="#cb128-930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-931"><a href="#cb128-931" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_order)</span>
<span id="cb128-932"><a href="#cb128-932" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-933"><a href="#cb128-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-934"><a href="#cb128-934" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb128-935"><a href="#cb128-935" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb128-936"><a href="#cb128-936" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb128-937"><a href="#cb128-937" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="sc">%&gt;%</span></span>
<span id="cb128-938"><a href="#cb128-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Order, <span class="fu">c</span>(Phylum, Class, Order), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-939"><a href="#cb128-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-940"><a href="#cb128-940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Order, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb128-941"><a href="#cb128-941" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-942"><a href="#cb128-942" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-943"><a href="#cb128-943" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-944"><a href="#cb128-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-945"><a href="#cb128-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-946"><a href="#cb128-946" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb128-947"><a href="#cb128-947" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-948"><a href="#cb128-948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Order level test for differential abundance"</span>)</span>
<span id="cb128-949"><a href="#cb128-949" aria-hidden="true" tabindex="-1"></a><span class="co"># ?geom_errorbar</span></span>
<span id="cb128-950"><a href="#cb128-950" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-951"><a href="#cb128-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-952"><a href="#cb128-952" aria-hidden="true" tabindex="-1"></a><span class="fu">### Family corncob</span></span>
<span id="cb128-953"><a href="#cb128-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-954"><a href="#cb128-954" aria-hidden="true" tabindex="-1"></a>Plan to pairing with tree below</span>
<span id="cb128-955"><a href="#cb128-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-958"><a href="#cb128-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-959"><a href="#cb128-959" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_fam)</span>
<span id="cb128-960"><a href="#cb128-960" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-961"><a href="#cb128-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-964"><a href="#cb128-964" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-965"><a href="#cb128-965" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="sc">%&gt;%</span></span>
<span id="cb128-966"><a href="#cb128-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Family, <span class="fu">c</span>(Class, Order, Family), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-967"><a href="#cb128-967" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-968"><a href="#cb128-968" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Family, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb128-969"><a href="#cb128-969" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-970"><a href="#cb128-970" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-971"><a href="#cb128-971" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-972"><a href="#cb128-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Phylum <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-973"><a href="#cb128-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-974"><a href="#cb128-974" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb128-975"><a href="#cb128-975" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-976"><a href="#cb128-976" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Family level test for differential abundance"</span>)</span>
<span id="cb128-977"><a href="#cb128-977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-978"><a href="#cb128-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-979"><a href="#cb128-979" aria-hidden="true" tabindex="-1"></a><span class="fu">### Genus corncob</span></span>
<span id="cb128-980"><a href="#cb128-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-981"><a href="#cb128-981" aria-hidden="true" tabindex="-1"></a>Plan to pairing with tree below</span>
<span id="cb128-982"><a href="#cb128-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-985"><a href="#cb128-985" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-986"><a href="#cb128-986" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_genera)</span>
<span id="cb128-987"><a href="#cb128-987" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-988"><a href="#cb128-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-991"><a href="#cb128-991" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-992"><a href="#cb128-992" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="sc">%&gt;%</span></span>
<span id="cb128-993"><a href="#cb128-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Genus, <span class="fu">c</span>(Phylum, Genus), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-994"><a href="#cb128-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-995"><a href="#cb128-995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Genus, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb128-996"><a href="#cb128-996" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-997"><a href="#cb128-997" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-998"><a href="#cb128-998" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-999"><a href="#cb128-999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-1000"><a href="#cb128-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-1001"><a href="#cb128-1001" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb128-1002"><a href="#cb128-1002" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-1003"><a href="#cb128-1003" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Genus level test for differential abundance"</span>)</span>
<span id="cb128-1004"><a href="#cb128-1004" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1005"><a href="#cb128-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1006"><a href="#cb128-1006" aria-hidden="true" tabindex="-1"></a><span class="fu">### Species corncob</span></span>
<span id="cb128-1007"><a href="#cb128-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1010"><a href="#cb128-1010" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1011"><a href="#cb128-1011" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_spp)</span>
<span id="cb128-1012"><a href="#cb128-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1013"><a href="#cb128-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1014"><a href="#cb128-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb128-1015"><a href="#cb128-1015" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="sc">%&gt;%</span></span>
<span id="cb128-1016"><a href="#cb128-1016" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Species, <span class="fu">c</span>(Genus, Species), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1017"><a href="#cb128-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1018"><a href="#cb128-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Species, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb128-1019"><a href="#cb128-1019" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-1020"><a href="#cb128-1020" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb128-1021"><a href="#cb128-1021" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-1022"><a href="#cb128-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Order <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-1023"><a href="#cb128-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-1024"><a href="#cb128-1024" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb128-1025"><a href="#cb128-1025" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb128-1026"><a href="#cb128-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Species level test for differential abundance"</span>)</span>
<span id="cb128-1027"><a href="#cb128-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1028"><a href="#cb128-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1029"><a href="#cb128-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1030"><a href="#cb128-1030" aria-hidden="true" tabindex="-1"></a><span class="fu"># Compare in situ and Tf samples</span></span>
<span id="cb128-1031"><a href="#cb128-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1032"><a href="#cb128-1032" aria-hidden="true" tabindex="-1"></a>Examine in situ to T final samples for presence/absence.</span>
<span id="cb128-1033"><a href="#cb128-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1034"><a href="#cb128-1034" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Repeat corncob analysis. Add in situ vs. incubation and run corncob on incubation coefficient. Do this at class and ASV level to ID those ASVs that are specifically positively differentially variable in the incubation samples compared to the in situ.</span></span>
<span id="cb128-1035"><a href="#cb128-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1038"><a href="#cb128-1038" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1039"><a href="#cb128-1039" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span>
<span id="cb128-1040"><a href="#cb128-1040" aria-hidden="true" tabindex="-1"></a><span class="co"># View(asv_wtax_qc)</span></span>
<span id="cb128-1041"><a href="#cb128-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1042"><a href="#cb128-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1043"><a href="#cb128-1043" aria-hidden="true" tabindex="-1"></a>Calculate percent change from in situ to Tf for all grazing experiments</span>
<span id="cb128-1044"><a href="#cb128-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1047"><a href="#cb128-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1048"><a href="#cb128-1048" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb128-1049"><a href="#cb128-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1050"><a href="#cb128-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract taxa information</span></span>
<span id="cb128-1051"><a href="#cb128-1051" aria-hidden="true" tabindex="-1"></a>taxa_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">tax_table</span>(TAX)) <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb128-1052"><a href="#cb128-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1053"><a href="#cb128-1053" aria-hidden="true" tabindex="-1"></a>perc_change <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb128-1054"><a href="#cb128-1054" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1055"><a href="#cb128-1055" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb128-1056"><a href="#cb128-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SAMPLETYPE, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1057"><a href="#cb128-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1058"><a href="#cb128-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ASSAY =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-1059"><a href="#cb128-1059" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Tf"</span>,</span>
<span id="cb128-1060"><a href="#cb128-1060" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"insitu"</span></span>
<span id="cb128-1061"><a href="#cb128-1061" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb128-1062"><a href="#cb128-1062" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-1063"><a href="#cb128-1063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SAMPLETYPE) <span class="sc">%&gt;%</span></span>
<span id="cb128-1064"><a href="#cb128-1064" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> ASSAY, <span class="at">values_from =</span> avg_seq, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1065"><a href="#cb128-1065" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only ASVs present in both in situ and incubation experiments.</span></span>
<span id="cb128-1066"><a href="#cb128-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> <span class="co"># remove NAs</span></span>
<span id="cb128-1067"><a href="#cb128-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(insitu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> Tf <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="co"># remove if 1 or the other are zero</span></span>
<span id="cb128-1068"><a href="#cb128-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(insitu <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> Tf <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb128-1069"><a href="#cb128-1069" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">seq_change =</span> Tf <span class="sc">-</span> insitu) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1070"><a href="#cb128-1070" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">category_change =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-1071"><a href="#cb128-1071" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Decrease"</span>,</span>
<span id="cb128-1072"><a href="#cb128-1072" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Increase"</span>,</span>
<span id="cb128-1073"><a href="#cb128-1073" aria-hidden="true" tabindex="-1"></a>           seq_change <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No Change"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1074"><a href="#cb128-1074" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add in supergroup information</span></span>
<span id="cb128-1075"><a href="#cb128-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(taxa_table, FeatureID, Domain<span class="sc">:</span>Species) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1076"><a href="#cb128-1076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-1077"><a href="#cb128-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1078"><a href="#cb128-1078" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb128-1079"><a href="#cb128-1079" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb128-1080"><a href="#cb128-1080" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb128-1081"><a href="#cb128-1081" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1082"><a href="#cb128-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-1083"><a href="#cb128-1083" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb128-1084"><a href="#cb128-1084" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb128-1085"><a href="#cb128-1085" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb128-1086"><a href="#cb128-1086" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb128-1087"><a href="#cb128-1087" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb128-1088"><a href="#cb128-1088" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb128-1089"><a href="#cb128-1089" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb128-1090"><a href="#cb128-1090" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb128-1091"><a href="#cb128-1091" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb128-1092"><a href="#cb128-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1093"><a href="#cb128-1093" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(perc_change<span class="sc">$</span>category_change)</span>
<span id="cb128-1094"><a href="#cb128-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(perc_change)</span>
<span id="cb128-1095"><a href="#cb128-1095" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(perc_change[1:2])</span></span>
<span id="cb128-1096"><a href="#cb128-1096" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1097"><a href="#cb128-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1098"><a href="#cb128-1098" aria-hidden="true" tabindex="-1"></a>Of the ASVs that appeared in both in situ and Tf for each grazing experiment, 1073 decreased in sequence relative abundance, and over 1200 increased. Only 28 showed no change in sequence relative abundance.</span>
<span id="cb128-1099"><a href="#cb128-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1100"><a href="#cb128-1100" aria-hidden="true" tabindex="-1"></a>Formatted table to show sequence increase vs. decrease PER ASV from insitu to experiment Tf.</span>
<span id="cb128-1101"><a href="#cb128-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1102"><a href="#cb128-1102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=9}</span></span>
<span id="cb128-1103"><a href="#cb128-1103" aria-hidden="true" tabindex="-1"></a>all_taxa_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ciliophora"</span>, <span class="st">"Alveolata-Dinoflagellata"</span>, <span class="st">"Protalveolata"</span>, <span class="st">"Other Alveolata"</span>, <span class="st">"Amoebozoa"</span>, <span class="st">"Apusozoa"</span>, <span class="st">"Excavata"</span>, <span class="st">"Hacrobia"</span>, <span class="st">"Archaeplastida"</span>, <span class="st">"Rhizaria"</span>, <span class="st">"Rhizaria-Radiolaria"</span>, <span class="st">"Rhizaria-Cercozoa"</span>, <span class="st">"Stramenopiles"</span>, <span class="st">"Stramenopiles-Opalozoa"</span>, <span class="st">"Stramenopiles-Sagenista"</span>, <span class="st">"Stramenopiles-Ochrophyta"</span>, <span class="st">"Opisthokonta"</span>, <span class="st">"Unknown Eukaryota"</span>)</span>
<span id="cb128-1104"><a href="#cb128-1104" aria-hidden="true" tabindex="-1"></a><span class="co"># length(all_taxa_order)</span></span>
<span id="cb128-1105"><a href="#cb128-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1106"><a href="#cb128-1106" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>,<span class="st">"#cc4c02"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#238b45"</span>, <span class="st">"#c6dbef"</span>, <span class="st">"#99d8c9"</span>,<span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#f0f0f0"</span>)</span>
<span id="cb128-1107"><a href="#cb128-1107" aria-hidden="true" tabindex="-1"></a><span class="co"># length(all_taxa_color)</span></span>
<span id="cb128-1108"><a href="#cb128-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1109"><a href="#cb128-1109" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb128-1110"><a href="#cb128-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, category_change, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1111"><a href="#cb128-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_change =</span> <span class="fu">sum</span>(seq_change),</span>
<span id="cb128-1112"><a href="#cb128-1112" aria-hidden="true" tabindex="-1"></a>            <span class="at">asv_total =</span> <span class="fu">n_distinct</span>(FeatureID)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1113"><a href="#cb128-1113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP_ORDER =</span> <span class="fu">factor</span>(SUPERGROUP, <span class="at">levels =</span> all_taxa_order),</span>
<span id="cb128-1114"><a href="#cb128-1114" aria-hidden="true" tabindex="-1"></a>         <span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb128-1115"><a href="#cb128-1115" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1116"><a href="#cb128-1116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(SUPERGROUP_ORDER = factor(SUPERGROUP, levels = all_taxa_order)) %&gt;% </span></span>
<span id="cb128-1117"><a href="#cb128-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sum_change, <span class="at">y =</span> VENT_ORDER, <span class="at">fill =</span> SUPERGROUP_ORDER)) <span class="sc">+</span></span>
<span id="cb128-1118"><a href="#cb128-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb128-1119"><a href="#cb128-1119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(limits = c(-15000, 150000)) +</span></span>
<span id="cb128-1120"><a href="#cb128-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color) <span class="sc">+</span></span>
<span id="cb128-1121"><a href="#cb128-1121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(SITE_ORER ~ ., space = "free", scales = "free") +</span></span>
<span id="cb128-1122"><a href="#cb128-1122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb128-1123"><a href="#cb128-1123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb128-1124"><a href="#cb128-1124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb128-1125"><a href="#cb128-1125" aria-hidden="true" tabindex="-1"></a>          <span class="co"># strip.text = element_blank(),</span></span>
<span id="cb128-1126"><a href="#cb128-1126" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-1127"><a href="#cb128-1127" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-1128"><a href="#cb128-1128" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb128-1129"><a href="#cb128-1129" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-1130"><a href="#cb128-1130" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb128-1131"><a href="#cb128-1131" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb128-1132"><a href="#cb128-1132" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.background = element_blank(),</span></span>
<span id="cb128-1133"><a href="#cb128-1133" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb128-1134"><a href="#cb128-1134" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb128-1135"><a href="#cb128-1135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sequence Decrease           Sequence Increase"</span>, <span class="at">y =</span> <span class="st">""</span>)</span>
<span id="cb128-1136"><a href="#cb128-1136" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_bar(filter(category_change == "Increase"), stat = "identity") </span></span>
<span id="cb128-1137"><a href="#cb128-1137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1138"><a href="#cb128-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1141"><a href="#cb128-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1142"><a href="#cb128-1142" aria-hidden="true" tabindex="-1"></a><span class="co"># str(perc_change)</span></span>
<span id="cb128-1143"><a href="#cb128-1143" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb128-1144"><a href="#cb128-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, category_change, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1145"><a href="#cb128-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum_change =</span> <span class="fu">sum</span>(seq_change),</span>
<span id="cb128-1146"><a href="#cb128-1146" aria-hidden="true" tabindex="-1"></a>            <span class="at">asv_total =</span> <span class="fu">n_distinct</span>(FeatureID)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1147"><a href="#cb128-1147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-1148"><a href="#cb128-1148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">asv_int =</span> <span class="fu">as.numeric</span>(asv_total)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1149"><a href="#cb128-1149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">asv_change =</span> <span class="fu">case_when</span>(</span>
<span id="cb128-1150"><a href="#cb128-1150" aria-hidden="true" tabindex="-1"></a>           category_change <span class="sc">==</span> <span class="st">"Decrease"</span> <span class="sc">~</span> (<span class="dv">0</span> <span class="sc">-</span> asv_int),</span>
<span id="cb128-1151"><a href="#cb128-1151" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> asv_int</span>
<span id="cb128-1152"><a href="#cb128-1152" aria-hidden="true" tabindex="-1"></a>         )) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1153"><a href="#cb128-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP_ORDER =</span> <span class="fu">factor</span>(SUPERGROUP, <span class="at">levels =</span> all_taxa_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1154"><a href="#cb128-1154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> asv_change, <span class="at">y =</span> VENT, <span class="at">fill =</span> SUPERGROUP_ORDER)) <span class="sc">+</span></span>
<span id="cb128-1155"><a href="#cb128-1155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb128-1156"><a href="#cb128-1156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">350</span>, <span class="dv">350</span>)) <span class="sc">+</span></span>
<span id="cb128-1157"><a href="#cb128-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color) <span class="sc">+</span></span>
<span id="cb128-1158"><a href="#cb128-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(SITE <span class="sc">~</span> ., <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb128-1159"><a href="#cb128-1159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb128-1160"><a href="#cb128-1160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb128-1161"><a href="#cb128-1161" aria-hidden="true" tabindex="-1"></a>          <span class="co"># strip.text = element_blank(),</span></span>
<span id="cb128-1162"><a href="#cb128-1162" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-1163"><a href="#cb128-1163" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-1164"><a href="#cb128-1164" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.placement =</span> <span class="st">"outside"</span>,</span>
<span id="cb128-1165"><a href="#cb128-1165" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-1166"><a href="#cb128-1166" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb128-1167"><a href="#cb128-1167" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">5</span>),</span>
<span id="cb128-1168"><a href="#cb128-1168" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.background = element_blank(),</span></span>
<span id="cb128-1169"><a href="#cb128-1169" aria-hidden="true" tabindex="-1"></a>          <span class="co"># panel.border = element_blank(),</span></span>
<span id="cb128-1170"><a href="#cb128-1170" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb128-1171"><a href="#cb128-1171" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"ASV change"</span>, <span class="at">y =</span> <span class="st">""</span>)</span>
<span id="cb128-1172"><a href="#cb128-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1173"><a href="#cb128-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1176"><a href="#cb128-1176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1177"><a href="#cb128-1177" aria-hidden="true" tabindex="-1"></a>perc_change <span class="sc">%&gt;%</span> </span>
<span id="cb128-1178"><a href="#cb128-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SITE, VENT, SUPERGROUP)</span>
<span id="cb128-1179"><a href="#cb128-1179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1180"><a href="#cb128-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1181"><a href="#cb128-1181" aria-hidden="true" tabindex="-1"></a><span class="fu">## CLR change</span></span>
<span id="cb128-1182"><a href="#cb128-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1185"><a href="#cb128-1185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1186"><a href="#cb128-1186" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb128-1187"><a href="#cb128-1187" aria-hidden="true" tabindex="-1"></a>numeric_tmp <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb128-1188"><a href="#cb128-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1189"><a href="#cb128-1189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1190"><a href="#cb128-1190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1191"><a href="#cb128-1191" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unite(TAX, Taxon, FeatureID, sep = "__") %&gt;% </span></span>
<span id="cb128-1192"><a href="#cb128-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1193"><a href="#cb128-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-1194"><a href="#cb128-1194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb128-1195"><a href="#cb128-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1196"><a href="#cb128-1196" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(numeric_tmp))))</span>
<span id="cb128-1197"><a href="#cb128-1197" aria-hidden="true" tabindex="-1"></a><span class="do">## From above </span></span>
<span id="cb128-1198"><a href="#cb128-1198" aria-hidden="true" tabindex="-1"></a><span class="co"># head(logratio_mcr)</span></span>
<span id="cb128-1199"><a href="#cb128-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1200"><a href="#cb128-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1201"><a href="#cb128-1201" aria-hidden="true" tabindex="-1"></a><span class="fu"># Tree</span></span>
<span id="cb128-1202"><a href="#cb128-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1205"><a href="#cb128-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1206"><a href="#cb128-1206" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span>
<span id="cb128-1207"><a href="#cb128-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1208"><a href="#cb128-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1209"><a href="#cb128-1209" aria-hidden="true" tabindex="-1"></a>What is relatedness between piccard and von damm ciliate communities? First try at</span>
<span id="cb128-1210"><a href="#cb128-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1213"><a href="#cb128-1213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1214"><a href="#cb128-1214" aria-hidden="true" tabindex="-1"></a><span class="co"># head(tax_table(physeq_mcr))</span></span>
<span id="cb128-1215"><a href="#cb128-1215" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_ciliate &lt;- subset_taxa(physeq_mcr, Phylum == "Ciliophora") %&gt;% </span></span>
<span id="cb128-1216"><a href="#cb128-1216" aria-hidden="true" tabindex="-1"></a><span class="co">#   subset_samples(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb128-1217"><a href="#cb128-1217" aria-hidden="true" tabindex="-1"></a><span class="co">#   tax_glom(taxrank="Species")</span></span>
<span id="cb128-1218"><a href="#cb128-1218" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb128-1219"><a href="#cb128-1219" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_ciliate</span></span>
<span id="cb128-1220"><a href="#cb128-1220" aria-hidden="true" tabindex="-1"></a><span class="co"># # head(tax_table(mcr_ciliate))</span></span>
<span id="cb128-1221"><a href="#cb128-1221" aria-hidden="true" tabindex="-1"></a><span class="co"># # subset_ciliate &lt;- prune_samples(sample_sums(mcr_ciliate) &gt; 100)</span></span>
<span id="cb128-1222"><a href="#cb128-1222" aria-hidden="true" tabindex="-1"></a><span class="co"># phy_tree(mcr_ciliate)</span></span>
<span id="cb128-1223"><a href="#cb128-1223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1224"><a href="#cb128-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1227"><a href="#cb128-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1228"><a href="#cb128-1228" aria-hidden="true" tabindex="-1"></a><span class="co"># Bug in phyloseq requires update with dev version on github:</span></span>
<span id="cb128-1229"><a href="#cb128-1229" aria-hidden="true" tabindex="-1"></a><span class="co"># library("devtools")</span></span>
<span id="cb128-1230"><a href="#cb128-1230" aria-hidden="true" tabindex="-1"></a><span class="co"># install_github("joey711/phyloseq")</span></span>
<span id="cb128-1231"><a href="#cb128-1231" aria-hidden="true" tabindex="-1"></a><span class="co"># library(phyloseq)</span></span>
<span id="cb128-1232"><a href="#cb128-1232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1233"><a href="#cb128-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1234"><a href="#cb128-1234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=18, fig.width=9}</span></span>
<span id="cb128-1235"><a href="#cb128-1235" aria-hidden="true" tabindex="-1"></a><span class="co"># plot_tree(clean, </span></span>
<span id="cb128-1236"><a href="#cb128-1236" aria-hidden="true" tabindex="-1"></a><span class="co">#           color = "SITE",</span></span>
<span id="cb128-1237"><a href="#cb128-1237" aria-hidden="true" tabindex="-1"></a><span class="co">#           label.tips = "Species", </span></span>
<span id="cb128-1238"><a href="#cb128-1238" aria-hidden="true" tabindex="-1"></a><span class="co">#           shape = "SAMPLETYPE", size = "abundance", base.spacing = 0.06)</span></span>
<span id="cb128-1239"><a href="#cb128-1239" aria-hidden="true" tabindex="-1"></a><span class="co"># ?plot_tree</span></span>
<span id="cb128-1240"><a href="#cb128-1240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb128-1241"><a href="#cb128-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1242"><a href="#cb128-1242" aria-hidden="true" tabindex="-1"></a><span class="fu"># Session information</span></span>
<span id="cb128-1243"><a href="#cb128-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-1246"><a href="#cb128-1246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb128-1247"><a href="#cb128-1247" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb128-1248"><a href="#cb128-1248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>