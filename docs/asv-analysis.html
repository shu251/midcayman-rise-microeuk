<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mid-Cayman Rise analysis - 18S rRNA gene amplicon survey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Mid-Cayman Rise analysis</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./grazing.html">Grazing analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./asv-analysis.html" aria-current="page">Sequence analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sequence-qc.html">Sequence QC &amp; import</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#import-sequence-and-metadata" id="toc-import-sequence-and-metadata" class="nav-link active" data-scroll-target="#import-sequence-and-metadata"><span class="toc-section-number">1</span>  Import sequence and metadata</a>
  <ul class="collapse">
  <li><a href="#import-asv-r-objects" id="toc-import-asv-r-objects" class="nav-link" data-scroll-target="#import-asv-r-objects"><span class="toc-section-number">1.1</span>  Import ASV R objects</a></li>
  <li><a href="#factor---legendcolor-key" id="toc-factor---legendcolor-key" class="nav-link" data-scroll-target="#factor---legendcolor-key"><span class="toc-section-number">1.2</span>  Factor - legend/color key</a></li>
  </ul></li>
  <li><a href="#preliminary-look-at-all-samples" id="toc-preliminary-look-at-all-samples" class="nav-link" data-scroll-target="#preliminary-look-at-all-samples"><span class="toc-section-number">2</span>  Preliminary look at all samples</a>
  <ul class="collapse">
  <li><a href="#cluster-analysis" id="toc-cluster-analysis" class="nav-link" data-scroll-target="#cluster-analysis"><span class="toc-section-number">2.1</span>  Cluster analysis</a>
  <ul class="collapse">
  <li><a href="#with-grazing-assays" id="toc-with-grazing-assays" class="nav-link" data-scroll-target="#with-grazing-assays">with grazing assays</a></li>
  <li><a href="#insitu-only" id="toc-insitu-only" class="nav-link" data-scroll-target="#insitu-only">insitu only</a></li>
  </ul></li>
  <li><a href="#community-taxonomic-composition-richness-sequence-relative-abundance" id="toc-community-taxonomic-composition-richness-sequence-relative-abundance" class="nav-link" data-scroll-target="#community-taxonomic-composition-richness-sequence-relative-abundance"><span class="toc-section-number">2.2</span>  Community taxonomic composition (richness &amp; sequence relative abundance)</a>
  <ul class="collapse">
  <li><a href="#dendrogram-with-bubble-plot" id="toc-dendrogram-with-bubble-plot" class="nav-link" data-scroll-target="#dendrogram-with-bubble-plot">Dendrogram with bubble plot</a></li>
  <li><a href="#relative-abundance" id="toc-relative-abundance" class="nav-link" data-scroll-target="#relative-abundance">Relative abundance</a></li>
  </ul></li>
  <li><a href="#richness" id="toc-richness" class="nav-link" data-scroll-target="#richness"><span class="toc-section-number">2.3</span>  Richness</a></li>
  </ul></li>
  <li><a href="#asv-overlap-comparison" id="toc-asv-overlap-comparison" class="nav-link" data-scroll-target="#asv-overlap-comparison"><span class="toc-section-number">3</span>  ASV overlap comparison</a>
  <ul class="collapse">
  <li><a href="#supergroup-to-phylum-level-comparisons" id="toc-supergroup-to-phylum-level-comparisons" class="nav-link" data-scroll-target="#supergroup-to-phylum-level-comparisons"><span class="toc-section-number">3.1</span>  Supergroup to phylum level comparisons</a></li>
  <li><a href="#asvs-shared-across-mcr-vents" id="toc-asvs-shared-across-mcr-vents" class="nav-link" data-scroll-target="#asvs-shared-across-mcr-vents"><span class="toc-section-number">3.2</span>  ASVs shared across MCR vents</a></li>
  <li><a href="#asvs-shared-in-situ-tf-for-each-experiment" id="toc-asvs-shared-in-situ-tf-for-each-experiment" class="nav-link" data-scroll-target="#asvs-shared-in-situ-tf-for-each-experiment"><span class="toc-section-number">3.3</span>  ASVs shared in situ &amp; Tf for each experiment</a>
  <ul class="collapse">
  <li><a href="#table-to-present-shared-asvs-and-taxa" id="toc-table-to-present-shared-asvs-and-taxa" class="nav-link" data-scroll-target="#table-to-present-shared-asvs-and-taxa">Table to present shared ASVs and taxa</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#in-situ-vs.-tf-relative-changes" id="toc-in-situ-vs.-tf-relative-changes" class="nav-link" data-scroll-target="#in-situ-vs.-tf-relative-changes"><span class="toc-section-number">4</span>  In situ vs.&nbsp;Tf relative changes</a></li>
  <li><a href="#corncob-enriched-taxa" id="toc-corncob-enriched-taxa" class="nav-link" data-scroll-target="#corncob-enriched-taxa"><span class="toc-section-number">5</span>  Corncob enriched taxa</a>
  <ul class="collapse">
  <li><a href="#supergroup-corncob" id="toc-supergroup-corncob" class="nav-link" data-scroll-target="#supergroup-corncob">Supergroup corncob</a></li>
  <li><a href="#phylum-corncob-analysis" id="toc-phylum-corncob-analysis" class="nav-link" data-scroll-target="#phylum-corncob-analysis">Phylum corncob analysis</a></li>
  <li><a href="#class-corncob-analysis" id="toc-class-corncob-analysis" class="nav-link" data-scroll-target="#class-corncob-analysis">Class corncob analysis</a></li>
  <li><a href="#order-corncob" id="toc-order-corncob" class="nav-link" data-scroll-target="#order-corncob">Order corncob</a></li>
  <li><a href="#family-corncob" id="toc-family-corncob" class="nav-link" data-scroll-target="#family-corncob">Family corncob</a></li>
  <li><a href="#genus-corncob" id="toc-genus-corncob" class="nav-link" data-scroll-target="#genus-corncob">Genus corncob</a></li>
  <li><a href="#species-corncob" id="toc-species-corncob" class="nav-link" data-scroll-target="#species-corncob">Species corncob</a></li>
  </ul></li>
  <li><a href="#corncob-pa-info" id="toc-corncob-pa-info" class="nav-link" data-scroll-target="#corncob-pa-info"><span class="toc-section-number">6</span>  Corncob + P/A info</a></li>
  <li><a href="#info" id="toc-info" class="nav-link" data-scroll-target="#info"><span class="toc-section-number">7</span>  Info</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">18S rRNA gene amplicon survey</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Goals for this analysis are to investigate specific protistan taxonomic groups in the context of elevated grazing activity, cell biomass, and hydrothermal vent sample type.</p>
<p>Data originate from in situ MCR samples from a tag-sequence survey and the Tf time point from the grazing experiments. Additionally, in situ and grazing experiments were conducted within vent sites, at the plume, and in the background.</p>
<section id="import-sequence-and-metadata" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Import sequence and metadata</h1>
<p>Set up R environment</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(ape)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggupset); <span class="fu">library</span>(cowplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import previously sequenced and analyzed tag-sequence data. See https://shu251.github.io/microeuk-amplicon-survey/ for additional information.</p>
<section id="import-asv-r-objects" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="import-asv-r-objects"><span class="header-section-number">1.1</span> Import ASV R objects</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="factor---legendcolor-key" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="factor---legendcolor-key"><span class="header-section-number">1.2</span> Factor - legend/color key</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"LotsOShrimp"</span>, <span class="st">"X18"</span>, <span class="st">"OMT"</span>, <span class="st">"OldManTree"</span>, <span class="st">"Rav2"</span>, <span class="st">"MustardStand"</span>, <span class="st">"ShrimpHole"</span>, <span class="st">"WhiteCastle"</span>, <span class="st">"ArrowLoop"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>vent_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"Lots 'O Shrimp"</span>, <span class="st">"X-18"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Ravelin #2"</span>, <span class="st">"Mustard Stand"</span>, <span class="st">"Shrimp Hole"</span>, <span class="st">"White Castle"</span>, <span class="st">"Arrow Loop"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>site_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VD"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>site_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_color) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>whole_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#E9C46A"</span>,<span class="st">"#F4A261"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#eae2b7"</span>, <span class="st">"#5f0f40"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#941b0c"</span>, <span class="st">"#577590"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for VD and Piccard</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>site_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#418b84"</span>, <span class="st">"#943b36"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># site_colors</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent colors</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>vent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#253494"</span>,<span class="st">"#1d91c0"</span>, <span class="st">"#E9C46A"</span>, <span class="st">"#E76F51"</span>, <span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#941b0c"</span>, <span class="st">"#577590"</span>, <span class="st">"#eae2b7"</span>, <span class="st">"#deebf7"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># vent_colors &lt;- c("")</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vent_colors) <span class="ot">&lt;-</span> vent_fullname</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># all_taxa_color = c("#fa9fb5", "#c51b8a", "#67000d", "#ef3b2c", "#ffffcc", "#feb24c", "#c7e9b4", "#1d91c0", "#deebf7", "#253494", "#9e9ac8", "#238b45", "#54278f", "#bdbdbd", "#252525", "#fa9fb5", "#c51b8a", "#67000d", "#ef3b2c", "#ffffcc", "#feb24c", "#c7e9b4", "#1d91c0", "#253494", "#9e9ac8", "#238b45", "#54278f", "#bdbdbd", "#252525")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="preliminary-look-at-all-samples" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Preliminary look at all samples</h1>
<section id="cluster-analysis" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="cluster-analysis"><span class="header-section-number">2.1</span> Cluster analysis</h2>
<p>Ordination analysis and methods to look at whole protistan communities at MCR.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan); <span class="fu">library</span>(ggdendro); <span class="fu">library</span>(compositions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: permute</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is vegan 2.6-2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to compositions, a package for compositional data analysis.
Find an intro with "? compositions"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'compositions'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ape':

    balance</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    anova, cor, cov, dist, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    %*%, norm, scale, scale.default</code></pre>
</div>
</div>
<section id="with-grazing-assays" class="level3">
<h3 class="anchored" data-anchor-id="with-grazing-assays">with grazing assays</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<p>Transform compositional data, center log ratio.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric)))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(logratio_mcr)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ?alr()</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ?ilr()</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(logratio_mcr)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>variance_logratio <span class="ot">&lt;-</span> (pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 21 rows [1, 2, 3, 4, 5, 6, 7,
8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mcr_pca_pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                            SAMPLENAME    SITE SAMPLETYPE YEAR        VENT
1              VonDamm Vent 2020 Rav2  VonDamm       Vent 2020        Rav2
2         VonDamm Incubation 2020 X18  VonDamm Incubation 2020         X18
3            VonDamm Plume 2020 Plume  VonDamm      Plume 2020       Plume
4        VonDamm Vent 2020 OldManTree  VonDamm       Vent 2020  OldManTree
5 Piccard Incubation 2020 LotsOShrimp  Piccard Incubation 2020 LotsOShrimp
6       Piccard Vent 2020 LotsOShrimp  Piccard       Vent 2020 LotsOShrimp
        PC1        PC2        PC3        PC4       PC5        PC6        PC7
1 -16.66049  33.491320  27.826731  -6.626164 14.976707 -0.5598742  2.1386231
2   7.68631  18.562691 -24.234851   4.428354  2.402076 -2.7348938  6.7272331
3  24.34783  -5.176543  12.216126  -1.961113 -6.287978 11.4643143 30.7784505
4 -15.23842  -7.130815   3.587339  13.558573 -3.885170  6.5688452 -0.7907721
5 -10.07097  -8.865207  -9.303047 -23.625628  4.376019  1.2473642  1.1679888
6  -9.60356 -10.661881  -8.528201 -20.910781  3.655157  0.5449495  0.1408619
         PC8        PC9       PC10        PC11      PC12       PC13       PC14
1 -0.5113209  1.0579649 -1.6933270  2.55940568  1.595370 -1.1555829  1.8003407
2 -6.6733795 22.7666021 -3.5049975 -4.64339892 -4.353012 -9.5529134  0.5902162
3  2.4093512 -2.7924319 -0.7539172 -2.16438508  1.977934 -0.5109521  0.3881920
4 -3.6934376  0.7177921  0.2817636  1.88966025  3.008961 -4.2030272 18.1914206
5  7.4655090  2.3548114 -5.3315562  2.64448731  4.596835 -2.0376774  2.1808512
6  6.1318504  1.3543691 -4.9460733 -0.01426047  1.842904  2.5475468  2.5326266
         PC15        PC16       PC17        PC18       PC19        PC20
1 -0.19918653   2.1499335 -0.7776007   0.5647057  0.7680609 -0.02735687
2 -0.36867909   0.2394945  0.1971653   0.9217671  0.3150451  0.16893204
3 -0.07038206   0.4930806  0.4687030   0.3778031 -0.2564890 -0.11219944
4 -8.43466011 -14.1597969 -0.4244370   1.9523757 -6.7918517 -0.08065150
5 -0.59260566  -3.5621454  5.8461063 -17.9802573 -1.3045755 -0.04419918
6 -0.57219613   1.0017413  1.1247682  21.0753191  1.1712653 -0.06307456
           PC21                               SAMPLE
1 -2.524533e-13              VonDamm Vent 2020 Rav2 
2  2.866462e-14         VonDamm Incubation 2020 X18 
3  7.005959e-15            VonDamm Plume 2020 Plume 
4 -1.456441e-14        VonDamm Vent 2020 OldManTree 
5  5.043544e-14 Piccard Incubation 2020 LotsOShrimp 
6  7.144871e-14       Piccard Vent 2020 LotsOShrimp </code></pre>
</div>
</div>
<p>PCoA with all samples</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE, <span class="at">fill =</span> TYPE, <span class="at">color =</span> VENT_ORDER)) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">23</span>)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>,<span class="st">"darkgrey"</span>)) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<section id="dendrogram-analysis" class="level4">
<h4 class="anchored" data-anchor-id="dendrogram-analysis">Dendrogram analysis</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?decostand()</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative abundance</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>rel_abun <span class="ot">&lt;-</span> <span class="fu">decostand</span>(asv_mcr_numeric, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"total"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster dendrogram (average hierarchical clustering)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>cluster_mcr <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(rel_abun)), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>dendro <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(cluster_mcr)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>mcr_dendro <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(dendro, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">segment</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend)) <span class="sc">+</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">data =</span> <span class="fu">label</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dendro</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Dissimilarity"</span>) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">14</span>), <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#252525"</span>), </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># svg('figs/SUPPLEMENTARY-dendrogram-wreps.svg', w = 10, h = 8)</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
</section>
<section id="insitu-only" class="level3">
<h3 class="anchored" data-anchor-id="insitu-only">insitu only</h3>
<p>PCoA with in situ only</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric_insitu <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>insitu_logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric_insitu)))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>insitu_pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(insitu_logratio_mcr)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>insitu_variance_logratio <span class="ot">&lt;-</span> (insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(insitu_variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points for only insitu samples</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(insitu_pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(insitu_pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 13 rows [1, 2, 3, 4, 5, 6, 7,
8, 9, 10, 11, 12, 13].</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE_ORDER, <span class="at">fill =</span> VENT_ORDER)) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
</section>
<section id="community-taxonomic-composition-richness-sequence-relative-abundance" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="community-taxonomic-composition-richness-sequence-relative-abundance"><span class="header-section-number">2.2</span> Community taxonomic composition (richness &amp; sequence relative abundance)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>out_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcr_dendro<span class="sc">$</span>labels)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>mcr_sample_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(out_labels<span class="sc">$</span>label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span> </span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TOTAL_SEQ =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq),</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">REL_ABUN =</span> SUM<span class="sc">/</span>TOTAL_SEQ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUPERGROUP, <span class="at">size =</span> REL_ABUN)) <span class="sc">+</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="fu">aes</span>(<span class="at">size =</span> REL_ABUN, <span class="at">fill =</span> SUPERGROUP, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(. ~ SITE, scales = "free", space = "free") +</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'Taxon'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 10924 rows [3, 10, 11, 12,
13, 14, 18, 19, 20, 21, 23, 27, 28, 30, 31, 32, 33, 34, 35, 38, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 6487 rows [1, 2, 4, 5, 6,
7, 8, 9, 15, 16, 17, 22, 24, 25, 26, 29, 36, 37, 48, 49, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
 Please use `reframe()` instead.
 When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'SUPERGROUP'. You can override using the `.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bubble</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="1056"></p>
</div>
</div>
<section id="dendrogram-with-bubble-plot" class="level3">
<h3 class="anchored" data-anchor-id="dendrogram-with-bubble-plot">Dendrogram with bubble plot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_dendro_plot + bubble + patchwork::plot_layout(ncol = 2) + patchwork::plot_annotation(tag_levels = "a")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="relative-abundance" class="level3">
<h3 class="anchored" data-anchor-id="relative-abundance">Relative abundance</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUM)) <span class="sc">+</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VENT <span class="sc">+</span> SITE, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'Taxon'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 10924 rows [3, 10, 11, 12,
13, 14, 18, 19, 20, 21, 23, 27, 28, 30, 31, 32, 33, 34, 35, 38, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 6487 rows [1, 2, 4, 5, 6,
7, 8, 9, 15, 16, 17, 22, 24, 25, 26, 29, 36, 37, 48, 49, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE'.
You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In bar plot above, in situ and Tf incubation samples are paired for each site.</p>
</section>
</section>
<section id="richness" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="richness"><span class="header-section-number">2.3</span> Richness</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("adw96/breakaway")</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("adw96/DivNet")</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(breakaway); <span class="fu">library</span>(DivNet); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_data</span>(physeq_mcr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                         X           VENT
52_MCR_Piccard_expTf_LotsOShrimp_A_0_Jun2021             2    LotsOShrimp
53_MCR_Piccard_expTf_LotsOShrimp_B_0_Jun2021             3    LotsOShrimp
54_MCR_VonDamm_expTf_MustardStand_0_0_Jun2021            9   MustardStand
55_MCR_VonDamm_expTf_ShrimpHole_0_0_Jun2021             10     ShrimpHole
57_MCR_Piccard_expTf_Shrimpocalypse_0_0_Jun2021          4 Shrimpocalypse
58_MCR_VonDamm_expTf_Plume_0_0_Jun2021                  11          Plume
59_MCR_VonDamm_expTf_X18_0_0_Jun2021                    12            X18
60_MCR_VonDamm_expTf_BSW_0_0_Jun2021                    13            BSW
61_MCR_VonDamm_expTf_Rav2_0_0_Jun2021                   14           Rav2
63_MCR_VonDamm_CTD_BSW_CTD002_0_Jun2021                  8            BSW
65_MCR_VonDamm_CTD_Plume_CTD003_0_Jun2021               15          Plume
66_MCR_VonDamm_HOG_ArrowLoop_J21243HOG18_5_Jun2021      16      ArrowLoop
67_MCR_VonDamm_HOG_WhiteCastle_J21235HOG12_5_Jun2021    17    WhiteCastle
69_MCR_VonDamm_HOG_MustardStand_J21243HOG14_5_Jun2021   18   MustardStand
70_MCR_VonDamm_HOG_Rav2_J21238HOG14_5_Jun2021           19           Rav2
71_MCR_VonDamm_HOG_OldManTree_J21238HOG20_5_Jun2021     20     OldManTree
72_MCR_VonDamm_HOG_ShrimpHole_J21244HOG18_0_Jun2021     21     ShrimpHole
73_MCR_Piccard_CTD_BSW_CTD005_0_Jun2021                  1            BSW
74_MCR_Piccard_CTD_Plume_CTD004_5_Jun2021                5          Plume
76_MCR_VonDamm_HOG_X18_J21235HOG20_0_Jun2021            22            X18
77_MCR_Piccard_HOG_Shrimpocalypse_J21240HOG14_0_Jun2021  6 Shrimpocalypse
78_MCR_Piccard_HOG_LotsOShrimp_J21241HOG14_0_Jun2021     7    LotsOShrimp
80_MCR_VonDamm_HOG_Rav2_J21244HOG20_0_Jun2021           23           Rav2
                                                           SITE SAMPLEID  DEPTH
52_MCR_Piccard_expTf_LotsOShrimp_A_0_Jun2021            Piccard                
53_MCR_Piccard_expTf_LotsOShrimp_B_0_Jun2021            Piccard                
54_MCR_VonDamm_expTf_MustardStand_0_0_Jun2021           VonDamm                
55_MCR_VonDamm_expTf_ShrimpHole_0_0_Jun2021             VonDamm                
57_MCR_Piccard_expTf_Shrimpocalypse_0_0_Jun2021         Piccard                
58_MCR_VonDamm_expTf_Plume_0_0_Jun2021                  VonDamm                
59_MCR_VonDamm_expTf_X18_0_0_Jun2021                    VonDamm                
60_MCR_VonDamm_expTf_BSW_0_0_Jun2021                    VonDamm                
61_MCR_VonDamm_expTf_Rav2_0_0_Jun2021                   VonDamm                
63_MCR_VonDamm_CTD_BSW_CTD002_0_Jun2021                 VonDamm            2400
65_MCR_VonDamm_CTD_Plume_CTD003_0_Jun2021               VonDamm            1979
66_MCR_VonDamm_HOG_ArrowLoop_J21243HOG18_5_Jun2021      VonDamm            2309
67_MCR_VonDamm_HOG_WhiteCastle_J21235HOG12_5_Jun2021    VonDamm            2307
69_MCR_VonDamm_HOG_MustardStand_J21243HOG14_5_Jun2021   VonDamm            2374
70_MCR_VonDamm_HOG_Rav2_J21238HOG14_5_Jun2021           VonDamm          2389.6
71_MCR_VonDamm_HOG_OldManTree_J21238HOG20_5_Jun2021     VonDamm          2375.8
72_MCR_VonDamm_HOG_ShrimpHole_J21244HOG18_0_Jun2021     VonDamm            2376
73_MCR_Piccard_CTD_BSW_CTD005_0_Jun2021                 Piccard            4776
74_MCR_Piccard_CTD_Plume_CTD004_5_Jun2021               Piccard            4944
76_MCR_VonDamm_HOG_X18_J21235HOG20_0_Jun2021            VonDamm            2377
77_MCR_Piccard_HOG_Shrimpocalypse_J21240HOG14_0_Jun2021 Piccard            4945
78_MCR_Piccard_HOG_LotsOShrimp_J21241HOG14_0_Jun2021    Piccard            4967
80_MCR_VonDamm_HOG_Rav2_J21244HOG20_0_Jun2021           VonDamm          2388.9
                                                        SAMPLETYPE
52_MCR_Piccard_expTf_LotsOShrimp_A_0_Jun2021            Incubation
53_MCR_Piccard_expTf_LotsOShrimp_B_0_Jun2021            Incubation
54_MCR_VonDamm_expTf_MustardStand_0_0_Jun2021           Incubation
55_MCR_VonDamm_expTf_ShrimpHole_0_0_Jun2021             Incubation
57_MCR_Piccard_expTf_Shrimpocalypse_0_0_Jun2021         Incubation
58_MCR_VonDamm_expTf_Plume_0_0_Jun2021                  Incubation
59_MCR_VonDamm_expTf_X18_0_0_Jun2021                    Incubation
60_MCR_VonDamm_expTf_BSW_0_0_Jun2021                    Incubation
61_MCR_VonDamm_expTf_Rav2_0_0_Jun2021                   Incubation
63_MCR_VonDamm_CTD_BSW_CTD002_0_Jun2021                 Background
65_MCR_VonDamm_CTD_Plume_CTD003_0_Jun2021                    Plume
66_MCR_VonDamm_HOG_ArrowLoop_J21243HOG18_5_Jun2021            Vent
67_MCR_VonDamm_HOG_WhiteCastle_J21235HOG12_5_Jun2021          Vent
69_MCR_VonDamm_HOG_MustardStand_J21243HOG14_5_Jun2021         Vent
70_MCR_VonDamm_HOG_Rav2_J21238HOG14_5_Jun2021                 Vent
71_MCR_VonDamm_HOG_OldManTree_J21238HOG20_5_Jun2021           Vent
72_MCR_VonDamm_HOG_ShrimpHole_J21244HOG18_0_Jun2021           Vent
73_MCR_Piccard_CTD_BSW_CTD005_0_Jun2021                 Background
74_MCR_Piccard_CTD_Plume_CTD004_5_Jun2021                    Plume
76_MCR_VonDamm_HOG_X18_J21235HOG20_0_Jun2021                  Vent
77_MCR_Piccard_HOG_Shrimpocalypse_J21240HOG14_0_Jun2021       Vent
78_MCR_Piccard_HOG_LotsOShrimp_J21241HOG14_0_Jun2021          Vent
80_MCR_VonDamm_HOG_Rav2_J21244HOG20_0_Jun2021                 Vent
                                                        SAMPLETYPE_BIN YEAR
52_MCR_Piccard_expTf_LotsOShrimp_A_0_Jun2021                  non-vent 2020
53_MCR_Piccard_expTf_LotsOShrimp_B_0_Jun2021                  non-vent 2020
54_MCR_VonDamm_expTf_MustardStand_0_0_Jun2021                 non-vent 2020
55_MCR_VonDamm_expTf_ShrimpHole_0_0_Jun2021                   non-vent 2020
57_MCR_Piccard_expTf_Shrimpocalypse_0_0_Jun2021               non-vent 2020
58_MCR_VonDamm_expTf_Plume_0_0_Jun2021                        non-vent 2020
59_MCR_VonDamm_expTf_X18_0_0_Jun2021                          non-vent 2020
60_MCR_VonDamm_expTf_BSW_0_0_Jun2021                          non-vent 2020
61_MCR_VonDamm_expTf_Rav2_0_0_Jun2021                         non-vent 2020
63_MCR_VonDamm_CTD_BSW_CTD002_0_Jun2021                       non-vent 2020
65_MCR_VonDamm_CTD_Plume_CTD003_0_Jun2021                     non-vent 2020
66_MCR_VonDamm_HOG_ArrowLoop_J21243HOG18_5_Jun2021                vent 2020
67_MCR_VonDamm_HOG_WhiteCastle_J21235HOG12_5_Jun2021              vent 2020
69_MCR_VonDamm_HOG_MustardStand_J21243HOG14_5_Jun2021             vent 2020
70_MCR_VonDamm_HOG_Rav2_J21238HOG14_5_Jun2021                     vent 2020
71_MCR_VonDamm_HOG_OldManTree_J21238HOG20_5_Jun2021               vent 2020
72_MCR_VonDamm_HOG_ShrimpHole_J21244HOG18_0_Jun2021               vent 2020
73_MCR_Piccard_CTD_BSW_CTD005_0_Jun2021                       non-vent 2020
74_MCR_Piccard_CTD_Plume_CTD004_5_Jun2021                     non-vent 2020
76_MCR_VonDamm_HOG_X18_J21235HOG20_0_Jun2021                      vent 2020
77_MCR_Piccard_HOG_Shrimpocalypse_J21240HOG14_0_Jun2021           vent 2020
78_MCR_Piccard_HOG_LotsOShrimp_J21241HOG14_0_Jun2021              vent 2020
80_MCR_VonDamm_HOG_Rav2_J21244HOG20_0_Jun2021                     vent 2020
                                                         TEMP   pH PercSeawater
52_MCR_Piccard_expTf_LotsOShrimp_A_0_Jun2021             &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
53_MCR_Piccard_expTf_LotsOShrimp_B_0_Jun2021             &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
54_MCR_VonDamm_expTf_MustardStand_0_0_Jun2021            &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
55_MCR_VonDamm_expTf_ShrimpHole_0_0_Jun2021              &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
57_MCR_Piccard_expTf_Shrimpocalypse_0_0_Jun2021          &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
58_MCR_VonDamm_expTf_Plume_0_0_Jun2021                   &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
59_MCR_VonDamm_expTf_X18_0_0_Jun2021                     &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
60_MCR_VonDamm_expTf_BSW_0_0_Jun2021                     &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
61_MCR_VonDamm_expTf_Rav2_0_0_Jun2021                    &lt;NA&gt; &lt;NA&gt;         &lt;NA&gt;
63_MCR_VonDamm_CTD_BSW_CTD002_0_Jun2021                 4.181 &lt;NA&gt;          100
65_MCR_VonDamm_CTD_Plume_CTD003_0_Jun2021               4.208 &lt;NA&gt;         &lt;NA&gt;
66_MCR_VonDamm_HOG_ArrowLoop_J21243HOG18_5_Jun2021        137 5.69         33.8
67_MCR_VonDamm_HOG_WhiteCastle_J21235HOG12_5_Jun2021      108 5.49         16.6
69_MCR_VonDamm_HOG_MustardStand_J21243HOG14_5_Jun2021     108 5.63         36.2
70_MCR_VonDamm_HOG_Rav2_J21238HOG14_5_Jun2021              94 5.81         33.4
71_MCR_VonDamm_HOG_OldManTree_J21238HOG20_5_Jun2021     121.6 5.69         25.6
72_MCR_VonDamm_HOG_ShrimpHole_J21244HOG18_0_Jun2021        21 7.72         96.4
73_MCR_Piccard_CTD_BSW_CTD005_0_Jun2021                  4.46 &lt;NA&gt;          100
74_MCR_Piccard_CTD_Plume_CTD004_5_Jun2021                4.46 &lt;NA&gt;         &lt;NA&gt;
76_MCR_VonDamm_HOG_X18_J21235HOG20_0_Jun2021               48 6.99           52
77_MCR_Piccard_HOG_Shrimpocalypse_J21240HOG14_0_Jun2021    85 5.11         81.7
78_MCR_Piccard_HOG_LotsOShrimp_J21241HOG14_0_Jun2021       36 5.92         94.9
80_MCR_VonDamm_HOG_Rav2_J21244HOG20_0_Jun2021            98.2 5.81         33.4
                                                          Mg      H2  H2S
52_MCR_Piccard_expTf_LotsOShrimp_A_0_Jun2021               0         &lt;NA&gt;
53_MCR_Piccard_expTf_LotsOShrimp_B_0_Jun2021               0         &lt;NA&gt;
54_MCR_VonDamm_expTf_MustardStand_0_0_Jun2021              0         &lt;NA&gt;
55_MCR_VonDamm_expTf_ShrimpHole_0_0_Jun2021                0         &lt;NA&gt;
57_MCR_Piccard_expTf_Shrimpocalypse_0_0_Jun2021            0         &lt;NA&gt;
58_MCR_VonDamm_expTf_Plume_0_0_Jun2021                     0         &lt;NA&gt;
59_MCR_VonDamm_expTf_X18_0_0_Jun2021                       0         &lt;NA&gt;
60_MCR_VonDamm_expTf_BSW_0_0_Jun2021                       0         &lt;NA&gt;
61_MCR_VonDamm_expTf_Rav2_0_0_Jun2021                      0         &lt;NA&gt;
63_MCR_VonDamm_CTD_BSW_CTD002_0_Jun2021                 &lt;NA&gt;         &lt;NA&gt;
65_MCR_VonDamm_CTD_Plume_CTD003_0_Jun2021               &lt;NA&gt;         &lt;NA&gt;
66_MCR_VonDamm_HOG_ArrowLoop_J21243HOG18_5_Jun2021      18.1   11500 1.74
67_MCR_VonDamm_HOG_WhiteCastle_J21235HOG12_5_Jun2021     8.9   14500 1.96
69_MCR_VonDamm_HOG_MustardStand_J21243HOG14_5_Jun2021   19.4    9800 1.79
70_MCR_VonDamm_HOG_Rav2_J21238HOG14_5_Jun2021             18   10200 1.37
71_MCR_VonDamm_HOG_OldManTree_J21238HOG20_5_Jun2021     13.7   11600 1.77
72_MCR_VonDamm_HOG_ShrimpHole_J21244HOG18_0_Jun2021     51.8 5.52744 &lt;NA&gt;
73_MCR_Piccard_CTD_BSW_CTD005_0_Jun2021                 53.7         &lt;NA&gt;
74_MCR_Piccard_CTD_Plume_CTD004_5_Jun2021               &lt;NA&gt;         &lt;NA&gt;
76_MCR_VonDamm_HOG_X18_J21235HOG20_0_Jun2021              28         2.11
77_MCR_Piccard_HOG_Shrimpocalypse_J21240HOG14_0_Jun2021 43.9       0 &lt;NA&gt;
78_MCR_Piccard_HOG_LotsOShrimp_J21241HOG14_0_Jun2021      51   22700 &lt;NA&gt;
80_MCR_VonDamm_HOG_Rav2_J21244HOG20_0_Jun2021             18   10200 1.37
                                                              CH4   ProkConc
52_MCR_Piccard_expTf_LotsOShrimp_A_0_Jun2021                 &lt;NA&gt;           
53_MCR_Piccard_expTf_LotsOShrimp_B_0_Jun2021                 &lt;NA&gt;           
54_MCR_VonDamm_expTf_MustardStand_0_0_Jun2021                &lt;NA&gt;           
55_MCR_VonDamm_expTf_ShrimpHole_0_0_Jun2021                  &lt;NA&gt;           
57_MCR_Piccard_expTf_Shrimpocalypse_0_0_Jun2021              &lt;NA&gt;           
58_MCR_VonDamm_expTf_Plume_0_0_Jun2021                       &lt;NA&gt;           
59_MCR_VonDamm_expTf_X18_0_0_Jun2021                         &lt;NA&gt;           
60_MCR_VonDamm_expTf_BSW_0_0_Jun2021                         &lt;NA&gt;           
61_MCR_VonDamm_expTf_Rav2_0_0_Jun2021                        &lt;NA&gt;           
63_MCR_VonDamm_CTD_BSW_CTD002_0_Jun2021                      &lt;NA&gt; 34705.9161
65_MCR_VonDamm_CTD_Plume_CTD003_0_Jun2021                    &lt;NA&gt;  16478.313
66_MCR_VonDamm_HOG_ArrowLoop_J21243HOG18_5_Jun2021        1893.66  10369.792
67_MCR_VonDamm_HOG_WhiteCastle_J21235HOG12_5_Jun2021      2251.92           
69_MCR_VonDamm_HOG_MustardStand_J21243HOG14_5_Jun2021   1819.9608      56677
70_MCR_VonDamm_HOG_Rav2_J21238HOG14_5_Jun2021             1893.66           
71_MCR_VonDamm_HOG_OldManTree_J21238HOG20_5_Jun2021      1985.784           
72_MCR_VonDamm_HOG_ShrimpHole_J21244HOG18_0_Jun2021      218.0268           
73_MCR_Piccard_CTD_BSW_CTD005_0_Jun2021                      &lt;NA&gt;  11860.187
74_MCR_Piccard_CTD_Plume_CTD004_5_Jun2021                    &lt;NA&gt;   51429.13
76_MCR_VonDamm_HOG_X18_J21235HOG20_0_Jun2021             1310.208 111429.781
77_MCR_Piccard_HOG_Shrimpocalypse_J21240HOG14_0_Jun2021  27.53484  238585.68
78_MCR_Piccard_HOG_LotsOShrimp_J21241HOG14_0_Jun2021     11.46432  53878.136
80_MCR_VonDamm_HOG_Rav2_J21244HOG20_0_Jun2021             1893.66           
                                                        Sample_or_Control
52_MCR_Piccard_expTf_LotsOShrimp_A_0_Jun2021                       Sample
53_MCR_Piccard_expTf_LotsOShrimp_B_0_Jun2021                       Sample
54_MCR_VonDamm_expTf_MustardStand_0_0_Jun2021                      Sample
55_MCR_VonDamm_expTf_ShrimpHole_0_0_Jun2021                        Sample
57_MCR_Piccard_expTf_Shrimpocalypse_0_0_Jun2021                    Sample
58_MCR_VonDamm_expTf_Plume_0_0_Jun2021                             Sample
59_MCR_VonDamm_expTf_X18_0_0_Jun2021                               Sample
60_MCR_VonDamm_expTf_BSW_0_0_Jun2021                               Sample
61_MCR_VonDamm_expTf_Rav2_0_0_Jun2021                              Sample
63_MCR_VonDamm_CTD_BSW_CTD002_0_Jun2021                            Sample
65_MCR_VonDamm_CTD_Plume_CTD003_0_Jun2021                          Sample
66_MCR_VonDamm_HOG_ArrowLoop_J21243HOG18_5_Jun2021                 Sample
67_MCR_VonDamm_HOG_WhiteCastle_J21235HOG12_5_Jun2021               Sample
69_MCR_VonDamm_HOG_MustardStand_J21243HOG14_5_Jun2021              Sample
70_MCR_VonDamm_HOG_Rav2_J21238HOG14_5_Jun2021                      Sample
71_MCR_VonDamm_HOG_OldManTree_J21238HOG20_5_Jun2021                Sample
72_MCR_VonDamm_HOG_ShrimpHole_J21244HOG18_0_Jun2021                Sample
73_MCR_Piccard_CTD_BSW_CTD005_0_Jun2021                            Sample
74_MCR_Piccard_CTD_Plume_CTD004_5_Jun2021                          Sample
76_MCR_VonDamm_HOG_X18_J21235HOG20_0_Jun2021                       Sample
77_MCR_Piccard_HOG_Shrimpocalypse_J21240HOG14_0_Jun2021            Sample
78_MCR_Piccard_HOG_LotsOShrimp_J21241HOG14_0_Jun2021               Sample
80_MCR_VonDamm_HOG_Rav2_J21244HOG20_0_Jun2021                      Sample</code></pre>
</div>
</div>
<p>Rscript run on HPC:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>gen_divnet <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Genus"</span>), <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Incubation vs in situ</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>gen_divnet_SAMPLETYPE <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Genus"</span>), <span class="at">X =</span> <span class="st">"SAMPLETYPE"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent vs. non-vent</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>gen_divnet_SAMPLETYPE_BIN <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Genus"</span>), <span class="at">X =</span> <span class="st">"SAMPLETYPE_BIN"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># location and vent vs plume vs background</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Piccard vs. Von Damm</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>gen_divnet_SITE <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Genus"</span>), <span class="at">X =</span> <span class="st">"SITE"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(gen_divnet, gen_divnet_SAMPLETYPE, gen_divnet_SAMPLETYPE_BIN, gen_divnet_SITE, <span class="at">file =</span> <span class="st">"GENUS.Rdata"</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Analyzed at the ASV level:</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>spp_divnet <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Species"</span>), <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Incubation vs. in situ</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>spp_divnet_SAMPLETYPE <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Species"</span>), <span class="at">X =</span> <span class="st">"SAMPLETYPE"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent vs. non-vent</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>spp_divnet_SAMPLETYPE_BIN <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Species"</span>), <span class="at">X =</span> <span class="st">"SAMPLETYPE_BIN"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Piccard vs. VD</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>spp_divnet_SITE <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Species"</span>), <span class="at">X =</span> <span class="st">"SITE"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="co"># save(spp_divnet, spp_divnet_SAMPLETYPE, spp_divnet_SAMPLETYPE_BIN, spp_divnet_SITE, file = "SPECIES.Rdata")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Above is run on HPC. Bring outputs locally to visualize output below.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/SPECIES.Rdata"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  spp_divnet
  spp_divnet_SAMPLETYPE
  spp_divnet_SAMPLETYPE_BIN
  spp_divnet_SITE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/GENUS.Rdata"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  gen_divnet
  gen_divnet_SAMPLETYPE
  gen_divnet_SAMPLETYPE_BIN
  gen_divnet_SITE</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(metadata_mcr)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>fxn_extract_divet <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>shannon <span class="sc">%&gt;%</span> summary <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"estimate"</span>), <span class="at">names_to =</span> <span class="st">"ESTIMATE-shannon"</span>, <span class="at">values_to =</span> <span class="st">"Shannon"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"error"</span>), <span class="at">names_to =</span> <span class="st">"ERROR-shannon"</span>, <span class="at">values_to =</span> <span class="st">"Shannon-error"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"lower"</span>), <span class="at">names_to =</span> <span class="st">"LOWER-shannon"</span>, <span class="at">values_to =</span> <span class="st">"Shannon-lower"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"upper"</span>), <span class="at">names_to =</span> <span class="st">"UPPER-shannon"</span>, <span class="at">values_to =</span> <span class="st">"Shannon-upper"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df<span class="sc">$</span>simpson <span class="sc">%&gt;%</span> summary <span class="sc">%&gt;%</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"estimate"</span>), <span class="at">names_to =</span> <span class="st">"ESTIMATE-simpson"</span>, <span class="at">values_to =</span> <span class="st">"Simpson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"error"</span>), <span class="at">names_to =</span> <span class="st">"ERROR-simpson"</span>, <span class="at">values_to =</span> <span class="st">"Simpson-error"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"lower"</span>), <span class="at">names_to =</span> <span class="st">"LOWER-simpson"</span>, <span class="at">values_to =</span> <span class="st">"Simpson-lower"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"upper"</span>), <span class="at">names_to =</span> <span class="st">"UPPER-simpson"</span>, <span class="at">values_to =</span> <span class="st">"Simpson-upper"</span>),</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sample_names"</span> <span class="ot">=</span> <span class="st">"sample_names"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(metadata_mcr <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_names"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sample_names, <span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">"-simpson"</span>), <span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">"-shannon"</span>), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"model."</span>), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"name."</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TYPE_BIN =</span> <span class="fu">case_when</span>(</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>      SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"in situ"</span>,</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Incubation"</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>gen_divnet gen_divnet_SAMPLETYPE gen_divnet_SAMPLETYPE_BIN gen_divnet_SITE spp_divnet spp_divnet_SAMPLETYPE spp_divnet_SAMPLETYPE_BIN spp_divnet_SITE</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Set colors and symbols for dataset</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>sampletype_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>, <span class="st">"Incubation"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>site_symbol<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">22</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>site_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>site_alpha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.4</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>site_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_color) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>bin_type_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"in situ"</span>, <span class="st">"Incubation"</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_alpha) <span class="ot">&lt;-</span> bin_type_order</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>plot_sampletype <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>SITE_ORDER <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>SITE, <span class="at">levels =</span> site_order, <span class="at">labels =</span> site_fullname)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>SAMPLETYPE_ORDER <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>SAMPLETYPE, <span class="at">levels =</span> sampletype_order)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>TYPE_BIN_ORDER <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>TYPE_BIN, <span class="at">levels =</span> bin_type_order)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(site_symbol) <span class="ot">&lt;-</span> site_order</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(df <span class="sc">%&gt;%</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VENT, <span class="at">y =</span> Shannon)) <span class="sc">+</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SITE_ORDER, <span class="at">alpha =</span> TYPE_BIN_ORDER)) <span class="sc">+</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> site_alpha) <span class="sc">+</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> site_color) <span class="sc">+</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shannon"</span>) <span class="sc">+</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>(),</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VENT, <span class="at">y =</span> Simpson)) <span class="sc">+</span></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SITE_ORDER, <span class="at">alpha =</span> TYPE_BIN_ORDER)) <span class="sc">+</span></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> site_alpha) <span class="sc">+</span></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> site_color) <span class="sc">+</span></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Simpson"</span>) <span class="sc">+</span></span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>(),</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">axis =</span> <span class="fu">c</span>(<span class="st">"lrt"</span>), <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"vh"</span>))</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>gen_divnet gen_divnet_SAMPLETYPE gen_divnet_SAMPLETYPE_BIN gen_divnet_SITE spp_divnet spp_divnet_SAMPLETYPE spp_divnet_SAMPLETYPE_BIN spp_divnet_SITE</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>spp_alpha_18s <span class="ot">&lt;-</span> <span class="fu">fxn_extract_divet</span>(spp_divnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(sample_names)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>spp_alpha_label <span class="ot">&lt;-</span> <span class="fu">fxn_extract_divet</span>(spp_divnet_SAMPLETYPE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(sample_names)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>spp_alpha_TYPE <span class="ot">&lt;-</span> <span class="fu">fxn_extract_divet</span>(spp_divnet_SAMPLETYPE_BIN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(sample_names)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>spp_alpha_TYPE_SITE <span class="ot">&lt;-</span> <span class="fu">fxn_extract_divet</span>(spp_divnet_SITE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(sample_names)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(spp_alpha_18s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  26
  Shannon Shannon- Shann Shann Simpson Simps Simps Simps X     VENT 
    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
1    3.42    0.00972    3.40    3.44  0.0713 1.42e-3  0.0684  0.0741 2     Lots
2    3.36    0.00518    3.35    3.37  0.0828 1.96e-4  0.0824  0.0832 3     Lots
3    4.13    0.00367    4.12    4.13  0.0322 1.66e-4  0.0319  0.0325 9     Must
4    3.88    0.00651    3.87    3.90  0.0392 2.30e-4  0.0387  0.0396 10    Shri
5    4.02    0.00181    4.01    4.02  0.0310 2.50e-5  0.0309  0.0310 4     Shri
6    3.69    0.00349    3.69    3.70  0.0450 3.03e-4  0.0444  0.0456 11    Plume
#  with 16 more variables: SITE &lt;chr&gt;, SAMPLEID &lt;chr&gt;, DEPTH &lt;chr&gt;,
#   SAMPLETYPE &lt;chr&gt;, SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;, pH &lt;chr&gt;,
#   PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, TYPE_BIN &lt;chr&gt;, and abbreviated
#   variable names `Shannon-error`, `Shannon-lower`, `Shannon-upper`,
#   `Simpson-error`, `Simpson-lower`, `Simpson-upper`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sampletype</span>(spp_alpha_18s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="480"></p>
</div>
</div>
</section>
</section>
<section id="asv-overlap-comparison" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> ASV overlap comparison</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load("input-data/MCR-amplicon-data.RData", verbose=TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="supergroup-to-phylum-level-comparisons" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="supergroup-to-phylum-level-comparisons"><span class="header-section-number">3.1</span> Supergroup to phylum level comparisons</h2>
<p>Generate upsetR plots with varied taxonomic levels.</p>
<p>Questions:</p>
<ul>
<li>How which major supergroups and phyla are shared among vent sites within Von Damm and Piccard?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># options for taxa: SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 5926 rows [5, 6, 7, 8, 9, 10,
11, 14, 15, 16, 17, 20, 21, 22, 24, 25, 26, 28, 29, 30, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 3451 rows [1, 2, 3, 4,
12, 13, 18, 19, 23, 27, 35, 44, 45, 46, 48, 49, 53, 54, 55, 56, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME', 'VENT'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 7678 rows [1, 2, 3, 4, 5, 6,
7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SupergroupPhylum'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="1056"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to reduce noise and show sample type to vent ecosystem variability.</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Taxon, SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 5926 rows [5, 6, 7, 8, 9, 10,
11, 14, 15, 16, 17, 20, 21, 22, 24, 25, 26, 28, 29, 30, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 3451 rows [1, 2, 3, 4,
12, 13, 18, 19, 23, 27, 35, 44, 45, 46, 48, 49, 53, 54, 55, 56, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME', 'VENT',
'SupergroupPhylum'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 7678 rows [1, 2, 3, 4, 5, 6,
7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SupergroupPhylum', 'Taxon'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'SupergroupPhylum'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 300 rows containing non-finite values (`stat_count()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="asvs-shared-across-mcr-vents" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="asvs-shared-across-mcr-vents"><span class="header-section-number">3.2</span> ASVs shared across MCR vents</h2>
<p>ID ASVs that are shared across Piccard and Von Damm, and those that are shared at vent and non-vent samples.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  22
  FeatureID SAMPLE value Taxon Conse SAMPL VENT  SITE  SAMPL DEPTH SAMPL
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
1 00056209 52_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
2 00056209 53_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
3 00056209 54_MC     0 Euka     0.8 "VonDa Must VonD ""      ""    Incuba
4 00056209 55_MC     0 Euka     0.8 "VonDa Shri VonD ""      ""    Incuba
5 00056209 57_MC     0 Euka     0.8 "Picca Shri Picc ""      ""    Incuba
6 00056209 58_MC     0 Euka     0.8 "VonDa Plume VonD ""      ""    Incuba
#  with 11 more variables: SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;,
#   pH &lt;chr&gt;, PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, and abbreviated variable names
#   Consensus, SAMPLENAME, SAMPLEID, SAMPLETYPE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>shared_across <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, SAMPLETYPE, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SITE, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FIELD_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(Piccard) <span class="sc">~</span> <span class="st">"VonDamm only"</span>,</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(VonDamm) <span class="sc">~</span> <span class="st">"Piccard only"</span>,</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    (VonDamm <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> Piccard <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Shared across"</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, FIELD_PA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  22
  FeatureID SAMPLE value Taxon Conse SAMPL VENT  SITE  SAMPL DEPTH SAMPL
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
1 00056209 52_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
2 00056209 53_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
3 00056209 54_MC     0 Euka     0.8 "VonDa Must VonD ""      ""    Incuba
4 00056209 55_MC     0 Euka     0.8 "VonDa Shri VonD ""      ""    Incuba
5 00056209 57_MC     0 Euka     0.8 "Picca Shri Picc ""      ""    Incuba
6 00056209 58_MC     0 Euka     0.8 "VonDa Plume VonD ""      ""    Incuba
#  with 11 more variables: SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;,
#   pH &lt;chr&gt;, PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, and abbreviated variable names
#   Consensus, SAMPLENAME, SAMPLEID, SAMPLETYPE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>shared_type <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, SAMPLETYPE, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLETYPE_BIN, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLETYPE_BIN, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">non-vent</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> vent <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Cosmo"</span>,</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">non-vent</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Vent only"</span>,</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    vent <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Non-vent only"</span>,</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, TYPE_PA)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(shared_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [8,026  2] (S3: tbl_df/tbl/data.frame)
 $ FeatureID: chr [1:8026] "0016c92095329cf769d2fc9f5a0b826c" "0024760a130d14a29d63bb07f082733e" "00508684a4c673b882a5d186733b3271" "0052bc3663c02b5375d7472fdcb21cd0" ...
 $ TYPE_PA  : chr [1:8026] "Non-vent only" "Vent only" "Non-vent only" "Vent only" ...</code></pre>
</div>
</div>
</section>
<section id="asvs-shared-in-situ-tf-for-each-experiment" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="asvs-shared-in-situ-tf-for-each-experiment"><span class="header-section-number">3.3</span> ASVs shared in situ &amp; Tf for each experiment</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(asv_wtax_qc$SAMPLETYPE)</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>shared_exp <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXP_BIN =</span> <span class="fu">case_when</span>(</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, EXP_BIN, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, EXP_BIN, SITE, VENT, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> EXP_BIN, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXP_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">in situ</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> Incubation <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Shared"</span>,</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">in situ</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"In situ only"</span>,</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    Incubation <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Incubation only"</span>,</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, EXP_PA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="table-to-present-shared-asvs-and-taxa" class="level3">
<h3 class="anchored" data-anchor-id="table-to-present-shared-asvs-and-taxa">Table to present shared ASVs and taxa</h3>
<p>Number of ASVs that are shared or unique at Piccard and Von Damm</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(FIELD_PA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(shared_across, shared_exp): Each row in `x` is expected to match at most 1 row in `y`.
 Row 7 of `x` matches multiple rows.
 If multiple matches are expected, set `multiple = "all"` to silence this
  warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>FIELD_PA
 Piccard only Shared across  VonDamm only 
         1861          5535          7277 </code></pre>
</div>
</div>
<p>Number of ASVs that are shared between in situ and incubation experiments</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(EXP_PA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(shared_across, shared_exp): Each row in `x` is expected to match at most 1 row in `y`.
 Row 7 of `x` matches multiple rows.
 If multiple matches are expected, set `multiple = "all"` to silence this
  warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>EXP_PA
   In situ only Incubation only          Shared 
           6362            5573            2738 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(TYPE_PA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(shared_across, shared_exp): Each row in `x` is expected to match at most 1 row in `y`.
 Row 7 of `x` matches multiple rows.
 If multiple matches are expected, set `multiple = "all"` to silence this
  warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>TYPE_PA
        Cosmo Non-vent only     Vent only 
         7586          2034          5053 </code></pre>
</div>
</div>
<p>For ASVs shared between in situ and experiment (Tf)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(EXP_PA <span class="sc">==</span> <span class="st">"Shared"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TYPE_PA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(shared_across, shared_exp): Each row in `x` is expected to match at most 1 row in `y`.
 Row 7 of `x` matches multiple rows.
 If multiple matches are expected, set `multiple = "all"` to silence this
  warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>TYPE_PA
    Cosmo Vent only 
     2488       250 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select(FIELD_PA))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>What is the taxonomic composition of those that are shared between the grazing experiments and in situ?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(asv_wtax_qc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(EXP_PA == "Shared") %&gt;% </span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID, EXP_PA) <span class="sc">%&gt;%</span> </span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SUPERGROUP, EXP_PA) <span class="sc">%&gt;%</span> </span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(SAMPLENAME_ORDER = factor(SAMPLENAME, levels = mcr_sample_order)) %&gt;% </span></span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VENT, <span class="at">y =</span> SUM)) <span class="sc">+</span></span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(EXP_PA <span class="sc">~</span> SITE, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(shared_across, shared_exp): Each row in `x` is expected to match at most 1 row in `y`.
 Row 7 of `x` matches multiple rows.
 If multiple matches are expected, set `multiple = "all"` to silence this
  warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`
Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in right_join(., asv_wtax_qc %&gt;% filter(value &gt; 0)): Each row in `x` is expected to match at most 1 row in `y`.
 Row 7 of `x` matches multiple rows.
 If multiple matches are expected, set `multiple = "all"` to silence this
  warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'Taxon', 'FeatureID'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 22276 rows [3, 17, 18, 19,
20, 21, 22, 23, 24, 25, 26, 27, 28, 32, 33, 34, 35, 36, 37, 38, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 11065 rows [1, 2, 4, 5,
6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 29, 30, 31, 39, 40, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT', 'SUPERGROUP'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Create table as output</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>tax_table_shared <span class="ot">&lt;-</span> <span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(asv_wtax_qc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EXP_PA <span class="sc">==</span> <span class="st">"Shared"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, <span class="fu">ends_with</span>(<span class="st">"_PA"</span>), Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(shared_across, shared_exp): Each row in `x` is expected to match at most 1 row in `y`.
 Row 7 of `x` matches multiple rows.
 If multiple matches are expected, set `multiple = "all"` to silence this
  warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(FeatureID)`
Joining with `by = join_by(FeatureID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in right_join(., asv_wtax_qc %&gt;% filter(value &gt; 0)): Each row in `x` is expected to match at most 1 row in `y`.
 Row 7 of `x` matches multiple rows.
 If multiple matches are expected, set `multiple = "all"` to silence this
  warning.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write_delim(tax_table_shared, file = "output-data/list-of-shared-taxa.txt", delim = "\t")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="in-situ-vs.-tf-relative-changes" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> In situ vs.&nbsp;Tf relative changes</h1>
</section>
<section id="corncob-enriched-taxa" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Corncob enriched taxa</h1>
<p>Corncob analysis can be used to identify specific ASVs that may be enriched when we compare non-vent to vent samples.</p>
<p>Questions:</p>
<ul>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at Piccard?</p></li>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at Von Damm?</p></li>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at both sites?</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("bryandmartin/corncob")</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corncob); <span class="fu">library</span>(phyloseq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
</div>
<p>Explore data input for corncob</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># otu_table(physeq_mcr)[1:10, 1:3]</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(physeq_mcr)</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(physeq_mcr)[1:3, ]</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Designated vent vs. non-vent</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SAMPLETYPE_BIN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "non-vent" "vent"    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Designats Piccard vs. vondamm.</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SITE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Piccard" "VonDamm"</code></pre>
</div>
</div>
<p>Start by removing incubation samples for now. Subset to eukaryotes only and use phyloseqs tax glom to summarize to Supergroup, Phylum, Class, Order, Genus, &amp; species.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tax_table</span>(physeq_mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Taxonomy Table:     [6 taxa by 8 taxonomic ranks]:
                                 Domain      Supergroup     Phylum            
0c7bdd7d35a3559db857584cecc4f5c9 "Eukaryota" "Opisthokonta" "Choanoflagellida"
7b0dd4c34fe16642ff23b7effa1bf1bd "Eukaryota" "Alveolata"    "Ciliophora"      
dc268dc3fdd431dc0de1fcc60de681f0 "Eukaryota" "Rhizaria"     "Cercozoa"        
08586d1dca4dda0f128d142b85379e0b "Eukaryota" "Apusozoa"     "Apusomonadidae"  
e3bed7480f3f3c95f0f4db2e03cee011 "Eukaryota" "Rhizaria"     "Radiolaria"      
44dcf603d76f712038c8b797beb1282f "Eukaryota" "Alveolata"    "Dinoflagellata"  
                                 Class                   
0c7bdd7d35a3559db857584cecc4f5c9 "Choanoflagellatea"     
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP"             
dc268dc3fdd431dc0de1fcc60de681f0 "Filosa-Thecofilosea"   
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1"
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea"            
44dcf603d76f712038c8b797beb1282f "Syndiniales"           
                                 Order                     
0c7bdd7d35a3559db857584cecc4f5c9 "Acanthoecida"            
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP_X"             
dc268dc3fdd431dc0de1fcc60de681f0 "Ventricleftida"          
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1_X"
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1"            
44dcf603d76f712038c8b797beb1282f "Dino-Group-IV"           
                                 Family                            
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D"          
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP_XX"                    
dc268dc3fdd431dc0de1fcc60de681f0 NA                                
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1_XX"       
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_X"                  
44dcf603d76f712038c8b797beb1282f "Dino-Group-IV-Hematodinium-Group"
                                 Genus                     
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D_X"
7b0dd4c34fe16642ff23b7effa1bf1bd NA                        
dc268dc3fdd431dc0de1fcc60de681f0 NA                        
08586d1dca4dda0f128d142b85379e0b NA                        
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_XX"         
44dcf603d76f712038c8b797beb1282f "Hematodinium"            
                                 Species                       
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D_X_sp."
7b0dd4c34fe16642ff23b7effa1bf1bd NA                            
dc268dc3fdd431dc0de1fcc60de681f0 NA                            
08586d1dca4dda0f128d142b85379e0b NA                            
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_XX_sp."         
44dcf603d76f712038c8b797beb1282f "Hematodinium_sp."            </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>mcr_super <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Supergroup"</span>)</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>mcr_phy <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Phylum"</span>)</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a>mcr_class <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Class"</span>)</span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a>mcr_order <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Order"</span>)</span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-21"><a href="#cb136-21" aria-hidden="true" tabindex="-1"></a>mcr_fam <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb136-22"><a href="#cb136-22" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-23"><a href="#cb136-23" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-24"><a href="#cb136-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Family"</span>)</span>
<span id="cb136-25"><a href="#cb136-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-26"><a href="#cb136-26" aria-hidden="true" tabindex="-1"></a>mcr_genera <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb136-27"><a href="#cb136-27" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-28"><a href="#cb136-28" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-29"><a href="#cb136-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Genus"</span>)</span>
<span id="cb136-30"><a href="#cb136-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-31"><a href="#cb136-31" aria-hidden="true" tabindex="-1"></a>mcr_spp <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb136-32"><a href="#cb136-32" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb136-33"><a href="#cb136-33" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-34"><a href="#cb136-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Species"</span>)</span>
<span id="cb136-35"><a href="#cb136-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-36"><a href="#cb136-36" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(mcr_order)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Differential tests in corncob</p>
<p>These tests work to see if taxa are differentially-abundant or variable across a given variable. In this study we have different taxonomic levels, are there more general or species-specific trends? We also have across sample types and site Below set up differential tests across sample types and site (and either or) at different taxonomic levels.</p>
<p>Function to perform specific differential tests across vent fields. Below use <strong>SITE_PICK</strong> parameter to choose between vent fields. Then use the df, to specify the taxonomic level.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>corncob_mcr <span class="ot">&lt;-</span> <span class="cf">function</span>(df_in){</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SAMPLETYPE+ SITE,</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SAMPLETYPE_BIN specifically compares vent to non-vent.</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  da_analysis_output <span class="ot">&lt;-</span> <span class="fu">differentialTest</span>(<span class="at">formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula_null =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula_null =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">test =</span> <span class="st">"Wald"</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> df_in,</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fdr_cutoff =</span> <span class="fl">0.05</span>)</span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SITE,</span></span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SITE,</span></span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SITE,</span></span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a>  list_ofsig <span class="ot">&lt;-</span> <span class="fu">as.character</span>(da_analysis_output<span class="sc">$</span>significant_taxa)</span>
<span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a>  total_number <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ofsig)[<span class="dv">1</span>]</span>
<span id="cb137-27"><a href="#cb137-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb137-28"><a href="#cb137-28" aria-hidden="true" tabindex="-1"></a>  sig_taxa_names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(df_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb137-29"><a href="#cb137-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FEATURE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-30"><a href="#cb137-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(FEATURE <span class="sc">%in%</span> list_ofsig) <span class="sc">%&gt;%</span> </span>
<span id="cb137-31"><a href="#cb137-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"NUMBER"</span>)</span>
<span id="cb137-32"><a href="#cb137-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb137-33"><a href="#cb137-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_number){</span>
<span id="cb137-34"><a href="#cb137-34" aria-hidden="true" tabindex="-1"></a>    out_0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(da_analysis_output<span class="sc">$</span>significant_models[[var]]<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb137-35"><a href="#cb137-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">NUMBER =</span> <span class="fu">as.character</span>(var))</span>
<span id="cb137-36"><a href="#cb137-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"extracted # "</span>,var, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb137-37"><a href="#cb137-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"extracted_coef"</span>)){</span>
<span id="cb137-38"><a href="#cb137-38" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> out_0 <span class="co"># create the final count table</span></span>
<span id="cb137-39"><a href="#cb137-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb137-40"><a href="#cb137-40" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extracted_coef, out_0)</span>
<span id="cb137-41"><a href="#cb137-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb137-42"><a href="#cb137-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(out_0) <span class="co"># remove excess df</span></span>
<span id="cb137-43"><a href="#cb137-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb137-44"><a href="#cb137-44" aria-hidden="true" tabindex="-1"></a>  output_full <span class="ot">&lt;-</span> extracted_coef <span class="sc">%&gt;%</span> </span>
<span id="cb137-45"><a href="#cb137-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb137-46"><a href="#cb137-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"mu."</span>, variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb137-47"><a href="#cb137-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sig_taxa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUMBER"</span> <span class="ot">=</span> <span class="st">"NUMBER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb137-48"><a href="#cb137-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">VARIABLE =</span> <span class="fu">str_remove</span>(variable, <span class="st">"[:digit:]+"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variable) <span class="co">#%&gt;% </span></span>
<span id="cb137-49"><a href="#cb137-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pivot_wider(names_from = VARIABLE, names_glue = "{VARIABLE}_{.value}", values_from = c(Estimate, Std..Error, t.value, Pr...t..))</span></span>
<span id="cb137-50"><a href="#cb137-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(extracted_coef)</span>
<span id="cb137-51"><a href="#cb137-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_full)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Define SITE_PICK</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>, <span class="st">"VonDamm"</span>)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>picc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>)</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to visualize output from corncob</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>plot_corn <span class="ot">&lt;-</span> <span class="cf">function</span>(cob_out, LEVEL, TITLE){</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">enquo</span>(LEVEL)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  cob_out <span class="sc">%&gt;%</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> level, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> TITLE)</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="supergroup-corncob" class="level3">
<h3 class="anchored" data-anchor-id="supergroup-corncob">Supergroup corncob</h3>
<p>What main supergroups are enriched at MCR?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # vd</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% vd))</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% picc))</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_super <span class="sc">%&gt;%</span> </span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd %&gt;%</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "VD supergroup")</span></span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-13"><a href="#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc %&gt;%</span></span>
<span id="cb142-14"><a href="#cb142-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb142-15"><a href="#cb142-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb142-16"><a href="#cb142-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb142-17"><a href="#cb142-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb142-18"><a href="#cb142-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb142-19"><a href="#cb142-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb142-20"><a href="#cb142-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb142-21"><a href="#cb142-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb142-22"><a href="#cb142-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb142-23"><a href="#cb142-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "piccard supergroup")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot supergroup enrichment</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="sc">%&gt;%</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Supergroup, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR supergroup"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="phylum-corncob-analysis" class="level3">
<h3 class="anchored" data-anchor-id="phylum-corncob-analysis">Phylum corncob analysis</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_phy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="sc">%&gt;%</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Phylum, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Phylum), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR Phylum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="class-corncob-analysis" class="level3">
<h3 class="anchored" data-anchor-id="class-corncob-analysis">Class corncob analysis</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_class <span class="sc">%&gt;%</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="sc">%&gt;%</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Class, <span class="fu">c</span>(Phylum, Class), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Class, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Class level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<blockquote class="blockquote">
<p>Class level looks pretty good. Keep this one. Looks at major taxonomic groups that were more enriched at vents? Work on the language here. Repeat vent vs.&nbsp;plume at ASV level. ID some of the core ASVs that can help elaborate on what we see above (table in supplementary)</p>
</blockquote>
<blockquote class="blockquote">
<p><em>Interpretation</em> :</p>
</blockquote>
</section>
<section id="order-corncob" class="level3">
<h3 class="anchored" data-anchor-id="order-corncob">Order corncob</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_order)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 
extracted #  17 
extracted #  18 
extracted #  19 
extracted #  20 
extracted #  21 
extracted #  22 
extracted #  23 
extracted #  24 
extracted #  25 
extracted #  26 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="sc">%&gt;%</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Order, <span class="fu">c</span>(Phylum, Class, Order), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Order, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Order level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="960"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?geom_errorbar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="family-corncob" class="level3">
<h3 class="anchored" data-anchor-id="family-corncob">Family corncob</h3>
<p>Plan to pairing with tree below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_fam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 
extracted #  17 
extracted #  18 
extracted #  19 
extracted #  20 
extracted #  21 
extracted #  22 
extracted #  23 
extracted #  24 
extracted #  25 
extracted #  26 
extracted #  27 
extracted #  28 
extracted #  29 
extracted #  30 
extracted #  31 
extracted #  32 
extracted #  33 
extracted #  34 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(tax_table(mcr_fam))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="sc">%&gt;%</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unite(Family, c(Class, Order, Family), sep = " ", remove = FALSE) %&gt;%</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Family, <span class="fu">c</span>(Order, Family), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Family, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Phylum <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Family level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="genus-corncob" class="level3">
<h3 class="anchored" data-anchor-id="genus-corncob">Genus corncob</h3>
<p>Plan to pairing with tree below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_genera)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="sc">%&gt;%</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Genus, <span class="fu">c</span>(Phylum, Genus), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Genus, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Genus level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="species-corncob" class="level3">
<h3 class="anchored" data-anchor-id="species-corncob">Species corncob</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_spp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="sc">%&gt;%</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Species, <span class="fu">c</span>(Genus, Species), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Species, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Order <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Species level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="corncob-pa-info" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Corncob + P/A info</h1>
<p>Which ASVs were enriched within vent site, and also found in grazing experiments?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>enriched_at_family <span class="ot">&lt;-</span> <span class="fu">as.character</span>(analysis_fam<span class="sc">$</span>FEATURE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import table of shared ASVs</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>tax_table_shared <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="at">file =</span> <span class="st">"output-data/list-of-shared-taxa.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1505 Columns: 5
 Column specification 
Delimiter: "\t"
chr (5): FeatureID, FIELD_PA, EXP_PA, TYPE_PA, Taxon

 Use `spec()` to retrieve the full column specification for this data.
 Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>enriched_and_shared<span class="ot">&lt;-</span> tax_table_shared <span class="sc">%&gt;%</span> </span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FeatureID <span class="sc">%in%</span> enriched_at_family)</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="co"># View(enriched_and_shared)</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="co"># write_delim(enriched_and_shared, file = "output-data/enriched-and-shared.txt", delim = "\t")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There was a total of 29 ASVs that were both a part of the enriched at vents (compared to background) and were present in both in situ and incubation (Tf) samples. These 29 ASVs represent a subset that we hypothesize are more likely to be involved in grazing. Another observation is that the majority of them are cosmopolitan. This indicates that based on the grazing experiments, the taxa that are enriched at vents and are subsequently members of the grazing population in the experiments are also able to inhabit plume and background.</p>
</section>
<section id="info" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Info</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.1 (2022-06-23)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur ... 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] corncob_0.3.0      DivNet_0.4.0       breakaway_4.8.4    compositions_2.0-4
 [5] ggdendro_0.1.23    vegan_2.6-2        lattice_0.20-45    permute_0.9-7     
 [9] cowplot_1.1.1      ggupset_0.3.0      ape_5.6-2          phyloseq_1.41.1   
[13] forcats_0.5.2      stringr_1.5.0      dplyr_1.1.0        purrr_1.0.1       
[17] readr_2.1.2        tidyr_1.3.0        tibble_3.1.8       ggplot2_3.4.1     
[21] tidyverse_1.3.2   

loaded via a namespace (and not attached):
  [1] VGAM_1.1-7               minqa_1.2.5              googledrive_2.0.0       
  [4] colorspace_2.1-0         ellipsis_0.3.2           XVector_0.36.0          
  [7] fs_1.6.1                 rstudioapi_0.14          farver_2.1.1            
 [10] bit64_4.0.5              fansi_1.0.4              lubridate_1.8.0         
 [13] xml2_1.3.3               codetools_0.2-18         splines_4.2.1           
 [16] doParallel_1.0.17        robustbase_0.95-0        knitr_1.40              
 [19] ade4_1.7-19              jsonlite_1.8.4           nloptr_2.0.3            
 [22] broom_1.0.1              cluster_2.1.4            dbplyr_2.2.1            
 [25] compiler_4.2.1           httr_1.4.4               backports_1.4.1         
 [28] assertthat_0.2.1         Matrix_1.5-1             fastmap_1.1.0           
 [31] gargle_1.2.1             cli_3.6.0                htmltools_0.5.3         
 [34] tools_4.2.1              igraph_1.3.5             ROI.plugin.lpsolve_1.0-1
 [37] gtable_0.3.1             glue_1.6.2               GenomeInfoDbData_1.2.8  
 [40] reshape2_1.4.4           Rcpp_1.0.10              slam_0.1-50             
 [43] Biobase_2.56.0           cellranger_1.1.0         vctrs_0.5.2             
 [46] Biostrings_2.64.1        rhdf5filters_1.8.0       multtest_2.52.0         
 [49] nlme_3.1-159             iterators_1.0.14         tensorA_0.36.2          
 [52] xfun_0.33                trust_0.1-8              lme4_1.1-31             
 [55] rvest_1.0.3              lifecycle_1.0.3          googlesheets4_1.0.1     
 [58] ROI_1.0-0                DEoptimR_1.0-11          zlibbioc_1.42.0         
 [61] MASS_7.3-58.1            scales_1.2.1             vroom_1.5.7             
 [64] hms_1.1.2                parallel_4.2.1           biomformat_1.24.0       
 [67] rhdf5_2.40.0             mvnfast_0.2.8            yaml_2.3.5              
 [70] stringi_1.7.12           S4Vectors_0.34.0         foreach_1.5.2           
 [73] BiocGenerics_0.42.0      boot_1.3-28              detectseparation_0.3    
 [76] GenomeInfoDb_1.32.4      rlang_1.0.6              pkgconfig_2.0.3         
 [79] bitops_1.0-7             lpSolveAPI_5.5.2.0-17.9  evaluate_0.20           
 [82] Rhdf5lib_1.18.2          htmlwidgets_1.5.4        labeling_0.4.2          
 [85] bit_4.0.4                tidyselect_1.2.0         plyr_1.8.7              
 [88] magrittr_2.0.3           R6_2.5.1                 IRanges_2.30.1          
 [91] generics_0.1.3           DBI_1.1.3                pillar_1.8.1            
 [94] haven_2.5.1              withr_2.5.0              mgcv_1.8-40             
 [97] abind_1.4-5              survival_3.4-0           RCurl_1.98-1.8          
[100] bayesm_3.1-4             modelr_0.1.9             crayon_1.5.2            
[103] utf8_1.2.3               tzdb_0.3.0               rmarkdown_2.16          
[106] grid_4.2.1               readxl_1.4.1             data.table_1.14.2       
[109] reprex_2.0.2             digest_0.6.31            numDeriv_2016.8-1.1     
[112] stats4_4.2.1             munsell_0.5.0            registry_0.5-1          </code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb170" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "18S rRNA gene amplicon survey"</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 2</span></span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a>Goals for this analysis are to investigate specific protistan taxonomic groups in the context of elevated grazing activity, cell biomass, and hydrothermal vent sample type. </span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a>Data originate from in situ MCR samples from a tag-sequence survey and the Tf time point from the grazing experiments. Additionally, in situ and grazing experiments were conducted within vent sites, at the plume, and in the background.</span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># Import sequence and metadata</span></span>
<span id="cb170-21"><a href="#cb170-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-22"><a href="#cb170-22" aria-hidden="true" tabindex="-1"></a>Set up R environment</span>
<span id="cb170-23"><a href="#cb170-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-26"><a href="#cb170-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-27"><a href="#cb170-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb170-28"><a href="#cb170-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(ape)</span>
<span id="cb170-29"><a href="#cb170-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggupset); <span class="fu">library</span>(cowplot)</span>
<span id="cb170-30"><a href="#cb170-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-31"><a href="#cb170-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-32"><a href="#cb170-32" aria-hidden="true" tabindex="-1"></a>Import previously sequenced and analyzed tag-sequence data. See https://shu251.github.io/microeuk-amplicon-survey/ for additional information.</span>
<span id="cb170-33"><a href="#cb170-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-34"><a href="#cb170-34" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import ASV R objects</span></span>
<span id="cb170-35"><a href="#cb170-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-38"><a href="#cb170-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-39"><a href="#cb170-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb170-40"><a href="#cb170-40" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> T)</span>
<span id="cb170-41"><a href="#cb170-41" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span>
<span id="cb170-42"><a href="#cb170-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-43"><a href="#cb170-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-44"><a href="#cb170-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Factor - legend/color key</span></span>
<span id="cb170-45"><a href="#cb170-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-48"><a href="#cb170-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-49"><a href="#cb170-49" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"LotsOShrimp"</span>, <span class="st">"X18"</span>, <span class="st">"OMT"</span>, <span class="st">"OldManTree"</span>, <span class="st">"Rav2"</span>, <span class="st">"MustardStand"</span>, <span class="st">"ShrimpHole"</span>, <span class="st">"WhiteCastle"</span>, <span class="st">"ArrowLoop"</span>)</span>
<span id="cb170-50"><a href="#cb170-50" aria-hidden="true" tabindex="-1"></a>vent_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"Lots 'O Shrimp"</span>, <span class="st">"X-18"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Ravelin #2"</span>, <span class="st">"Mustard Stand"</span>, <span class="st">"Shrimp Hole"</span>, <span class="st">"White Castle"</span>, <span class="st">"Arrow Loop"</span>)</span>
<span id="cb170-51"><a href="#cb170-51" aria-hidden="true" tabindex="-1"></a>site_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VD"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb170-52"><a href="#cb170-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-53"><a href="#cb170-53" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb170-54"><a href="#cb170-54" aria-hidden="true" tabindex="-1"></a>site_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb170-55"><a href="#cb170-55" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_color) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb170-56"><a href="#cb170-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-57"><a href="#cb170-57" aria-hidden="true" tabindex="-1"></a>whole_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#E9C46A"</span>,<span class="st">"#F4A261"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb170-58"><a href="#cb170-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-59"><a href="#cb170-59" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#eae2b7"</span>, <span class="st">"#5f0f40"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#941b0c"</span>, <span class="st">"#577590"</span>)</span>
<span id="cb170-60"><a href="#cb170-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for VD and Piccard</span></span>
<span id="cb170-61"><a href="#cb170-61" aria-hidden="true" tabindex="-1"></a>site_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#418b84"</span>, <span class="st">"#943b36"</span>)</span>
<span id="cb170-62"><a href="#cb170-62" aria-hidden="true" tabindex="-1"></a><span class="co"># site_colors</span></span>
<span id="cb170-63"><a href="#cb170-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-64"><a href="#cb170-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent colors</span></span>
<span id="cb170-65"><a href="#cb170-65" aria-hidden="true" tabindex="-1"></a>vent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#253494"</span>,<span class="st">"#1d91c0"</span>, <span class="st">"#E9C46A"</span>, <span class="st">"#E76F51"</span>, <span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#941b0c"</span>, <span class="st">"#577590"</span>, <span class="st">"#eae2b7"</span>, <span class="st">"#deebf7"</span>)</span>
<span id="cb170-66"><a href="#cb170-66" aria-hidden="true" tabindex="-1"></a><span class="co"># vent_colors &lt;- c("")</span></span>
<span id="cb170-67"><a href="#cb170-67" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vent_colors) <span class="ot">&lt;-</span> vent_fullname</span>
<span id="cb170-68"><a href="#cb170-68" aria-hidden="true" tabindex="-1"></a><span class="co"># all_taxa_color = c("#fa9fb5", "#c51b8a", "#67000d", "#ef3b2c", "#ffffcc", "#feb24c", "#c7e9b4", "#1d91c0", "#deebf7", "#253494", "#9e9ac8", "#238b45", "#54278f", "#bdbdbd", "#252525", "#fa9fb5", "#c51b8a", "#67000d", "#ef3b2c", "#ffffcc", "#feb24c", "#c7e9b4", "#1d91c0", "#253494", "#9e9ac8", "#238b45", "#54278f", "#bdbdbd", "#252525")</span></span>
<span id="cb170-69"><a href="#cb170-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-70"><a href="#cb170-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-71"><a href="#cb170-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-72"><a href="#cb170-72" aria-hidden="true" tabindex="-1"></a><span class="fu"># Preliminary look at all samples</span></span>
<span id="cb170-73"><a href="#cb170-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-74"><a href="#cb170-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cluster analysis</span></span>
<span id="cb170-75"><a href="#cb170-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-76"><a href="#cb170-76" aria-hidden="true" tabindex="-1"></a>Ordination analysis and methods to look at whole protistan communities at MCR.</span>
<span id="cb170-77"><a href="#cb170-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-80"><a href="#cb170-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-81"><a href="#cb170-81" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb170-82"><a href="#cb170-82" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan); <span class="fu">library</span>(ggdendro); <span class="fu">library</span>(compositions)</span>
<span id="cb170-83"><a href="#cb170-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-84"><a href="#cb170-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-85"><a href="#cb170-85" aria-hidden="true" tabindex="-1"></a><span class="fu">### with grazing assays</span></span>
<span id="cb170-86"><a href="#cb170-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-89"><a href="#cb170-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-90"><a href="#cb170-90" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb170-91"><a href="#cb170-91" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-92"><a href="#cb170-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-93"><a href="#cb170-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb170-94"><a href="#cb170-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-95"><a href="#cb170-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb170-96"><a href="#cb170-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-97"><a href="#cb170-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb170-98"><a href="#cb170-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-99"><a href="#cb170-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-100"><a href="#cb170-100" aria-hidden="true" tabindex="-1"></a>Transform compositional data, center log ratio.</span>
<span id="cb170-101"><a href="#cb170-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-104"><a href="#cb170-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-105"><a href="#cb170-105" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric)))</span>
<span id="cb170-106"><a href="#cb170-106" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(logratio_mcr)</span></span>
<span id="cb170-107"><a href="#cb170-107" aria-hidden="true" tabindex="-1"></a><span class="co"># ?alr()</span></span>
<span id="cb170-108"><a href="#cb170-108" aria-hidden="true" tabindex="-1"></a><span class="co"># ?ilr()</span></span>
<span id="cb170-109"><a href="#cb170-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-110"><a href="#cb170-110" aria-hidden="true" tabindex="-1"></a>pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(logratio_mcr)</span>
<span id="cb170-111"><a href="#cb170-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-112"><a href="#cb170-112" aria-hidden="true" tabindex="-1"></a>variance_logratio <span class="ot">&lt;-</span> (pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb170-113"><a href="#cb170-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-114"><a href="#cb170-114" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb170-115"><a href="#cb170-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span>
<span id="cb170-116"><a href="#cb170-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-117"><a href="#cb170-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-118"><a href="#cb170-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-121"><a href="#cb170-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-122"><a href="#cb170-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points</span></span>
<span id="cb170-123"><a href="#cb170-123" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-124"><a href="#cb170-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-125"><a href="#cb170-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb170-126"><a href="#cb170-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb170-127"><a href="#cb170-127" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mcr_pca_pts)</span>
<span id="cb170-128"><a href="#cb170-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-129"><a href="#cb170-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-130"><a href="#cb170-130" aria-hidden="true" tabindex="-1"></a>PCoA with all samples</span>
<span id="cb170-131"><a href="#cb170-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-132"><a href="#cb170-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=6}</span></span>
<span id="cb170-133"><a href="#cb170-133" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb170-134"><a href="#cb170-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb170-135"><a href="#cb170-135" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-136"><a href="#cb170-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-137"><a href="#cb170-137" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb170-138"><a href="#cb170-138" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb170-139"><a href="#cb170-139" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-140"><a href="#cb170-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb170-141"><a href="#cb170-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE, <span class="at">fill =</span> TYPE, <span class="at">color =</span> VENT_ORDER)) <span class="sc">+</span></span>
<span id="cb170-142"><a href="#cb170-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">23</span>)) <span class="sc">+</span></span>
<span id="cb170-143"><a href="#cb170-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"white"</span>,<span class="st">"darkgrey"</span>)) <span class="sc">+</span></span>
<span id="cb170-144"><a href="#cb170-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb170-145"><a href="#cb170-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb170-146"><a href="#cb170-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb170-147"><a href="#cb170-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb170-148"><a href="#cb170-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb170-149"><a href="#cb170-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-150"><a href="#cb170-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-151"><a href="#cb170-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-152"><a href="#cb170-152" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dendrogram analysis</span></span>
<span id="cb170-153"><a href="#cb170-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-156"><a href="#cb170-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-157"><a href="#cb170-157" aria-hidden="true" tabindex="-1"></a><span class="co"># ?decostand()</span></span>
<span id="cb170-158"><a href="#cb170-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative abundance</span></span>
<span id="cb170-159"><a href="#cb170-159" aria-hidden="true" tabindex="-1"></a>rel_abun <span class="ot">&lt;-</span> <span class="fu">decostand</span>(asv_mcr_numeric, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"total"</span>)</span>
<span id="cb170-160"><a href="#cb170-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster dendrogram (average hierarchical clustering)</span></span>
<span id="cb170-161"><a href="#cb170-161" aria-hidden="true" tabindex="-1"></a>cluster_mcr <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(rel_abun)), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb170-162"><a href="#cb170-162" aria-hidden="true" tabindex="-1"></a>dendro <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(cluster_mcr)</span>
<span id="cb170-163"><a href="#cb170-163" aria-hidden="true" tabindex="-1"></a>mcr_dendro <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(dendro, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span>
<span id="cb170-164"><a href="#cb170-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-165"><a href="#cb170-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-166"><a href="#cb170-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-167"><a href="#cb170-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=4}</span></span>
<span id="cb170-168"><a href="#cb170-168" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">segment</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb170-169"><a href="#cb170-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, </span>
<span id="cb170-170"><a href="#cb170-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend)) <span class="sc">+</span> </span>
<span id="cb170-171"><a href="#cb170-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb170-172"><a href="#cb170-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb170-173"><a href="#cb170-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">data =</span> <span class="fu">label</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb170-174"><a href="#cb170-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dendro</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Dissimilarity"</span>) <span class="sc">+</span></span>
<span id="cb170-175"><a href="#cb170-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">14</span>), <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#252525"</span>), </span>
<span id="cb170-176"><a href="#cb170-176" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb170-177"><a href="#cb170-177" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb170-178"><a href="#cb170-178" aria-hidden="true" tabindex="-1"></a><span class="co"># svg('figs/SUPPLEMENTARY-dendrogram-wreps.svg', w = 10, h = 8)</span></span>
<span id="cb170-179"><a href="#cb170-179" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot</span>
<span id="cb170-180"><a href="#cb170-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-181"><a href="#cb170-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-182"><a href="#cb170-182" aria-hidden="true" tabindex="-1"></a><span class="fu">### insitu only</span></span>
<span id="cb170-183"><a href="#cb170-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-184"><a href="#cb170-184" aria-hidden="true" tabindex="-1"></a>PCoA with in situ only</span>
<span id="cb170-185"><a href="#cb170-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-188"><a href="#cb170-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-189"><a href="#cb170-189" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric_insitu <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-190"><a href="#cb170-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-191"><a href="#cb170-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-192"><a href="#cb170-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb170-193"><a href="#cb170-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-194"><a href="#cb170-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb170-195"><a href="#cb170-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-196"><a href="#cb170-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb170-197"><a href="#cb170-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-198"><a href="#cb170-198" aria-hidden="true" tabindex="-1"></a>insitu_logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric_insitu)))</span>
<span id="cb170-199"><a href="#cb170-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-200"><a href="#cb170-200" aria-hidden="true" tabindex="-1"></a>insitu_pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(insitu_logratio_mcr)</span>
<span id="cb170-201"><a href="#cb170-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-202"><a href="#cb170-202" aria-hidden="true" tabindex="-1"></a>insitu_variance_logratio <span class="ot">&lt;-</span> (insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb170-203"><a href="#cb170-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-204"><a href="#cb170-204" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(insitu_variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb170-205"><a href="#cb170-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span>
<span id="cb170-206"><a href="#cb170-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-207"><a href="#cb170-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-210"><a href="#cb170-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-211"><a href="#cb170-211" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points for only insitu samples</span></span>
<span id="cb170-212"><a href="#cb170-212" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(insitu_pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(insitu_pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-213"><a href="#cb170-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-214"><a href="#cb170-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb170-215"><a href="#cb170-215" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb170-216"><a href="#cb170-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-217"><a href="#cb170-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-218"><a href="#cb170-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=6}</span></span>
<span id="cb170-219"><a href="#cb170-219" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb170-220"><a href="#cb170-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb170-221"><a href="#cb170-221" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-222"><a href="#cb170-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-223"><a href="#cb170-223" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb170-224"><a href="#cb170-224" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb170-225"><a href="#cb170-225" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-226"><a href="#cb170-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb170-227"><a href="#cb170-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE_ORDER, <span class="at">fill =</span> VENT_ORDER)) <span class="sc">+</span></span>
<span id="cb170-228"><a href="#cb170-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb170-229"><a href="#cb170-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb170-230"><a href="#cb170-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb170-231"><a href="#cb170-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb170-232"><a href="#cb170-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span>
<span id="cb170-233"><a href="#cb170-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-234"><a href="#cb170-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-235"><a href="#cb170-235" aria-hidden="true" tabindex="-1"></a><span class="fu">## Community taxonomic composition (richness &amp; sequence relative abundance)</span></span>
<span id="cb170-236"><a href="#cb170-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-239"><a href="#cb170-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-240"><a href="#cb170-240" aria-hidden="true" tabindex="-1"></a>out_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcr_dendro<span class="sc">$</span>labels)</span>
<span id="cb170-241"><a href="#cb170-241" aria-hidden="true" tabindex="-1"></a>mcr_sample_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(out_labels<span class="sc">$</span>label)</span>
<span id="cb170-242"><a href="#cb170-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-243"><a href="#cb170-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-244"><a href="#cb170-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=11}</span></span>
<span id="cb170-245"><a href="#cb170-245" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb170-246"><a href="#cb170-246" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb170-247"><a href="#cb170-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-248"><a href="#cb170-248" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-249"><a href="#cb170-249" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-250"><a href="#cb170-250" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb170-251"><a href="#cb170-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb170-252"><a href="#cb170-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-253"><a href="#cb170-253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb170-254"><a href="#cb170-254" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb170-255"><a href="#cb170-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb170-256"><a href="#cb170-256" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb170-257"><a href="#cb170-257" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-258"><a href="#cb170-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb170-259"><a href="#cb170-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb170-260"><a href="#cb170-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb170-261"><a href="#cb170-261" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb170-262"><a href="#cb170-262" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb170-263"><a href="#cb170-263" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-264"><a href="#cb170-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-265"><a href="#cb170-265" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb170-266"><a href="#cb170-266" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb170-267"><a href="#cb170-267" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb170-268"><a href="#cb170-268" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb170-269"><a href="#cb170-269" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb170-270"><a href="#cb170-270" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb170-271"><a href="#cb170-271" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb170-272"><a href="#cb170-272" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb170-273"><a href="#cb170-273" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-274"><a href="#cb170-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb170-275"><a href="#cb170-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb170-276"><a href="#cb170-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span> </span>
<span id="cb170-277"><a href="#cb170-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TOTAL_SEQ =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-278"><a href="#cb170-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb170-279"><a href="#cb170-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb170-280"><a href="#cb170-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq),</span>
<span id="cb170-281"><a href="#cb170-281" aria-hidden="true" tabindex="-1"></a>            <span class="at">REL_ABUN =</span> SUM<span class="sc">/</span>TOTAL_SEQ) <span class="sc">%&gt;%</span> </span>
<span id="cb170-282"><a href="#cb170-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-283"><a href="#cb170-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUPERGROUP, <span class="at">size =</span> REL_ABUN)) <span class="sc">+</span></span>
<span id="cb170-284"><a href="#cb170-284" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="fu">aes</span>(<span class="at">size =</span> REL_ABUN, <span class="at">fill =</span> SUPERGROUP, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb170-285"><a href="#cb170-285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb170-286"><a href="#cb170-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(. ~ SITE, scales = "free", space = "free") +</span></span>
<span id="cb170-287"><a href="#cb170-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb170-288"><a href="#cb170-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb170-289"><a href="#cb170-289" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb170-290"><a href="#cb170-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-291"><a href="#cb170-291" aria-hidden="true" tabindex="-1"></a>bubble</span>
<span id="cb170-292"><a href="#cb170-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-293"><a href="#cb170-293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dendrogram with bubble plot</span></span>
<span id="cb170-294"><a href="#cb170-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-295"><a href="#cb170-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=20, fig.height=11}</span></span>
<span id="cb170-296"><a href="#cb170-296" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_dendro_plot + bubble + patchwork::plot_layout(ncol = 2) + patchwork::plot_annotation(tag_levels = "a")</span></span>
<span id="cb170-297"><a href="#cb170-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-298"><a href="#cb170-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-299"><a href="#cb170-299" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relative abundance</span></span>
<span id="cb170-300"><a href="#cb170-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-303"><a href="#cb170-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-304"><a href="#cb170-304" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb170-305"><a href="#cb170-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-306"><a href="#cb170-306" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-307"><a href="#cb170-307" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-308"><a href="#cb170-308" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb170-309"><a href="#cb170-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb170-310"><a href="#cb170-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-311"><a href="#cb170-311" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb170-312"><a href="#cb170-312" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb170-313"><a href="#cb170-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb170-314"><a href="#cb170-314" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb170-315"><a href="#cb170-315" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-316"><a href="#cb170-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb170-317"><a href="#cb170-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb170-318"><a href="#cb170-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb170-319"><a href="#cb170-319" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb170-320"><a href="#cb170-320" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb170-321"><a href="#cb170-321" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-322"><a href="#cb170-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-323"><a href="#cb170-323" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb170-324"><a href="#cb170-324" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb170-325"><a href="#cb170-325" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb170-326"><a href="#cb170-326" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb170-327"><a href="#cb170-327" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb170-328"><a href="#cb170-328" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb170-329"><a href="#cb170-329" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb170-330"><a href="#cb170-330" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb170-331"><a href="#cb170-331" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-332"><a href="#cb170-332" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb170-333"><a href="#cb170-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb170-334"><a href="#cb170-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb170-335"><a href="#cb170-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-336"><a href="#cb170-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-337"><a href="#cb170-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUM)) <span class="sc">+</span></span>
<span id="cb170-338"><a href="#cb170-338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb170-339"><a href="#cb170-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VENT <span class="sc">+</span> SITE, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-340"><a href="#cb170-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-341"><a href="#cb170-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb170-342"><a href="#cb170-342" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb170-343"><a href="#cb170-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-344"><a href="#cb170-344" aria-hidden="true" tabindex="-1"></a>In bar plot above, in situ and Tf incubation samples are paired for each site.</span>
<span id="cb170-345"><a href="#cb170-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-346"><a href="#cb170-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-347"><a href="#cb170-347" aria-hidden="true" tabindex="-1"></a><span class="fu">## Richness</span></span>
<span id="cb170-350"><a href="#cb170-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-351"><a href="#cb170-351" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb170-352"><a href="#cb170-352" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("adw96/breakaway")</span></span>
<span id="cb170-353"><a href="#cb170-353" aria-hidden="true" tabindex="-1"></a><span class="co"># remotes::install_github("adw96/DivNet")</span></span>
<span id="cb170-354"><a href="#cb170-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-355"><a href="#cb170-355" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(breakaway); <span class="fu">library</span>(DivNet); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(tidyverse)</span>
<span id="cb170-356"><a href="#cb170-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-357"><a href="#cb170-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-360"><a href="#cb170-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-361"><a href="#cb170-361" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb170-362"><a href="#cb170-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-363"><a href="#cb170-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-366"><a href="#cb170-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-367"><a href="#cb170-367" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_data</span>(physeq_mcr)</span>
<span id="cb170-368"><a href="#cb170-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-369"><a href="#cb170-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-370"><a href="#cb170-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-371"><a href="#cb170-371" aria-hidden="true" tabindex="-1"></a>Rscript run on HPC:</span>
<span id="cb170-372"><a href="#cb170-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb170-373"><a href="#cb170-373" aria-hidden="true" tabindex="-1"></a><span class="co"># | eval: false</span></span>
<span id="cb170-374"><a href="#cb170-374" aria-hidden="true" tabindex="-1"></a>gen_divnet <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Genus"</span>), <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb170-375"><a href="#cb170-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-376"><a href="#cb170-376" aria-hidden="true" tabindex="-1"></a><span class="co"># Incubation vs in situ</span></span>
<span id="cb170-377"><a href="#cb170-377" aria-hidden="true" tabindex="-1"></a>gen_divnet_SAMPLETYPE <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Genus"</span>), <span class="at">X =</span> <span class="st">"SAMPLETYPE"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb170-378"><a href="#cb170-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-379"><a href="#cb170-379" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent vs. non-vent</span></span>
<span id="cb170-380"><a href="#cb170-380" aria-hidden="true" tabindex="-1"></a>gen_divnet_SAMPLETYPE_BIN <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Genus"</span>), <span class="at">X =</span> <span class="st">"SAMPLETYPE_BIN"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb170-381"><a href="#cb170-381" aria-hidden="true" tabindex="-1"></a><span class="co"># location and vent vs plume vs background</span></span>
<span id="cb170-382"><a href="#cb170-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-383"><a href="#cb170-383" aria-hidden="true" tabindex="-1"></a><span class="co"># Piccard vs. Von Damm</span></span>
<span id="cb170-384"><a href="#cb170-384" aria-hidden="true" tabindex="-1"></a>gen_divnet_SITE <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Genus"</span>), <span class="at">X =</span> <span class="st">"SITE"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb170-385"><a href="#cb170-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-386"><a href="#cb170-386" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(gen_divnet, gen_divnet_SAMPLETYPE, gen_divnet_SAMPLETYPE_BIN, gen_divnet_SITE, <span class="at">file =</span> <span class="st">"GENUS.Rdata"</span>)</span>
<span id="cb170-387"><a href="#cb170-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-388"><a href="#cb170-388" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb170-389"><a href="#cb170-389" aria-hidden="true" tabindex="-1"></a><span class="do">## Analyzed at the ASV level:</span></span>
<span id="cb170-390"><a href="#cb170-390" aria-hidden="true" tabindex="-1"></a>spp_divnet <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Species"</span>), <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb170-391"><a href="#cb170-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-392"><a href="#cb170-392" aria-hidden="true" tabindex="-1"></a><span class="co"># Incubation vs. in situ</span></span>
<span id="cb170-393"><a href="#cb170-393" aria-hidden="true" tabindex="-1"></a>spp_divnet_SAMPLETYPE <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Species"</span>), <span class="at">X =</span> <span class="st">"SAMPLETYPE"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb170-394"><a href="#cb170-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-395"><a href="#cb170-395" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent vs. non-vent</span></span>
<span id="cb170-396"><a href="#cb170-396" aria-hidden="true" tabindex="-1"></a>spp_divnet_SAMPLETYPE_BIN <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Species"</span>), <span class="at">X =</span> <span class="st">"SAMPLETYPE_BIN"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb170-397"><a href="#cb170-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-398"><a href="#cb170-398" aria-hidden="true" tabindex="-1"></a><span class="co"># Piccard vs. VD</span></span>
<span id="cb170-399"><a href="#cb170-399" aria-hidden="true" tabindex="-1"></a>spp_divnet_SITE <span class="ot">&lt;-</span> <span class="fu">divnet</span>(<span class="fu">tax_glom</span>(physeq_mcr, <span class="at">taxrank =</span> <span class="st">"Species"</span>), <span class="at">X =</span> <span class="st">"SITE"</span>, <span class="at">base =</span> <span class="dv">3</span>)</span>
<span id="cb170-400"><a href="#cb170-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-401"><a href="#cb170-401" aria-hidden="true" tabindex="-1"></a><span class="co"># save(spp_divnet, spp_divnet_SAMPLETYPE, spp_divnet_SAMPLETYPE_BIN, spp_divnet_SITE, file = "SPECIES.Rdata")</span></span>
<span id="cb170-402"><a href="#cb170-402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-403"><a href="#cb170-403" aria-hidden="true" tabindex="-1"></a>Above is run on HPC. Bring outputs locally to visualize output below.</span>
<span id="cb170-404"><a href="#cb170-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-407"><a href="#cb170-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-408"><a href="#cb170-408" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/SPECIES.Rdata"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb170-409"><a href="#cb170-409" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/GENUS.Rdata"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb170-410"><a href="#cb170-410" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-411"><a href="#cb170-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-414"><a href="#cb170-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-415"><a href="#cb170-415" aria-hidden="true" tabindex="-1"></a><span class="co"># head(metadata_mcr)</span></span>
<span id="cb170-416"><a href="#cb170-416" aria-hidden="true" tabindex="-1"></a>fxn_extract_divet <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb170-417"><a href="#cb170-417" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>shannon <span class="sc">%&gt;%</span> summary <span class="sc">%&gt;%</span> </span>
<span id="cb170-418"><a href="#cb170-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"estimate"</span>), <span class="at">names_to =</span> <span class="st">"ESTIMATE-shannon"</span>, <span class="at">values_to =</span> <span class="st">"Shannon"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-419"><a href="#cb170-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"error"</span>), <span class="at">names_to =</span> <span class="st">"ERROR-shannon"</span>, <span class="at">values_to =</span> <span class="st">"Shannon-error"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-420"><a href="#cb170-420" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"lower"</span>), <span class="at">names_to =</span> <span class="st">"LOWER-shannon"</span>, <span class="at">values_to =</span> <span class="st">"Shannon-lower"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-421"><a href="#cb170-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"upper"</span>), <span class="at">names_to =</span> <span class="st">"UPPER-shannon"</span>, <span class="at">values_to =</span> <span class="st">"Shannon-upper"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-422"><a href="#cb170-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(df<span class="sc">$</span>simpson <span class="sc">%&gt;%</span> summary <span class="sc">%&gt;%</span></span>
<span id="cb170-423"><a href="#cb170-423" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"estimate"</span>), <span class="at">names_to =</span> <span class="st">"ESTIMATE-simpson"</span>, <span class="at">values_to =</span> <span class="st">"Simpson"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-424"><a href="#cb170-424" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"error"</span>), <span class="at">names_to =</span> <span class="st">"ERROR-simpson"</span>, <span class="at">values_to =</span> <span class="st">"Simpson-error"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-425"><a href="#cb170-425" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"lower"</span>), <span class="at">names_to =</span> <span class="st">"LOWER-simpson"</span>, <span class="at">values_to =</span> <span class="st">"Simpson-lower"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-426"><a href="#cb170-426" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"upper"</span>), <span class="at">names_to =</span> <span class="st">"UPPER-simpson"</span>, <span class="at">values_to =</span> <span class="st">"Simpson-upper"</span>),</span>
<span id="cb170-427"><a href="#cb170-427" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"sample_names"</span> <span class="ot">=</span> <span class="st">"sample_names"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb170-428"><a href="#cb170-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(metadata_mcr <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_names"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb170-429"><a href="#cb170-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>sample_names, <span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">"-simpson"</span>), <span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">"-shannon"</span>), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"model."</span>), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"name."</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb170-430"><a href="#cb170-430" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TYPE_BIN =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-431"><a href="#cb170-431" aria-hidden="true" tabindex="-1"></a>      SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"in situ"</span>,</span>
<span id="cb170-432"><a href="#cb170-432" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Incubation"</span></span>
<span id="cb170-433"><a href="#cb170-433" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-434"><a href="#cb170-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb170-435"><a href="#cb170-435" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb170-436"><a href="#cb170-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-437"><a href="#cb170-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-438"><a href="#cb170-438" aria-hidden="true" tabindex="-1"></a> gen_divnet</span>
<span id="cb170-439"><a href="#cb170-439" aria-hidden="true" tabindex="-1"></a>  gen_divnet_SAMPLETYPE</span>
<span id="cb170-440"><a href="#cb170-440" aria-hidden="true" tabindex="-1"></a>  gen_divnet_SAMPLETYPE_BIN</span>
<span id="cb170-441"><a href="#cb170-441" aria-hidden="true" tabindex="-1"></a>  gen_divnet_SITE</span>
<span id="cb170-442"><a href="#cb170-442" aria-hidden="true" tabindex="-1"></a> spp_divnet</span>
<span id="cb170-443"><a href="#cb170-443" aria-hidden="true" tabindex="-1"></a>  spp_divnet_SAMPLETYPE</span>
<span id="cb170-444"><a href="#cb170-444" aria-hidden="true" tabindex="-1"></a>  spp_divnet_SAMPLETYPE_BIN</span>
<span id="cb170-445"><a href="#cb170-445" aria-hidden="true" tabindex="-1"></a>  spp_divnet_SITE</span>
<span id="cb170-446"><a href="#cb170-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-449"><a href="#cb170-449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-450"><a href="#cb170-450" aria-hidden="true" tabindex="-1"></a><span class="do">### Set colors and symbols for dataset</span></span>
<span id="cb170-451"><a href="#cb170-451" aria-hidden="true" tabindex="-1"></a>sampletype_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>, <span class="st">"Incubation"</span>)</span>
<span id="cb170-452"><a href="#cb170-452" aria-hidden="true" tabindex="-1"></a>site_symbol<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">22</span>)</span>
<span id="cb170-453"><a href="#cb170-453" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb170-454"><a href="#cb170-454" aria-hidden="true" tabindex="-1"></a>site_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb170-455"><a href="#cb170-455" aria-hidden="true" tabindex="-1"></a>site_alpha <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.4</span>)</span>
<span id="cb170-456"><a href="#cb170-456" aria-hidden="true" tabindex="-1"></a>site_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb170-457"><a href="#cb170-457" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_color) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb170-458"><a href="#cb170-458" aria-hidden="true" tabindex="-1"></a>bin_type_order <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"in situ"</span>, <span class="st">"Incubation"</span>)</span>
<span id="cb170-459"><a href="#cb170-459" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_alpha) <span class="ot">&lt;-</span> bin_type_order</span>
<span id="cb170-460"><a href="#cb170-460" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb170-461"><a href="#cb170-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-462"><a href="#cb170-462" aria-hidden="true" tabindex="-1"></a>plot_sampletype <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb170-463"><a href="#cb170-463" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>SITE_ORDER <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>SITE, <span class="at">levels =</span> site_order, <span class="at">labels =</span> site_fullname)</span>
<span id="cb170-464"><a href="#cb170-464" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>SAMPLETYPE_ORDER <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>SAMPLETYPE, <span class="at">levels =</span> sampletype_order)</span>
<span id="cb170-465"><a href="#cb170-465" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>TYPE_BIN_ORDER <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>TYPE_BIN, <span class="at">levels =</span> bin_type_order)</span>
<span id="cb170-466"><a href="#cb170-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(site_symbol) <span class="ot">&lt;-</span> site_order</span>
<span id="cb170-467"><a href="#cb170-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_grid</span>(df <span class="sc">%&gt;%</span></span>
<span id="cb170-468"><a href="#cb170-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VENT, <span class="at">y =</span> Shannon)) <span class="sc">+</span></span>
<span id="cb170-469"><a href="#cb170-469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SITE_ORDER, <span class="at">alpha =</span> TYPE_BIN_ORDER)) <span class="sc">+</span></span>
<span id="cb170-470"><a href="#cb170-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> site_alpha) <span class="sc">+</span></span>
<span id="cb170-471"><a href="#cb170-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> site_color) <span class="sc">+</span></span>
<span id="cb170-472"><a href="#cb170-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb170-473"><a href="#cb170-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb170-474"><a href="#cb170-474" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-475"><a href="#cb170-475" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-476"><a href="#cb170-476" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>),</span>
<span id="cb170-477"><a href="#cb170-477" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb170-478"><a href="#cb170-478" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb170-479"><a href="#cb170-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shannon"</span>) <span class="sc">+</span></span>
<span id="cb170-480"><a href="#cb170-480" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>(),</span>
<span id="cb170-481"><a href="#cb170-481" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb170-482"><a href="#cb170-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VENT, <span class="at">y =</span> Simpson)) <span class="sc">+</span></span>
<span id="cb170-483"><a href="#cb170-483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SITE_ORDER, <span class="at">alpha =</span> TYPE_BIN_ORDER)) <span class="sc">+</span></span>
<span id="cb170-484"><a href="#cb170-484" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> site_alpha) <span class="sc">+</span></span>
<span id="cb170-485"><a href="#cb170-485" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> site_color) <span class="sc">+</span></span>
<span id="cb170-486"><a href="#cb170-486" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb170-487"><a href="#cb170-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb170-488"><a href="#cb170-488" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb170-489"><a href="#cb170-489" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-490"><a href="#cb170-490" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-491"><a href="#cb170-491" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-492"><a href="#cb170-492" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"right"</span>) <span class="sc">+</span></span>
<span id="cb170-493"><a href="#cb170-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Simpson"</span>) <span class="sc">+</span></span>
<span id="cb170-494"><a href="#cb170-494" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>(),</span>
<span id="cb170-495"><a href="#cb170-495" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">axis =</span> <span class="fu">c</span>(<span class="st">"lrt"</span>), <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"vh"</span>))</span>
<span id="cb170-496"><a href="#cb170-496" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb170-497"><a href="#cb170-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-498"><a href="#cb170-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-499"><a href="#cb170-499" aria-hidden="true" tabindex="-1"></a> gen_divnet</span>
<span id="cb170-500"><a href="#cb170-500" aria-hidden="true" tabindex="-1"></a>  gen_divnet_SAMPLETYPE</span>
<span id="cb170-501"><a href="#cb170-501" aria-hidden="true" tabindex="-1"></a>  gen_divnet_SAMPLETYPE_BIN</span>
<span id="cb170-502"><a href="#cb170-502" aria-hidden="true" tabindex="-1"></a>  gen_divnet_SITE</span>
<span id="cb170-503"><a href="#cb170-503" aria-hidden="true" tabindex="-1"></a> spp_divnet</span>
<span id="cb170-504"><a href="#cb170-504" aria-hidden="true" tabindex="-1"></a>  spp_divnet_SAMPLETYPE</span>
<span id="cb170-505"><a href="#cb170-505" aria-hidden="true" tabindex="-1"></a>  spp_divnet_SAMPLETYPE_BIN</span>
<span id="cb170-506"><a href="#cb170-506" aria-hidden="true" tabindex="-1"></a>  spp_divnet_SITE</span>
<span id="cb170-507"><a href="#cb170-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-508"><a href="#cb170-508" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=5}</span></span>
<span id="cb170-509"><a href="#cb170-509" aria-hidden="true" tabindex="-1"></a>spp_alpha_18s <span class="ot">&lt;-</span> <span class="fu">fxn_extract_divet</span>(spp_divnet)</span>
<span id="cb170-510"><a href="#cb170-510" aria-hidden="true" tabindex="-1"></a>spp_alpha_label <span class="ot">&lt;-</span> <span class="fu">fxn_extract_divet</span>(spp_divnet_SAMPLETYPE)</span>
<span id="cb170-511"><a href="#cb170-511" aria-hidden="true" tabindex="-1"></a>spp_alpha_TYPE <span class="ot">&lt;-</span> <span class="fu">fxn_extract_divet</span>(spp_divnet_SAMPLETYPE_BIN)</span>
<span id="cb170-512"><a href="#cb170-512" aria-hidden="true" tabindex="-1"></a>spp_alpha_TYPE_SITE <span class="ot">&lt;-</span> <span class="fu">fxn_extract_divet</span>(spp_divnet_SITE)</span>
<span id="cb170-513"><a href="#cb170-513" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb170-514"><a href="#cb170-514" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(spp_alpha_18s)</span>
<span id="cb170-515"><a href="#cb170-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-516"><a href="#cb170-516" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sampletype</span>(spp_alpha_18s)</span>
<span id="cb170-517"><a href="#cb170-517" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-518"><a href="#cb170-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-519"><a href="#cb170-519" aria-hidden="true" tabindex="-1"></a><span class="fu"># ASV overlap comparison</span></span>
<span id="cb170-520"><a href="#cb170-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-523"><a href="#cb170-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-524"><a href="#cb170-524" aria-hidden="true" tabindex="-1"></a><span class="co"># load("input-data/MCR-amplicon-data.RData", verbose=TRUE)</span></span>
<span id="cb170-525"><a href="#cb170-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-526"><a href="#cb170-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-527"><a href="#cb170-527" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supergroup to phylum level comparisons</span></span>
<span id="cb170-528"><a href="#cb170-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-529"><a href="#cb170-529" aria-hidden="true" tabindex="-1"></a>Generate upsetR plots with varied taxonomic levels.</span>
<span id="cb170-530"><a href="#cb170-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-531"><a href="#cb170-531" aria-hidden="true" tabindex="-1"></a>Questions:</span>
<span id="cb170-532"><a href="#cb170-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-533"><a href="#cb170-533" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How which major supergroups and phyla are shared among vent sites within Von Damm and Piccard?</span>
<span id="cb170-534"><a href="#cb170-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-535"><a href="#cb170-535" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=11}</span></span>
<span id="cb170-536"><a href="#cb170-536" aria-hidden="true" tabindex="-1"></a><span class="co"># options for taxa: SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb170-537"><a href="#cb170-537" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb170-538"><a href="#cb170-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-539"><a href="#cb170-539" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb170-540"><a href="#cb170-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-541"><a href="#cb170-541" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-542"><a href="#cb170-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-543"><a href="#cb170-543" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-544"><a href="#cb170-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb170-545"><a href="#cb170-545" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb170-546"><a href="#cb170-546" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-547"><a href="#cb170-547" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb170-548"><a href="#cb170-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb170-549"><a href="#cb170-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb170-550"><a href="#cb170-550" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb170-551"><a href="#cb170-551" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb170-552"><a href="#cb170-552" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-553"><a href="#cb170-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-554"><a href="#cb170-554" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb170-555"><a href="#cb170-555" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb170-556"><a href="#cb170-556" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb170-557"><a href="#cb170-557" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb170-558"><a href="#cb170-558" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb170-559"><a href="#cb170-559" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb170-560"><a href="#cb170-560" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb170-561"><a href="#cb170-561" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb170-562"><a href="#cb170-562" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-563"><a href="#cb170-563" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb170-564"><a href="#cb170-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb170-565"><a href="#cb170-565" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb170-566"><a href="#cb170-566" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb170-567"><a href="#cb170-567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-568"><a href="#cb170-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb170-569"><a href="#cb170-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-570"><a href="#cb170-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb170-571"><a href="#cb170-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-572"><a href="#cb170-572" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb170-573"><a href="#cb170-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-574"><a href="#cb170-574" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb170-575"><a href="#cb170-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb170-576"><a href="#cb170-576" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb170-577"><a href="#cb170-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb170-578"><a href="#cb170-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-579"><a href="#cb170-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb170-580"><a href="#cb170-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-581"><a href="#cb170-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb170-582"><a href="#cb170-582" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb170-583"><a href="#cb170-583" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb170-584"><a href="#cb170-584" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb170-585"><a href="#cb170-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb170-586"><a href="#cb170-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb170-587"><a href="#cb170-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-588"><a href="#cb170-588" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-589"><a href="#cb170-589" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-590"><a href="#cb170-590" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-591"><a href="#cb170-591" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-592"><a href="#cb170-592" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-593"><a href="#cb170-593" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb170-594"><a href="#cb170-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span>
<span id="cb170-595"><a href="#cb170-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-596"><a href="#cb170-596" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to reduce noise and show sample type to vent ecosystem variability.</span></span>
<span id="cb170-597"><a href="#cb170-597" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb170-598"><a href="#cb170-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-599"><a href="#cb170-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-600"><a href="#cb170-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=15, fig.height=12}</span></span>
<span id="cb170-601"><a href="#cb170-601" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-602"><a href="#cb170-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-603"><a href="#cb170-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-604"><a href="#cb170-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb170-605"><a href="#cb170-605" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb170-606"><a href="#cb170-606" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-607"><a href="#cb170-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb170-608"><a href="#cb170-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb170-609"><a href="#cb170-609" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb170-610"><a href="#cb170-610" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb170-611"><a href="#cb170-611" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb170-612"><a href="#cb170-612" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-613"><a href="#cb170-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-614"><a href="#cb170-614" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb170-615"><a href="#cb170-615" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb170-616"><a href="#cb170-616" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb170-617"><a href="#cb170-617" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb170-618"><a href="#cb170-618" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb170-619"><a href="#cb170-619" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb170-620"><a href="#cb170-620" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb170-621"><a href="#cb170-621" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb170-622"><a href="#cb170-622" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-623"><a href="#cb170-623" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb170-624"><a href="#cb170-624" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb170-625"><a href="#cb170-625" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb170-626"><a href="#cb170-626" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb170-627"><a href="#cb170-627" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-628"><a href="#cb170-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb170-629"><a href="#cb170-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-630"><a href="#cb170-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb170-631"><a href="#cb170-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-632"><a href="#cb170-632" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb170-633"><a href="#cb170-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-634"><a href="#cb170-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb170-635"><a href="#cb170-635" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb170-636"><a href="#cb170-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb170-637"><a href="#cb170-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Taxon, SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-638"><a href="#cb170-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb170-639"><a href="#cb170-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-640"><a href="#cb170-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb170-641"><a href="#cb170-641" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb170-642"><a href="#cb170-642" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb170-643"><a href="#cb170-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb170-644"><a href="#cb170-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb170-645"><a href="#cb170-645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb170-646"><a href="#cb170-646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-647"><a href="#cb170-647" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-648"><a href="#cb170-648" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-649"><a href="#cb170-649" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb170-650"><a href="#cb170-650" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-651"><a href="#cb170-651" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-652"><a href="#cb170-652" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb170-653"><a href="#cb170-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span>
<span id="cb170-654"><a href="#cb170-654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-655"><a href="#cb170-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-656"><a href="#cb170-656" aria-hidden="true" tabindex="-1"></a><span class="fu">## ASVs shared across MCR vents</span></span>
<span id="cb170-657"><a href="#cb170-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-658"><a href="#cb170-658" aria-hidden="true" tabindex="-1"></a>ID ASVs that are shared across Piccard and Von Damm, and those that are shared at vent and non-vent samples.</span>
<span id="cb170-659"><a href="#cb170-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-662"><a href="#cb170-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-663"><a href="#cb170-663" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span>
<span id="cb170-664"><a href="#cb170-664" aria-hidden="true" tabindex="-1"></a>shared_across <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-665"><a href="#cb170-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-666"><a href="#cb170-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, SAMPLETYPE, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb170-667"><a href="#cb170-667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-668"><a href="#cb170-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb170-669"><a href="#cb170-669" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SITE, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb170-670"><a href="#cb170-670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FIELD_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-671"><a href="#cb170-671" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(Piccard) <span class="sc">~</span> <span class="st">"VonDamm only"</span>,</span>
<span id="cb170-672"><a href="#cb170-672" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(VonDamm) <span class="sc">~</span> <span class="st">"Piccard only"</span>,</span>
<span id="cb170-673"><a href="#cb170-673" aria-hidden="true" tabindex="-1"></a>    (VonDamm <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> Piccard <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Shared across"</span></span>
<span id="cb170-674"><a href="#cb170-674" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-675"><a href="#cb170-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, FIELD_PA)</span>
<span id="cb170-676"><a href="#cb170-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-677"><a href="#cb170-677" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-678"><a href="#cb170-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-681"><a href="#cb170-681" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-682"><a href="#cb170-682" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span>
<span id="cb170-683"><a href="#cb170-683" aria-hidden="true" tabindex="-1"></a>shared_type <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-684"><a href="#cb170-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-685"><a href="#cb170-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, SAMPLETYPE, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb170-686"><a href="#cb170-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-687"><a href="#cb170-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLETYPE_BIN, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb170-688"><a href="#cb170-688" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLETYPE_BIN, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb170-689"><a href="#cb170-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-690"><a href="#cb170-690" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">non-vent</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> vent <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Cosmo"</span>,</span>
<span id="cb170-691"><a href="#cb170-691" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">non-vent</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Vent only"</span>,</span>
<span id="cb170-692"><a href="#cb170-692" aria-hidden="true" tabindex="-1"></a>    vent <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Non-vent only"</span>,</span>
<span id="cb170-693"><a href="#cb170-693" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-694"><a href="#cb170-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, TYPE_PA)</span>
<span id="cb170-695"><a href="#cb170-695" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(shared_type)</span>
<span id="cb170-696"><a href="#cb170-696" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-697"><a href="#cb170-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-698"><a href="#cb170-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-699"><a href="#cb170-699" aria-hidden="true" tabindex="-1"></a><span class="fu">## ASVs shared in situ &amp; Tf for each experiment</span></span>
<span id="cb170-700"><a href="#cb170-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-703"><a href="#cb170-703" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-704"><a href="#cb170-704" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb170-705"><a href="#cb170-705" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(asv_wtax_qc$SAMPLETYPE)</span></span>
<span id="cb170-706"><a href="#cb170-706" aria-hidden="true" tabindex="-1"></a>shared_exp <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb170-707"><a href="#cb170-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-708"><a href="#cb170-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXP_BIN =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-709"><a href="#cb170-709" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb170-710"><a href="#cb170-710" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb170-711"><a href="#cb170-711" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-712"><a href="#cb170-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, EXP_BIN, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb170-713"><a href="#cb170-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-714"><a href="#cb170-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, EXP_BIN, SITE, VENT, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb170-715"><a href="#cb170-715" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> EXP_BIN, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb170-716"><a href="#cb170-716" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXP_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-717"><a href="#cb170-717" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">in situ</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> Incubation <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Shared"</span>,</span>
<span id="cb170-718"><a href="#cb170-718" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">in situ</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"In situ only"</span>,</span>
<span id="cb170-719"><a href="#cb170-719" aria-hidden="true" tabindex="-1"></a>    Incubation <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Incubation only"</span>,</span>
<span id="cb170-720"><a href="#cb170-720" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-721"><a href="#cb170-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, EXP_PA)</span>
<span id="cb170-722"><a href="#cb170-722" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-723"><a href="#cb170-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-724"><a href="#cb170-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-725"><a href="#cb170-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-726"><a href="#cb170-726" aria-hidden="true" tabindex="-1"></a><span class="fu">### Table to present shared ASVs and taxa</span></span>
<span id="cb170-727"><a href="#cb170-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-728"><a href="#cb170-728" aria-hidden="true" tabindex="-1"></a>Number of ASVs that are shared or unique at Piccard and Von Damm</span>
<span id="cb170-731"><a href="#cb170-731" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-732"><a href="#cb170-732" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb170-733"><a href="#cb170-733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(FIELD_PA))</span>
<span id="cb170-734"><a href="#cb170-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-735"><a href="#cb170-735" aria-hidden="true" tabindex="-1"></a>Number of ASVs that are shared between in situ and incubation experiments</span>
<span id="cb170-738"><a href="#cb170-738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-739"><a href="#cb170-739" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb170-740"><a href="#cb170-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(EXP_PA))</span>
<span id="cb170-741"><a href="#cb170-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-744"><a href="#cb170-744" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-745"><a href="#cb170-745" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb170-746"><a href="#cb170-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(TYPE_PA))</span>
<span id="cb170-747"><a href="#cb170-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-748"><a href="#cb170-748" aria-hidden="true" tabindex="-1"></a>For ASVs shared between in situ and experiment (Tf)</span>
<span id="cb170-751"><a href="#cb170-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-752"><a href="#cb170-752" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb170-753"><a href="#cb170-753" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb170-754"><a href="#cb170-754" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(EXP_PA <span class="sc">==</span> <span class="st">"Shared"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-755"><a href="#cb170-755" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TYPE_PA))</span>
<span id="cb170-756"><a href="#cb170-756" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select(FIELD_PA))</span></span>
<span id="cb170-757"><a href="#cb170-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-758"><a href="#cb170-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-759"><a href="#cb170-759" aria-hidden="true" tabindex="-1"></a>What is the taxonomic composition of those that are shared between the grazing experiments and in situ?</span>
<span id="cb170-760"><a href="#cb170-760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=7}</span></span>
<span id="cb170-761"><a href="#cb170-761" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb170-762"><a href="#cb170-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb170-763"><a href="#cb170-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(asv_wtax_qc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-764"><a href="#cb170-764" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(EXP_PA == "Shared") %&gt;% </span></span>
<span id="cb170-765"><a href="#cb170-765" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID, EXP_PA) <span class="sc">%&gt;%</span> </span>
<span id="cb170-766"><a href="#cb170-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-767"><a href="#cb170-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb170-768"><a href="#cb170-768" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb170-769"><a href="#cb170-769" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-770"><a href="#cb170-770" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb170-771"><a href="#cb170-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb170-772"><a href="#cb170-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb170-773"><a href="#cb170-773" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb170-774"><a href="#cb170-774" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb170-775"><a href="#cb170-775" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-776"><a href="#cb170-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb170-777"><a href="#cb170-777" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb170-778"><a href="#cb170-778" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb170-779"><a href="#cb170-779" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb170-780"><a href="#cb170-780" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb170-781"><a href="#cb170-781" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb170-782"><a href="#cb170-782" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb170-783"><a href="#cb170-783" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb170-784"><a href="#cb170-784" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb170-785"><a href="#cb170-785" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb170-786"><a href="#cb170-786" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SUPERGROUP, EXP_PA) <span class="sc">%&gt;%</span> </span>
<span id="cb170-787"><a href="#cb170-787" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-788"><a href="#cb170-788" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(SAMPLENAME_ORDER = factor(SAMPLENAME, levels = mcr_sample_order)) %&gt;% </span></span>
<span id="cb170-789"><a href="#cb170-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VENT, <span class="at">y =</span> SUM)) <span class="sc">+</span></span>
<span id="cb170-790"><a href="#cb170-790" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb170-791"><a href="#cb170-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(EXP_PA <span class="sc">~</span> SITE, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-792"><a href="#cb170-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-793"><a href="#cb170-793" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb170-794"><a href="#cb170-794" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb170-795"><a href="#cb170-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-796"><a href="#cb170-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-797"><a href="#cb170-797" aria-hidden="true" tabindex="-1"></a>Create table as output</span>
<span id="cb170-800"><a href="#cb170-800" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-801"><a href="#cb170-801" aria-hidden="true" tabindex="-1"></a>tax_table_shared <span class="ot">&lt;-</span> <span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb170-802"><a href="#cb170-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb170-803"><a href="#cb170-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(asv_wtax_qc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-804"><a href="#cb170-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(EXP_PA <span class="sc">==</span> <span class="st">"Shared"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-805"><a href="#cb170-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, <span class="fu">ends_with</span>(<span class="st">"_PA"</span>), Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb170-806"><a href="#cb170-806" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb170-807"><a href="#cb170-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-808"><a href="#cb170-808" aria-hidden="true" tabindex="-1"></a><span class="co"># write_delim(tax_table_shared, file = "output-data/list-of-shared-taxa.txt", delim = "\t")</span></span>
<span id="cb170-809"><a href="#cb170-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-810"><a href="#cb170-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-811"><a href="#cb170-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-812"><a href="#cb170-812" aria-hidden="true" tabindex="-1"></a><span class="fu"># In situ vs. Tf relative changes</span></span>
<span id="cb170-813"><a href="#cb170-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-814"><a href="#cb170-814" aria-hidden="true" tabindex="-1"></a><span class="fu"># Corncob enriched taxa</span></span>
<span id="cb170-815"><a href="#cb170-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-816"><a href="#cb170-816" aria-hidden="true" tabindex="-1"></a>Corncob analysis can be used to identify specific ASVs that may be enriched when we compare non-vent to vent samples.</span>
<span id="cb170-817"><a href="#cb170-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-818"><a href="#cb170-818" aria-hidden="true" tabindex="-1"></a>Questions:</span>
<span id="cb170-819"><a href="#cb170-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-820"><a href="#cb170-820" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at Piccard?</span>
<span id="cb170-821"><a href="#cb170-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-822"><a href="#cb170-822" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at Von Damm?</span>
<span id="cb170-823"><a href="#cb170-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-824"><a href="#cb170-824" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at both sites?</span>
<span id="cb170-825"><a href="#cb170-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-828"><a href="#cb170-828" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-829"><a href="#cb170-829" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb170-830"><a href="#cb170-830" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("bryandmartin/corncob")</span></span>
<span id="cb170-831"><a href="#cb170-831" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corncob); <span class="fu">library</span>(phyloseq)</span>
<span id="cb170-832"><a href="#cb170-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-833"><a href="#cb170-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-836"><a href="#cb170-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-837"><a href="#cb170-837" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb170-838"><a href="#cb170-838" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-839"><a href="#cb170-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-840"><a href="#cb170-840" aria-hidden="true" tabindex="-1"></a>Explore data input for corncob</span>
<span id="cb170-841"><a href="#cb170-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-844"><a href="#cb170-844" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-845"><a href="#cb170-845" aria-hidden="true" tabindex="-1"></a><span class="co"># otu_table(physeq_mcr)[1:10, 1:3]</span></span>
<span id="cb170-846"><a href="#cb170-846" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(physeq_mcr)</span></span>
<span id="cb170-847"><a href="#cb170-847" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(physeq_mcr)[1:3, ]</span></span>
<span id="cb170-848"><a href="#cb170-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-849"><a href="#cb170-849" aria-hidden="true" tabindex="-1"></a><span class="co"># Designated vent vs. non-vent</span></span>
<span id="cb170-850"><a href="#cb170-850" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SAMPLETYPE_BIN)</span>
<span id="cb170-851"><a href="#cb170-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-852"><a href="#cb170-852" aria-hidden="true" tabindex="-1"></a><span class="co">#Designats Piccard vs. vondamm.</span></span>
<span id="cb170-853"><a href="#cb170-853" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SITE)</span>
<span id="cb170-854"><a href="#cb170-854" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-855"><a href="#cb170-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-856"><a href="#cb170-856" aria-hidden="true" tabindex="-1"></a>Start by removing incubation samples for now. Subset to eukaryotes only and use phyloseq's tax glom to summarize to Supergroup, Phylum, Class, Order, Genus, &amp; species.</span>
<span id="cb170-857"><a href="#cb170-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-860"><a href="#cb170-860" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-861"><a href="#cb170-861" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tax_table</span>(physeq_mcr))</span>
<span id="cb170-862"><a href="#cb170-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-863"><a href="#cb170-863" aria-hidden="true" tabindex="-1"></a>mcr_super <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span></span>
<span id="cb170-864"><a href="#cb170-864" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb170-865"><a href="#cb170-865" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-866"><a href="#cb170-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Supergroup"</span>)</span>
<span id="cb170-867"><a href="#cb170-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-868"><a href="#cb170-868" aria-hidden="true" tabindex="-1"></a>mcr_phy <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb170-869"><a href="#cb170-869" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-870"><a href="#cb170-870" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-871"><a href="#cb170-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Phylum"</span>)</span>
<span id="cb170-872"><a href="#cb170-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-873"><a href="#cb170-873" aria-hidden="true" tabindex="-1"></a>mcr_class <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb170-874"><a href="#cb170-874" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-875"><a href="#cb170-875" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-876"><a href="#cb170-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Class"</span>)</span>
<span id="cb170-877"><a href="#cb170-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-878"><a href="#cb170-878" aria-hidden="true" tabindex="-1"></a>mcr_order <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb170-879"><a href="#cb170-879" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-880"><a href="#cb170-880" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-881"><a href="#cb170-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Order"</span>)</span>
<span id="cb170-882"><a href="#cb170-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-883"><a href="#cb170-883" aria-hidden="true" tabindex="-1"></a>mcr_fam <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb170-884"><a href="#cb170-884" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-885"><a href="#cb170-885" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-886"><a href="#cb170-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Family"</span>)</span>
<span id="cb170-887"><a href="#cb170-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-888"><a href="#cb170-888" aria-hidden="true" tabindex="-1"></a>mcr_genera <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb170-889"><a href="#cb170-889" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-890"><a href="#cb170-890" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-891"><a href="#cb170-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Genus"</span>)</span>
<span id="cb170-892"><a href="#cb170-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-893"><a href="#cb170-893" aria-hidden="true" tabindex="-1"></a>mcr_spp <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb170-894"><a href="#cb170-894" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-895"><a href="#cb170-895" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-896"><a href="#cb170-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Species"</span>)</span>
<span id="cb170-897"><a href="#cb170-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-898"><a href="#cb170-898" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(mcr_order)</span></span>
<span id="cb170-899"><a href="#cb170-899" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-900"><a href="#cb170-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-901"><a href="#cb170-901" aria-hidden="true" tabindex="-1"></a>Differential tests in corncob</span>
<span id="cb170-902"><a href="#cb170-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-903"><a href="#cb170-903" aria-hidden="true" tabindex="-1"></a>These tests work to see if taxa are differentially-abundant or variable across a given variable. In this study we have different taxonomic levels, are there more general or species-specific trends? We also have across sample types and site Below set up differential tests across sample types and site (and either or) at different taxonomic levels.</span>
<span id="cb170-904"><a href="#cb170-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-905"><a href="#cb170-905" aria-hidden="true" tabindex="-1"></a>Function to perform specific differential tests across vent fields. Below use **SITE_PICK** parameter to choose between vent fields. Then use the df, to specify the taxonomic level.</span>
<span id="cb170-906"><a href="#cb170-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-909"><a href="#cb170-909" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-910"><a href="#cb170-910" aria-hidden="true" tabindex="-1"></a>corncob_mcr <span class="ot">&lt;-</span> <span class="cf">function</span>(df_in){</span>
<span id="cb170-911"><a href="#cb170-911" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb170-912"><a href="#cb170-912" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SAMPLETYPE+ SITE,</span></span>
<span id="cb170-913"><a href="#cb170-913" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb170-914"><a href="#cb170-914" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb170-915"><a href="#cb170-915" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb170-916"><a href="#cb170-916" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb170-917"><a href="#cb170-917" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb170-918"><a href="#cb170-918" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SAMPLETYPE_BIN specifically compares vent to non-vent.</span></span>
<span id="cb170-919"><a href="#cb170-919" aria-hidden="true" tabindex="-1"></a>  da_analysis_output <span class="ot">&lt;-</span> <span class="fu">differentialTest</span>(<span class="at">formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb170-920"><a href="#cb170-920" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb170-921"><a href="#cb170-921" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula_null =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb170-922"><a href="#cb170-922" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula_null =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb170-923"><a href="#cb170-923" aria-hidden="true" tabindex="-1"></a>                                <span class="at">test =</span> <span class="st">"Wald"</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb170-924"><a href="#cb170-924" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> df_in,</span>
<span id="cb170-925"><a href="#cb170-925" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fdr_cutoff =</span> <span class="fl">0.05</span>)</span>
<span id="cb170-926"><a href="#cb170-926" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SITE,</span></span>
<span id="cb170-927"><a href="#cb170-927" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SITE,</span></span>
<span id="cb170-928"><a href="#cb170-928" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb170-929"><a href="#cb170-929" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SITE,</span></span>
<span id="cb170-930"><a href="#cb170-930" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb170-931"><a href="#cb170-931" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb170-932"><a href="#cb170-932" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb170-933"><a href="#cb170-933" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb170-934"><a href="#cb170-934" aria-hidden="true" tabindex="-1"></a>  list_ofsig <span class="ot">&lt;-</span> <span class="fu">as.character</span>(da_analysis_output<span class="sc">$</span>significant_taxa)</span>
<span id="cb170-935"><a href="#cb170-935" aria-hidden="true" tabindex="-1"></a>  total_number <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ofsig)[<span class="dv">1</span>]</span>
<span id="cb170-936"><a href="#cb170-936" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb170-937"><a href="#cb170-937" aria-hidden="true" tabindex="-1"></a>  sig_taxa_names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(df_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-938"><a href="#cb170-938" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FEATURE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-939"><a href="#cb170-939" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(FEATURE <span class="sc">%in%</span> list_ofsig) <span class="sc">%&gt;%</span> </span>
<span id="cb170-940"><a href="#cb170-940" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"NUMBER"</span>)</span>
<span id="cb170-941"><a href="#cb170-941" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb170-942"><a href="#cb170-942" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_number){</span>
<span id="cb170-943"><a href="#cb170-943" aria-hidden="true" tabindex="-1"></a>    out_0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(da_analysis_output<span class="sc">$</span>significant_models[[var]]<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb170-944"><a href="#cb170-944" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">NUMBER =</span> <span class="fu">as.character</span>(var))</span>
<span id="cb170-945"><a href="#cb170-945" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"extracted # "</span>,var, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb170-946"><a href="#cb170-946" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"extracted_coef"</span>)){</span>
<span id="cb170-947"><a href="#cb170-947" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> out_0 <span class="co"># create the final count table</span></span>
<span id="cb170-948"><a href="#cb170-948" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb170-949"><a href="#cb170-949" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extracted_coef, out_0)</span>
<span id="cb170-950"><a href="#cb170-950" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb170-951"><a href="#cb170-951" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(out_0) <span class="co"># remove excess df</span></span>
<span id="cb170-952"><a href="#cb170-952" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb170-953"><a href="#cb170-953" aria-hidden="true" tabindex="-1"></a>  output_full <span class="ot">&lt;-</span> extracted_coef <span class="sc">%&gt;%</span> </span>
<span id="cb170-954"><a href="#cb170-954" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-955"><a href="#cb170-955" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"mu."</span>, variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-956"><a href="#cb170-956" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sig_taxa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUMBER"</span> <span class="ot">=</span> <span class="st">"NUMBER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb170-957"><a href="#cb170-957" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">VARIABLE =</span> <span class="fu">str_remove</span>(variable, <span class="st">"[:digit:]+"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variable) <span class="co">#%&gt;% </span></span>
<span id="cb170-958"><a href="#cb170-958" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pivot_wider(names_from = VARIABLE, names_glue = "{VARIABLE}_{.value}", values_from = c(Estimate, Std..Error, t.value, Pr...t..))</span></span>
<span id="cb170-959"><a href="#cb170-959" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(extracted_coef)</span>
<span id="cb170-960"><a href="#cb170-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_full)}</span>
<span id="cb170-961"><a href="#cb170-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-962"><a href="#cb170-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-963"><a href="#cb170-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-964"><a href="#cb170-964" aria-hidden="true" tabindex="-1"></a>Define SITE_PICK</span>
<span id="cb170-965"><a href="#cb170-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-968"><a href="#cb170-968" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-969"><a href="#cb170-969" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>, <span class="st">"VonDamm"</span>)</span>
<span id="cb170-970"><a href="#cb170-970" aria-hidden="true" tabindex="-1"></a>picc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>)</span>
<span id="cb170-971"><a href="#cb170-971" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>)</span>
<span id="cb170-972"><a href="#cb170-972" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-973"><a href="#cb170-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-974"><a href="#cb170-974" aria-hidden="true" tabindex="-1"></a>Function to visualize output from corncob</span>
<span id="cb170-975"><a href="#cb170-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-978"><a href="#cb170-978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-979"><a href="#cb170-979" aria-hidden="true" tabindex="-1"></a>plot_corn <span class="ot">&lt;-</span> <span class="cf">function</span>(cob_out, LEVEL, TITLE){</span>
<span id="cb170-980"><a href="#cb170-980" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">enquo</span>(LEVEL)</span>
<span id="cb170-981"><a href="#cb170-981" aria-hidden="true" tabindex="-1"></a>  cob_out <span class="sc">%&gt;%</span></span>
<span id="cb170-982"><a href="#cb170-982" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-983"><a href="#cb170-983" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> level, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb170-984"><a href="#cb170-984" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-985"><a href="#cb170-985" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-986"><a href="#cb170-986" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb170-987"><a href="#cb170-987" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-988"><a href="#cb170-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-989"><a href="#cb170-989" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb170-990"><a href="#cb170-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-991"><a href="#cb170-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> TITLE)</span>
<span id="cb170-992"><a href="#cb170-992" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb170-993"><a href="#cb170-993" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-994"><a href="#cb170-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-995"><a href="#cb170-995" aria-hidden="true" tabindex="-1"></a><span class="fu">### Supergroup corncob</span></span>
<span id="cb170-996"><a href="#cb170-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-997"><a href="#cb170-997" aria-hidden="true" tabindex="-1"></a>What main supergroups are enriched at MCR?</span>
<span id="cb170-998"><a href="#cb170-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1001"><a href="#cb170-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1002"><a href="#cb170-1002" aria-hidden="true" tabindex="-1"></a><span class="co"># # vd</span></span>
<span id="cb170-1003"><a href="#cb170-1003" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb170-1004"><a href="#cb170-1004" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% vd))</span></span>
<span id="cb170-1005"><a href="#cb170-1005" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb170-1006"><a href="#cb170-1006" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb170-1007"><a href="#cb170-1007" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% picc))</span></span>
<span id="cb170-1008"><a href="#cb170-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1009"><a href="#cb170-1009" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_super <span class="sc">%&gt;%</span> </span>
<span id="cb170-1010"><a href="#cb170-1010" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span>
<span id="cb170-1011"><a href="#cb170-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1012"><a href="#cb170-1012" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd %&gt;%</span></span>
<span id="cb170-1013"><a href="#cb170-1013" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb170-1014"><a href="#cb170-1014" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb170-1015"><a href="#cb170-1015" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb170-1016"><a href="#cb170-1016" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb170-1017"><a href="#cb170-1017" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb170-1018"><a href="#cb170-1018" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb170-1019"><a href="#cb170-1019" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb170-1020"><a href="#cb170-1020" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb170-1021"><a href="#cb170-1021" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb170-1022"><a href="#cb170-1022" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "VD supergroup")</span></span>
<span id="cb170-1023"><a href="#cb170-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1024"><a href="#cb170-1024" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc %&gt;%</span></span>
<span id="cb170-1025"><a href="#cb170-1025" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb170-1026"><a href="#cb170-1026" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb170-1027"><a href="#cb170-1027" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb170-1028"><a href="#cb170-1028" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb170-1029"><a href="#cb170-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb170-1030"><a href="#cb170-1030" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb170-1031"><a href="#cb170-1031" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb170-1032"><a href="#cb170-1032" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb170-1033"><a href="#cb170-1033" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb170-1034"><a href="#cb170-1034" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "piccard supergroup")</span></span>
<span id="cb170-1035"><a href="#cb170-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1036"><a href="#cb170-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1037"><a href="#cb170-1037" aria-hidden="true" tabindex="-1"></a>Plot supergroup enrichment</span>
<span id="cb170-1038"><a href="#cb170-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1041"><a href="#cb170-1041" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1042"><a href="#cb170-1042" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="sc">%&gt;%</span></span>
<span id="cb170-1043"><a href="#cb170-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-1044"><a href="#cb170-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Supergroup, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb170-1045"><a href="#cb170-1045" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1046"><a href="#cb170-1046" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1047"><a href="#cb170-1047" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb170-1048"><a href="#cb170-1048" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-1049"><a href="#cb170-1049" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-1050"><a href="#cb170-1050" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb170-1051"><a href="#cb170-1051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-1052"><a href="#cb170-1052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR supergroup"</span>)</span>
<span id="cb170-1053"><a href="#cb170-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1054"><a href="#cb170-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1055"><a href="#cb170-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">### Phylum corncob analysis</span></span>
<span id="cb170-1056"><a href="#cb170-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1059"><a href="#cb170-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1060"><a href="#cb170-1060" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_phy)</span>
<span id="cb170-1061"><a href="#cb170-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1062"><a href="#cb170-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1065"><a href="#cb170-1065" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1066"><a href="#cb170-1066" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="sc">%&gt;%</span></span>
<span id="cb170-1067"><a href="#cb170-1067" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-1068"><a href="#cb170-1068" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Phylum, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb170-1069"><a href="#cb170-1069" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1070"><a href="#cb170-1070" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1071"><a href="#cb170-1071" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Phylum), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb170-1072"><a href="#cb170-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-1073"><a href="#cb170-1073" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-1074"><a href="#cb170-1074" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb170-1075"><a href="#cb170-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-1076"><a href="#cb170-1076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR Phylum"</span>)</span>
<span id="cb170-1077"><a href="#cb170-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1078"><a href="#cb170-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1079"><a href="#cb170-1079" aria-hidden="true" tabindex="-1"></a><span class="fu">### Class corncob analysis</span></span>
<span id="cb170-1080"><a href="#cb170-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1083"><a href="#cb170-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1084"><a href="#cb170-1084" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_class <span class="sc">%&gt;%</span></span>
<span id="cb170-1085"><a href="#cb170-1085" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span>
<span id="cb170-1086"><a href="#cb170-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1087"><a href="#cb170-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1088"><a href="#cb170-1088" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb170-1089"><a href="#cb170-1089" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb170-1090"><a href="#cb170-1090" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb170-1091"><a href="#cb170-1091" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="sc">%&gt;%</span></span>
<span id="cb170-1092"><a href="#cb170-1092" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Class, <span class="fu">c</span>(Phylum, Class), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1093"><a href="#cb170-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-1094"><a href="#cb170-1094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Class, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb170-1095"><a href="#cb170-1095" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1096"><a href="#cb170-1096" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1097"><a href="#cb170-1097" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb170-1098"><a href="#cb170-1098" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-1099"><a href="#cb170-1099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-1100"><a href="#cb170-1100" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb170-1101"><a href="#cb170-1101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-1102"><a href="#cb170-1102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Class level test for differential abundance"</span>)</span>
<span id="cb170-1103"><a href="#cb170-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1104"><a href="#cb170-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1105"><a href="#cb170-1105" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Class level looks pretty good. Keep this one. Looks at major taxonomic groups that were more enriched at vents? Work on the language here. Repeat vent vs. plume at ASV level. ID some of the core ASVs that can help elaborate on what we see above (table in supplementary)</span></span>
<span id="cb170-1106"><a href="#cb170-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1107"><a href="#cb170-1107" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Interpretation* :</span></span>
<span id="cb170-1108"><a href="#cb170-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1109"><a href="#cb170-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">### Order corncob</span></span>
<span id="cb170-1110"><a href="#cb170-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1113"><a href="#cb170-1113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1114"><a href="#cb170-1114" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_order)</span>
<span id="cb170-1115"><a href="#cb170-1115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1116"><a href="#cb170-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1117"><a href="#cb170-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb170-1118"><a href="#cb170-1118" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb170-1119"><a href="#cb170-1119" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb170-1120"><a href="#cb170-1120" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="sc">%&gt;%</span></span>
<span id="cb170-1121"><a href="#cb170-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Order, <span class="fu">c</span>(Phylum, Class, Order), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1122"><a href="#cb170-1122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1123"><a href="#cb170-1123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Order, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb170-1124"><a href="#cb170-1124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1125"><a href="#cb170-1125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1126"><a href="#cb170-1126" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb170-1127"><a href="#cb170-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-1128"><a href="#cb170-1128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-1129"><a href="#cb170-1129" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb170-1130"><a href="#cb170-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-1131"><a href="#cb170-1131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Order level test for differential abundance"</span>)</span>
<span id="cb170-1132"><a href="#cb170-1132" aria-hidden="true" tabindex="-1"></a><span class="co"># ?geom_errorbar</span></span>
<span id="cb170-1133"><a href="#cb170-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1134"><a href="#cb170-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1135"><a href="#cb170-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">### Family corncob</span></span>
<span id="cb170-1136"><a href="#cb170-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1137"><a href="#cb170-1137" aria-hidden="true" tabindex="-1"></a>Plan to pairing with tree below</span>
<span id="cb170-1138"><a href="#cb170-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1141"><a href="#cb170-1141" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1142"><a href="#cb170-1142" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_fam)</span>
<span id="cb170-1143"><a href="#cb170-1143" aria-hidden="true" tabindex="-1"></a><span class="co"># head(tax_table(mcr_fam))</span></span>
<span id="cb170-1144"><a href="#cb170-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1145"><a href="#cb170-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1148"><a href="#cb170-1148" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1149"><a href="#cb170-1149" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="sc">%&gt;%</span></span>
<span id="cb170-1150"><a href="#cb170-1150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unite(Family, c(Class, Order, Family), sep = " ", remove = FALSE) %&gt;%</span></span>
<span id="cb170-1151"><a href="#cb170-1151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Family, <span class="fu">c</span>(Order, Family), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1152"><a href="#cb170-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1153"><a href="#cb170-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Family, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb170-1154"><a href="#cb170-1154" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1155"><a href="#cb170-1155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1156"><a href="#cb170-1156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb170-1157"><a href="#cb170-1157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Phylum <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-1158"><a href="#cb170-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb170-1159"><a href="#cb170-1159" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb170-1160"><a href="#cb170-1160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-1161"><a href="#cb170-1161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Family level test for differential abundance"</span>)</span>
<span id="cb170-1162"><a href="#cb170-1162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1163"><a href="#cb170-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1164"><a href="#cb170-1164" aria-hidden="true" tabindex="-1"></a><span class="fu">### Genus corncob</span></span>
<span id="cb170-1165"><a href="#cb170-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1166"><a href="#cb170-1166" aria-hidden="true" tabindex="-1"></a>Plan to pairing with tree below</span>
<span id="cb170-1167"><a href="#cb170-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1170"><a href="#cb170-1170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1171"><a href="#cb170-1171" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_genera)</span>
<span id="cb170-1172"><a href="#cb170-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1173"><a href="#cb170-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1176"><a href="#cb170-1176" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1177"><a href="#cb170-1177" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="sc">%&gt;%</span></span>
<span id="cb170-1178"><a href="#cb170-1178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Genus, <span class="fu">c</span>(Phylum, Genus), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1179"><a href="#cb170-1179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1180"><a href="#cb170-1180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Genus, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb170-1181"><a href="#cb170-1181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1182"><a href="#cb170-1182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1183"><a href="#cb170-1183" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb170-1184"><a href="#cb170-1184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-1185"><a href="#cb170-1185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-1186"><a href="#cb170-1186" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb170-1187"><a href="#cb170-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-1188"><a href="#cb170-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Genus level test for differential abundance"</span>)</span>
<span id="cb170-1189"><a href="#cb170-1189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1190"><a href="#cb170-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1191"><a href="#cb170-1191" aria-hidden="true" tabindex="-1"></a><span class="fu">### Species corncob</span></span>
<span id="cb170-1192"><a href="#cb170-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1195"><a href="#cb170-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1196"><a href="#cb170-1196" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_spp)</span>
<span id="cb170-1197"><a href="#cb170-1197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1198"><a href="#cb170-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1199"><a href="#cb170-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb170-1200"><a href="#cb170-1200" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="sc">%&gt;%</span></span>
<span id="cb170-1201"><a href="#cb170-1201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Species, <span class="fu">c</span>(Genus, Species), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1202"><a href="#cb170-1202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb170-1203"><a href="#cb170-1203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Species, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb170-1204"><a href="#cb170-1204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1205"><a href="#cb170-1205" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb170-1206"><a href="#cb170-1206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb170-1207"><a href="#cb170-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Order <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb170-1208"><a href="#cb170-1208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb170-1209"><a href="#cb170-1209" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb170-1210"><a href="#cb170-1210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb170-1211"><a href="#cb170-1211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Species level test for differential abundance"</span>)</span>
<span id="cb170-1212"><a href="#cb170-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1213"><a href="#cb170-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1214"><a href="#cb170-1214" aria-hidden="true" tabindex="-1"></a><span class="fu"># Corncob + P/A info</span></span>
<span id="cb170-1215"><a href="#cb170-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1216"><a href="#cb170-1216" aria-hidden="true" tabindex="-1"></a>Which ASVs were enriched within vent site, and also found in grazing experiments?</span>
<span id="cb170-1217"><a href="#cb170-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1220"><a href="#cb170-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1221"><a href="#cb170-1221" aria-hidden="true" tabindex="-1"></a>enriched_at_family <span class="ot">&lt;-</span> <span class="fu">as.character</span>(analysis_fam<span class="sc">$</span>FEATURE)</span>
<span id="cb170-1222"><a href="#cb170-1222" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1223"><a href="#cb170-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1224"><a href="#cb170-1224" aria-hidden="true" tabindex="-1"></a>Import table of shared ASVs</span>
<span id="cb170-1227"><a href="#cb170-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1228"><a href="#cb170-1228" aria-hidden="true" tabindex="-1"></a>tax_table_shared <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="at">file =</span> <span class="st">"output-data/list-of-shared-taxa.txt"</span>)</span>
<span id="cb170-1229"><a href="#cb170-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1230"><a href="#cb170-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1231"><a href="#cb170-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1234"><a href="#cb170-1234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1235"><a href="#cb170-1235" aria-hidden="true" tabindex="-1"></a>enriched_and_shared<span class="ot">&lt;-</span> tax_table_shared <span class="sc">%&gt;%</span> </span>
<span id="cb170-1236"><a href="#cb170-1236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(FeatureID <span class="sc">%in%</span> enriched_at_family)</span>
<span id="cb170-1237"><a href="#cb170-1237" aria-hidden="true" tabindex="-1"></a><span class="co"># View(enriched_and_shared)</span></span>
<span id="cb170-1238"><a href="#cb170-1238" aria-hidden="true" tabindex="-1"></a><span class="co"># write_delim(enriched_and_shared, file = "output-data/enriched-and-shared.txt", delim = "\t")</span></span>
<span id="cb170-1239"><a href="#cb170-1239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1240"><a href="#cb170-1240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1241"><a href="#cb170-1241" aria-hidden="true" tabindex="-1"></a>There was a total of 29 ASVs that were both a part of the enriched at vents (compared to background) and were present in both in situ and incubation (Tf) samples. These 29 ASVs represent a subset that we hypothesize are more likely to be involved in grazing. Another observation is that the majority of them are cosmopolitan. This indicates that based on the grazing experiments, the taxa that are enriched at vents and are subsequently members of the grazing population in the experiments are also able to inhabit plume and background.</span>
<span id="cb170-1242"><a href="#cb170-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1243"><a href="#cb170-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-1244"><a href="#cb170-1244" aria-hidden="true" tabindex="-1"></a><span class="fu"># Info</span></span>
<span id="cb170-1247"><a href="#cb170-1247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb170-1248"><a href="#cb170-1248" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb170-1249"><a href="#cb170-1249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb170-1250"><a href="#cb170-1250" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>