<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Mid-Cayman Rise analysis - 18S rRNA gene amplicon survey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Mid-Cayman Rise analysis</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./grazing.html">Grazing analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./asv-analysis.html" aria-current="page">Sequence analysis</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sequence-qc.html">Sequence QC &amp; import</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#import-sequence-and-metadata" id="toc-import-sequence-and-metadata" class="nav-link active" data-scroll-target="#import-sequence-and-metadata"><span class="toc-section-number">1</span>  Import sequence and metadata</a>
  <ul class="collapse">
  <li><a href="#import-asv-r-objects" id="toc-import-asv-r-objects" class="nav-link" data-scroll-target="#import-asv-r-objects"><span class="toc-section-number">1.1</span>  Import ASV R objects</a></li>
  <li><a href="#factor---legendcolor-key" id="toc-factor---legendcolor-key" class="nav-link" data-scroll-target="#factor---legendcolor-key"><span class="toc-section-number">1.2</span>  Factor - legend/color key</a></li>
  </ul></li>
  <li><a href="#preliminary-look-at-all-samples" id="toc-preliminary-look-at-all-samples" class="nav-link" data-scroll-target="#preliminary-look-at-all-samples"><span class="toc-section-number">2</span>  Preliminary look at all samples</a>
  <ul class="collapse">
  <li><a href="#cluster-analysis" id="toc-cluster-analysis" class="nav-link" data-scroll-target="#cluster-analysis"><span class="toc-section-number">2.1</span>  Cluster analysis</a>
  <ul class="collapse">
  <li><a href="#with-grazing-assays" id="toc-with-grazing-assays" class="nav-link" data-scroll-target="#with-grazing-assays">with grazing assays</a></li>
  <li><a href="#insitu-only" id="toc-insitu-only" class="nav-link" data-scroll-target="#insitu-only">insitu only</a></li>
  </ul></li>
  <li><a href="#community-taxonomic-composition-richness-sequence-relative-abundance" id="toc-community-taxonomic-composition-richness-sequence-relative-abundance" class="nav-link" data-scroll-target="#community-taxonomic-composition-richness-sequence-relative-abundance"><span class="toc-section-number">2.2</span>  Community taxonomic composition (richness &amp; sequence relative abundance)</a>
  <ul class="collapse">
  <li><a href="#dendrogram-with-bubble-plot" id="toc-dendrogram-with-bubble-plot" class="nav-link" data-scroll-target="#dendrogram-with-bubble-plot">Dendrogram with bubble plot</a></li>
  <li><a href="#relative-abundance" id="toc-relative-abundance" class="nav-link" data-scroll-target="#relative-abundance">Relative abundance</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#asv-overlap-comparison" id="toc-asv-overlap-comparison" class="nav-link" data-scroll-target="#asv-overlap-comparison"><span class="toc-section-number">3</span>  ASV overlap comparison</a>
  <ul class="collapse">
  <li><a href="#supergroup-to-phylum-level-comparisons" id="toc-supergroup-to-phylum-level-comparisons" class="nav-link" data-scroll-target="#supergroup-to-phylum-level-comparisons"><span class="toc-section-number">3.1</span>  Supergroup to phylum level comparisons</a></li>
  <li><a href="#asvs-shared-across-mcr-vents" id="toc-asvs-shared-across-mcr-vents" class="nav-link" data-scroll-target="#asvs-shared-across-mcr-vents"><span class="toc-section-number">3.2</span>  ASVs shared across MCR vents</a></li>
  <li><a href="#asvs-shared-in-situ-tf-for-each-experiment" id="toc-asvs-shared-in-situ-tf-for-each-experiment" class="nav-link" data-scroll-target="#asvs-shared-in-situ-tf-for-each-experiment"><span class="toc-section-number">3.3</span>  ASVs shared in situ &amp; Tf for each experiment</a>
  <ul class="collapse">
  <li><a href="#table-to-present-shared-asvs-and-taxa" id="toc-table-to-present-shared-asvs-and-taxa" class="nav-link" data-scroll-target="#table-to-present-shared-asvs-and-taxa">Table to present shared ASVs and taxa</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#in-situ-vs.-tf-relative-changes" id="toc-in-situ-vs.-tf-relative-changes" class="nav-link" data-scroll-target="#in-situ-vs.-tf-relative-changes"><span class="toc-section-number">4</span>  In situ vs.&nbsp;Tf relative changes</a></li>
  <li><a href="#corncob-enriched-taxa" id="toc-corncob-enriched-taxa" class="nav-link" data-scroll-target="#corncob-enriched-taxa"><span class="toc-section-number">5</span>  Corncob enriched taxa</a>
  <ul class="collapse">
  <li><a href="#supergroup-corncob" id="toc-supergroup-corncob" class="nav-link" data-scroll-target="#supergroup-corncob">Supergroup corncob</a></li>
  <li><a href="#phylum-corncob-analysis" id="toc-phylum-corncob-analysis" class="nav-link" data-scroll-target="#phylum-corncob-analysis">Phylum corncob analysis</a></li>
  <li><a href="#class-corncob-analysis" id="toc-class-corncob-analysis" class="nav-link" data-scroll-target="#class-corncob-analysis">Class corncob analysis</a></li>
  <li><a href="#order-corncob" id="toc-order-corncob" class="nav-link" data-scroll-target="#order-corncob">Order corncob</a></li>
  <li><a href="#family-corncob" id="toc-family-corncob" class="nav-link" data-scroll-target="#family-corncob">Family corncob</a></li>
  <li><a href="#genus-corncob" id="toc-genus-corncob" class="nav-link" data-scroll-target="#genus-corncob">Genus corncob</a></li>
  <li><a href="#species-corncob" id="toc-species-corncob" class="nav-link" data-scroll-target="#species-corncob">Species corncob</a></li>
  </ul></li>
  <li><a href="#corncob-pa-info" id="toc-corncob-pa-info" class="nav-link" data-scroll-target="#corncob-pa-info"><span class="toc-section-number">6</span>  Corncob + P/A info</a></li>
  <li><a href="#info" id="toc-info" class="nav-link" data-scroll-target="#info"><span class="toc-section-number">7</span>  Info</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">18S rRNA gene amplicon survey</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>Goals for this analysis are to investigate specific protistan taxonomic groups in the context of elevated grazing activity, cell biomass, and hydrothermal vent sample type.</p>
<p>Data originate from in situ MCR samples from a tag-sequence survey and the Tf time point from the grazing experiments. Additionally, in situ and grazing experiments were conducted within vent sites, at the plume, and in the background.</p>
<section id="import-sequence-and-metadata" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Import sequence and metadata</h1>
<p>Set up R environment</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(ape)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggupset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Import previously sequenced and analyzed tag-sequence data. See https://shu251.github.io/microeuk-amplicon-survey/ for additional information.</p>
<section id="import-asv-r-objects" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="import-asv-r-objects"><span class="header-section-number">1.1</span> Import ASV R objects</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="factor---legendcolor-key" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="factor---legendcolor-key"><span class="header-section-number">1.2</span> Factor - legend/color key</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>, <span class="st">"Plume"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"LotsOShrimp"</span>, <span class="st">"X18"</span>, <span class="st">"OMT"</span>, <span class="st">"OldManTree"</span>, <span class="st">"Rav2"</span>, <span class="st">"MustardStand"</span>, <span class="st">"ShrimpHole"</span>, <span class="st">"WhiteCastle"</span>, <span class="st">"ArrowLoop"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>vent_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"Lots 'O Shrimp"</span>, <span class="st">"X-18"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Ravelin #2"</span>, <span class="st">"Mustard Stand"</span>, <span class="st">"Shrimp Hole"</span>, <span class="st">"White Castle"</span>, <span class="st">"Arrow Loop"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>site_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VD"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>site_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_color) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>whole_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#E9C46A"</span>,<span class="st">"#F4A261"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#eae2b7"</span>, <span class="st">"#5f0f40"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#941b0c"</span>, <span class="st">"#577590"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for VD and Piccard</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>site_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#418b84"</span>, <span class="st">"#943b36"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># site_colors</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent colors</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>vent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#253494"</span>,<span class="st">"#1d91c0"</span>, <span class="st">"#E9C46A"</span>, <span class="st">"#E76F51"</span>, <span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#941b0c"</span>, <span class="st">"#577590"</span>, <span class="st">"#eae2b7"</span>, <span class="st">"#deebf7"</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co"># vent_colors &lt;- c("")</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vent_colors) <span class="ot">&lt;-</span> vent_fullname</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co"># all_taxa_color = c("#fa9fb5", "#c51b8a", "#67000d", "#ef3b2c", "#ffffcc", "#feb24c", "#c7e9b4", "#1d91c0", "#deebf7", "#253494", "#9e9ac8", "#238b45", "#54278f", "#bdbdbd", "#252525", "#fa9fb5", "#c51b8a", "#67000d", "#ef3b2c", "#ffffcc", "#feb24c", "#c7e9b4", "#1d91c0", "#253494", "#9e9ac8", "#238b45", "#54278f", "#bdbdbd", "#252525")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="preliminary-look-at-all-samples" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Preliminary look at all samples</h1>
<section id="cluster-analysis" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="cluster-analysis"><span class="header-section-number">2.1</span> Cluster analysis</h2>
<p>Ordination analysis and methods to look at whole protistan communities at MCR.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan); <span class="fu">library</span>(ggdendro); <span class="fu">library</span>(compositions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: permute</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is vegan 2.6-2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to compositions, a package for compositional data analysis.
Find an intro with "? compositions"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'compositions'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ape':

    balance</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    anova, cor, cov, dist, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    %*%, norm, scale, scale.default</code></pre>
</div>
</div>
<section id="with-grazing-assays" class="level3">
<h3 class="anchored" data-anchor-id="with-grazing-assays">with grazing assays</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<p>Transform compositional data, center log ratio.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric)))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(logratio_mcr)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ?alr()</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ?ilr()</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(logratio_mcr)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>variance_logratio <span class="ot">&lt;-</span> (pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 21 rows [1, 2, 3, 4,
5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
</div>
<p>PCoA with all samples</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> TYPE, <span class="at">fill =</span> VENT_ORDER, <span class="at">alpha =</span> SITE)) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<section id="dendrogram-analysis" class="level4">
<h4 class="anchored" data-anchor-id="dendrogram-analysis">Dendrogram analysis</h4>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?decostand()</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative abundance</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>rel_abun <span class="ot">&lt;-</span> <span class="fu">decostand</span>(asv_mcr_numeric, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"total"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster dendrogram (average hierarchical clustering)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>cluster_mcr <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(rel_abun)), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>dendro <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(cluster_mcr)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>mcr_dendro <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(dendro, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">segment</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend)) <span class="sc">+</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">data =</span> <span class="fu">label</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dendro</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Dissimilarity"</span>) <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">14</span>), <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#252525"</span>), </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># svg('figs/SUPPLEMENTARY-dendrogram-wreps.svg', w = 10, h = 8)</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="384"></p>
</div>
</div>
</section>
</section>
<section id="insitu-only" class="level3">
<h3 class="anchored" data-anchor-id="insitu-only">insitu only</h3>
<p>PCoA with in situ only</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric_insitu <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>insitu_logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric_insitu)))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>insitu_pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(insitu_logratio_mcr)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>insitu_variance_logratio <span class="ot">&lt;-</span> (insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(insitu_variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points for only insitu samples</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(insitu_pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(insitu_pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 13 rows [1, 2, 3, 4,
5, 6, 7, 8, 9, 10, 11, 12, 13].</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE_ORDER, <span class="at">fill =</span> VENT_ORDER)) <span class="sc">+</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="576"></p>
</div>
</div>
</section>
</section>
<section id="community-taxonomic-composition-richness-sequence-relative-abundance" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="community-taxonomic-composition-richness-sequence-relative-abundance"><span class="header-section-number">2.2</span> Community taxonomic composition (richness &amp; sequence relative abundance)</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>out_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcr_dendro<span class="sc">$</span>labels)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>mcr_sample_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(out_labels<span class="sc">$</span>label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span> </span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TOTAL_SEQ =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq),</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">REL_ABUN =</span> SUM<span class="sc">/</span>TOTAL_SEQ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUPERGROUP, <span class="at">size =</span> REL_ABUN)) <span class="sc">+</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="fu">aes</span>(<span class="at">size =</span> REL_ABUN, <span class="at">fill =</span> SUPERGROUP, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(. ~ SITE, scales = "free", space = "free") +</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'Taxon'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 10924 rows [3, 10,
11, 12, 13, 14, 18, 19, 20, 21, 23, 27, 28, 30, 31, 32, 33, 34, 35, 38, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 6487 rows [1, 2,
4, 5, 6, 7, 8, 9, 15, 16, 17, 22, 24, 25, 26, 29, 36, 37, 48, 49, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'SUPERGROUP'. You can override using the `.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>bubble</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="1056"></p>
</div>
</div>
<section id="dendrogram-with-bubble-plot" class="level3">
<h3 class="anchored" data-anchor-id="dendrogram-with-bubble-plot">Dendrogram with bubble plot</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_dendro_plot + bubble + patchwork::plot_layout(ncol = 2) + patchwork::plot_annotation(tag_levels = "a")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="relative-abundance" class="level3">
<h3 class="anchored" data-anchor-id="relative-abundance">Relative abundance</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUM)) <span class="sc">+</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VENT <span class="sc">+</span> SITE, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'Taxon'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 10924 rows [3, 10,
11, 12, 13, 14, 18, 19, 20, 21, 23, 27, 28, 30, 31, 32, 33, 34, 35, 38, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 6487 rows [1, 2,
4, 5, 6, 7, 8, 9, 15, 16, 17, 22, 24, 25, 26, 29, 36, 37, 48, 49, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE'.
You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In bar plot above, in situ and Tf incubation samples are paired for each site.</p>
</section>
</section>
</section>
<section id="asv-overlap-comparison" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> ASV overlap comparison</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load("input-data/MCR-amplicon-data.RData", verbose=TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="supergroup-to-phylum-level-comparisons" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="supergroup-to-phylum-level-comparisons"><span class="header-section-number">3.1</span> Supergroup to phylum level comparisons</h2>
<p>Generate upsetR plots with varied taxonomic levels.</p>
<p>Questions:</p>
<ul>
<li>How which major supergroups and phyla are shared among vent sites within Von Damm and Piccard?</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># options for taxa: SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 5926 rows [5, 6, 7,
8, 9, 10, 11, 14, 15, 16, 17, 20, 21, 22, 24, 25, 26, 28, 29, 30, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 3451 rows [1, 2,
3, 4, 12, 13, 18, 19, 23, 27, 35, 44, 45, 46, 48, 49, 53, 54, 55, 56, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME', 'VENT'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 7678 rows [1, 2, 3,
4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SupergroupPhylum'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="1056"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to reduce noise and show sample type to vent ecosystem variability.</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Taxon, SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 5926 rows [5, 6, 7,
8, 9, 10, 11, 14, 15, 16, 17, 20, 21, 22, 24, 25, 26, 28, 29, 30, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 3451 rows [1, 2,
3, 4, 12, 13, 18, 19, 23, 27, 35, 44, 45, 46, 48, 49, 53, 54, 55, 56, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'FeatureID', 'SAMPLENAME', 'VENT',
'SupergroupPhylum'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 4 pieces. Additional pieces discarded in 7678 rows [1, 2, 3,
4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SupergroupPhylum', 'Taxon'. You can
override using the `.groups` argument.
`summarise()` has grouped output by 'SupergroupPhylum'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 300 rows containing non-finite values (stat_count).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="asvs-shared-across-mcr-vents" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="asvs-shared-across-mcr-vents"><span class="header-section-number">3.2</span> ASVs shared across MCR vents</h2>
<p>ID ASVs that are shared across Piccard and Von Damm, and those that are shared at vent and non-vent samples.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  22
  FeatureID SAMPLE value Taxon Conse SAMPL VENT  SITE  SAMPL DEPTH SAMPL
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
1 00056209 52_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
2 00056209 53_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
3 00056209 54_MC     0 Euka     0.8 "VonDa Must VonD ""      ""    Incuba
4 00056209 55_MC     0 Euka     0.8 "VonDa Shri VonD ""      ""    Incuba
5 00056209 57_MC     0 Euka     0.8 "Picca Shri Picc ""      ""    Incuba
6 00056209 58_MC     0 Euka     0.8 "VonDa Plume VonD ""      ""    Incuba
#  with 11 more variables: SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;,
#   pH &lt;chr&gt;, PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, and abbreviated variable names
#   Consensus, SAMPLENAME, SAMPLEID, SAMPLETYPE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>shared_across <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, SAMPLETYPE, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SITE, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FIELD_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(Piccard) <span class="sc">~</span> <span class="st">"VonDamm only"</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(VonDamm) <span class="sc">~</span> <span class="st">"Piccard only"</span>,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    (VonDamm <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> Piccard <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Shared across"</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, FIELD_PA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6  22
  FeatureID SAMPLE value Taxon Conse SAMPL VENT  SITE  SAMPL DEPTH SAMPL
  &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
1 00056209 52_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
2 00056209 53_MC     0 Euka     0.8 "Picca Lots Picc ""      ""    Incuba
3 00056209 54_MC     0 Euka     0.8 "VonDa Must VonD ""      ""    Incuba
4 00056209 55_MC     0 Euka     0.8 "VonDa Shri VonD ""      ""    Incuba
5 00056209 57_MC     0 Euka     0.8 "Picca Shri Picc ""      ""    Incuba
6 00056209 58_MC     0 Euka     0.8 "VonDa Plume VonD ""      ""    Incuba
#  with 11 more variables: SAMPLETYPE_BIN &lt;chr&gt;, YEAR &lt;chr&gt;, TEMP &lt;chr&gt;,
#   pH &lt;chr&gt;, PercSeawater &lt;chr&gt;, Mg &lt;chr&gt;, H2 &lt;chr&gt;, H2S &lt;chr&gt;, CH4 &lt;chr&gt;,
#   ProkConc &lt;chr&gt;, Sample_or_Control &lt;chr&gt;, and abbreviated variable names
#   Consensus, SAMPLENAME, SAMPLEID, SAMPLETYPE</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>shared_type <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, SAMPLETYPE, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLETYPE_BIN, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLETYPE_BIN, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">non-vent</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> vent <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Cosmo"</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">non-vent</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Vent only"</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    vent <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Non-vent only"</span>,</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, TYPE_PA)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(shared_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [8,026  2] (S3: tbl_df/tbl/data.frame)
 $ FeatureID: chr [1:8026] "0016c92095329cf769d2fc9f5a0b826c" "0024760a130d14a29d63bb07f082733e" "00508684a4c673b882a5d186733b3271" "0052bc3663c02b5375d7472fdcb21cd0" ...
 $ TYPE_PA  : chr [1:8026] "Non-vent only" "Vent only" "Non-vent only" "Vent only" ...</code></pre>
</div>
</div>
</section>
<section id="asvs-shared-in-situ-tf-for-each-experiment" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="asvs-shared-in-situ-tf-for-each-experiment"><span class="header-section-number">3.3</span> ASVs shared in situ &amp; Tf for each experiment</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(asv_wtax_qc$SAMPLETYPE)</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>shared_exp <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXP_BIN =</span> <span class="fu">case_when</span>(</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, EXP_BIN, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, EXP_BIN, SITE, VENT, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> EXP_BIN, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXP_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">in situ</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> Incubation <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Shared"</span>,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">in situ</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"In situ only"</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    Incubation <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Incubation only"</span>,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, EXP_PA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="table-to-present-shared-asvs-and-taxa" class="level3">
<h3 class="anchored" data-anchor-id="table-to-present-shared-asvs-and-taxa">Table to present shared ASVs and taxa</h3>
<p>Number of ASVs that are shared or unique at Piccard and Von Damm</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(FIELD_PA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "FeatureID"
Joining, by = "FeatureID"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>FIELD_PA
 Piccard only Shared across  VonDamm only 
         1861          5535          7277 </code></pre>
</div>
</div>
<p>Number of ASVs that are shared between in situ and incubation experiments</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(EXP_PA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "FeatureID"
Joining, by = "FeatureID"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>EXP_PA
   In situ only Incubation only          Shared 
           6362            5573            2738 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(TYPE_PA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "FeatureID"
Joining, by = "FeatureID"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>TYPE_PA
        Cosmo Non-vent only     Vent only 
         7586          2034          5053 </code></pre>
</div>
</div>
<p>For ASVs shared between in situ and experiment (Tf)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(EXP_PA <span class="sc">==</span> <span class="st">"Shared"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TYPE_PA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "FeatureID"
Joining, by = "FeatureID"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>TYPE_PA
    Cosmo Vent only 
     2488       250 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select(FIELD_PA))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>What is the taxonomic composition of those that are shared between the grazing experiments and in situ?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(asv_wtax_qc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(EXP_PA == "Shared") %&gt;% </span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID, EXP_PA) <span class="sc">%&gt;%</span> </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SUPERGROUP, EXP_PA) <span class="sc">%&gt;%</span> </span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(SAMPLENAME_ORDER = factor(SAMPLENAME, levels = mcr_sample_order)) %&gt;% </span></span>
<span id="cb78-29"><a href="#cb78-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VENT, <span class="at">y =</span> SUM)) <span class="sc">+</span></span>
<span id="cb78-30"><a href="#cb78-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb78-31"><a href="#cb78-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(EXP_PA <span class="sc">~</span> SITE, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb78-32"><a href="#cb78-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb78-33"><a href="#cb78-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb78-34"><a href="#cb78-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining, by = "FeatureID"
Joining, by = "FeatureID"
Joining, by = "FeatureID"
`summarise()` has grouped output by 'SAMPLENAME', 'SITE', 'VENT', 'SAMPLETYPE',
'Taxon', 'FeatureID'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Additional pieces discarded in 22276 rows [3, 17,
18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 32, 33, 34, 35, 36, 37, 38, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 8 pieces. Missing pieces filled with `NA` in 11065 rows [1, 2,
4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 29, 30, 31, 39, 40, ...].</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'SITE', 'VENT', 'SUPERGROUP'. You can
override using the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="in-situ-vs.-tf-relative-changes" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> In situ vs.&nbsp;Tf relative changes</h1>
</section>
<section id="corncob-enriched-taxa" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Corncob enriched taxa</h1>
<p>Corncob analysis can be used to identify specific ASVs that may be enriched when we compare non-vent to vent samples.</p>
<p>Questions:</p>
<ul>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at Piccard?</p></li>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at Von Damm?</p></li>
<li><p>For vent vs.&nbsp;non-vent ASVs, what ASVs are enriched at both sites?</p></li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("bryandmartin/corncob")</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corncob); <span class="fu">library</span>(phyloseq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading objects:
  phylo_obj
  samplenames
  physeq_wnames
  metadata_mcr
  asv_wtax_qc
  TAX
  tax_matrix
  physeq_mcr</code></pre>
</div>
</div>
<p>Explore data input for corncob</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># otu_table(physeq_mcr)[1:10, 1:3]</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(physeq_mcr)</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(physeq_mcr)[1:3, ]</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Designated vent vs. non-vent</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SAMPLETYPE_BIN)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "non-vent" "vent"    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Designats Piccard vs. vondamm.</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SITE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Piccard" "VonDamm"</code></pre>
</div>
</div>
<p>Start by removing incubation samples for now. Subset to eukaryotes only and use phyloseqs tax glom to summarize to Supergroup, Phylum, Class, Order, Genus, &amp; species.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tax_table</span>(physeq_mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Taxonomy Table:     [6 taxa by 8 taxonomic ranks]:
                                 Domain      Supergroup     Phylum            
0c7bdd7d35a3559db857584cecc4f5c9 "Eukaryota" "Opisthokonta" "Choanoflagellida"
7b0dd4c34fe16642ff23b7effa1bf1bd "Eukaryota" "Alveolata"    "Ciliophora"      
dc268dc3fdd431dc0de1fcc60de681f0 "Eukaryota" "Rhizaria"     "Cercozoa"        
08586d1dca4dda0f128d142b85379e0b "Eukaryota" "Apusozoa"     "Apusomonadidae"  
e3bed7480f3f3c95f0f4db2e03cee011 "Eukaryota" "Rhizaria"     "Radiolaria"      
44dcf603d76f712038c8b797beb1282f "Eukaryota" "Alveolata"    "Dinoflagellata"  
                                 Class                   
0c7bdd7d35a3559db857584cecc4f5c9 "Choanoflagellatea"     
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP"             
dc268dc3fdd431dc0de1fcc60de681f0 "Filosa-Thecofilosea"   
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1"
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea"            
44dcf603d76f712038c8b797beb1282f "Syndiniales"           
                                 Order                     
0c7bdd7d35a3559db857584cecc4f5c9 "Acanthoecida"            
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP_X"             
dc268dc3fdd431dc0de1fcc60de681f0 "Ventricleftida"          
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1_X"
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1"            
44dcf603d76f712038c8b797beb1282f "Dino-Group-IV"           
                                 Family                            
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D"          
7b0dd4c34fe16642ff23b7effa1bf1bd "CONThreeP_XX"                    
dc268dc3fdd431dc0de1fcc60de681f0 NA                                
08586d1dca4dda0f128d142b85379e0b "Apusomonadidae_Group-1_XX"       
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_X"                  
44dcf603d76f712038c8b797beb1282f "Dino-Group-IV-Hematodinium-Group"
                                 Genus                     
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D_X"
7b0dd4c34fe16642ff23b7effa1bf1bd NA                        
dc268dc3fdd431dc0de1fcc60de681f0 NA                        
08586d1dca4dda0f128d142b85379e0b NA                        
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_XX"         
44dcf603d76f712038c8b797beb1282f "Hematodinium"            
                                 Species                       
0c7bdd7d35a3559db857584cecc4f5c9 "Stephanoecidae_Group_D_X_sp."
7b0dd4c34fe16642ff23b7effa1bf1bd NA                            
dc268dc3fdd431dc0de1fcc60de681f0 NA                            
08586d1dca4dda0f128d142b85379e0b NA                            
e3bed7480f3f3c95f0f4db2e03cee011 "Acantharea_1_XX_sp."         
44dcf603d76f712038c8b797beb1282f "Hematodinium_sp."            </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>mcr_super <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Supergroup"</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>mcr_phy <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Phylum"</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>mcr_class <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Class"</span>)</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>mcr_order <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Order"</span>)</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>mcr_fam <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Family"</span>)</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>mcr_genera <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Genus"</span>)</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>mcr_spp <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Species"</span>)</span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(mcr_order)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Differential tests in corncob</p>
<p>These tests work to see if taxa are differentially-abundant or variable across a given variable. In this study we have different taxonomic levels, are there more general or species-specific trends? We also have across sample types and site Below set up differential tests across sample types and site (and either or) at different taxonomic levels.</p>
<p>Function to perform specific differential tests across vent fields. Below use <strong>SITE_PICK</strong> parameter to choose between vent fields. Then use the df, to specify the taxonomic level.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>corncob_mcr <span class="ot">&lt;-</span> <span class="cf">function</span>(df_in){</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SAMPLETYPE+ SITE,</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SAMPLETYPE_BIN specifically compares vent to non-vent.</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  da_analysis_output <span class="ot">&lt;-</span> <span class="fu">differentialTest</span>(<span class="at">formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula_null =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula_null =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">test =</span> <span class="st">"Wald"</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> df_in,</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fdr_cutoff =</span> <span class="fl">0.05</span>)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SITE,</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SITE,</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SITE,</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>  list_ofsig <span class="ot">&lt;-</span> <span class="fu">as.character</span>(da_analysis_output<span class="sc">$</span>significant_taxa)</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>  total_number <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ofsig)[<span class="dv">1</span>]</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>  sig_taxa_names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(df_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FEATURE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(FEATURE <span class="sc">%in%</span> list_ofsig) <span class="sc">%&gt;%</span> </span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"NUMBER"</span>)</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_number){</span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>    out_0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(da_analysis_output<span class="sc">$</span>significant_models[[var]]<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">NUMBER =</span> <span class="fu">as.character</span>(var))</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"extracted # "</span>,var, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"extracted_coef"</span>)){</span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> out_0 <span class="co"># create the final count table</span></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extracted_coef, out_0)</span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(out_0) <span class="co"># remove excess df</span></span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>  output_full <span class="ot">&lt;-</span> extracted_coef <span class="sc">%&gt;%</span> </span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"mu."</span>, variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sig_taxa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUMBER"</span> <span class="ot">=</span> <span class="st">"NUMBER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">VARIABLE =</span> <span class="fu">str_remove</span>(variable, <span class="st">"[:digit:]+"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variable) <span class="co">#%&gt;% </span></span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pivot_wider(names_from = VARIABLE, names_glue = "{VARIABLE}_{.value}", values_from = c(Estimate, Std..Error, t.value, Pr...t..))</span></span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(extracted_coef)</span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_full)}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Define SITE_PICK</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>, <span class="st">"VonDamm"</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>picc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Function to visualize output from corncob</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>plot_corn <span class="ot">&lt;-</span> <span class="cf">function</span>(cob_out, LEVEL, TITLE){</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">enquo</span>(LEVEL)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  cob_out <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> level, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> TITLE)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="supergroup-corncob" class="level3">
<h3 class="anchored" data-anchor-id="supergroup-corncob">Supergroup corncob</h3>
<p>What main supergroups are enriched at MCR?</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # vd</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% vd))</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% picc))</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_super <span class="sc">%&gt;%</span> </span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd %&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "VD supergroup")</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc %&gt;%</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "piccard supergroup")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot supergroup enrichment</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Supergroup, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR supergroup"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="phylum-corncob-analysis" class="level3">
<h3 class="anchored" data-anchor-id="phylum-corncob-analysis">Phylum corncob analysis</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_phy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Phylum, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Phylum), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR Phylum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="class-corncob-analysis" class="level3">
<h3 class="anchored" data-anchor-id="class-corncob-analysis">Class corncob analysis</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_class <span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="sc">%&gt;%</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Class, <span class="fu">c</span>(Phylum, Class), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Class, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Class level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<blockquote class="blockquote">
<p>Class level looks pretty good. Keep this one. Looks at major taxonomic groups that were more enriched at vents? Work on the language here. Repeat vent vs.&nbsp;plume at ASV level. ID some of the core ASVs that can help elaborate on what we see above (table in supplementary)</p>
</blockquote>
<blockquote class="blockquote">
<p><em>Interpretation</em> :</p>
</blockquote>
</section>
<section id="order-corncob" class="level3">
<h3 class="anchored" data-anchor-id="order-corncob">Order corncob</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_order)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 
extracted #  17 
extracted #  18 
extracted #  19 
extracted #  20 
extracted #  21 
extracted #  22 
extracted #  23 
extracted #  24 
extracted #  25 
extracted #  26 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Order, <span class="fu">c</span>(Phylum, Class, Order), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Order, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Order level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="960"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?geom_errorbar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="family-corncob" class="level3">
<h3 class="anchored" data-anchor-id="family-corncob">Family corncob</h3>
<p>Plan to pairing with tree below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_fam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 
extracted #  9 
extracted #  10 
extracted #  11 
extracted #  12 
extracted #  13 
extracted #  14 
extracted #  15 
extracted #  16 
extracted #  17 
extracted #  18 
extracted #  19 
extracted #  20 
extracted #  21 
extracted #  22 
extracted #  23 
extracted #  24 
extracted #  25 
extracted #  26 
extracted #  27 
extracted #  28 
extracted #  29 
extracted #  30 
extracted #  31 
extracted #  32 
extracted #  33 
extracted #  34 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Family, <span class="fu">c</span>(Class, Order, Family), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Family, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Phylum <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Family level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="genus-corncob" class="level3">
<h3 class="anchored" data-anchor-id="genus-corncob">Genus corncob</h3>
<p>Plan to pairing with tree below</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_genera)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 
extracted #  6 
extracted #  7 
extracted #  8 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Genus, <span class="fu">c</span>(Phylum, Genus), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Genus, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Genus level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="species-corncob" class="level3">
<h3 class="anchored" data-anchor-id="species-corncob">Species corncob</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_spp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>extracted #  1 
extracted #  2 
extracted #  3 
extracted #  4 
extracted #  5 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Species, <span class="fu">c</span>(Genus, Species), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Species, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Order <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Species level test for differential abundance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="asv-analysis_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="960"></p>
</div>
</div>
</section>
</section>
<section id="corncob-pa-info" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Corncob + P/A info</h1>
<p>Which ASVs were enriched within vent site, and also found in grazing experiments?</p>
</section>
<section id="info" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Info</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.2.1 (2022-06-23)
Platform: x86_64-apple-darwin17.0 (64-bit)
Running under: macOS Big Sur ... 10.16

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib
LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] corncob_0.3.0      compositions_2.0-4 ggdendro_0.1.23    vegan_2.6-2       
 [5] lattice_0.20-45    permute_0.9-7      ggupset_0.3.0      ape_5.6-2         
 [9] phyloseq_1.41.1    forcats_0.5.2      stringr_1.4.1      dplyr_1.0.10      
[13] purrr_0.3.5        readr_2.1.2        tidyr_1.2.1        tibble_3.1.8      
[17] ggplot2_3.3.6      tidyverse_1.3.2   

loaded via a namespace (and not attached):
  [1] VGAM_1.1-7               googledrive_2.0.0        colorspace_2.0-3        
  [4] ellipsis_0.3.2           XVector_0.36.0           fs_1.5.2                
  [7] rstudioapi_0.14          farver_2.1.1             fansi_1.0.3             
 [10] lubridate_1.8.0          xml2_1.3.3               codetools_0.2-18        
 [13] splines_4.2.1            robustbase_0.95-0        knitr_1.40              
 [16] ade4_1.7-19              jsonlite_1.8.0           broom_1.0.1             
 [19] cluster_2.1.4            dbplyr_2.2.1             compiler_4.2.1          
 [22] httr_1.4.4               backports_1.4.1          assertthat_0.2.1        
 [25] Matrix_1.5-1             fastmap_1.1.0            gargle_1.2.1            
 [28] cli_3.4.1                htmltools_0.5.3          tools_4.2.1             
 [31] igraph_1.3.5             ROI.plugin.lpsolve_1.0-1 gtable_0.3.1            
 [34] glue_1.6.2               GenomeInfoDbData_1.2.8   reshape2_1.4.4          
 [37] Rcpp_1.0.9               slam_0.1-50              Biobase_2.56.0          
 [40] cellranger_1.1.0         vctrs_0.5.0              Biostrings_2.64.1       
 [43] rhdf5filters_1.8.0       multtest_2.52.0          nlme_3.1-159            
 [46] iterators_1.0.14         tensorA_0.36.2           xfun_0.33               
 [49] trust_0.1-8              rvest_1.0.3              lifecycle_1.0.3         
 [52] googlesheets4_1.0.1      ROI_1.0-0                DEoptimR_1.0-11         
 [55] zlibbioc_1.42.0          MASS_7.3-58.1            scales_1.2.1            
 [58] hms_1.1.2                parallel_4.2.1           biomformat_1.24.0       
 [61] rhdf5_2.40.0             yaml_2.3.5               stringi_1.7.8           
 [64] S4Vectors_0.34.0         foreach_1.5.2            BiocGenerics_0.42.0     
 [67] detectseparation_0.3     GenomeInfoDb_1.32.4      rlang_1.0.6             
 [70] pkgconfig_2.0.3          bitops_1.0-7             lpSolveAPI_5.5.2.0-17.9 
 [73] evaluate_0.16            Rhdf5lib_1.18.2          htmlwidgets_1.5.4       
 [76] labeling_0.4.2           tidyselect_1.2.0         plyr_1.8.7              
 [79] magrittr_2.0.3           R6_2.5.1                 IRanges_2.30.1          
 [82] generics_0.1.3           DBI_1.1.3                pillar_1.8.1            
 [85] haven_2.5.1              withr_2.5.0              mgcv_1.8-40             
 [88] survival_3.4-0           RCurl_1.98-1.8           bayesm_3.1-4            
 [91] modelr_0.1.9             crayon_1.5.2             utf8_1.2.2              
 [94] tzdb_0.3.0               rmarkdown_2.16           grid_4.2.1              
 [97] readxl_1.4.1             data.table_1.14.2        reprex_2.0.2            
[100] digest_0.6.30            numDeriv_2016.8-1.1      stats4_4.2.1            
[103] munsell_0.5.0            registry_0.5-1          </code></pre>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb121" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "18S rRNA gene amplicon survey"</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a><span class="co">    number-depth: 2</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>Goals for this analysis are to investigate specific protistan taxonomic groups in the context of elevated grazing activity, cell biomass, and hydrothermal vent sample type. </span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>Data originate from in situ MCR samples from a tag-sequence survey and the Tf time point from the grazing experiments. Additionally, in situ and grazing experiments were conducted within vent sites, at the plume, and in the background.</span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a><span class="fu"># Import sequence and metadata</span></span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a>Set up R environment</span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse); <span class="fu">library</span>(phyloseq); <span class="fu">library</span>(ape)</span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggupset)</span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a>Import previously sequenced and analyzed tag-sequence data. See https://shu251.github.io/microeuk-amplicon-survey/ for additional information.</span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a><span class="fu">## Import ASV R objects</span></span>
<span id="cb121-35"><a href="#cb121-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-38"><a href="#cb121-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-39"><a href="#cb121-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb121-40"><a href="#cb121-40" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> T)</span>
<span id="cb121-41"><a href="#cb121-41" aria-hidden="true" tabindex="-1"></a><span class="co"># physeq_mcr</span></span>
<span id="cb121-42"><a href="#cb121-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-43"><a href="#cb121-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-44"><a href="#cb121-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Factor - legend/color key</span></span>
<span id="cb121-45"><a href="#cb121-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-48"><a href="#cb121-48" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-49"><a href="#cb121-49" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>, <span class="st">"Plume"</span>)</span>
<span id="cb121-50"><a href="#cb121-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-51"><a href="#cb121-51" aria-hidden="true" tabindex="-1"></a>vent_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"BSW"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"LotsOShrimp"</span>, <span class="st">"X18"</span>, <span class="st">"OMT"</span>, <span class="st">"OldManTree"</span>, <span class="st">"Rav2"</span>, <span class="st">"MustardStand"</span>, <span class="st">"ShrimpHole"</span>, <span class="st">"WhiteCastle"</span>, <span class="st">"ArrowLoop"</span>)</span>
<span id="cb121-52"><a href="#cb121-52" aria-hidden="true" tabindex="-1"></a>vent_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Background"</span>,<span class="st">"Plume"</span>, <span class="st">"Shrimpocalypse"</span>, <span class="st">"Lots 'O Shrimp"</span>, <span class="st">"X-18"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Old Man Tree"</span>, <span class="st">"Ravelin #2"</span>, <span class="st">"Mustard Stand"</span>, <span class="st">"Shrimp Hole"</span>, <span class="st">"White Castle"</span>, <span class="st">"Arrow Loop"</span>)</span>
<span id="cb121-53"><a href="#cb121-53" aria-hidden="true" tabindex="-1"></a>site_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VD"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb121-54"><a href="#cb121-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-55"><a href="#cb121-55" aria-hidden="true" tabindex="-1"></a>site_fullname <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Von Damm"</span>, <span class="st">"Piccard"</span>)</span>
<span id="cb121-56"><a href="#cb121-56" aria-hidden="true" tabindex="-1"></a>site_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb121-57"><a href="#cb121-57" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(site_color) <span class="ot">&lt;-</span> site_fullname</span>
<span id="cb121-58"><a href="#cb121-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-59"><a href="#cb121-59" aria-hidden="true" tabindex="-1"></a>whole_pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#E9C46A"</span>,<span class="st">"#F4A261"</span>, <span class="st">"#E76F51"</span>)</span>
<span id="cb121-60"><a href="#cb121-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-61"><a href="#cb121-61" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#eae2b7"</span>, <span class="st">"#5f0f40"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#941b0c"</span>, <span class="st">"#577590"</span>)</span>
<span id="cb121-62"><a href="#cb121-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors for VD and Piccard</span></span>
<span id="cb121-63"><a href="#cb121-63" aria-hidden="true" tabindex="-1"></a>site_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#418b84"</span>, <span class="st">"#943b36"</span>)</span>
<span id="cb121-64"><a href="#cb121-64" aria-hidden="true" tabindex="-1"></a><span class="co"># site_colors</span></span>
<span id="cb121-65"><a href="#cb121-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-66"><a href="#cb121-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Vent colors</span></span>
<span id="cb121-67"><a href="#cb121-67" aria-hidden="true" tabindex="-1"></a>vent_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#253494"</span>,<span class="st">"#1d91c0"</span>, <span class="st">"#E9C46A"</span>, <span class="st">"#E76F51"</span>, <span class="st">"#264653"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#90be6d"</span>, <span class="st">"#941b0c"</span>, <span class="st">"#577590"</span>, <span class="st">"#eae2b7"</span>, <span class="st">"#deebf7"</span>)</span>
<span id="cb121-68"><a href="#cb121-68" aria-hidden="true" tabindex="-1"></a><span class="co"># vent_colors &lt;- c("")</span></span>
<span id="cb121-69"><a href="#cb121-69" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vent_colors) <span class="ot">&lt;-</span> vent_fullname</span>
<span id="cb121-70"><a href="#cb121-70" aria-hidden="true" tabindex="-1"></a><span class="co"># all_taxa_color = c("#fa9fb5", "#c51b8a", "#67000d", "#ef3b2c", "#ffffcc", "#feb24c", "#c7e9b4", "#1d91c0", "#deebf7", "#253494", "#9e9ac8", "#238b45", "#54278f", "#bdbdbd", "#252525", "#fa9fb5", "#c51b8a", "#67000d", "#ef3b2c", "#ffffcc", "#feb24c", "#c7e9b4", "#1d91c0", "#253494", "#9e9ac8", "#238b45", "#54278f", "#bdbdbd", "#252525")</span></span>
<span id="cb121-71"><a href="#cb121-71" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-72"><a href="#cb121-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-73"><a href="#cb121-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-74"><a href="#cb121-74" aria-hidden="true" tabindex="-1"></a><span class="fu"># Preliminary look at all samples</span></span>
<span id="cb121-75"><a href="#cb121-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-76"><a href="#cb121-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cluster analysis</span></span>
<span id="cb121-77"><a href="#cb121-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-78"><a href="#cb121-78" aria-hidden="true" tabindex="-1"></a>Ordination analysis and methods to look at whole protistan communities at MCR.</span>
<span id="cb121-79"><a href="#cb121-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-82"><a href="#cb121-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-83"><a href="#cb121-83" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb121-84"><a href="#cb121-84" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan); <span class="fu">library</span>(ggdendro); <span class="fu">library</span>(compositions)</span>
<span id="cb121-85"><a href="#cb121-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-86"><a href="#cb121-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-87"><a href="#cb121-87" aria-hidden="true" tabindex="-1"></a><span class="fu">### with grazing assays</span></span>
<span id="cb121-88"><a href="#cb121-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-91"><a href="#cb121-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-92"><a href="#cb121-92" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb121-93"><a href="#cb121-93" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-94"><a href="#cb121-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-95"><a href="#cb121-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb121-96"><a href="#cb121-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-97"><a href="#cb121-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb121-98"><a href="#cb121-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-99"><a href="#cb121-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb121-100"><a href="#cb121-100" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-101"><a href="#cb121-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-102"><a href="#cb121-102" aria-hidden="true" tabindex="-1"></a>Transform compositional data, center log ratio.</span>
<span id="cb121-103"><a href="#cb121-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-106"><a href="#cb121-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-107"><a href="#cb121-107" aria-hidden="true" tabindex="-1"></a>logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric)))</span>
<span id="cb121-108"><a href="#cb121-108" aria-hidden="true" tabindex="-1"></a><span class="co"># dim(logratio_mcr)</span></span>
<span id="cb121-109"><a href="#cb121-109" aria-hidden="true" tabindex="-1"></a><span class="co"># ?alr()</span></span>
<span id="cb121-110"><a href="#cb121-110" aria-hidden="true" tabindex="-1"></a><span class="co"># ?ilr()</span></span>
<span id="cb121-111"><a href="#cb121-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-112"><a href="#cb121-112" aria-hidden="true" tabindex="-1"></a>pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(logratio_mcr)</span>
<span id="cb121-113"><a href="#cb121-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-114"><a href="#cb121-114" aria-hidden="true" tabindex="-1"></a>variance_logratio <span class="ot">&lt;-</span> (pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb121-115"><a href="#cb121-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-116"><a href="#cb121-116" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb121-117"><a href="#cb121-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span>
<span id="cb121-118"><a href="#cb121-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-119"><a href="#cb121-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-120"><a href="#cb121-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-123"><a href="#cb121-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-124"><a href="#cb121-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points</span></span>
<span id="cb121-125"><a href="#cb121-125" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-126"><a href="#cb121-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-127"><a href="#cb121-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb121-128"><a href="#cb121-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb121-129"><a href="#cb121-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-130"><a href="#cb121-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-131"><a href="#cb121-131" aria-hidden="true" tabindex="-1"></a>PCoA with all samples</span>
<span id="cb121-132"><a href="#cb121-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-133"><a href="#cb121-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=6}</span></span>
<span id="cb121-134"><a href="#cb121-134" aria-hidden="true" tabindex="-1"></a>mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb121-135"><a href="#cb121-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb121-136"><a href="#cb121-136" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-137"><a href="#cb121-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-138"><a href="#cb121-138" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb121-139"><a href="#cb121-139" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb121-140"><a href="#cb121-140" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-141"><a href="#cb121-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb121-142"><a href="#cb121-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> TYPE, <span class="at">fill =</span> VENT_ORDER, <span class="at">alpha =</span> SITE)) <span class="sc">+</span></span>
<span id="cb121-143"><a href="#cb121-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb121-144"><a href="#cb121-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb121-145"><a href="#cb121-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb121-146"><a href="#cb121-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb121-147"><a href="#cb121-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb121-148"><a href="#cb121-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span>
<span id="cb121-149"><a href="#cb121-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-150"><a href="#cb121-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-151"><a href="#cb121-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-152"><a href="#cb121-152" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Dendrogram analysis</span></span>
<span id="cb121-153"><a href="#cb121-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-156"><a href="#cb121-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-157"><a href="#cb121-157" aria-hidden="true" tabindex="-1"></a><span class="co"># ?decostand()</span></span>
<span id="cb121-158"><a href="#cb121-158" aria-hidden="true" tabindex="-1"></a><span class="co"># Relative abundance</span></span>
<span id="cb121-159"><a href="#cb121-159" aria-hidden="true" tabindex="-1"></a>rel_abun <span class="ot">&lt;-</span> <span class="fu">decostand</span>(asv_mcr_numeric, <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="at">method =</span> <span class="st">"total"</span>)</span>
<span id="cb121-160"><a href="#cb121-160" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster dendrogram (average hierarchical clustering)</span></span>
<span id="cb121-161"><a href="#cb121-161" aria-hidden="true" tabindex="-1"></a>cluster_mcr <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(<span class="fu">t</span>(rel_abun)), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb121-162"><a href="#cb121-162" aria-hidden="true" tabindex="-1"></a>dendro <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(cluster_mcr)</span>
<span id="cb121-163"><a href="#cb121-163" aria-hidden="true" tabindex="-1"></a>mcr_dendro <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(dendro, <span class="at">type =</span> <span class="st">"rectangle"</span>)</span>
<span id="cb121-164"><a href="#cb121-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-165"><a href="#cb121-165" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-166"><a href="#cb121-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-167"><a href="#cb121-167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=4}</span></span>
<span id="cb121-168"><a href="#cb121-168" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">segment</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb121-169"><a href="#cb121-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">xend =</span> xend, </span>
<span id="cb121-170"><a href="#cb121-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">yend =</span> yend)) <span class="sc">+</span> </span>
<span id="cb121-171"><a href="#cb121-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb121-172"><a href="#cb121-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb121-173"><a href="#cb121-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="at">data =</span> <span class="fu">label</span>(mcr_dendro)) <span class="sc">+</span></span>
<span id="cb121-174"><a href="#cb121-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dendro</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Dissimilarity"</span>) <span class="sc">+</span></span>
<span id="cb121-175"><a href="#cb121-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">14</span>), <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#252525"</span>), </span>
<span id="cb121-176"><a href="#cb121-176" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_line</span>(), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb121-177"><a href="#cb121-177" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb121-178"><a href="#cb121-178" aria-hidden="true" tabindex="-1"></a><span class="co"># svg('figs/SUPPLEMENTARY-dendrogram-wreps.svg', w = 10, h = 8)</span></span>
<span id="cb121-179"><a href="#cb121-179" aria-hidden="true" tabindex="-1"></a>mcr_dendro_plot</span>
<span id="cb121-180"><a href="#cb121-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-181"><a href="#cb121-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-182"><a href="#cb121-182" aria-hidden="true" tabindex="-1"></a><span class="fu">### insitu only</span></span>
<span id="cb121-183"><a href="#cb121-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-184"><a href="#cb121-184" aria-hidden="true" tabindex="-1"></a>PCoA with in situ only</span>
<span id="cb121-185"><a href="#cb121-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-188"><a href="#cb121-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-189"><a href="#cb121-189" aria-hidden="true" tabindex="-1"></a>asv_mcr_numeric_insitu <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-190"><a href="#cb121-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-191"><a href="#cb121-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-192"><a href="#cb121-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(FeatureID, SAMPLENAME) <span class="sc">%&gt;%</span> </span>
<span id="cb121-193"><a href="#cb121-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MEAN_ACROSS_REPS =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-194"><a href="#cb121-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLENAME, MEAN_ACROSS_REPS) <span class="sc">%&gt;%</span> </span>
<span id="cb121-195"><a href="#cb121-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLENAME, <span class="at">values_from =</span> MEAN_ACROSS_REPS, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-196"><a href="#cb121-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="at">var =</span> <span class="st">"FeatureID"</span>)</span>
<span id="cb121-197"><a href="#cb121-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-198"><a href="#cb121-198" aria-hidden="true" tabindex="-1"></a>insitu_logratio_mcr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(compositions<span class="sc">::</span><span class="fu">clr</span>(<span class="fu">t</span>(asv_mcr_numeric_insitu)))</span>
<span id="cb121-199"><a href="#cb121-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-200"><a href="#cb121-200" aria-hidden="true" tabindex="-1"></a>insitu_pca_logratio <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(insitu_logratio_mcr)</span>
<span id="cb121-201"><a href="#cb121-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-202"><a href="#cb121-202" aria-hidden="true" tabindex="-1"></a>insitu_variance_logratio <span class="ot">&lt;-</span> (insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">sum</span>(insitu_pca_logratio<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb121-203"><a href="#cb121-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-204"><a href="#cb121-204" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(insitu_variance_logratio, <span class="at">main =</span> <span class="st">"Log-Ratio PCA Screeplot"</span>, <span class="at">xlab =</span> <span class="st">"PC Axis"</span>, <span class="at">ylab =</span> <span class="st">"% Variance"</span>, </span>
<span id="cb121-205"><a href="#cb121-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">cex.names =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.main =</span> <span class="fl">1.5</span>)</span>
<span id="cb121-206"><a href="#cb121-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-207"><a href="#cb121-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-210"><a href="#cb121-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-211"><a href="#cb121-211" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract PCA points for only insitu samples</span></span>
<span id="cb121-212"><a href="#cb121-212" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(insitu_pca_logratio<span class="sc">$</span>x, <span class="at">SAMPLE =</span> <span class="fu">rownames</span>(insitu_pca_logratio<span class="sc">$</span>x)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-213"><a href="#cb121-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"SAMPLENAME"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-214"><a href="#cb121-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"VENT"</span>), <span class="st">" "</span>, </span>
<span id="cb121-215"><a href="#cb121-215" aria-hidden="true" tabindex="-1"></a>        <span class="at">remove =</span> <span class="cn">FALSE</span>) </span>
<span id="cb121-216"><a href="#cb121-216" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-217"><a href="#cb121-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-218"><a href="#cb121-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=5, fig.width=6}</span></span>
<span id="cb121-219"><a href="#cb121-219" aria-hidden="true" tabindex="-1"></a>insitu_mcr_pca_pts <span class="sc">%&gt;%</span> </span>
<span id="cb121-220"><a href="#cb121-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENT_ORDER =</span> <span class="fu">factor</span>(VENT, <span class="at">levels =</span> vent_ids, <span class="at">labels =</span> vent_fullname),</span>
<span id="cb121-221"><a href="#cb121-221" aria-hidden="true" tabindex="-1"></a>         <span class="at">SITE_ORDER =</span> <span class="fu">factor</span>(SITE, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>, <span class="st">"Piccard"</span>), <span class="at">labels =</span> site_fullname)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-222"><a href="#cb121-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-223"><a href="#cb121-223" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb121-224"><a href="#cb121-224" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb121-225"><a href="#cb121-225" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-226"><a href="#cb121-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb121-227"><a href="#cb121-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">stroke =</span> <span class="fl">1.3</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> SITE_ORDER, <span class="at">fill =</span> VENT_ORDER)) <span class="sc">+</span></span>
<span id="cb121-228"><a href="#cb121-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb121-229"><a href="#cb121-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> vent_colors) <span class="sc">+</span></span>
<span id="cb121-230"><a href="#cb121-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb121-231"><a href="#cb121-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="fu">c</span>(<span class="dv">22</span>)))) <span class="sc">+</span></span>
<span id="cb121-232"><a href="#cb121-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>)</span>
<span id="cb121-233"><a href="#cb121-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-234"><a href="#cb121-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-235"><a href="#cb121-235" aria-hidden="true" tabindex="-1"></a><span class="fu">## Community taxonomic composition (richness &amp; sequence relative abundance)</span></span>
<span id="cb121-236"><a href="#cb121-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-239"><a href="#cb121-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-240"><a href="#cb121-240" aria-hidden="true" tabindex="-1"></a>out_labels <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(mcr_dendro<span class="sc">$</span>labels)</span>
<span id="cb121-241"><a href="#cb121-241" aria-hidden="true" tabindex="-1"></a>mcr_sample_order <span class="ot">&lt;-</span> <span class="fu">as.character</span>(out_labels<span class="sc">$</span>label)</span>
<span id="cb121-242"><a href="#cb121-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-243"><a href="#cb121-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-244"><a href="#cb121-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=11}</span></span>
<span id="cb121-245"><a href="#cb121-245" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb121-246"><a href="#cb121-246" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb121-247"><a href="#cb121-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-248"><a href="#cb121-248" aria-hidden="true" tabindex="-1"></a>bubble <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-249"><a href="#cb121-249" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-250"><a href="#cb121-250" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb121-251"><a href="#cb121-251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb121-252"><a href="#cb121-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-253"><a href="#cb121-253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb121-254"><a href="#cb121-254" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb121-255"><a href="#cb121-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb121-256"><a href="#cb121-256" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb121-257"><a href="#cb121-257" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-258"><a href="#cb121-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb121-259"><a href="#cb121-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb121-260"><a href="#cb121-260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb121-261"><a href="#cb121-261" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb121-262"><a href="#cb121-262" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb121-263"><a href="#cb121-263" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-264"><a href="#cb121-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-265"><a href="#cb121-265" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb121-266"><a href="#cb121-266" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb121-267"><a href="#cb121-267" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb121-268"><a href="#cb121-268" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb121-269"><a href="#cb121-269" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb121-270"><a href="#cb121-270" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb121-271"><a href="#cb121-271" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb121-272"><a href="#cb121-272" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb121-273"><a href="#cb121-273" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-274"><a href="#cb121-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb121-275"><a href="#cb121-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb121-276"><a href="#cb121-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE) <span class="sc">%&gt;%</span> </span>
<span id="cb121-277"><a href="#cb121-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">TOTAL_SEQ =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-278"><a href="#cb121-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb121-279"><a href="#cb121-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb121-280"><a href="#cb121-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq),</span>
<span id="cb121-281"><a href="#cb121-281" aria-hidden="true" tabindex="-1"></a>            <span class="at">REL_ABUN =</span> SUM<span class="sc">/</span>TOTAL_SEQ) <span class="sc">%&gt;%</span> </span>
<span id="cb121-282"><a href="#cb121-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-283"><a href="#cb121-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUPERGROUP, <span class="at">size =</span> REL_ABUN)) <span class="sc">+</span></span>
<span id="cb121-284"><a href="#cb121-284" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="fu">aes</span>(<span class="at">size =</span> REL_ABUN, <span class="at">fill =</span> SUPERGROUP, <span class="at">alpha =</span> <span class="fl">0.4</span>)) <span class="sc">+</span></span>
<span id="cb121-285"><a href="#cb121-285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">14</span>)) <span class="sc">+</span></span>
<span id="cb121-286"><a href="#cb121-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># facet_grid(. ~ SITE, scales = "free", space = "free") +</span></span>
<span id="cb121-287"><a href="#cb121-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span><span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb121-288"><a href="#cb121-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb121-289"><a href="#cb121-289" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb121-290"><a href="#cb121-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-291"><a href="#cb121-291" aria-hidden="true" tabindex="-1"></a>bubble</span>
<span id="cb121-292"><a href="#cb121-292" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-293"><a href="#cb121-293" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dendrogram with bubble plot</span></span>
<span id="cb121-294"><a href="#cb121-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-295"><a href="#cb121-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=20, fig.height=11}</span></span>
<span id="cb121-296"><a href="#cb121-296" aria-hidden="true" tabindex="-1"></a><span class="co"># mcr_dendro_plot + bubble + patchwork::plot_layout(ncol = 2) + patchwork::plot_annotation(tag_levels = "a")</span></span>
<span id="cb121-297"><a href="#cb121-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-298"><a href="#cb121-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-299"><a href="#cb121-299" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relative abundance</span></span>
<span id="cb121-300"><a href="#cb121-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-303"><a href="#cb121-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-304"><a href="#cb121-304" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb121-305"><a href="#cb121-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-306"><a href="#cb121-306" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-307"><a href="#cb121-307" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-308"><a href="#cb121-308" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Avg seq count by ASV across replicates</span></span>
<span id="cb121-309"><a href="#cb121-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID) <span class="sc">%&gt;%</span> </span>
<span id="cb121-310"><a href="#cb121-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-311"><a href="#cb121-311" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate and curate taxa information</span></span>
<span id="cb121-312"><a href="#cb121-312" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(SAMPLETYPE != "Incubation") %&gt;% </span></span>
<span id="cb121-313"><a href="#cb121-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb121-314"><a href="#cb121-314" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb121-315"><a href="#cb121-315" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-316"><a href="#cb121-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb121-317"><a href="#cb121-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb121-318"><a href="#cb121-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb121-319"><a href="#cb121-319" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb121-320"><a href="#cb121-320" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb121-321"><a href="#cb121-321" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-322"><a href="#cb121-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-323"><a href="#cb121-323" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb121-324"><a href="#cb121-324" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb121-325"><a href="#cb121-325" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb121-326"><a href="#cb121-326" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb121-327"><a href="#cb121-327" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb121-328"><a href="#cb121-328" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb121-329"><a href="#cb121-329" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb121-330"><a href="#cb121-330" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb121-331"><a href="#cb121-331" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-332"><a href="#cb121-332" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb121-333"><a href="#cb121-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb121-334"><a href="#cb121-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, SUPERGROUP) <span class="sc">%&gt;%</span> </span>
<span id="cb121-335"><a href="#cb121-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-336"><a href="#cb121-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SAMPLENAME_ORDER =</span> <span class="fu">factor</span>(SAMPLENAME, <span class="at">levels =</span> mcr_sample_order)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-337"><a href="#cb121-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLENAME_ORDER, <span class="at">y =</span> SUM)) <span class="sc">+</span></span>
<span id="cb121-338"><a href="#cb121-338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb121-339"><a href="#cb121-339" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VENT <span class="sc">+</span> SITE, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-340"><a href="#cb121-340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-341"><a href="#cb121-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb121-342"><a href="#cb121-342" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb121-343"><a href="#cb121-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-344"><a href="#cb121-344" aria-hidden="true" tabindex="-1"></a>In bar plot above, in situ and Tf incubation samples are paired for each site.</span>
<span id="cb121-345"><a href="#cb121-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-346"><a href="#cb121-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-347"><a href="#cb121-347" aria-hidden="true" tabindex="-1"></a><span class="fu"># ASV overlap comparison</span></span>
<span id="cb121-348"><a href="#cb121-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-351"><a href="#cb121-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-352"><a href="#cb121-352" aria-hidden="true" tabindex="-1"></a><span class="co"># load("input-data/MCR-amplicon-data.RData", verbose=TRUE)</span></span>
<span id="cb121-353"><a href="#cb121-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-354"><a href="#cb121-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-355"><a href="#cb121-355" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supergroup to phylum level comparisons</span></span>
<span id="cb121-356"><a href="#cb121-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-357"><a href="#cb121-357" aria-hidden="true" tabindex="-1"></a>Generate upsetR plots with varied taxonomic levels.</span>
<span id="cb121-358"><a href="#cb121-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-359"><a href="#cb121-359" aria-hidden="true" tabindex="-1"></a>Questions:</span>
<span id="cb121-360"><a href="#cb121-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-361"><a href="#cb121-361" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How which major supergroups and phyla are shared among vent sites within Von Damm and Piccard?</span>
<span id="cb121-362"><a href="#cb121-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-363"><a href="#cb121-363" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=8, fig.width=11}</span></span>
<span id="cb121-364"><a href="#cb121-364" aria-hidden="true" tabindex="-1"></a><span class="co"># options for taxa: SupergroupPhylum, Supergroup, Phylum, Class, Order, Family, Genus, Species</span></span>
<span id="cb121-365"><a href="#cb121-365" aria-hidden="true" tabindex="-1"></a>alv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Alveolata-Ellobiopsidae"</span>, <span class="st">"Alveolata-Perkinsea"</span>, <span class="st">"Alveolata-Unknown"</span>, <span class="st">"Alveolata-Chrompodellids"</span>, <span class="st">"Alveolata-Apicomplexa"</span>)</span>
<span id="cb121-366"><a href="#cb121-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-367"><a href="#cb121-367" aria-hidden="true" tabindex="-1"></a>all_taxa_color <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#deebf7"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>, <span class="st">"#fa9fb5"</span>, <span class="st">"#c51b8a"</span>, <span class="st">"#67000d"</span>, <span class="st">"#ef3b2c"</span>, <span class="st">"#ffffcc"</span>, <span class="st">"#feb24c"</span>, <span class="st">"#c7e9b4"</span>, <span class="st">"#1d91c0"</span>, <span class="st">"#253494"</span>, <span class="st">"#9e9ac8"</span>, <span class="st">"#238b45"</span>, <span class="st">"#54278f"</span>, <span class="st">"#bdbdbd"</span>, <span class="st">"#252525"</span>)</span>
<span id="cb121-368"><a href="#cb121-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-369"><a href="#cb121-369" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-370"><a href="#cb121-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-371"><a href="#cb121-371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-372"><a href="#cb121-372" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb121-373"><a href="#cb121-373" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb121-374"><a href="#cb121-374" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-375"><a href="#cb121-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb121-376"><a href="#cb121-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb121-377"><a href="#cb121-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb121-378"><a href="#cb121-378" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb121-379"><a href="#cb121-379" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb121-380"><a href="#cb121-380" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-381"><a href="#cb121-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-382"><a href="#cb121-382" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb121-383"><a href="#cb121-383" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb121-384"><a href="#cb121-384" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb121-385"><a href="#cb121-385" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb121-386"><a href="#cb121-386" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb121-387"><a href="#cb121-387" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb121-388"><a href="#cb121-388" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb121-389"><a href="#cb121-389" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb121-390"><a href="#cb121-390" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-391"><a href="#cb121-391" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb121-392"><a href="#cb121-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb121-393"><a href="#cb121-393" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb121-394"><a href="#cb121-394" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb121-395"><a href="#cb121-395" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-396"><a href="#cb121-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb121-397"><a href="#cb121-397" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-398"><a href="#cb121-398" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb121-399"><a href="#cb121-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-400"><a href="#cb121-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb121-401"><a href="#cb121-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-402"><a href="#cb121-402" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-403"><a href="#cb121-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb121-404"><a href="#cb121-404" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb121-405"><a href="#cb121-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb121-406"><a href="#cb121-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-407"><a href="#cb121-407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum) <span class="sc">%&gt;%</span> </span>
<span id="cb121-408"><a href="#cb121-408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-409"><a href="#cb121-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb121-410"><a href="#cb121-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb121-411"><a href="#cb121-411" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb121-412"><a href="#cb121-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb121-413"><a href="#cb121-413" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb121-414"><a href="#cb121-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb121-415"><a href="#cb121-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb121-416"><a href="#cb121-416" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb121-417"><a href="#cb121-417" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb121-418"><a href="#cb121-418" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb121-419"><a href="#cb121-419" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-420"><a href="#cb121-420" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-421"><a href="#cb121-421" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb121-422"><a href="#cb121-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span>
<span id="cb121-423"><a href="#cb121-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-424"><a href="#cb121-424" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data to reduce noise and show sample type to vent ecosystem variability.</span></span>
<span id="cb121-425"><a href="#cb121-425" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb121-426"><a href="#cb121-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-427"><a href="#cb121-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-428"><a href="#cb121-428" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=15, fig.height=12}</span></span>
<span id="cb121-429"><a href="#cb121-429" aria-hidden="true" tabindex="-1"></a>asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-430"><a href="#cb121-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-431"><a href="#cb121-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SAMPLETYPE <span class="sc">!=</span> <span class="st">"Incubation"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-432"><a href="#cb121-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb121-433"><a href="#cb121-433" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb121-434"><a href="#cb121-434" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-435"><a href="#cb121-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb121-436"><a href="#cb121-436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb121-437"><a href="#cb121-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb121-438"><a href="#cb121-438" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb121-439"><a href="#cb121-439" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb121-440"><a href="#cb121-440" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-441"><a href="#cb121-441" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-442"><a href="#cb121-442" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb121-443"><a href="#cb121-443" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb121-444"><a href="#cb121-444" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb121-445"><a href="#cb121-445" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb121-446"><a href="#cb121-446" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb121-447"><a href="#cb121-447" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb121-448"><a href="#cb121-448" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb121-449"><a href="#cb121-449" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb121-450"><a href="#cb121-450" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-451"><a href="#cb121-451" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Taxa to supergroup</span></span>
<span id="cb121-452"><a href="#cb121-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SupergroupPhylum =</span> SUPERGROUP) <span class="sc">%&gt;%</span> <span class="co">#add modified "supergroup-phylum category"</span></span>
<span id="cb121-453"><a href="#cb121-453" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average across replicates</span></span>
<span id="cb121-454"><a href="#cb121-454" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(FeatureID, SAMPLENAME, VENT, SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb121-455"><a href="#cb121-455" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">AVG =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-456"><a href="#cb121-456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb121-457"><a href="#cb121-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(SAMPLENAME, <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"SAMPLETYPE"</span>, <span class="st">"YEAR"</span>, <span class="st">"Sample_tmp"</span>), <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-458"><a href="#cb121-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REGION =</span> <span class="st">"Mid-Cayman Rise"</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb121-459"><a href="#cb121-459" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">VENTNAME =</span> <span class="fu">paste</span>(SITE, VENT, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-460"><a href="#cb121-460" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>Sample_tmp) <span class="sc">%&gt;%</span> </span>
<span id="cb121-461"><a href="#cb121-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(SAMPLE, SITE, SAMPLETYPE, VENT, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-462"><a href="#cb121-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon, SAMPLE) <span class="sc">%&gt;%</span> </span>
<span id="cb121-463"><a href="#cb121-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(AVG)) <span class="sc">%&gt;%</span></span>
<span id="cb121-464"><a href="#cb121-464" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb121-465"><a href="#cb121-465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Taxon, SupergroupPhylum, SUM, SAMPLE, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-466"><a href="#cb121-466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SupergroupPhylum, Taxon) <span class="sc">%&gt;%</span> </span>
<span id="cb121-467"><a href="#cb121-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SAMPLE =</span> <span class="fu">list</span>(SAMPLE)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-468"><a href="#cb121-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SAMPLE)) <span class="sc">+</span></span>
<span id="cb121-469"><a href="#cb121-469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.7</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SupergroupPhylum)) <span class="sc">+</span></span>
<span id="cb121-470"><a href="#cb121-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb121-471"><a href="#cb121-471" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb121-472"><a href="#cb121-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Shared at taxonomic level"</span>) <span class="sc">+</span></span>
<span id="cb121-473"><a href="#cb121-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_linedraw</span>() <span class="sc">+</span></span>
<span id="cb121-474"><a href="#cb121-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb121-475"><a href="#cb121-475" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb121-476"><a href="#cb121-476" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">"black"</span>, <span class="at">size=</span><span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb121-477"><a href="#cb121-477" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb121-478"><a href="#cb121-478" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-479"><a href="#cb121-479" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-480"><a href="#cb121-480" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span> </span>
<span id="cb121-481"><a href="#cb121-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> all_taxa_color)</span>
<span id="cb121-482"><a href="#cb121-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-483"><a href="#cb121-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-484"><a href="#cb121-484" aria-hidden="true" tabindex="-1"></a><span class="fu">## ASVs shared across MCR vents</span></span>
<span id="cb121-485"><a href="#cb121-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-486"><a href="#cb121-486" aria-hidden="true" tabindex="-1"></a>ID ASVs that are shared across Piccard and Von Damm, and those that are shared at vent and non-vent samples.</span>
<span id="cb121-487"><a href="#cb121-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-490"><a href="#cb121-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-491"><a href="#cb121-491" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span>
<span id="cb121-492"><a href="#cb121-492" aria-hidden="true" tabindex="-1"></a>shared_across <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-493"><a href="#cb121-493" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-494"><a href="#cb121-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, SAMPLETYPE, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb121-495"><a href="#cb121-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-496"><a href="#cb121-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb121-497"><a href="#cb121-497" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SITE, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb121-498"><a href="#cb121-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FIELD_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-499"><a href="#cb121-499" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(Piccard) <span class="sc">~</span> <span class="st">"VonDamm only"</span>,</span>
<span id="cb121-500"><a href="#cb121-500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">is.na</span>(VonDamm) <span class="sc">~</span> <span class="st">"Piccard only"</span>,</span>
<span id="cb121-501"><a href="#cb121-501" aria-hidden="true" tabindex="-1"></a>    (VonDamm <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> Piccard <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Shared across"</span></span>
<span id="cb121-502"><a href="#cb121-502" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-503"><a href="#cb121-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, FIELD_PA)</span>
<span id="cb121-504"><a href="#cb121-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-505"><a href="#cb121-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-506"><a href="#cb121-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-509"><a href="#cb121-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-510"><a href="#cb121-510" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asv_wtax_qc)</span>
<span id="cb121-511"><a href="#cb121-511" aria-hidden="true" tabindex="-1"></a>shared_type <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-512"><a href="#cb121-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-513"><a href="#cb121-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, SAMPLETYPE, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb121-514"><a href="#cb121-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-515"><a href="#cb121-515" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SAMPLETYPE_BIN, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb121-516"><a href="#cb121-516" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> SAMPLETYPE_BIN, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb121-517"><a href="#cb121-517" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TYPE_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-518"><a href="#cb121-518" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">non-vent</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> vent <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Cosmo"</span>,</span>
<span id="cb121-519"><a href="#cb121-519" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">non-vent</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Vent only"</span>,</span>
<span id="cb121-520"><a href="#cb121-520" aria-hidden="true" tabindex="-1"></a>    vent <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Non-vent only"</span>,</span>
<span id="cb121-521"><a href="#cb121-521" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-522"><a href="#cb121-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, TYPE_PA)</span>
<span id="cb121-523"><a href="#cb121-523" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(shared_type)</span>
<span id="cb121-524"><a href="#cb121-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-525"><a href="#cb121-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-526"><a href="#cb121-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-527"><a href="#cb121-527" aria-hidden="true" tabindex="-1"></a><span class="fu">## ASVs shared in situ &amp; Tf for each experiment</span></span>
<span id="cb121-528"><a href="#cb121-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-531"><a href="#cb121-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-532"><a href="#cb121-532" aria-hidden="true" tabindex="-1"></a><span class="co"># head(asv_wtax_qc)</span></span>
<span id="cb121-533"><a href="#cb121-533" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(asv_wtax_qc$SAMPLETYPE)</span></span>
<span id="cb121-534"><a href="#cb121-534" aria-hidden="true" tabindex="-1"></a>shared_exp <span class="ot">&lt;-</span> asv_wtax_qc <span class="sc">%&gt;%</span> </span>
<span id="cb121-535"><a href="#cb121-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-536"><a href="#cb121-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXP_BIN =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-537"><a href="#cb121-537" aria-hidden="true" tabindex="-1"></a>    SAMPLETYPE <span class="sc">==</span> <span class="st">"Incubation"</span> <span class="sc">~</span> <span class="st">"Incubation"</span>,</span>
<span id="cb121-538"><a href="#cb121-538" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"in situ"</span></span>
<span id="cb121-539"><a href="#cb121-539" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-540"><a href="#cb121-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, SITE, EXP_BIN, SAMPLETYPE_BIN, VENT) <span class="sc">%&gt;%</span> </span>
<span id="cb121-541"><a href="#cb121-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">PRESENCE =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-542"><a href="#cb121-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, EXP_BIN, SITE, VENT, PRESENCE) <span class="sc">%&gt;%</span> </span>
<span id="cb121-543"><a href="#cb121-543" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> EXP_BIN, <span class="at">values_from =</span> PRESENCE, <span class="at">values_fn =</span> sum) <span class="sc">%&gt;%</span> </span>
<span id="cb121-544"><a href="#cb121-544" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXP_PA =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-545"><a href="#cb121-545" aria-hidden="true" tabindex="-1"></a>    (<span class="st">`</span><span class="at">in situ</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> Incubation <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">~</span> <span class="st">"Shared"</span>,</span>
<span id="cb121-546"><a href="#cb121-546" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">in situ</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"In situ only"</span>,</span>
<span id="cb121-547"><a href="#cb121-547" aria-hidden="true" tabindex="-1"></a>    Incubation <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Incubation only"</span>,</span>
<span id="cb121-548"><a href="#cb121-548" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-549"><a href="#cb121-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(FeatureID, EXP_PA)</span>
<span id="cb121-550"><a href="#cb121-550" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-551"><a href="#cb121-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-552"><a href="#cb121-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-553"><a href="#cb121-553" aria-hidden="true" tabindex="-1"></a><span class="fu">### Table to present shared ASVs and taxa</span></span>
<span id="cb121-554"><a href="#cb121-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-555"><a href="#cb121-555" aria-hidden="true" tabindex="-1"></a>Number of ASVs that are shared or unique at Piccard and Von Damm</span>
<span id="cb121-558"><a href="#cb121-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-559"><a href="#cb121-559" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb121-560"><a href="#cb121-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(FIELD_PA))</span>
<span id="cb121-561"><a href="#cb121-561" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-562"><a href="#cb121-562" aria-hidden="true" tabindex="-1"></a>Number of ASVs that are shared between in situ and incubation experiments</span>
<span id="cb121-565"><a href="#cb121-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-566"><a href="#cb121-566" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb121-567"><a href="#cb121-567" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(EXP_PA))</span>
<span id="cb121-568"><a href="#cb121-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-571"><a href="#cb121-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-572"><a href="#cb121-572" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb121-573"><a href="#cb121-573" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> <span class="fu">select</span>(TYPE_PA))</span>
<span id="cb121-574"><a href="#cb121-574" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-575"><a href="#cb121-575" aria-hidden="true" tabindex="-1"></a>For ASVs shared between in situ and experiment (Tf)</span>
<span id="cb121-578"><a href="#cb121-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-579"><a href="#cb121-579" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb121-580"><a href="#cb121-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb121-581"><a href="#cb121-581" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(EXP_PA <span class="sc">==</span> <span class="st">"Shared"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-582"><a href="#cb121-582" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(TYPE_PA))</span>
<span id="cb121-583"><a href="#cb121-583" aria-hidden="true" tabindex="-1"></a>    <span class="co"># select(FIELD_PA))</span></span>
<span id="cb121-584"><a href="#cb121-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-585"><a href="#cb121-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-586"><a href="#cb121-586" aria-hidden="true" tabindex="-1"></a>What is the taxonomic composition of those that are shared between the grazing experiments and in situ?</span>
<span id="cb121-587"><a href="#cb121-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=7}</span></span>
<span id="cb121-588"><a href="#cb121-588" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(shared_across, shared_exp) <span class="sc">%&gt;%</span> </span>
<span id="cb121-589"><a href="#cb121-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(shared_type) <span class="sc">%&gt;%</span> </span>
<span id="cb121-590"><a href="#cb121-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(asv_wtax_qc <span class="sc">%&gt;%</span> <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-591"><a href="#cb121-591" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(EXP_PA == "Shared") %&gt;% </span></span>
<span id="cb121-592"><a href="#cb121-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAMPLENAME, SITE, VENT, SAMPLETYPE, Taxon, FeatureID, EXP_PA) <span class="sc">%&gt;%</span> </span>
<span id="cb121-593"><a href="#cb121-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_seq =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-594"><a href="#cb121-594" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Taxon, <span class="fu">c</span>(<span class="st">"Domain"</span>, <span class="st">"Supergroup"</span>, </span>
<span id="cb121-595"><a href="#cb121-595" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Phylum"</span>, <span class="st">"Class"</span>, <span class="st">"Order"</span>,</span>
<span id="cb121-596"><a href="#cb121-596" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Family"</span>, <span class="st">"Genus"</span>, <span class="st">"Species"</span>), <span class="at">sep =</span> <span class="st">";"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-597"><a href="#cb121-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> <span class="co">#select eukaryotes only</span></span>
<span id="cb121-598"><a href="#cb121-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Supergroup <span class="sc">!=</span> <span class="st">"Opisthokonta"</span>) <span class="sc">%&gt;%</span> <span class="co"># remove multicellular metazoa</span></span>
<span id="cb121-599"><a href="#cb121-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Supergroup =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Supergroup), <span class="st">"Unknown Eukaryota"</span>, Supergroup),</span>
<span id="cb121-600"><a href="#cb121-600" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(Phylum), <span class="st">"Unknown"</span>, Phylum),</span>
<span id="cb121-601"><a href="#cb121-601" aria-hidden="true" tabindex="-1"></a>         <span class="at">Phylum =</span> <span class="fu">ifelse</span>(Phylum <span class="sc">==</span> <span class="st">"Alveolata_X"</span>, <span class="st">"Ellobiopsidae"</span>, Phylum),</span>
<span id="cb121-602"><a href="#cb121-602" aria-hidden="true" tabindex="-1"></a>         <span class="at">Supergroup =</span> <span class="fu">ifelse</span>(Supergroup <span class="sc">==</span> <span class="st">"Alveolata"</span>, <span class="fu">paste</span>(Supergroup, Phylum, <span class="at">sep =</span> <span class="st">"-"</span>), Supergroup)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-603"><a href="#cb121-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SUPERGROUP =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-604"><a href="#cb121-604" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">%in%</span> alv <span class="sc">~</span> <span class="st">"Other Alveolata"</span>,</span>
<span id="cb121-605"><a href="#cb121-605" aria-hidden="true" tabindex="-1"></a>    Supergroup <span class="sc">==</span> <span class="st">"Eukaryota_X"</span> <span class="sc">~</span> <span class="st">"Unknown Eukaryota"</span>,</span>
<span id="cb121-606"><a href="#cb121-606" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Cercozoa"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Cercozoa"</span>,</span>
<span id="cb121-607"><a href="#cb121-607" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Radiolaria"</span> <span class="sc">~</span> <span class="st">"Rhizaria-Radiolaria"</span>,</span>
<span id="cb121-608"><a href="#cb121-608" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Ochrophyta"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Ochrophyta"</span>,</span>
<span id="cb121-609"><a href="#cb121-609" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Opalozoa"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Opalozoa"</span>,</span>
<span id="cb121-610"><a href="#cb121-610" aria-hidden="true" tabindex="-1"></a>    Phylum <span class="sc">==</span> <span class="st">"Sagenista"</span> <span class="sc">~</span> <span class="st">"Stramenopiles-Sagenista"</span>,</span>
<span id="cb121-611"><a href="#cb121-611" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> Supergroup</span>
<span id="cb121-612"><a href="#cb121-612" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb121-613"><a href="#cb121-613" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SITE, VENT, SUPERGROUP, EXP_PA) <span class="sc">%&gt;%</span> </span>
<span id="cb121-614"><a href="#cb121-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">SUM =</span> <span class="fu">sum</span>(avg_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-615"><a href="#cb121-615" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(SAMPLENAME_ORDER = factor(SAMPLENAME, levels = mcr_sample_order)) %&gt;% </span></span>
<span id="cb121-616"><a href="#cb121-616" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> VENT, <span class="at">y =</span> SUM)) <span class="sc">+</span></span>
<span id="cb121-617"><a href="#cb121-617" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="fu">aes</span>(<span class="at">fill =</span> SUPERGROUP)) <span class="sc">+</span></span>
<span id="cb121-618"><a href="#cb121-618" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(EXP_PA <span class="sc">~</span> SITE, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-619"><a href="#cb121-619" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-620"><a href="#cb121-620" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb121-621"><a href="#cb121-621" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>))</span>
<span id="cb121-622"><a href="#cb121-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-623"><a href="#cb121-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-624"><a href="#cb121-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-625"><a href="#cb121-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-626"><a href="#cb121-626" aria-hidden="true" tabindex="-1"></a><span class="fu"># In situ vs. Tf relative changes</span></span>
<span id="cb121-627"><a href="#cb121-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-628"><a href="#cb121-628" aria-hidden="true" tabindex="-1"></a><span class="fu"># Corncob enriched taxa</span></span>
<span id="cb121-629"><a href="#cb121-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-630"><a href="#cb121-630" aria-hidden="true" tabindex="-1"></a>Corncob analysis can be used to identify specific ASVs that may be enriched when we compare non-vent to vent samples.</span>
<span id="cb121-631"><a href="#cb121-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-632"><a href="#cb121-632" aria-hidden="true" tabindex="-1"></a>Questions:</span>
<span id="cb121-633"><a href="#cb121-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-634"><a href="#cb121-634" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at Piccard?</span>
<span id="cb121-635"><a href="#cb121-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-636"><a href="#cb121-636" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at Von Damm?</span>
<span id="cb121-637"><a href="#cb121-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-638"><a href="#cb121-638" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For vent vs. non-vent ASVs, what ASVs are enriched at both sites?</span>
<span id="cb121-639"><a href="#cb121-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-642"><a href="#cb121-642" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-643"><a href="#cb121-643" aria-hidden="true" tabindex="-1"></a><span class="co"># | message: false</span></span>
<span id="cb121-644"><a href="#cb121-644" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("bryandmartin/corncob")</span></span>
<span id="cb121-645"><a href="#cb121-645" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corncob); <span class="fu">library</span>(phyloseq)</span>
<span id="cb121-646"><a href="#cb121-646" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-647"><a href="#cb121-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-650"><a href="#cb121-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-651"><a href="#cb121-651" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"input-data/MCR-amplicon-data.RData"</span>, <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-652"><a href="#cb121-652" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-653"><a href="#cb121-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-654"><a href="#cb121-654" aria-hidden="true" tabindex="-1"></a>Explore data input for corncob</span>
<span id="cb121-655"><a href="#cb121-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-658"><a href="#cb121-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-659"><a href="#cb121-659" aria-hidden="true" tabindex="-1"></a><span class="co"># otu_table(physeq_mcr)[1:10, 1:3]</span></span>
<span id="cb121-660"><a href="#cb121-660" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(physeq_mcr)</span></span>
<span id="cb121-661"><a href="#cb121-661" aria-hidden="true" tabindex="-1"></a><span class="co"># tax_table(physeq_mcr)[1:3, ]</span></span>
<span id="cb121-662"><a href="#cb121-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-663"><a href="#cb121-663" aria-hidden="true" tabindex="-1"></a><span class="co"># Designated vent vs. non-vent</span></span>
<span id="cb121-664"><a href="#cb121-664" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SAMPLETYPE_BIN)</span>
<span id="cb121-665"><a href="#cb121-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-666"><a href="#cb121-666" aria-hidden="true" tabindex="-1"></a><span class="co">#Designats Piccard vs. vondamm.</span></span>
<span id="cb121-667"><a href="#cb121-667" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(<span class="fu">sample_data</span>(physeq_mcr)<span class="sc">$</span>SITE)</span>
<span id="cb121-668"><a href="#cb121-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-669"><a href="#cb121-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-670"><a href="#cb121-670" aria-hidden="true" tabindex="-1"></a>Start by removing incubation samples for now. Subset to eukaryotes only and use phyloseq's tax glom to summarize to Supergroup, Phylum, Class, Order, Genus, &amp; species.</span>
<span id="cb121-671"><a href="#cb121-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-674"><a href="#cb121-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-675"><a href="#cb121-675" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tax_table</span>(physeq_mcr))</span>
<span id="cb121-676"><a href="#cb121-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-677"><a href="#cb121-677" aria-hidden="true" tabindex="-1"></a>mcr_super <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span></span>
<span id="cb121-678"><a href="#cb121-678" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb121-679"><a href="#cb121-679" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-680"><a href="#cb121-680" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Supergroup"</span>)</span>
<span id="cb121-681"><a href="#cb121-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-682"><a href="#cb121-682" aria-hidden="true" tabindex="-1"></a>mcr_phy <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb121-683"><a href="#cb121-683" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-684"><a href="#cb121-684" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-685"><a href="#cb121-685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Phylum"</span>)</span>
<span id="cb121-686"><a href="#cb121-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-687"><a href="#cb121-687" aria-hidden="true" tabindex="-1"></a>mcr_class <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb121-688"><a href="#cb121-688" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-689"><a href="#cb121-689" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-690"><a href="#cb121-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Class"</span>)</span>
<span id="cb121-691"><a href="#cb121-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-692"><a href="#cb121-692" aria-hidden="true" tabindex="-1"></a>mcr_order <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb121-693"><a href="#cb121-693" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-694"><a href="#cb121-694" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-695"><a href="#cb121-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Order"</span>)</span>
<span id="cb121-696"><a href="#cb121-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-697"><a href="#cb121-697" aria-hidden="true" tabindex="-1"></a>mcr_fam <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb121-698"><a href="#cb121-698" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-699"><a href="#cb121-699" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-700"><a href="#cb121-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Family"</span>)</span>
<span id="cb121-701"><a href="#cb121-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-702"><a href="#cb121-702" aria-hidden="true" tabindex="-1"></a>mcr_genera <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb121-703"><a href="#cb121-703" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-704"><a href="#cb121-704" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-705"><a href="#cb121-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Genus"</span>)</span>
<span id="cb121-706"><a href="#cb121-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-707"><a href="#cb121-707" aria-hidden="true" tabindex="-1"></a>mcr_spp <span class="ot">&lt;-</span> physeq_mcr <span class="sc">%&gt;%</span> </span>
<span id="cb121-708"><a href="#cb121-708" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SAMPLETYPE <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Background"</span>, <span class="st">"Plume"</span>, <span class="st">"Vent"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-709"><a href="#cb121-709" aria-hidden="true" tabindex="-1"></a>  phyloseq<span class="sc">::</span><span class="fu">subset_taxa</span>(Domain <span class="sc">==</span> <span class="st">"Eukaryota"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-710"><a href="#cb121-710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tax_glom</span>(<span class="st">"Species"</span>)</span>
<span id="cb121-711"><a href="#cb121-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-712"><a href="#cb121-712" aria-hidden="true" tabindex="-1"></a><span class="co"># sample_data(mcr_order)</span></span>
<span id="cb121-713"><a href="#cb121-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-714"><a href="#cb121-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-715"><a href="#cb121-715" aria-hidden="true" tabindex="-1"></a>Differential tests in corncob</span>
<span id="cb121-716"><a href="#cb121-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-717"><a href="#cb121-717" aria-hidden="true" tabindex="-1"></a>These tests work to see if taxa are differentially-abundant or variable across a given variable. In this study we have different taxonomic levels, are there more general or species-specific trends? We also have across sample types and site Below set up differential tests across sample types and site (and either or) at different taxonomic levels.</span>
<span id="cb121-718"><a href="#cb121-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-719"><a href="#cb121-719" aria-hidden="true" tabindex="-1"></a>Function to perform specific differential tests across vent fields. Below use **SITE_PICK** parameter to choose between vent fields. Then use the df, to specify the taxonomic level.</span>
<span id="cb121-720"><a href="#cb121-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-723"><a href="#cb121-723" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-724"><a href="#cb121-724" aria-hidden="true" tabindex="-1"></a>corncob_mcr <span class="ot">&lt;-</span> <span class="cf">function</span>(df_in){</span>
<span id="cb121-725"><a href="#cb121-725" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb121-726"><a href="#cb121-726" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SAMPLETYPE+ SITE,</span></span>
<span id="cb121-727"><a href="#cb121-727" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb121-728"><a href="#cb121-728" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SAMPLETYPE + SITE,</span></span>
<span id="cb121-729"><a href="#cb121-729" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb121-730"><a href="#cb121-730" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb121-731"><a href="#cb121-731" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb121-732"><a href="#cb121-732" aria-hidden="true" tabindex="-1"></a>  <span class="do">## SAMPLETYPE_BIN specifically compares vent to non-vent.</span></span>
<span id="cb121-733"><a href="#cb121-733" aria-hidden="true" tabindex="-1"></a>  da_analysis_output <span class="ot">&lt;-</span> <span class="fu">differentialTest</span>(<span class="at">formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb121-734"><a href="#cb121-734" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb121-735"><a href="#cb121-735" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula_null =</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb121-736"><a href="#cb121-736" aria-hidden="true" tabindex="-1"></a>                                <span class="at">phi.formula_null =</span> <span class="sc">~</span> SAMPLETYPE_BIN,</span>
<span id="cb121-737"><a href="#cb121-737" aria-hidden="true" tabindex="-1"></a>                                <span class="at">test =</span> <span class="st">"Wald"</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb121-738"><a href="#cb121-738" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> df_in,</span>
<span id="cb121-739"><a href="#cb121-739" aria-hidden="true" tabindex="-1"></a>                                <span class="at">fdr_cutoff =</span> <span class="fl">0.05</span>)</span>
<span id="cb121-740"><a href="#cb121-740" aria-hidden="true" tabindex="-1"></a>  <span class="co"># da_analysis_output &lt;- differentialTest(formula = ~ SITE,</span></span>
<span id="cb121-741"><a href="#cb121-741" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula = ~ SITE,</span></span>
<span id="cb121-742"><a href="#cb121-742" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               formula_null = ~ 1,</span></span>
<span id="cb121-743"><a href="#cb121-743" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               phi.formula_null = ~ SITE,</span></span>
<span id="cb121-744"><a href="#cb121-744" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               test = "Wald", boot = FALSE,</span></span>
<span id="cb121-745"><a href="#cb121-745" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               data = df_in,</span></span>
<span id="cb121-746"><a href="#cb121-746" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                               fdr_cutoff = 0.05)</span></span>
<span id="cb121-747"><a href="#cb121-747" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb121-748"><a href="#cb121-748" aria-hidden="true" tabindex="-1"></a>  list_ofsig <span class="ot">&lt;-</span> <span class="fu">as.character</span>(da_analysis_output<span class="sc">$</span>significant_taxa)</span>
<span id="cb121-749"><a href="#cb121-749" aria-hidden="true" tabindex="-1"></a>  total_number <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ofsig)[<span class="dv">1</span>]</span>
<span id="cb121-750"><a href="#cb121-750" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb121-751"><a href="#cb121-751" aria-hidden="true" tabindex="-1"></a>  sig_taxa_names <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">tax_table</span>(df_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-752"><a href="#cb121-752" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"FEATURE"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-753"><a href="#cb121-753" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(FEATURE <span class="sc">%in%</span> list_ofsig) <span class="sc">%&gt;%</span> </span>
<span id="cb121-754"><a href="#cb121-754" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"NUMBER"</span>)</span>
<span id="cb121-755"><a href="#cb121-755" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb121-756"><a href="#cb121-756" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>total_number){</span>
<span id="cb121-757"><a href="#cb121-757" aria-hidden="true" tabindex="-1"></a>    out_0 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(da_analysis_output<span class="sc">$</span>significant_models[[var]]<span class="sc">$</span>coefficients) <span class="sc">%&gt;%</span> </span>
<span id="cb121-758"><a href="#cb121-758" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">NUMBER =</span> <span class="fu">as.character</span>(var))</span>
<span id="cb121-759"><a href="#cb121-759" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"extracted # "</span>,var, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb121-760"><a href="#cb121-760" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">"extracted_coef"</span>)){</span>
<span id="cb121-761"><a href="#cb121-761" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> out_0 <span class="co"># create the final count table</span></span>
<span id="cb121-762"><a href="#cb121-762" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb121-763"><a href="#cb121-763" aria-hidden="true" tabindex="-1"></a>        extracted_coef <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extracted_coef, out_0)</span>
<span id="cb121-764"><a href="#cb121-764" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb121-765"><a href="#cb121-765" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(out_0) <span class="co"># remove excess df</span></span>
<span id="cb121-766"><a href="#cb121-766" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb121-767"><a href="#cb121-767" aria-hidden="true" tabindex="-1"></a>  output_full <span class="ot">&lt;-</span> extracted_coef <span class="sc">%&gt;%</span> </span>
<span id="cb121-768"><a href="#cb121-768" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"variable"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-769"><a href="#cb121-769" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"mu."</span>, variable)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-770"><a href="#cb121-770" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sig_taxa_names, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NUMBER"</span> <span class="ot">=</span> <span class="st">"NUMBER"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-771"><a href="#cb121-771" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">VARIABLE =</span> <span class="fu">str_remove</span>(variable, <span class="st">"[:digit:]+"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>variable) <span class="co">#%&gt;% </span></span>
<span id="cb121-772"><a href="#cb121-772" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pivot_wider(names_from = VARIABLE, names_glue = "{VARIABLE}_{.value}", values_from = c(Estimate, Std..Error, t.value, Pr...t..))</span></span>
<span id="cb121-773"><a href="#cb121-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(extracted_coef)</span>
<span id="cb121-774"><a href="#cb121-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output_full)}</span>
<span id="cb121-775"><a href="#cb121-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-776"><a href="#cb121-776" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-777"><a href="#cb121-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-778"><a href="#cb121-778" aria-hidden="true" tabindex="-1"></a>Define SITE_PICK</span>
<span id="cb121-779"><a href="#cb121-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-782"><a href="#cb121-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-783"><a href="#cb121-783" aria-hidden="true" tabindex="-1"></a>mcr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>, <span class="st">"VonDamm"</span>)</span>
<span id="cb121-784"><a href="#cb121-784" aria-hidden="true" tabindex="-1"></a>picc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Piccard"</span>)</span>
<span id="cb121-785"><a href="#cb121-785" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VonDamm"</span>)</span>
<span id="cb121-786"><a href="#cb121-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-787"><a href="#cb121-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-788"><a href="#cb121-788" aria-hidden="true" tabindex="-1"></a>Function to visualize output from corncob</span>
<span id="cb121-789"><a href="#cb121-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-792"><a href="#cb121-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-793"><a href="#cb121-793" aria-hidden="true" tabindex="-1"></a>plot_corn <span class="ot">&lt;-</span> <span class="cf">function</span>(cob_out, LEVEL, TITLE){</span>
<span id="cb121-794"><a href="#cb121-794" aria-hidden="true" tabindex="-1"></a>  level <span class="ot">&lt;-</span> <span class="fu">enquo</span>(LEVEL)</span>
<span id="cb121-795"><a href="#cb121-795" aria-hidden="true" tabindex="-1"></a>  cob_out <span class="sc">%&gt;%</span></span>
<span id="cb121-796"><a href="#cb121-796" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-797"><a href="#cb121-797" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> level, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb121-798"><a href="#cb121-798" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-799"><a href="#cb121-799" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-800"><a href="#cb121-800" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> level), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-801"><a href="#cb121-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-802"><a href="#cb121-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-803"><a href="#cb121-803" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb121-804"><a href="#cb121-804" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-805"><a href="#cb121-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> TITLE)</span>
<span id="cb121-806"><a href="#cb121-806" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb121-807"><a href="#cb121-807" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-808"><a href="#cb121-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-809"><a href="#cb121-809" aria-hidden="true" tabindex="-1"></a><span class="fu">### Supergroup corncob</span></span>
<span id="cb121-810"><a href="#cb121-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-811"><a href="#cb121-811" aria-hidden="true" tabindex="-1"></a>What main supergroups are enriched at MCR?</span>
<span id="cb121-812"><a href="#cb121-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-815"><a href="#cb121-815" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-816"><a href="#cb121-816" aria-hidden="true" tabindex="-1"></a><span class="co"># # vd</span></span>
<span id="cb121-817"><a href="#cb121-817" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb121-818"><a href="#cb121-818" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% vd))</span></span>
<span id="cb121-819"><a href="#cb121-819" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb121-820"><a href="#cb121-820" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc &lt;- corncob_mcr(mcr_super %&gt;% </span></span>
<span id="cb121-821"><a href="#cb121-821" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 phyloseq::subset_samples(SITE %in% picc))</span></span>
<span id="cb121-822"><a href="#cb121-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-823"><a href="#cb121-823" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_super <span class="sc">%&gt;%</span> </span>
<span id="cb121-824"><a href="#cb121-824" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span>
<span id="cb121-825"><a href="#cb121-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-826"><a href="#cb121-826" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_vd %&gt;%</span></span>
<span id="cb121-827"><a href="#cb121-827" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb121-828"><a href="#cb121-828" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb121-829"><a href="#cb121-829" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb121-830"><a href="#cb121-830" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb121-831"><a href="#cb121-831" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb121-832"><a href="#cb121-832" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb121-833"><a href="#cb121-833" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb121-834"><a href="#cb121-834" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb121-835"><a href="#cb121-835" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb121-836"><a href="#cb121-836" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "VD supergroup")</span></span>
<span id="cb121-837"><a href="#cb121-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-838"><a href="#cb121-838" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis_super_picc %&gt;%</span></span>
<span id="cb121-839"><a href="#cb121-839" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(VARIABLE != "mu.(Intercept)") %&gt;% </span></span>
<span id="cb121-840"><a href="#cb121-840" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(y = Supergroup, x = Estimate)) +</span></span>
<span id="cb121-841"><a href="#cb121-841" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_vline(xintercept = 0, alpha = 0.2) +</span></span>
<span id="cb121-842"><a href="#cb121-842" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_errorbar(aes(xmin = (Estimate-Std..Error), xmax = (Estimate+Std..Error)), width = 0.2) +</span></span>
<span id="cb121-843"><a href="#cb121-843" aria-hidden="true" tabindex="-1"></a><span class="co">#     geom_point(aes(fill = Supergroup), shape = 21, color = "black") +</span></span>
<span id="cb121-844"><a href="#cb121-844" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_grid(. ~ VARIABLE, space = "free", scales = "free") +</span></span>
<span id="cb121-845"><a href="#cb121-845" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = element_blank(),</span></span>
<span id="cb121-846"><a href="#cb121-846" aria-hidden="true" tabindex="-1"></a><span class="co">#         axis.text.y = element_text(color = "black")) +</span></span>
<span id="cb121-847"><a href="#cb121-847" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb121-848"><a href="#cb121-848" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Coefficient", y = "", title = "piccard supergroup")</span></span>
<span id="cb121-849"><a href="#cb121-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-850"><a href="#cb121-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-851"><a href="#cb121-851" aria-hidden="true" tabindex="-1"></a>Plot supergroup enrichment</span>
<span id="cb121-852"><a href="#cb121-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-855"><a href="#cb121-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-856"><a href="#cb121-856" aria-hidden="true" tabindex="-1"></a>analysis_super_all <span class="sc">%&gt;%</span></span>
<span id="cb121-857"><a href="#cb121-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-858"><a href="#cb121-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Supergroup, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb121-859"><a href="#cb121-859" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-860"><a href="#cb121-860" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-861"><a href="#cb121-861" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-862"><a href="#cb121-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-863"><a href="#cb121-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-864"><a href="#cb121-864" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb121-865"><a href="#cb121-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-866"><a href="#cb121-866" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR supergroup"</span>)</span>
<span id="cb121-867"><a href="#cb121-867" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-868"><a href="#cb121-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-869"><a href="#cb121-869" aria-hidden="true" tabindex="-1"></a><span class="fu">### Phylum corncob analysis</span></span>
<span id="cb121-870"><a href="#cb121-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-873"><a href="#cb121-873" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-874"><a href="#cb121-874" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_phy)</span>
<span id="cb121-875"><a href="#cb121-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-876"><a href="#cb121-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-879"><a href="#cb121-879" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-880"><a href="#cb121-880" aria-hidden="true" tabindex="-1"></a>analysis_phylum <span class="sc">%&gt;%</span></span>
<span id="cb121-881"><a href="#cb121-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-882"><a href="#cb121-882" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Phylum, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb121-883"><a href="#cb121-883" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-884"><a href="#cb121-884" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-885"><a href="#cb121-885" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Phylum), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-886"><a href="#cb121-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-887"><a href="#cb121-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-888"><a href="#cb121-888" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb121-889"><a href="#cb121-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-890"><a href="#cb121-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"MCR Phylum"</span>)</span>
<span id="cb121-891"><a href="#cb121-891" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-892"><a href="#cb121-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-893"><a href="#cb121-893" aria-hidden="true" tabindex="-1"></a><span class="fu">### Class corncob analysis</span></span>
<span id="cb121-894"><a href="#cb121-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-897"><a href="#cb121-897" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-898"><a href="#cb121-898" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_class <span class="sc">%&gt;%</span></span>
<span id="cb121-899"><a href="#cb121-899" aria-hidden="true" tabindex="-1"></a>                                phyloseq<span class="sc">::</span><span class="fu">subset_samples</span>(SITE <span class="sc">%in%</span> mcr))</span>
<span id="cb121-900"><a href="#cb121-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-901"><a href="#cb121-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-902"><a href="#cb121-902" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb121-903"><a href="#cb121-903" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb121-904"><a href="#cb121-904" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb121-905"><a href="#cb121-905" aria-hidden="true" tabindex="-1"></a>analysis_class <span class="sc">%&gt;%</span></span>
<span id="cb121-906"><a href="#cb121-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Class, <span class="fu">c</span>(Phylum, Class), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-907"><a href="#cb121-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb121-908"><a href="#cb121-908" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Class, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb121-909"><a href="#cb121-909" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-910"><a href="#cb121-910" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-911"><a href="#cb121-911" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-912"><a href="#cb121-912" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-913"><a href="#cb121-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-914"><a href="#cb121-914" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb121-915"><a href="#cb121-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-916"><a href="#cb121-916" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Class level test for differential abundance"</span>)</span>
<span id="cb121-917"><a href="#cb121-917" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-918"><a href="#cb121-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-919"><a href="#cb121-919" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Class level looks pretty good. Keep this one. Looks at major taxonomic groups that were more enriched at vents? Work on the language here. Repeat vent vs. plume at ASV level. ID some of the core ASVs that can help elaborate on what we see above (table in supplementary)</span></span>
<span id="cb121-920"><a href="#cb121-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-921"><a href="#cb121-921" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; *Interpretation* :</span></span>
<span id="cb121-922"><a href="#cb121-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-923"><a href="#cb121-923" aria-hidden="true" tabindex="-1"></a><span class="fu">### Order corncob</span></span>
<span id="cb121-924"><a href="#cb121-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-927"><a href="#cb121-927" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-928"><a href="#cb121-928" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_order)</span>
<span id="cb121-929"><a href="#cb121-929" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-930"><a href="#cb121-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-931"><a href="#cb121-931" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb121-932"><a href="#cb121-932" aria-hidden="true" tabindex="-1"></a><span class="co"># head(analysis_class)</span></span>
<span id="cb121-933"><a href="#cb121-933" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(analysis_class$VARIABLE)</span></span>
<span id="cb121-934"><a href="#cb121-934" aria-hidden="true" tabindex="-1"></a>analysis_order <span class="sc">%&gt;%</span></span>
<span id="cb121-935"><a href="#cb121-935" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Order, <span class="fu">c</span>(Phylum, Class, Order), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-936"><a href="#cb121-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-937"><a href="#cb121-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Order, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb121-938"><a href="#cb121-938" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-939"><a href="#cb121-939" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-940"><a href="#cb121-940" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-941"><a href="#cb121-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-942"><a href="#cb121-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-943"><a href="#cb121-943" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb121-944"><a href="#cb121-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-945"><a href="#cb121-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Order level test for differential abundance"</span>)</span>
<span id="cb121-946"><a href="#cb121-946" aria-hidden="true" tabindex="-1"></a><span class="co"># ?geom_errorbar</span></span>
<span id="cb121-947"><a href="#cb121-947" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-948"><a href="#cb121-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-949"><a href="#cb121-949" aria-hidden="true" tabindex="-1"></a><span class="fu">### Family corncob</span></span>
<span id="cb121-950"><a href="#cb121-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-951"><a href="#cb121-951" aria-hidden="true" tabindex="-1"></a>Plan to pairing with tree below</span>
<span id="cb121-952"><a href="#cb121-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-955"><a href="#cb121-955" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-956"><a href="#cb121-956" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_fam)</span>
<span id="cb121-957"><a href="#cb121-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-958"><a href="#cb121-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-961"><a href="#cb121-961" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-962"><a href="#cb121-962" aria-hidden="true" tabindex="-1"></a>analysis_fam <span class="sc">%&gt;%</span></span>
<span id="cb121-963"><a href="#cb121-963" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Family, <span class="fu">c</span>(Class, Order, Family), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-964"><a href="#cb121-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-965"><a href="#cb121-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Family, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb121-966"><a href="#cb121-966" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-967"><a href="#cb121-967" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-968"><a href="#cb121-968" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-969"><a href="#cb121-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Phylum <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-970"><a href="#cb121-970" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-971"><a href="#cb121-971" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb121-972"><a href="#cb121-972" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-973"><a href="#cb121-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Family level test for differential abundance"</span>)</span>
<span id="cb121-974"><a href="#cb121-974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-975"><a href="#cb121-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-976"><a href="#cb121-976" aria-hidden="true" tabindex="-1"></a><span class="fu">### Genus corncob</span></span>
<span id="cb121-977"><a href="#cb121-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-978"><a href="#cb121-978" aria-hidden="true" tabindex="-1"></a>Plan to pairing with tree below</span>
<span id="cb121-979"><a href="#cb121-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-982"><a href="#cb121-982" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-983"><a href="#cb121-983" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_genera)</span>
<span id="cb121-984"><a href="#cb121-984" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-985"><a href="#cb121-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-988"><a href="#cb121-988" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-989"><a href="#cb121-989" aria-hidden="true" tabindex="-1"></a>analysis_genus <span class="sc">%&gt;%</span></span>
<span id="cb121-990"><a href="#cb121-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Genus, <span class="fu">c</span>(Phylum, Genus), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-991"><a href="#cb121-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-992"><a href="#cb121-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Genus, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb121-993"><a href="#cb121-993" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-994"><a href="#cb121-994" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-995"><a href="#cb121-995" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-996"><a href="#cb121-996" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-997"><a href="#cb121-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-998"><a href="#cb121-998" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb121-999"><a href="#cb121-999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-1000"><a href="#cb121-1000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Genus level test for differential abundance"</span>)</span>
<span id="cb121-1001"><a href="#cb121-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1002"><a href="#cb121-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1003"><a href="#cb121-1003" aria-hidden="true" tabindex="-1"></a><span class="fu">### Species corncob</span></span>
<span id="cb121-1004"><a href="#cb121-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1007"><a href="#cb121-1007" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1008"><a href="#cb121-1008" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="ot">&lt;-</span> <span class="fu">corncob_mcr</span>(mcr_spp)</span>
<span id="cb121-1009"><a href="#cb121-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1010"><a href="#cb121-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1011"><a href="#cb121-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=10, fig.width=10}</span></span>
<span id="cb121-1012"><a href="#cb121-1012" aria-hidden="true" tabindex="-1"></a>analysis_spp <span class="sc">%&gt;%</span></span>
<span id="cb121-1013"><a href="#cb121-1013" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(Species, <span class="fu">c</span>(Genus, Species), <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-1014"><a href="#cb121-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(VARIABLE <span class="sc">!=</span> <span class="st">"mu.(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-1015"><a href="#cb121-1015" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> Species, <span class="at">x =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb121-1016"><a href="#cb121-1016" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-1017"><a href="#cb121-1017" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> (Estimate<span class="sc">-</span>Std..Error), <span class="at">xmax =</span> (Estimate<span class="sc">+</span>Std..Error)), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb121-1018"><a href="#cb121-1018" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Supergroup), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb121-1019"><a href="#cb121-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Supergroup <span class="sc">+</span> Order <span class="sc">~</span> VARIABLE, <span class="at">space =</span> <span class="st">"free"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb121-1020"><a href="#cb121-1020" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb121-1021"><a href="#cb121-1021" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>)) <span class="sc">+</span></span>
<span id="cb121-1022"><a href="#cb121-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb121-1023"><a href="#cb121-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Coefficient"</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">title =</span> <span class="st">"Species level test for differential abundance"</span>)</span>
<span id="cb121-1024"><a href="#cb121-1024" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1025"><a href="#cb121-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1026"><a href="#cb121-1026" aria-hidden="true" tabindex="-1"></a><span class="fu"># Corncob + P/A info</span></span>
<span id="cb121-1027"><a href="#cb121-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1028"><a href="#cb121-1028" aria-hidden="true" tabindex="-1"></a>Which ASVs were enriched within vent site, and also found in grazing experiments?</span>
<span id="cb121-1029"><a href="#cb121-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1030"><a href="#cb121-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1031"><a href="#cb121-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1032"><a href="#cb121-1032" aria-hidden="true" tabindex="-1"></a><span class="fu"># Info</span></span>
<span id="cb121-1035"><a href="#cb121-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1036"><a href="#cb121-1036" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span>
<span id="cb121-1037"><a href="#cb121-1037" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1038"><a href="#cb121-1038" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>